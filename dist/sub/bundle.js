!function(e){function t(e){var t=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",r.src=f.p+""+e+"."+_+".hot-update.js",t.appendChild(r)}function r(e){if("undefined"==typeof XMLHttpRequest)return e(new Error("No browser support"));try{var t=new XMLHttpRequest,r=f.p+""+_+".hot-update.json";t.open("GET",r,!0),t.timeout=1e4,t.send(null)}catch(n){return e(n)}t.onreadystatechange=function(){if(4===t.readyState)if(0===t.status)e(new Error("Manifest request to "+r+" timed out."));else if(404===t.status)e();else if(200!==t.status&&304!==t.status)e(new Error("Manifest request to "+r+" failed."));else{try{var n=JSON.parse(t.responseText)}catch(i){return void e(i)}e(null,n)}}}function n(e){var t=w[e];if(!t)return f;var r=function(r){return t.hot.active?w[r]?(w[r].parents.indexOf(e)<0&&w[r].parents.push(e),t.children.indexOf(r)<0&&t.children.push(r)):x=[e]:(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),x=[]),f(r)};for(var n in f)Object.prototype.hasOwnProperty.call(f,n)&&(r[n]=f[n]);return r.e=function(e,t){"ready"===S&&o("prepare"),M++,f.e(e,function(){function n(){M--,"prepare"===S&&(T[e]||c(e),0===M&&0===E&&l())}try{t.call(null,r)}finally{n()}})},r}function i(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],active:!0,accept:function(e,r){if("undefined"==typeof e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._acceptedDependencies[e[n]]=r;else t._acceptedDependencies[e]=r},decline:function(e){if("undefined"==typeof e)t._selfDeclined=!0;else if("number"==typeof e)t._declinedDependencies[e]=!0;else for(var r=0;r<e.length;r++)t._declinedDependencies[e[r]]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var r=t._disposeHandlers.indexOf(e);r>=0&&t._disposeHandlers.splice(r,1)},check:a,apply:h,status:function(e){return e?void b.push(e):S},addStatusHandler:function(e){b.push(e)},removeStatusHandler:function(e){var t=b.indexOf(e);t>=0&&b.splice(t,1)},data:y[e]};return t}function o(e){S=e;for(var t=0;t<b.length;t++)b[t].call(null,e)}function s(e){var t=+e+""===e;return t?+e:e}function a(e,t){if("idle"!==S)throw new Error("check() is only allowed in idle status");"function"==typeof e?(v=!1,t=e):(v=e,t=t||function(e){if(e)throw e}),o("check"),r(function(e,r){if(e)return t(e);if(!r)return o("idle"),void t(null,null);P={},C={},T={};for(var n=0;n<r.c.length;n++)C[r.c[n]]=!0;g=r.h,o("prepare"),p=t,m={};var i=0;c(i),"prepare"===S&&0===M&&0===E&&l()})}function u(e,t){if(C[e]&&P[e]){P[e]=!1;for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(m[r]=t[r]);0===--E&&0===M&&l()}}function c(e){C[e]?(P[e]=!0,E++,t(e)):T[e]=!0}function l(){o("ready");var e=p;if(p=null,e)if(v)h(v,e);else{var t=[];for(var r in m)Object.prototype.hasOwnProperty.call(m,r)&&t.push(s(r));e(null,t)}}function h(t,r){function n(e){for(var t=[e],r={},n=t.slice();n.length>0;){var o=n.pop(),e=w[o];if(e&&!e.hot._selfAccepted){if(e.hot._selfDeclined)return new Error("Aborted because of self decline: "+o);if(0===o)return;for(var s=0;s<e.parents.length;s++){var a=e.parents[s],u=w[a];if(u.hot._declinedDependencies[o])return new Error("Aborted because of declined dependency: "+o+" in "+a);t.indexOf(a)>=0||(u.hot._acceptedDependencies[o]?(r[a]||(r[a]=[]),i(r[a],[o])):(delete r[a],t.push(a),n.push(a)))}}}return[t,r]}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];e.indexOf(n)<0&&e.push(n)}}if("ready"!==S)throw new Error("apply() is only allowed in ready status");"function"==typeof t?(r=t,t={}):t&&"object"==typeof t?r=r||function(e){if(e)throw e}:(t={},r=r||function(e){if(e)throw e});var a={},u=[],c={};for(var l in m)if(Object.prototype.hasOwnProperty.call(m,l)){var h=s(l),d=n(h);if(!d){if(t.ignoreUnaccepted)continue;return o("abort"),r(new Error("Aborted because "+h+" is not accepted"))}if(d instanceof Error)return o("abort"),r(d);c[h]=m[h],i(u,d[0]);for(var h in d[1])Object.prototype.hasOwnProperty.call(d[1],h)&&(a[h]||(a[h]=[]),i(a[h],d[1][h]))}for(var p=[],v=0;v<u.length;v++){var h=u[v];w[h]&&w[h].hot._selfAccepted&&p.push({module:h,errorHandler:w[h].hot._selfAccepted})}o("dispose");for(var b=u.slice();b.length>0;){var h=b.pop(),E=w[h];if(E){for(var M={},T=E.hot._disposeHandlers,P=0;P<T.length;P++){var C=T[P];C(M)}y[h]=M,E.hot.active=!1,delete w[h];for(var P=0;P<E.children.length;P++){var A=w[E.children[P]];if(A){var D=A.parents.indexOf(h);D>=0&&A.parents.splice(D,1)}}}}for(var h in a)if(Object.prototype.hasOwnProperty.call(a,h))for(var E=w[h],I=a[h],P=0;P<I.length;P++){var R=I[P],D=E.children.indexOf(R);D>=0&&E.children.splice(D,1)}o("apply"),_=g;for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(e[h]=c[h]);var O=null;for(var h in a)if(Object.prototype.hasOwnProperty.call(a,h)){for(var E=w[h],I=a[h],L=[],v=0;v<I.length;v++){var R=I[v],C=E.hot._acceptedDependencies[R];L.indexOf(C)>=0||L.push(C)}for(var v=0;v<L.length;v++){var C=L[v];try{C(a)}catch(F){O||(O=F)}}}for(var v=0;v<p.length;v++){var V=p[v],h=V.module;x=[h];try{f(h)}catch(F){if("function"==typeof V.errorHandler)try{V.errorHandler(F)}catch(F){O||(O=F)}else O||(O=F)}}return O?(o("fail"),r(O)):(o("idle"),void r(null,u))}function f(t){if(w[t])return w[t].exports;var r=w[t]={exports:{},id:t,loaded:!1,hot:i(t),parents:x,children:[]};return e[t].call(r.exports,r,r.exports,n(t)),r.loaded=!0,r.exports}var d=this.webpackHotUpdate;this.webpackHotUpdate=function(e,t){u(e,t),d&&d(e,t)};var p,m,g,v=!0,_="dea28a535920bea3479f",y={},x=[],b=[],S="idle",E=0,M=0,T={},P={},C={},w={};return f.m=e,f.c=w,f.p="/static/",f.h=function(){return _},n(0)(0)}([function(e,t,r){r(520),e.exports=r(231)},function(e,t,r){var n=r(10),i=r(34),o=r(29),s=r(24),a=r(27),u="prototype",c=function(e,t,r){var l,h,f,d,p=e&c.F,m=e&c.G,g=e&c.S,v=e&c.P,_=e&c.B,y=m?n:g?n[t]||(n[t]={}):(n[t]||{})[u],x=m?i:i[t]||(i[t]={}),b=x[u]||(x[u]={});m&&(r=t);for(l in r)h=!p&&y&&l in y,f=(h?y:r)[l],d=_&&h?a(f,n):v&&"function"==typeof f?a(Function.call,f):f,y&&!h&&s(y,l,f),x[l]!=f&&o(x,l,d),v&&b[l]!=f&&(b[l]=f)};n.core=i,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,e.exports=c},function(e,t,r){"use strict";function n(e,t,r,n,i,o,s,a){if(!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,n,i,o,s,a],l=0;u=new Error(t.replace(/%s/g,function(){return c[l++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}}e.exports=n},function(e,t){var r=Object;e.exports={create:r.create,getProto:r.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:r.getOwnPropertyDescriptor,setDesc:r.defineProperty,setDescs:r.defineProperties,getKeys:r.keys,getNames:r.getOwnPropertyNames,getSymbols:r.getOwnPropertySymbols,each:[].forEach}},function(e,t,r){"use strict";var n=r(26),i=n;e.exports=i},function(e,t){"use strict";function r(e,t){if(null==e)throw new TypeError("Object.assign target cannot be null or undefined");for(var r=Object(e),n=Object.prototype.hasOwnProperty,i=1;i<arguments.length;i++){var o=arguments[i];if(null!=o){var s=Object(o);for(var a in s)n.call(s,a)&&(r[a]=s[a])}}return r}e.exports=r},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){"use strict";e.exports=r(457)},function(e,t,r){var n=r(6);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){var n=r(156)("wks"),i=r(49),o=r(10).Symbol;e.exports=function(e){return n[e]||(n[e]=o&&o[e]||(o||i)("Symbol."+e))}},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t){"use strict";var r=!("undefined"==typeof window||!window.document||!window.document.createElement),n={canUseDOM:r,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:r&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:r&&!!window.screen,isInWorker:!r};e.exports=n},function(e,t,r){"use strict";function n(e,t){for(var r=Math.min(e.length,t.length),n=0;r>n;n++)if(e.charAt(n)!==t.charAt(n))return n;return e.length===t.length?-1:r}function i(e){return e?e.nodeType===W?e.documentElement:e.firstChild:null}function o(e){var t=i(e);return t&&Z.getID(t)}function s(e){var t=a(e);if(t)if(U.hasOwnProperty(t)){var r=U[t];r!==e&&(h(r,t)?V(!1):void 0,U[t]=e)}else U[t]=e;return t}function a(e){return e&&e.getAttribute&&e.getAttribute(N)||""}function u(e,t){var r=a(e);r!==t&&delete U[r],e.setAttribute(N,t),U[t]=e}function c(e){return U.hasOwnProperty(e)&&h(U[e],e)||(U[e]=Z.findReactNodeByID(e)),U[e]}function l(e){var t=P.get(e)._rootNodeID;return M.isNullComponentID(t)?null:(U.hasOwnProperty(t)&&h(U[t],t)||(U[t]=Z.findReactNodeByID(t)),U[t])}function h(e,t){if(e){a(e)!==t?V(!1):void 0;var r=Z.findReactContainerForID(t);if(r&&L(r,e))return!0}return!1}function f(e){delete U[e]}function d(e){var t=U[e];return t&&h(t,e)?void(Y=t):!1}function p(e){Y=null,T.traverseAncestors(e,d);var t=Y;return Y=null,t}function m(e,t,r,n,i,o){S.useCreateElement&&(o=R({},o),r.nodeType===W?o[G]=r:o[G]=r.ownerDocument);var s=A.mountComponent(e,t,n,o);e._renderedComponent._topLevelWrapper=e,Z._mountImageIntoNode(s,r,i,n)}function g(e,t,r,n,i){var o=I.ReactReconcileTransaction.getPooled(n);o.perform(m,null,e,t,r,o,n,i),I.ReactReconcileTransaction.release(o)}function v(e,t){for(A.unmountComponent(e),t.nodeType===W&&(t=t.documentElement);t.lastChild;)t.removeChild(t.lastChild)}function _(e){var t=o(e);return t?t!==T.getReactRootIDFromNodeID(t):!1}function y(e){for(;e&&e.parentNode!==e;e=e.parentNode)if(1===e.nodeType){var t=a(e);if(t){var r,n=T.getReactRootIDFromNodeID(t),i=e;do if(r=a(i),i=i.parentNode,null==i)return null;while(r!==n);if(i===K[n])return e}}return null}var x=r(54),b=r(85),S=(r(32),r(195)),E=r(15),M=r(202),T=r(55),P=r(68),C=r(205),w=r(20),A=r(44),D=r(121),I=r(21),R=r(5),O=r(62),L=r(165),F=r(128),V=r(2),k=r(92),B=r(131),N=(r(133),r(4),x.ID_ATTRIBUTE_NAME),U={},z=1,W=9,j=11,G="__ReactMount_ownerDocument$"+Math.random().toString(36).slice(2),H={},K={},X=[],Y=null,q=function(){};q.prototype.isReactComponent={},q.prototype.render=function(){return this.props};var Z={TopLevelWrapper:q,_instancesByReactRootID:H,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,t,r,n){return Z.scrollMonitor(r,function(){D.enqueueElementInternal(e,t),n&&D.enqueueCallbackInternal(e,n)}),e},_registerComponent:function(e,t){!t||t.nodeType!==z&&t.nodeType!==W&&t.nodeType!==j?V(!1):void 0,b.ensureScrollValueMonitoring();var r=Z.registerContainer(t);return H[r]=e,r},_renderNewRootComponent:function(e,t,r,n){var i=F(e,null),o=Z._registerComponent(i,t);return I.batchedUpdates(g,i,o,t,r,n),i},renderSubtreeIntoContainer:function(e,t,r,n){return null==e||null==e._reactInternalInstance?V(!1):void 0,Z._renderSubtreeIntoContainer(e,t,r,n)},_renderSubtreeIntoContainer:function(e,t,r,n){E.isValidElement(t)?void 0:V(!1);var s=new E(q,null,null,null,null,null,t),u=H[o(r)];if(u){var c=u._currentElement,l=c.props;if(B(l,t)){var h=u._renderedComponent.getPublicInstance(),f=n&&function(){n.call(h)};return Z._updateRootComponent(u,s,r,f),h}Z.unmountComponentAtNode(r)}var d=i(r),p=d&&!!a(d),m=_(r),g=p&&!u&&!m,v=Z._renderNewRootComponent(s,r,g,null!=e?e._reactInternalInstance._processChildContext(e._reactInternalInstance._context):O)._renderedComponent.getPublicInstance();return n&&n.call(v),v},render:function(e,t,r){return Z._renderSubtreeIntoContainer(null,e,t,r)},registerContainer:function(e){var t=o(e);return t&&(t=T.getReactRootIDFromNodeID(t)),t||(t=T.createReactRootID()),K[t]=e,t},unmountComponentAtNode:function(e){!e||e.nodeType!==z&&e.nodeType!==W&&e.nodeType!==j?V(!1):void 0;var t=o(e),r=H[t];if(!r){var n=(_(e),a(e));n&&n===T.getReactRootIDFromNodeID(n);return!1}return I.batchedUpdates(v,r,e),delete H[t],delete K[t],!0},findReactContainerForID:function(e){var t=T.getReactRootIDFromNodeID(e),r=K[t];return r},findReactNodeByID:function(e){var t=Z.findReactContainerForID(e);return Z.findComponentRoot(t,e)},getFirstReactDOM:function(e){return y(e)},findComponentRoot:function(e,t){var r=X,n=0,i=p(t)||e;for(r[0]=i.firstChild,r.length=1;n<r.length;){for(var o,s=r[n++];s;){var a=Z.getID(s);a?t===a?o=s:T.isAncestorIDOf(a,t)&&(r.length=n=0,r.push(s.firstChild)):r.push(s.firstChild),s=s.nextSibling}if(o)return r.length=0,o}r.length=0,V(!1)},_mountImageIntoNode:function(e,t,r,o){if(!t||t.nodeType!==z&&t.nodeType!==W&&t.nodeType!==j?V(!1):void 0,r){var s=i(t);if(C.canReuseMarkup(e,s))return;var a=s.getAttribute(C.CHECKSUM_ATTR_NAME);s.removeAttribute(C.CHECKSUM_ATTR_NAME);var u=s.outerHTML;s.setAttribute(C.CHECKSUM_ATTR_NAME,a);var c=e,l=n(c,u);" (client) "+c.substring(l-20,l+20)+"\n (server) "+u.substring(l-20,l+20);t.nodeType===W?V(!1):void 0}if(t.nodeType===W?V(!1):void 0,o.useCreateElement){for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(e)}else k(t,e)},ownerDocumentContextKey:G,getReactRootID:o,getID:s,setID:u,getNode:c,getNodeFromInstance:l,isValid:h,purgeID:f};w.measureMethods(Z,"ReactMount",{_renderNewRootComponent:"_renderNewRootComponent",_mountImageIntoNode:"_mountImageIntoNode"}),e.exports=Z},function(e,t,r){"use strict";var n=function(e,t,r,n,i,o,s,a){if(!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,n,i,o,s,a],l=0;u=new Error(t.replace(/%s/g,function(){return c[l++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}};e.exports=n},function(e,t,r){"use strict";var n=r(32),i=r(5),o=(r(90),"function"==typeof Symbol&&Symbol["for"]&&Symbol["for"]("react.element")||60103),s={key:!0,ref:!0,__self:!0,__source:!0},a=function(e,t,r,n,i,s,a){var u={$$typeof:o,type:e,key:t,ref:r,props:a,_owner:s};return u};a.createElement=function(e,t,r){var i,o={},u=null,c=null,l=null,h=null;if(null!=t){c=void 0===t.ref?null:t.ref,u=void 0===t.key?null:""+t.key,l=void 0===t.__self?null:t.__self,h=void 0===t.__source?null:t.__source;for(i in t)t.hasOwnProperty(i)&&!s.hasOwnProperty(i)&&(o[i]=t[i])}var f=arguments.length-2;if(1===f)o.children=r;else if(f>1){for(var d=Array(f),p=0;f>p;p++)d[p]=arguments[p+2];o.children=d}if(e&&e.defaultProps){var m=e.defaultProps;for(i in m)"undefined"==typeof o[i]&&(o[i]=m[i])}return a(e,u,c,l,h,n.current,o)},a.createFactory=function(e){var t=a.createElement.bind(null,e);return t.type=e,t},a.cloneAndReplaceKey=function(e,t){var r=a(e.type,t,e.ref,e._self,e._source,e._owner,e.props);return r},a.cloneAndReplaceProps=function(e,t){var r=a(e.type,e.key,e.ref,e._self,e._source,e._owner,t);return r},a.cloneElement=function(e,t,r){var o,u=i({},e.props),c=e.key,l=e.ref,h=e._self,f=e._source,d=e._owner;if(null!=t){void 0!==t.ref&&(l=t.ref,d=n.current),void 0!==t.key&&(c=""+t.key);for(o in t)t.hasOwnProperty(o)&&!s.hasOwnProperty(o)&&(u[o]=t[o])}var p=arguments.length-2;if(1===p)u.children=r;else if(p>1){for(var m=Array(p),g=0;p>g;g++)m[g]=arguments[g+2];u.children=m}return a(e.type,c,l,h,f,d,u)},a.isValidElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},e.exports=a},function(e,t){function r(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=r},function(e,t,r){"use strict";var n=function(){};e.exports=n},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(61),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){"use strict";function n(e,t,r){return r}var i={enableMeasure:!1,storedMeasure:n,measureMethods:function(e,t,r){},measure:function(e,t,r){return r},injection:{injectMeasure:function(e){i.storedMeasure=e}}};e.exports=i},function(e,t,r){"use strict";function n(){P.ReactReconcileTransaction&&x?void 0:g(!1)}function i(){this.reinitializeTransaction(),this.dirtyComponentsLength=null,this.callbackQueue=l.getPooled(),this.reconcileTransaction=P.ReactReconcileTransaction.getPooled(!1)}function o(e,t,r,i,o,s){n(),x.batchedUpdates(e,t,r,i,o,s)}function s(e,t){return e._mountOrder-t._mountOrder}function a(e){var t=e.dirtyComponentsLength;t!==v.length?g(!1):void 0,v.sort(s);for(var r=0;t>r;r++){var n=v[r],i=n._pendingCallbacks;if(n._pendingCallbacks=null,d.performUpdateIfNecessary(n,e.reconcileTransaction),i)for(var o=0;o<i.length;o++)e.callbackQueue.enqueue(i[o],n.getPublicInstance())}}function u(e){return n(),x.isBatchingUpdates?void v.push(e):void x.batchedUpdates(u,e)}function c(e,t){x.isBatchingUpdates?void 0:g(!1),_.enqueue(e,t),y=!0}var l=r(115),h=r(39),f=r(20),d=r(44),p=r(89),m=r(5),g=r(2),v=[],_=l.getPooled(),y=!1,x=null,b={initialize:function(){this.dirtyComponentsLength=v.length},close:function(){this.dirtyComponentsLength!==v.length?(v.splice(0,this.dirtyComponentsLength),M()):v.length=0}},S={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}},E=[b,S];m(i.prototype,p.Mixin,{getTransactionWrappers:function(){return E},destructor:function(){this.dirtyComponentsLength=null,l.release(this.callbackQueue),this.callbackQueue=null,P.ReactReconcileTransaction.release(this.reconcileTransaction),this.reconcileTransaction=null},perform:function(e,t,r){return p.Mixin.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,e,t,r)}}),h.addPoolingTo(i);var M=function(){for(;v.length||y;){if(v.length){var e=i.getPooled();e.perform(a,null,e),i.release(e)}if(y){y=!1;var t=_;_=l.getPooled(),t.notifyAll(),l.release(t)}}};M=f.measure("ReactUpdates","flushBatchedUpdates",M);var T={injectReconcileTransaction:function(e){e?void 0:g(!1),P.ReactReconcileTransaction=e},injectBatchingStrategy:function(e){e?void 0:g(!1),"function"!=typeof e.batchedUpdates?g(!1):void 0,"boolean"!=typeof e.isBatchingUpdates?g(!1):void 0,x=e}},P={ReactReconcileTransaction:null,batchedUpdates:o,enqueueUpdate:u,flushBatchedUpdates:M,injection:T,asap:c};e.exports=P},function(e,t,r){e.exports=!r(11)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(1),i=r(34),o=r(11);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],s={};s[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",s)}},function(e,t,r){var n=r(10),i=r(29),o=r(49)("src"),s="toString",a=Function[s],u=(""+a).split(s);r(34).inspectSource=function(e){return a.call(e)},(e.exports=function(e,t,r,s){"function"==typeof r&&(r.hasOwnProperty(o)||i(r,o,e[t]?""+e[t]:u.join(String(t))),r.hasOwnProperty("name")||i(r,"name",t)),e===n?e[t]=r:(s||delete e[t],i(e,t,r))})(Function.prototype,s,function(){return"function"==typeof this&&this[o]||a.call(this)})},function(e,t,r){var n=r(76),i=r(28);e.exports=function(e){return n(i(e))}},function(e,t){"use strict";function r(e){return function(){return e}}function n(){}n.thatReturns=r,n.thatReturnsFalse=r(!1),n.thatReturnsTrue=r(!0),n.thatReturnsNull=r(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(e){return e},e.exports=n},function(e,t,r){var n=r(47);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(3),i=r(40);e.exports=r(22)?function(e,t,r){return n.setDesc(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(83),i=r(63),o=r(37),s="[object Array]",a=Object.prototype,u=a.toString,c=n(Array,"isArray"),l=c||function(e){return o(e)&&i(e.length)&&u.call(e)==s};e.exports=l},function(e,t,r){"use strict";var n=r(81),i=n({bubbled:null,captured:null}),o=n({topAbort:null,topBlur:null,topCanPlay:null,topCanPlayThrough:null,topChange:null,topClick:null,topCompositionEnd:null,topCompositionStart:null,topCompositionUpdate:null,topContextMenu:null,topCopy:null,topCut:null,topDoubleClick:null,topDrag:null,topDragEnd:null,topDragEnter:null,topDragExit:null,topDragLeave:null,topDragOver:null,topDragStart:null,topDrop:null,topDurationChange:null,topEmptied:null,topEncrypted:null,topEnded:null,topError:null,topFocus:null,topInput:null,topKeyDown:null,topKeyPress:null,topKeyUp:null,topLoad:null,topLoadedData:null,topLoadedMetadata:null,topLoadStart:null,topMouseDown:null,topMouseMove:null,topMouseOut:null,topMouseOver:null,topMouseUp:null,topPaste:null,topPause:null,topPlay:null,topPlaying:null,topProgress:null,topRateChange:null,topReset:null,topScroll:null,topSeeked:null,topSeeking:null,topSelectionChange:null,topStalled:null,topSubmit:null,topSuspend:null,topTextInput:null,topTimeUpdate:null,topTouchCancel:null,topTouchEnd:null,topTouchMove:null,topTouchStart:null,topVolumeChange:null,topWaiting:null,topWheel:null}),s={topLevelTypes:o,PropagationPhases:i};e.exports=s},function(e,t){"use strict";var r={current:null};e.exports=r},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t){var r=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=r)},function(e,t,r){var n=r(28);e.exports=function(e){return Object(n(e))}},function(e,t){"use strict";var r=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return t;return null};e.exports=r},function(e,t){function r(e){return!!e&&"object"==typeof e}e.exports=r},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return null==e||d["default"].isValidElement(e)}function o(e){return i(e)||Array.isArray(e)&&e.every(i)}function s(e,t,r){e=e||"UnknownComponent";for(var n in t)if(t.hasOwnProperty(n)){var i=t[n](r,n,e);i instanceof Error}}function a(e,t){return h({},e,t)}function u(e){var t=e.type,r=a(t.defaultProps,e.props);if(t.propTypes&&s(t.displayName||t.name,t.propTypes,r),r.children){var n=c(r.children,r);n.length&&(r.childRoutes=n),delete r.children}return r}function c(e,t){var r=[];return d["default"].Children.forEach(e,function(e){if(d["default"].isValidElement(e))if(e.type.createRouteFromReactElement){var n=e.type.createRouteFromReactElement(e,t);n&&r.push(n)}else r.push(u(e))}),r}function l(e){return o(e)?e=c(e):e&&!Array.isArray(e)&&(e=[e]),e}t.__esModule=!0;var h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.isReactChildren=o,t.createRouteFromReactElement=u,t.createRoutesFromReactChildren=c,t.createRoutes=l;var f=r(7),d=n(f),p=r(17);n(p)},function(e,t,r){"use strict";var n=r(2),i=function(e){var t=this;if(t.instancePool.length){var r=t.instancePool.pop();return t.call(r,e),r}return new t(e)},o=function(e,t){var r=this;if(r.instancePool.length){var n=r.instancePool.pop();return r.call(n,e,t),n}return new r(e,t)},s=function(e,t,r){var n=this;if(n.instancePool.length){var i=n.instancePool.pop();return n.call(i,e,t,r),i}return new n(e,t,r)},a=function(e,t,r,n){var i=this;if(i.instancePool.length){var o=i.instancePool.pop();return i.call(o,e,t,r,n),o}return new i(e,t,r,n)},u=function(e,t,r,n,i){var o=this;if(o.instancePool.length){var s=o.instancePool.pop();return o.call(s,e,t,r,n,i),s}return new o(e,t,r,n,i)},c=function(e){var t=this;e instanceof t?void 0:n(!1),e.destructor(),t.instancePool.length<t.poolSize&&t.instancePool.push(e)},l=10,h=i,f=function(e,t){var r=e;return r.instancePool=[],r.getPooled=t||h,r.poolSize||(r.poolSize=l),r.release=c,r},d={addPoolingTo:f,oneArgumentPooler:i,twoArgumentPooler:o,threeArgumentPooler:s,fourArgumentPooler:a,fiveArgumentPooler:u};e.exports=d},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=a["default"](e),r="",n="",i=t.indexOf("#");-1!==i&&(n=t.substring(i),t=t.substring(0,i));var o=t.indexOf("?");return-1!==o&&(r=t.substring(o),t=t.substring(0,o)),""===t&&(t="/"),{pathname:t,search:r,hash:n}}t.__esModule=!0;var o=r(17),s=(n(o),r(173)),a=n(s);t["default"]=i,e.exports=t["default"]},function(e,t,r){function n(e){return i(e)?e:Object(e)}var i=r(16);e.exports=n},function(e,t,r){"use strict";function n(e,t,r){return e[t]?new Error("<"+r+'> should not have a "'+t+'" prop'):void 0}t.__esModule=!0,t.falsy=n;var i=r(7),o=i.PropTypes.func,s=i.PropTypes.object,a=i.PropTypes.arrayOf,u=i.PropTypes.oneOfType,c=i.PropTypes.element,l=i.PropTypes.shape,h=i.PropTypes.string,f=l({listen:o.isRequired,pushState:o.isRequired,replaceState:o.isRequired,go:o.isRequired});t.history=f;var d=l({pathname:h.isRequired,search:h.isRequired,state:s,action:h.isRequired,key:h});t.location=d;var p=u([o,h]);t.component=p;var m=u([p,s]);t.components=m;var g=u([s,c]);t.route=g;var v=u([g,a(g)]);t.routes=v,t["default"]={falsy:n,history:f,location:d,component:p,components:m,route:g}},function(e,t,r){"use strict";function n(){i.attachRefs(this,this._currentElement)}var i=r(476),o={mountComponent:function(e,t,r,i){var o=e.mountComponent(t,r,i);return e._currentElement&&null!=e._currentElement.ref&&r.getReactMountReady().enqueue(n,e),o},unmountComponent:function(e){i.detachRefs(e,e._currentElement),e.unmountComponent()},receiveComponent:function(e,t,r,o){var s=e._currentElement;if(t!==s||o!==e._context){var a=i.shouldUpdateRefs(s,t);a&&i.detachRefs(e,s),e.receiveComponent(t,r,o),a&&e._currentElement&&null!=e._currentElement.ref&&r.getReactMountReady().enqueue(n,e)}},performUpdateIfNecessary:function(e,t){e.performUpdateIfNecessary(t)}};e.exports=o},function(e,t,r){"use strict";function n(e,t,r,n){this.dispatchConfig=e,this.dispatchMarker=t,this.nativeEvent=r,this.target=n,this.currentTarget=n;var i=this.constructor.Interface;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];a?this[o]=a(r):this[o]=r[o]}var u=null!=r.defaultPrevented?r.defaultPrevented:r.returnValue===!1;u?this.isDefaultPrevented=s.thatReturnsTrue:this.isDefaultPrevented=s.thatReturnsFalse,this.isPropagationStopped=s.thatReturnsFalse}var i=r(39),o=r(5),s=r(26),a=(r(4),{type:null,currentTarget:s.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null});o(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1,this.isDefaultPrevented=s.thatReturnsTrue)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.isPropagationStopped=s.thatReturnsTrue)},persist:function(){this.isPersistent=s.thatReturnsTrue},isPersistent:s.thatReturnsFalse,destructor:function(){var e=this.constructor.Interface;for(var t in e)this[t]=null;this.dispatchConfig=null,this.dispatchMarker=null,this.nativeEvent=null}}),n.Interface=a,n.augmentClass=function(e,t){var r=this,n=Object.create(r.prototype);o(n,e.prototype),e.prototype=n,e.prototype.constructor=e,e.Interface=o({},r.Interface,t),e.augmentClass=r.augmentClass,i.addPoolingTo(e,i.fourArgumentPooler)},i.addPoolingTo(n,i.fourArgumentPooler),e.exports=n},function(e,t){"use strict";t.__esModule=!0;var r="@@reduxReactRouter/routerDidChange";t.ROUTER_DID_CHANGE=r;var n="@@reduxReactRouter/historyAPI";t.HISTORY_API=n;var i="@@reduxReactRouter/match";t.MATCH=i;var o="@@reduxReactRouter/initRoutes";t.INIT_ROUTES=o;var s="@@reduxReactRouter/replaceRoutes";t.REPLACE_ROUTES=s;var a="@@reduxReactRouter/routerStateSelector";t.ROUTER_STATE_SELECTOR=a;var u="@@reduxReactRouter/doesNeedRefresh";t.DOES_NEED_REFRESH=u},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var n=r(9)("unscopables"),i=Array.prototype;void 0==i[n]&&r(29)(i,n,{}),e.exports=function(e){i[n][e]=!0}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t){"use strict";t.__esModule=!0;var r="PUSH";t.PUSH=r;var n="REPLACE";t.REPLACE=n;var i="POP";t.POP=i,t["default"]={PUSH:r,REPLACE:n,POP:i}},function(e,t,r){function n(e){return null!=e&&o(i(e))}var i=r(407),o=r(63);e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),s=r(426),a=n(s),u=a["default"](o["default"]),c=u.Provider,l=u.connect;t.Provider=c,t.connect=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(439),o=n(i);t.Router=o["default"];var s=r(184),a=n(s);t.Link=a["default"];var u=r(433),c=n(u);t.IndexLink=c["default"];var l=r(434),h=n(l);t.IndexRedirect=h["default"];var f=r(435),d=n(f);t.IndexRoute=d["default"];var p=r(185),m=n(p);t.Redirect=m["default"];var g=r(437),v=n(g);t.Route=v["default"];var _=r(432),y=n(_);t.History=y["default"];var x=r(436),b=n(x);t.Lifecycle=b["default"];var S=r(438),E=n(S);t.RouteContext=E["default"];var M=r(114),T=n(M);t.useRoutes=T["default"];var P=r(38);t.createRoutes=P.createRoutes;var C=r(186),w=n(C);t.RoutingContext=w["default"];var A=r(43),D=n(A);t.PropTypes=D["default"];var I=r(444),R=n(I);t.match=R["default"];var O=n(i);t["default"]=O["default"]},function(e,t,r){"use strict";function n(e,t){return(e&t)===t}var i=r(2),o={MUST_USE_ATTRIBUTE:1,MUST_USE_PROPERTY:2,HAS_SIDE_EFFECTS:4,HAS_BOOLEAN_VALUE:8,HAS_NUMERIC_VALUE:16,HAS_POSITIVE_NUMERIC_VALUE:48,HAS_OVERLOADED_BOOLEAN_VALUE:64,injectDOMPropertyConfig:function(e){var t=o,r=e.Properties||{},s=e.DOMAttributeNamespaces||{},u=e.DOMAttributeNames||{},c=e.DOMPropertyNames||{},l=e.DOMMutationMethods||{};e.isCustomAttribute&&a._isCustomAttributeFunctions.push(e.isCustomAttribute);for(var h in r){a.properties.hasOwnProperty(h)?i(!1):void 0;var f=h.toLowerCase(),d=r[h],p={attributeName:f,attributeNamespace:null,propertyName:h,mutationMethod:null,mustUseAttribute:n(d,t.MUST_USE_ATTRIBUTE),mustUseProperty:n(d,t.MUST_USE_PROPERTY),hasSideEffects:n(d,t.HAS_SIDE_EFFECTS),hasBooleanValue:n(d,t.HAS_BOOLEAN_VALUE),hasNumericValue:n(d,t.HAS_NUMERIC_VALUE),hasPositiveNumericValue:n(d,t.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:n(d,t.HAS_OVERLOADED_BOOLEAN_VALUE)};if(p.mustUseAttribute&&p.mustUseProperty?i(!1):void 0,!p.mustUseProperty&&p.hasSideEffects?i(!1):void 0,p.hasBooleanValue+p.hasNumericValue+p.hasOverloadedBooleanValue<=1?void 0:i(!1),u.hasOwnProperty(h)){var m=u[h];p.attributeName=m}s.hasOwnProperty(h)&&(p.attributeNamespace=s[h]),c.hasOwnProperty(h)&&(p.propertyName=c[h]),l.hasOwnProperty(h)&&(p.mutationMethod=l[h]),a.properties[h]=p}}},s={},a={ID_ATTRIBUTE_NAME:"data-reactid",properties:{},getPossibleStandardName:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(e){for(var t=0;t<a._isCustomAttributeFunctions.length;t++){var r=a._isCustomAttributeFunctions[t];if(r(e))return!0}return!1},getDefaultValueForProperty:function(e,t){var r,n=s[e];return n||(s[e]=n={}),t in n||(r=document.createElement(e),n[t]=r[t]),n[t]},injection:o};e.exports=a},function(e,t,r){"use strict";function n(e){return d+e.toString(36)}function i(e,t){return e.charAt(t)===d||t===e.length}function o(e){return""===e||e.charAt(0)===d&&e.charAt(e.length-1)!==d}function s(e,t){return 0===t.indexOf(e)&&i(t,e.length)}function a(e){return e?e.substr(0,e.lastIndexOf(d)):""}function u(e,t){if(o(e)&&o(t)?void 0:f(!1),s(e,t)?void 0:f(!1),e===t)return e;var r,n=e.length+p;for(r=n;r<t.length&&!i(t,r);r++);return t.substr(0,r)}function c(e,t){var r=Math.min(e.length,t.length);if(0===r)return"";for(var n=0,s=0;r>=s;s++)if(i(e,s)&&i(t,s))n=s;else if(e.charAt(s)!==t.charAt(s))break;var a=e.substr(0,n);return o(a)?void 0:f(!1),a}function l(e,t,r,n,i,o){e=e||"",t=t||"",e===t?f(!1):void 0;var c=s(t,e);c||s(e,t)?void 0:f(!1);
for(var l=0,h=c?a:u,d=e;;d=h(d,t)){var p;if(i&&d===e||o&&d===t||(p=r(d,c,n)),p===!1||d===t)break;l++<m?void 0:f(!1)}}var h=r(210),f=r(2),d=".",p=d.length,m=1e4,g={createReactRootID:function(){return n(h.createReactRootIndex())},createReactID:function(e,t){return e+t},getReactRootIDFromNodeID:function(e){if(e&&e.charAt(0)===d&&e.length>1){var t=e.indexOf(d,1);return t>-1?e.substr(0,t):e}return null},traverseEnterLeave:function(e,t,r,n,i){var o=c(e,t);o!==e&&l(e,o,r,n,!1,!0),o!==t&&l(o,t,r,i,!0,!1)},traverseTwoPhase:function(e,t,r){e&&(l("",e,t,r,!0,!1),l(e,"",t,r,!1,!0))},traverseTwoPhaseSkipTarget:function(e,t,r){e&&(l("",e,t,r,!0,!0),l(e,"",t,r,!0,!0))},traverseAncestors:function(e,t,r){l("",e,t,r,!0,!1)},getFirstCommonAncestorID:c,_getNextDescendantID:u,isAncestorIDOf:s,SEPARATOR:d};e.exports=g},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(217),o=n(i),s=r(513),a=n(s),u=r(512),c=n(u),l=r(511),h=n(l),f=r(218),d=n(f);t.createStore=o["default"],t.combineReducers=a["default"],t.bindActionCreators=c["default"],t.applyMiddleware=h["default"],t.compose=d["default"]},function(e,t,r){var n=r(27),i=r(149),o=r(146),s=r(8),a=r(19),u=r(160);e.exports=function(e,t,r,c){var l,h,f,d=u(e),p=n(r,c,t?2:1),m=0;if("function"!=typeof d)throw TypeError(e+" is not iterable!");if(o(d))for(l=a(e.length);l>m;m++)t?p(s(h=e[m])[0],h[1]):p(e[m]);else for(f=d.call(e);!(h=f.next()).done;)i(f,p,h.value,t)}},function(e,t){e.exports={}},function(e,t,r){var n=r(3).setDesc,i=r(18),o=r(9)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){var n=r(61),i=Math.max,o=Math.min;e.exports=function(e,t){return e=n(e),0>e?i(e+t,0):o(e,t)}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){"use strict";var n={};e.exports=n},function(e,t){function r(e){return"number"==typeof e&&e>-1&&e%1==0&&n>=e}var n=9007199254740991;e.exports=r},function(e,t,r){function n(e){return o(e)&&i(e)&&a.call(e,"callee")&&!u.call(e,"callee")}var i=r(51),o=r(37),s=Object.prototype,a=s.hasOwnProperty,u=s.propertyIsEnumerable;e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function o(e){return i(e).replace(/\/+/g,"/+")}function s(e){for(var t="",r=[],n=[],i=void 0,s=0,a=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|\*\*|\*|\(|\)/g;i=a.exec(e);)i.index!==s&&(n.push(e.slice(s,i.index)),t+=o(e.slice(s,i.index))),i[1]?(t+="([^/?#]+)",r.push(i[1])):"**"===i[0]?(t+="([\\s\\S]*)",r.push("splat")):"*"===i[0]?(t+="([\\s\\S]*?)",r.push("splat")):"("===i[0]?t+="(?:":")"===i[0]&&(t+=")?"),n.push(i[0]),s=a.lastIndex;return s!==e.length&&(n.push(e.slice(s,e.length)),t+=o(e.slice(s,e.length))),{pattern:e,regexpSource:t,paramNames:r,tokens:n}}function a(e){return e in p||(p[e]=s(e)),p[e]}function u(e,t){"/"!==e.charAt(0)&&(e="/"+e),"/"!==t.charAt(0)&&(t="/"+t);var r=a(e),n=r.regexpSource,i=r.paramNames,o=r.tokens;n+="/*";var s="*"!==o[o.length-1];s&&(n+="([\\s\\S]*?)");var u=t.match(new RegExp("^"+n+"$","i")),c=void 0,l=void 0;if(null!=u){if(s){c=u.pop();var h=u[0].substr(0,u[0].length-c.length);if(c&&"/"!==h.charAt(h.length-1))return{remainingPathname:null,paramNames:i,paramValues:null}}else c="";l=u.slice(1).map(function(e){return null!=e?decodeURIComponent(e):e})}else c=l=null;return{remainingPathname:c,paramNames:i,paramValues:l}}function c(e){return a(e).paramNames}function l(e,t){var r=u(e,t),n=r.paramNames,i=r.paramValues;return null!=i?n.reduce(function(e,t,r){return e[t]=i[r],e},{}):null}function h(e,t){t=t||{};for(var r=a(e),n=r.tokens,i=0,o="",s=0,u=void 0,c=void 0,l=void 0,h=0,f=n.length;f>h;++h)u=n[h],"*"===u||"**"===u?(l=Array.isArray(t.splat)?t.splat[s++]:t.splat,null!=l||i>0?void 0:d["default"](!1),null!=l&&(o+=encodeURI(l))):"("===u?i+=1:")"===u?i-=1:":"===u.charAt(0)?(c=u.substring(1),l=t[c],null!=l||i>0?void 0:d["default"](!1),null!=l&&(o+=encodeURIComponent(l))):o+=u;return o.replace(/\/+/g,"/")}t.__esModule=!0,t.compilePattern=a,t.matchPattern=u,t.getParamNames=c,t.getParams=l,t.formatPattern=h;var f=r(14),d=n(f),p={}},function(e,t,r){"use strict";var n=r(190),i=r(454),o=r(203),s=r(212),a=r(213),u=r(2),c=(r(4),{}),l=null,h=function(e,t){e&&(i.executeDispatchesInOrder(e,t),e.isPersistent()||e.constructor.release(e))},f=function(e){return h(e,!0)},d=function(e){return h(e,!1)},p=null,m={injection:{injectMount:i.injection.injectMount,injectInstanceHandle:function(e){p=e},getInstanceHandle:function(){return p},injectEventPluginOrder:n.injectEventPluginOrder,injectEventPluginsByName:n.injectEventPluginsByName},eventNameDispatchConfigs:n.eventNameDispatchConfigs,registrationNameModules:n.registrationNameModules,putListener:function(e,t,r){"function"!=typeof r?u(!1):void 0;var i=c[t]||(c[t]={});i[e]=r;var o=n.registrationNameModules[t];o&&o.didPutListener&&o.didPutListener(e,t,r)},getListener:function(e,t){var r=c[t];return r&&r[e]},deleteListener:function(e,t){var r=n.registrationNameModules[t];r&&r.willDeleteListener&&r.willDeleteListener(e,t);var i=c[t];i&&delete i[e]},deleteAllListeners:function(e){for(var t in c)if(c[t][e]){var r=n.registrationNameModules[t];r&&r.willDeleteListener&&r.willDeleteListener(e,t),delete c[t][e]}},extractEvents:function(e,t,r,i,o){for(var a,u=n.plugins,c=0;c<u.length;c++){var l=u[c];if(l){var h=l.extractEvents(e,t,r,i,o);h&&(a=s(a,h))}}return a},enqueueEvents:function(e){e&&(l=s(l,e))},processEventQueue:function(e){var t=l;l=null,e?a(t,f):a(t,d),l?u(!1):void 0,o.rethrowCaughtError()},__purge:function(){c={}},__getListenerBank:function(){return c}};e.exports=m},function(e,t,r){"use strict";function n(e,t,r){var n=t.dispatchConfig.phasedRegistrationNames[r];return _(e,n)}function i(e,t,r){var i=t?v.bubbled:v.captured,o=n(e,r,i);o&&(r._dispatchListeners=m(r._dispatchListeners,o),r._dispatchIDs=m(r._dispatchIDs,e))}function o(e){e&&e.dispatchConfig.phasedRegistrationNames&&p.injection.getInstanceHandle().traverseTwoPhase(e.dispatchMarker,i,e)}function s(e){e&&e.dispatchConfig.phasedRegistrationNames&&p.injection.getInstanceHandle().traverseTwoPhaseSkipTarget(e.dispatchMarker,i,e)}function a(e,t,r){if(r&&r.dispatchConfig.registrationName){var n=r.dispatchConfig.registrationName,i=_(e,n);i&&(r._dispatchListeners=m(r._dispatchListeners,i),r._dispatchIDs=m(r._dispatchIDs,e))}}function u(e){e&&e.dispatchConfig.registrationName&&a(e.dispatchMarker,null,e)}function c(e){g(e,o)}function l(e){g(e,s)}function h(e,t,r,n){p.injection.getInstanceHandle().traverseEnterLeave(r,n,a,e,t)}function f(e){g(e,u)}var d=r(31),p=r(66),m=(r(4),r(212)),g=r(213),v=d.PropagationPhases,_=p.getListener,y={accumulateTwoPhaseDispatches:c,accumulateTwoPhaseDispatchesSkipTarget:l,accumulateDirectDispatches:f,accumulateEnterLeaveDispatches:h};e.exports=y},function(e,t){"use strict";var r={remove:function(e){e._reactInternalInstance=void 0},get:function(e){return e._reactInternalInstance},has:function(e){return void 0!==e._reactInternalInstance},set:function(e,t){e._reactInternalInstance=t}};e.exports=r},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(45),o=r(126),s={view:function(e){if(e.view)return e.view;var t=o(e);if(null!=t&&t.window===t)return t;var r=t.ownerDocument;return r?r.defaultView||r.parentWindow:window},detail:function(e){return e.detail||0}};i.augmentClass(n,s),e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(508),o=n(i);t.routerStateReducer=o["default"];var s=r(501),a=n(s);t.ReduxRouter=a["default"];var u=r(502),c=n(u);t.reduxReactRouter=c["default"];var l=r(504),h=n(l);t.isActive=h["default"];var f=r(134);t.historyAPI=f.historyAPI,t.pushState=f.pushState,t.push=f.push,t.replaceState=f.replaceState,t.replace=f.replace,t.setState=f.setState,t.go=f.go,t.goBack=f.goBack,t.goForward=f.goForward},function(e,t,r){var n=r(27),i=r(76),o=r(35),s=r(19),a=r(239);e.exports=function(e){var t=1==e,r=2==e,u=3==e,c=4==e,l=6==e,h=5==e||l;return function(f,d,p){for(var m,g,v=o(f),_=i(v),y=n(d,p,3),x=s(_.length),b=0,S=t?a(f,x):r?a(f,0):void 0;x>b;b++)if((h||b in _)&&(m=_[b],g=y(m,b,v),e))if(t)S[b]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return b;case 2:S.push(m)}else if(c)return!1;return l?-1:u||c?c:S}}},function(e,t,r){var n=r(33),i=r(9)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=(t=Object(e))[i])?r:o?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,r){"use strict";var n=r(10),i=r(1),o=r(24),s=r(77),a=r(57),u=r(79),c=r(6),l=r(11),h=r(96),f=r(59);e.exports=function(e,t,r,d,p,m){var g=n[e],v=g,_=p?"set":"add",y=v&&v.prototype,x={},b=function(e){var t=y[e];o(y,e,"delete"==e?function(e){return m&&!c(e)?!1:t.call(this,0===e?0:e)}:"has"==e?function(e){return m&&!c(e)?!1:t.call(this,0===e?0:e)}:"get"==e?function(e){return m&&!c(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,r){return t.call(this,0===e?0:e,r),this})};if("function"==typeof v&&(m||y.forEach&&!l(function(){(new v).entries().next()}))){var S,E=new v,M=E[_](m?{}:-0,1)!=E,T=l(function(){E.has(1)}),P=h(function(e){new v(e)});P||(v=t(function(t,r){u(t,v,e);var n=new g;return void 0!=r&&a(r,p,n[_],n),n}),v.prototype=y,y.constructor=v),m||E.forEach(function(e,t){S=1/t===-(1/0)}),(T||S)&&(b("delete"),b("has"),p&&b("get")),(S||M)&&b(_),m&&y.clear&&delete y.clear}else v=d.getConstructor(t,e,p,_),s(v.prototype,r);return f(v,e),x[e]=v,i(i.G+i.W+i.F*(v!=g),x),m||d.setStrong(v,e,p),v}},function(e,t,r){"use strict";var n=r(29),i=r(24),o=r(11),s=r(28),a=r(9);e.exports=function(e,t,r){var u=a(e),c=""[e];o(function(){var t={};return t[u]=function(){return 7},7!=""[e](t)})&&(i(String.prototype,e,r(s,u,c)),n(RegExp.prototype,u,2==t?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)}))}},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(33);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(24);e.exports=function(e,t){for(var r in t)n(e,r,t[r]);return e}},function(e,t,r){"use strict";var n=r(10),i=r(3),o=r(22),s=r(9)("species");e.exports=function(e){var t=n[e];o&&t&&!t[s]&&i.setDesc(t,s,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError(r+": use the 'new' operator!");return e}},function(e,t,r){var n=r(1),i=r(28),o=r(11),s="	\n\x0B\f\r   ᠎             　\u2028\u2029\ufeff",a="["+s+"]",u="​",c=RegExp("^"+a+a+"*"),l=RegExp(a+a+"*$"),h=function(e,t){var r={};r[e]=t(f),n(n.P+n.F*o(function(){return!!s[e]()||u[e]()!=u}),"String",r)},f=h.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(l,"")),e};e.exports=h},function(e,t,r){"use strict";var n=r(2),i=function(e){var t,r={};e instanceof Object&&!Array.isArray(e)?void 0:n(!1);for(t in e)e.hasOwnProperty(t)&&(r[t]=t);return r};e.exports=i},function(e,t){"use strict";t.__esModule=!0;var r=!("undefined"==typeof window||!window.document||!window.document.createElement);t.canUseDOM=r},function(e,t,r){function n(e,t){var r=null==e?void 0:e[t];return i(r)?r:void 0}var i=r(414);e.exports=n},function(e,t,r){var n=r(83),i=r(51),o=r(16),s=r(411),a=n(Object,"keys"),u=a?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&i(e)?s(e):o(e)?a(e):[]}:s;e.exports=u},function(e,t,r){"use strict";function n(e){return Object.prototype.hasOwnProperty.call(e,g)||(e[g]=p++,f[e[g]]={}),f[e[g]]}var i=r(31),o=r(66),s=r(190),a=r(469),u=r(20),c=r(211),l=r(5),h=r(129),f={},d=!1,p=0,m={topAbort:"abort",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"},g="_reactListenersID"+String(Math.random()).slice(2),v=l({},a,{ReactEventListener:null,injection:{injectReactEventListener:function(e){e.setHandleTopLevel(v.handleTopLevel),v.ReactEventListener=e}},setEnabled:function(e){v.ReactEventListener&&v.ReactEventListener.setEnabled(e)},isEnabled:function(){return!(!v.ReactEventListener||!v.ReactEventListener.isEnabled())},listenTo:function(e,t){for(var r=t,o=n(r),a=s.registrationNameDependencies[e],u=i.topLevelTypes,c=0;c<a.length;c++){var l=a[c];o.hasOwnProperty(l)&&o[l]||(l===u.topWheel?h("wheel")?v.ReactEventListener.trapBubbledEvent(u.topWheel,"wheel",r):h("mousewheel")?v.ReactEventListener.trapBubbledEvent(u.topWheel,"mousewheel",r):v.ReactEventListener.trapBubbledEvent(u.topWheel,"DOMMouseScroll",r):l===u.topScroll?h("scroll",!0)?v.ReactEventListener.trapCapturedEvent(u.topScroll,"scroll",r):v.ReactEventListener.trapBubbledEvent(u.topScroll,"scroll",v.ReactEventListener.WINDOW_HANDLE):l===u.topFocus||l===u.topBlur?(h("focus",!0)?(v.ReactEventListener.trapCapturedEvent(u.topFocus,"focus",r),v.ReactEventListener.trapCapturedEvent(u.topBlur,"blur",r)):h("focusin")&&(v.ReactEventListener.trapBubbledEvent(u.topFocus,"focusin",r),v.ReactEventListener.trapBubbledEvent(u.topBlur,"focusout",r)),o[u.topBlur]=!0,o[u.topFocus]=!0):m.hasOwnProperty(l)&&v.ReactEventListener.trapBubbledEvent(l,m[l],r),o[l]=!0)}},trapBubbledEvent:function(e,t,r){return v.ReactEventListener.trapBubbledEvent(e,t,r)},trapCapturedEvent:function(e,t,r){return v.ReactEventListener.trapCapturedEvent(e,t,r)},ensureScrollValueMonitoring:function(){if(!d){var e=c.refreshScrollValues;v.ReactEventListener.monitorScrollValue(e),d=!0}},eventNameDispatchConfigs:o.eventNameDispatchConfigs,registrationNameModules:o.registrationNameModules,putListener:o.putListener,getListener:o.getListener,deleteListener:o.deleteListener,deleteAllListeners:o.deleteAllListeners});u.measureMethods(v,"ReactBrowserEventEmitter",{putListener:"putListener",deleteListener:"deleteListener"}),e.exports=v},function(e,t,r){"use strict";var n={};e.exports=n},function(e,t,r){"use strict";var n=r(81),i=n({prop:null,context:null,childContext:null});e.exports=i},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(69),o=r(211),s=r(125),a={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:s,button:function(e){var t=e.button;return"which"in e?t:2===t?2:4===t?1:0},buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},pageX:function(e){return"pageX"in e?e.pageX:e.clientX+o.currentScrollLeft},pageY:function(e){return"pageY"in e?e.pageY:e.clientY+o.currentScrollTop}};i.augmentClass(n,a),e.exports=n},function(e,t,r){"use strict";var n=r(2),i={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(e,t,r,i,o,s,a,u){this.isInTransaction()?n(!1):void 0;var c,l;try{this._isInTransaction=!0,c=!0,this.initializeAll(0),l=e.call(t,r,i,o,s,a,u),c=!1}finally{try{if(c)try{this.closeAll(0)}catch(h){}else this.closeAll(0)}finally{this._isInTransaction=!1}}return l},initializeAll:function(e){for(var t=this.transactionWrappers,r=e;r<t.length;r++){var n=t[r];try{this.wrapperInitData[r]=o.OBSERVED_ERROR,this.wrapperInitData[r]=n.initialize?n.initialize.call(this):null}finally{if(this.wrapperInitData[r]===o.OBSERVED_ERROR)try{this.initializeAll(r+1)}catch(i){}}}},closeAll:function(e){this.isInTransaction()?void 0:n(!1);for(var t=this.transactionWrappers,r=e;r<t.length;r++){var i,s=t[r],a=this.wrapperInitData[r];try{i=!0,a!==o.OBSERVED_ERROR&&s.close&&s.close.call(this,a),i=!1}finally{if(i)try{this.closeAll(r+1)}catch(u){}}}this.wrapperInitData.length=0}},o={Mixin:i,OBSERVED_ERROR:{}};e.exports=o},function(e,t,r){"use strict";var n=!1;e.exports=n},function(e,t){"use strict";function r(e){return i[e]}function n(e){return(""+e).replace(o,r)}var i={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},o=/[&><"']/g;e.exports=n},function(e,t,r){"use strict";var n=r(12),i=/^[ \r\n\t\f]/,o=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/,s=function(e,t){e.innerHTML=t};if("undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction&&(s=function(e,t){MSApp.execUnsafeLocalFunction(function(){e.innerHTML=t})}),n.canUseDOM){var a=document.createElement("div");a.innerHTML=" ",""===a.innerHTML&&(s=function(e,t){if(e.parentNode&&e.parentNode.replaceChild(e,e),i.test(t)||"<"===t[0]&&o.test(t)){e.innerHTML=String.fromCharCode(65279)+t;var r=e.firstChild;1===r.data.length?e.removeChild(r):r.deleteData(0,1)}else e.innerHTML=t})}e.exports=s},function(e,t,r){var n=r(9)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,!"/./"[e](t)}catch(i){}}return!0}},function(e,t,r){var n=r(33);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){"use strict";var n=r(97),i=r(1),o=r(24),s=r(29),a=r(18),u=r(58),c=r(150),l=r(59),h=r(3).getProto,f=r(9)("iterator"),d=!([].keys&&"next"in[].keys()),p="@@iterator",m="keys",g="values",v=function(){return this};e.exports=function(e,t,r,_,y,x,b){c(r,t,_);var S,E,M=function(e){if(!d&&e in w)return w[e];switch(e){case m:return function(){return new r(this,e)};case g:return function(){return new r(this,e)}}return function(){return new r(this,e)}},T=t+" Iterator",P=y==g,C=!1,w=e.prototype,A=w[f]||w[p]||y&&w[y],D=A||M(y);if(A){var I=h(D.call(new e));l(I,T,!0),!n&&a(w,p)&&s(I,f,v),P&&A.name!==g&&(C=!0,D=function(){return A.call(this)})}if(n&&!b||!d&&!C&&w[f]||s(w,f,D),u[t]=D,u[T]=v,y)if(S={values:P?D:M(g),keys:x?D:M(m),entries:P?M("entries"):D},b)for(E in S)E in w||o(w,E,S[E]);else i(i.P+i.F*(d||C),t,S);return S}},function(e,t,r){var n=r(9)("iterator"),i=!1;try{var o=[7][n]();o["return"]=function(){i=!0},Array.from(o,function(){throw 2})}catch(s){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],s=o[n]();s.next=function(){r=!0},o[n]=function(){return s},e(o)}catch(a){}return r}},function(e,t){e.exports=!1},function(e,t){e.exports=Math.expm1||function(e){return 0==(e=+e)?e:e>-1e-6&&1e-6>e?e+e*e/2:Math.exp(e)-1}},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:0>e?-1:1}},function(e,t,r){var n=r(3).getDesc,i=r(6),o=r(8),s=function(e,t){if(o(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{i=r(27)(Function.call,n(Object.prototype,"__proto__").set,2),i(e,[]),t=!(e instanceof Array)}catch(o){t=!0}return function(e,r){return s(e,r),t?e.__proto__=r:i(e,r),e}}({},!1):void 0),check:s}},function(e,t,r){var n=r(61),i=r(28);e.exports=function(e){return function(t,r){var o,s,a=String(i(t)),u=n(r),c=a.length;return 0>u||u>=c?e?"":void 0:(o=a.charCodeAt(u),55296>o||o>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?e?a.charAt(u):o:e?a.slice(u,u+2):(o-55296<<10)+(s-56320)+65536)}}},function(e,t,r){var n=r(148),i=r(28);e.exports=function(e,t,r){if(n(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(e))}},function(e,t,r){t=e.exports=r(162)(),t.push([e.id,".top-menu{width:100%;background:rgba(0,0,0,.8);color:#fff;font-size:1em}.top-menu,.top-menu>ul{padding:0;margin:0}.top-menu li{margin:20px 16px;display:inline-block}.top-menu a{font-size:.7rem;letter-spacing:2px;color:#c6edf4;text-decoration:none;text-transform:uppercase}.top-menu a:hover{color:#74cddd}.top-menu a.active{color:#fff}.top-menu a.active:hover{cursor:default}",""])},function(e,t,r){t=e.exports=r(162)(),t.push([e.id,"body{padding:0;margin:0;font-family:Arial;background:#dddede;overflow-x:hidden;width:100%}a{color:#2799ae;text-decoration:none}#viewer3dContainer{background:radial-gradient(ellipse at center,#fff 0,#a3a3a3 100%);cursor:move;position:relative}.viewer3d-controls{width:100%;text-align:center;position:absolute;bottom:10px}.viewer3d-controls button{background:transparent;border:none;background:#fff;padding:8px 10px 6px;margin:5px;box-shadow:0 1px 1px rgba(0,0,0,.4);border-radius:50%;outline:none}.viewer3d-controls button:hover{cursor:pointer;background:#74cddd}.code{font-family:Georgia;font-size:.8rem;line-height:1.2rem}.code,.page-article{padding:16px}.page-article h3{margin-top:40px;margin-bottom:10px}.page-article ol>li,.page-article ul>li{padding:0 0 10px}.page-article table{font-size:.8rem}.page-article table th{padding:0 10px 10px}.page-article table td{border:1px solid #aaa;padding:10px 6px}.page-article table td:first-child{border-right:0;font-family:Georgia;font-style:italic}.page-title{font-size:17px;padding:16px}.page-subtitle,.page-title{font-weight:lighter;letter-spacing:2px;color:#333;margin:0;background:#fff}.page-subtitle{font-size:10px;text-transform:uppercase;display:block}.viewer3d-preloader{transition:all .5s ease-in-out;width:100%;height:100%;background:hsla(0,0%,100%,.7);position:absolute;top:0;left:0;opacity:0;z-index:-1;justify-content:center;align-items:center;display:flex}.viewer3d-preloader.shown{opacity:1;z-index:2}.preloader-title{font-size:.7rem;font-weight:lighter;text-transform:uppercase;letter-spacing:2px}.preloader-circle{width:62px;height:62px;clear:both;margin:20px auto;border:6px solid rgba(0,0,0,.25);border-top:6px solid #000;border-radius:50%;animation:spCircRot .6s infinite linear}@keyframes spCircRot{0%{transform:rotate(0deg)}to{transform:rotate(359deg)}}",""])},function(e,t){"use strict";function r(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent("on"+t,r)}function n(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent("on"+t,r)}function i(){return window.location.href.split("#")[1]||""}function o(e){window.location.replace(window.location.pathname+window.location.search+"#"+e)}function s(){return window.location.pathname+window.location.search+window.location.hash}function a(e){e&&window.history.go(e)}function u(e,t){t(window.confirm(e))}function c(){var e=navigator.userAgent;return-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone")?-1!==e.indexOf("CriOS")?!1:window.history&&"pushState"in window.history:!1}function l(){var e=navigator.userAgent;return-1===e.indexOf("Firefox")}t.__esModule=!0,t.addEventListener=r,t.removeEventListener=n,t.getHashPath=i,t.replaceHashPath=o,t.getWindowPath=s,t.go=a,t.getUserConfirmation=u,t.supportsHistory=c,t.supportsGoWithoutReloadUsingHash=l},function(e,t){"use strict";function r(e){return e}t.__esModule=!0,t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,r){var n=e(t,r);e.length<2&&r(n)}t.__esModule=!0;var o=r(17);n(o);t["default"]=i,e.exports=t["default"]},function(e,t,r){function n(e,t,r,a,u,c){return e===t?!0:null==e||null==t||!o(e)&&!s(t)?e!==e&&t!==t:i(e,t,n,r,a,u,c)}var i=r(388),o=r(16),s=r(37);e.exports=n},function(e,t,r){function n(e,t,r){if("function"!=typeof e)return i;if(void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,o){return e.call(t,r,n,i,o)};case 5:return function(r,n,i,o,s){return e.call(t,r,n,i,o,s)}}return function(){return e.apply(t,arguments)}}var i=r(182);e.exports=n},function(e,t){function r(e,t){return e="number"==typeof e||n.test(e)?+e:-1,t=null==t?i:t,e>-1&&e%1==0&&t>e}var n=/^\d+$/,i=9007199254740991;e.exports=r},function(e,t,r){function n(e){return o(e)&&i(e.length)&&!!A[I.call(e)]}var i=r(63),o=r(37),s="[object Arguments]",a="[object Array]",u="[object Boolean]",c="[object Date]",l="[object Error]",h="[object Function]",f="[object Map]",d="[object Number]",p="[object Object]",m="[object RegExp]",g="[object Set]",v="[object String]",_="[object WeakMap]",y="[object ArrayBuffer]",x="[object Float32Array]",b="[object Float64Array]",S="[object Int8Array]",E="[object Int16Array]",M="[object Int32Array]",T="[object Uint8Array]",P="[object Uint8ClampedArray]",C="[object Uint16Array]",w="[object Uint32Array]",A={};A[x]=A[b]=A[S]=A[E]=A[M]=A[T]=A[P]=A[C]=A[w]=!0,A[s]=A[a]=A[y]=A[u]=A[c]=A[l]=A[h]=A[f]=A[d]=A[p]=A[m]=A[g]=A[v]=A[_]=!1;var D=Object.prototype,I=D.toString;e.exports=n},function(e,t,r){function n(e){if(null==e)return[];u(e)||(e=Object(e));var t=e.length;t=t&&a(t)&&(o(e)||i(e))&&t||0;for(var r=e.constructor,n=-1,c="function"==typeof r&&r.prototype===e,h=Array(t),f=t>0;++n<t;)h[n]=n+"";for(var d in e)f&&s(d,t)||"constructor"==d&&(c||!l.call(e,d))||h.push(d);return h}var i=r(64),o=r(30),s=r(110),a=r(63),u=r(16),c=Object.prototype,l=c.hasOwnProperty;e.exports=n},function(e,t){"use strict";function r(e,t,r){function n(){s=!0,r.apply(this,arguments)}function i(){s||(e>o?t.call(this,o++,i,n):n.apply(this,arguments))}var o=0,s=!1;i()}function n(e,t,r){function n(e,t,n){s||(t?(s=!0,r(t)):(o[e]=n,s=++a===i,s&&r(null,o)))}var i=e.length,o=[];if(0===i)return r(null,o);var s=!1,a=0;e.forEach(function(e,r){t(e,r,function(e,t){n(r,e,t)})})}t.__esModule=!0,t.loopAsync=r,t.mapAsync=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function o(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}function s(e){return function(){function t(e,t){var r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];return g["default"](e,t,r,T.location,T.routes,T.params)}function r(e){var t=e.pathname,r=e.query,n=e.state;return M.createLocation(M.createPath(t,r),n,c.REPLACE)}function n(e,t){P&&P.location===e?s(P,t):x["default"](S,e,function(r,n){r?t(r):n?s(a({},n,{location:e}),t):t()})}function s(e,t){var n=d["default"](T,e),i=n.leaveRoutes,o=n.enterRoutes;p.runLeaveHooks(i),p.runEnterHooks(o,e,function(n,i){n?t(n):i?t(null,r(i)):_["default"](e,function(r,n){r?t(r):t(null,null,T=a({},e,{components:n}))})})}function u(e){return e.__id__||(e.__id__=C++)}function l(e){return e.reduce(function(e,t){return e.push.apply(e,w[u(t)]),e},[])}function f(e,t){x["default"](S,e,function(r,n){if(null==n)return void t();P=a({},n,{location:e});for(var i=l(d["default"](T,P).leaveRoutes),o=void 0,s=0,u=i.length;null==o&&u>s;++s)o=i[s](e);t(o)})}function m(){if(T.routes){for(var e=l(T.routes),t=void 0,r=0,n=e.length;"string"!=typeof t&&n>r;++r)t=e[r]();return t}}function v(e,t){var r=u(e),n=w[r];if(null==n){var i=!o(w);n=w[r]=[t],i&&(A=M.listenBefore(f),M.listenBeforeUnload&&(D=M.listenBeforeUnload(m)))}else-1===n.indexOf(t)&&n.push(t);return function(){var e=w[r];if(null!=e){var n=e.filter(function(e){return e!==t});0===n.length?(delete w[r],o(w)||(A&&(A(),A=null),D&&(D(),D=null))):w[r]=n}}}function y(e){return M.listen(function(t){T.location===t?e(null,T):n(t,function(t,r,n){t?e(t):r?M.transitionTo(r):n&&e(null,n)})})}var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],S=b.routes,E=i(b,["routes"]),M=h["default"](e)(E),T={},P=void 0,C=1,w={},A=void 0,D=void 0;return a({},M,{isActive:t,match:n,listenBeforeLeavingRoute:v,listen:y})}}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=r(17),c=(n(u),r(50)),l=r(372),h=n(l),f=r(441),d=n(f),p=r(440),m=r(187),g=n(m),v=r(442),_=n(v),y=r(445),x=n(y);t["default"]=s,e.exports=t["default"]},function(e,t,r){"use strict";function n(){this._callbacks=null,this._contexts=null}var i=r(39),o=r(5),s=r(2);o(n.prototype,{enqueue:function(e,t){this._callbacks=this._callbacks||[],this._contexts=this._contexts||[],this._callbacks.push(e),this._contexts.push(t)},notifyAll:function(){var e=this._callbacks,t=this._contexts;if(e){e.length!==t.length?s(!1):void 0,this._callbacks=null,this._contexts=null;for(var r=0;r<e.length;r++)e[r].call(t[r]);e.length=0,t.length=0}},reset:function(){this._callbacks=null,this._contexts=null},destructor:function(){this.reset()}}),i.addPoolingTo(n),e.exports=n},function(e,t,r){"use strict";function n(e){return l.hasOwnProperty(e)?!0:c.hasOwnProperty(e)?!1:u.test(e)?(l[e]=!0,!0):(c[e]=!0,!1)}function i(e,t){return null==t||e.hasBooleanValue&&!t||e.hasNumericValue&&isNaN(t)||e.hasPositiveNumericValue&&1>t||e.hasOverloadedBooleanValue&&t===!1}var o=r(54),s=r(20),a=r(499),u=(r(4),/^[a-zA-Z_][\w\.\-]*$/),c={},l={},h={createMarkupForID:function(e){return o.ID_ATTRIBUTE_NAME+"="+a(e)},setAttributeForID:function(e,t){e.setAttribute(o.ID_ATTRIBUTE_NAME,t)},createMarkupForProperty:function(e,t){var r=o.properties.hasOwnProperty(e)?o.properties[e]:null;if(r){if(i(r,t))return"";var n=r.attributeName;return r.hasBooleanValue||r.hasOverloadedBooleanValue&&t===!0?n+'=""':n+"="+a(t)}return o.isCustomAttribute(e)?null==t?"":e+"="+a(t):null},createMarkupForCustomAttribute:function(e,t){return n(e)&&null!=t?e+"="+a(t):""},setValueForProperty:function(e,t,r){var n=o.properties.hasOwnProperty(t)?o.properties[t]:null;if(n){var s=n.mutationMethod;if(s)s(e,r);else if(i(n,r))this.deleteValueForProperty(e,t);else if(n.mustUseAttribute){var a=n.attributeName,u=n.attributeNamespace;u?e.setAttributeNS(u,a,""+r):n.hasBooleanValue||n.hasOverloadedBooleanValue&&r===!0?e.setAttribute(a,""):e.setAttribute(a,""+r)}else{var c=n.propertyName;n.hasSideEffects&&""+e[c]==""+r||(e[c]=r)}}else o.isCustomAttribute(t)&&h.setValueForAttribute(e,t,r)},setValueForAttribute:function(e,t,r){n(t)&&(null==r?e.removeAttribute(t):e.setAttribute(t,""+r))},deleteValueForProperty:function(e,t){var r=o.properties.hasOwnProperty(t)?o.properties[t]:null;if(r){var n=r.mutationMethod;if(n)n(e,void 0);else if(r.mustUseAttribute)e.removeAttribute(r.attributeName);else{var i=r.propertyName,s=o.getDefaultValueForProperty(e.nodeName,i);r.hasSideEffects&&""+e[i]===s||(e[i]=s)}}else o.isCustomAttribute(t)&&e.removeAttribute(t)}};s.measureMethods(h,"DOMPropertyOperations",{setValueForProperty:"setValueForProperty",setValueForAttribute:"setValueForAttribute",deleteValueForProperty:"deleteValueForProperty"}),e.exports=h},function(e,t,r){"use strict";function n(e){null!=e.checkedLink&&null!=e.valueLink?c(!1):void 0}function i(e){n(e),null!=e.value||null!=e.onChange?c(!1):void 0}function o(e){
n(e),null!=e.checked||null!=e.onChange?c(!1):void 0}function s(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}var a=r(209),u=r(87),c=r(2),l=(r(4),{button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0}),h={value:function(e,t,r){return!e[t]||l[e.type]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(e,t,r){return!e[t]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")},onChange:a.func},f={},d={checkPropTypes:function(e,t,r){for(var n in h){if(h.hasOwnProperty(n))var i=h[n](t,n,e,u.prop);if(i instanceof Error&&!(i.message in f)){f[i.message]=!0;s(r)}}},getValue:function(e){return e.valueLink?(i(e),e.valueLink.value):e.value},getChecked:function(e){return e.checkedLink?(o(e),e.checkedLink.value):e.checked},executeOnChange:function(e,t){return e.valueLink?(i(e),e.valueLink.requestChange(t.target.value)):e.checkedLink?(o(e),e.checkedLink.requestChange(t.target.checked)):e.onChange?e.onChange.call(void 0,t):void 0}};e.exports=d},function(e,t,r){"use strict";var n=r(120),i=r(13),o={processChildrenUpdates:n.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkupByID:n.dangerouslyReplaceNodeWithMarkupByID,unmountIDFromEnvironment:function(e){i.purgeID(e)}};e.exports=o},function(e,t,r){"use strict";var n=r(2),i=!1,o={unmountIDFromEnvironment:null,replaceNodeWithMarkupByID:null,processChildrenUpdates:null,injection:{injectEnvironment:function(e){i?n(!1):void 0,o.unmountIDFromEnvironment=e.unmountIDFromEnvironment,o.replaceNodeWithMarkupByID=e.replaceNodeWithMarkupByID,o.processChildrenUpdates=e.processChildrenUpdates,i=!0}}};e.exports=o},function(e,t,r){"use strict";var n=r(189),i=r(116),o=r(13),s=r(20),a=r(2),u={dangerouslySetInnerHTML:"`dangerouslySetInnerHTML` must be set using `updateInnerHTMLByID()`.",style:"`style` must be set using `updateStylesByID()`."},c={updatePropertyByID:function(e,t,r){var n=o.getNode(e);u.hasOwnProperty(t)?a(!1):void 0,null!=r?i.setValueForProperty(n,t,r):i.deleteValueForProperty(n,t)},dangerouslyReplaceNodeWithMarkupByID:function(e,t){var r=o.getNode(e);n.dangerouslyReplaceNodeWithMarkup(r,t)},dangerouslyProcessChildrenUpdates:function(e,t){for(var r=0;r<e.length;r++)e[r].parentNode=o.getNode(e[r].parentID);n.processUpdates(e,t)}};s.measureMethods(c,"ReactDOMIDOperations",{dangerouslyReplaceNodeWithMarkupByID:"dangerouslyReplaceNodeWithMarkupByID",dangerouslyProcessChildrenUpdates:"dangerouslyProcessChildrenUpdates"}),e.exports=c},function(e,t,r){"use strict";function n(e){a.enqueueUpdate(e)}function i(e,t){var r=s.get(e);return r?r:null}var o=(r(32),r(15)),s=r(68),a=r(21),u=r(5),c=r(2),l=(r(4),{isMounted:function(e){var t=s.get(e);return t?!!t._renderedComponent:!1},enqueueCallback:function(e,t){"function"!=typeof t?c(!1):void 0;var r=i(e);return r?(r._pendingCallbacks?r._pendingCallbacks.push(t):r._pendingCallbacks=[t],void n(r)):null},enqueueCallbackInternal:function(e,t){"function"!=typeof t?c(!1):void 0,e._pendingCallbacks?e._pendingCallbacks.push(t):e._pendingCallbacks=[t],n(e)},enqueueForceUpdate:function(e){var t=i(e,"forceUpdate");t&&(t._pendingForceUpdate=!0,n(t))},enqueueReplaceState:function(e,t){var r=i(e,"replaceState");r&&(r._pendingStateQueue=[t],r._pendingReplaceState=!0,n(r))},enqueueSetState:function(e,t){var r=i(e,"setState");if(r){var o=r._pendingStateQueue||(r._pendingStateQueue=[]);o.push(t),n(r)}},enqueueSetProps:function(e,t){var r=i(e,"setProps");r&&l.enqueueSetPropsInternal(r,t)},enqueueSetPropsInternal:function(e,t){var r=e._topLevelWrapper;r?void 0:c(!1);var i=r._pendingElement||r._currentElement,s=i.props,a=u({},s.props,t);r._pendingElement=o.cloneAndReplaceProps(i,o.cloneAndReplaceProps(s,a)),n(r)},enqueueReplaceProps:function(e,t){var r=i(e,"replaceProps");r&&l.enqueueReplacePropsInternal(r,t)},enqueueReplacePropsInternal:function(e,t){var r=e._topLevelWrapper;r?void 0:c(!1);var i=r._pendingElement||r._currentElement,s=i.props;r._pendingElement=o.cloneAndReplaceProps(i,o.cloneAndReplaceProps(s,t)),n(r)},enqueueElementInternal:function(e,t){e._pendingElement=t,n(e)}});e.exports=l},function(e,t){"use strict";e.exports="0.14.5"},function(e,t,r){"use strict";function n(e){return null==e?null:1===e.nodeType?e:i.has(e)?o.getNodeFromInstance(e):(null!=e.render&&"function"==typeof e.render?s(!1):void 0,void s(!1))}var i=(r(32),r(68)),o=r(13),s=r(2);r(4);e.exports=n},function(e,t){"use strict";function r(e){var t,r=e.keyCode;return"charCode"in e?(t=e.charCode,0===t&&13===r&&(t=13)):t=r,t>=32||13===t?t:0}e.exports=r},function(e,t){"use strict";function r(e){var t=this,r=t.nativeEvent;if(r.getModifierState)return r.getModifierState(e);var n=i[e];return n?!!r[n]:!1}function n(e){return r}var i={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};e.exports=n},function(e,t){"use strict";function r(e){var t=e.target||e.srcElement||window;return 3===t.nodeType?t.parentNode:t}e.exports=r},function(e,t){"use strict";function r(e){var t=e&&(n&&e[n]||e[i]);return"function"==typeof t?t:void 0}var n="function"==typeof Symbol&&Symbol.iterator,i="@@iterator";e.exports=r},function(e,t,r){"use strict";function n(e){return"function"==typeof e&&"undefined"!=typeof e.prototype&&"function"==typeof e.prototype.mountComponent&&"function"==typeof e.prototype.receiveComponent}function i(e){var t;if(null===e||e===!1)t=new s(i);else if("object"==typeof e){var r=e;!r||"function"!=typeof r.type&&"string"!=typeof r.type?c(!1):void 0,t="string"==typeof r.type?a.createInternalComponent(r):n(r.type)?new r.type(r):new l}else"string"==typeof e||"number"==typeof e?t=a.createInstanceForText(e):c(!1);return t.construct(e),t._mountIndex=0,t._mountImage=null,t}var o=r(460),s=r(201),a=r(207),u=r(5),c=r(2),l=(r(4),function(){});u(l.prototype,o.Mixin,{_instantiateReactComponent:i}),e.exports=i},function(e,t,r){"use strict";/**
	 * Checks if an event is supported in the current execution environment.
	 *
	 * NOTE: This will not work correctly for non-generic events such as `change`,
	 * `reset`, `load`, `error`, and `select`.
	 *
	 * Borrows from Modernizr.
	 *
	 * @param {string} eventNameSuffix Event name, e.g. "click".
	 * @param {?boolean} capture Check if the capture phase is supported.
	 * @return {boolean} True if the event is supported.
	 * @internal
	 * @license Modernizr 3.0.0pre (Custom Build) | MIT
	 */
function n(e,t){if(!o.canUseDOM||t&&!("addEventListener"in document))return!1;var r="on"+e,n=r in document;if(!n){var s=document.createElement("div");s.setAttribute(r,"return;"),n="function"==typeof s[r]}return!n&&i&&"wheel"===e&&(n=document.implementation.hasFeature("Events.wheel","3.0")),n}var i,o=r(12);o.canUseDOM&&(i=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0),e.exports=n},function(e,t,r){"use strict";var n=r(12),i=r(91),o=r(92),s=function(e,t){e.textContent=t};n.canUseDOM&&("textContent"in document.documentElement||(s=function(e,t){o(e,i(t))})),e.exports=s},function(e,t){"use strict";function r(e,t){var r=null===e||e===!1,n=null===t||t===!1;if(r||n)return r===n;var i=typeof e,o=typeof t;return"string"===i||"number"===i?"string"===o||"number"===o:"object"===o&&e.type===t.type&&e.key===t.key}e.exports=r},function(e,t,r){"use strict";function n(e){return m[e]}function i(e,t){return e&&null!=e.key?s(e.key):t.toString(36)}function o(e){return(""+e).replace(g,n)}function s(e){return"$"+o(e)}function a(e,t,r,n){var o=typeof e;if(("undefined"===o||"boolean"===o)&&(e=null),null===e||"string"===o||"number"===o||c.isValidElement(e))return r(n,e,""===t?d+i(e,0):t),1;var u,l,m=0,g=""===t?d:t+p;if(Array.isArray(e))for(var v=0;v<e.length;v++)u=e[v],l=g+i(u,v),m+=a(u,l,r,n);else{var _=h(e);if(_){var y,x=_.call(e);if(_!==e.entries)for(var b=0;!(y=x.next()).done;)u=y.value,l=g+i(u,b++),m+=a(u,l,r,n);else for(;!(y=x.next()).done;){var S=y.value;S&&(u=S[1],l=g+s(S[0])+p+i(u,0),m+=a(u,l,r,n))}}else if("object"===o){String(e);f(!1)}}return m}function u(e,t,r){return null==e?0:a(e,"",t,r)}var c=(r(32),r(15)),l=r(55),h=r(127),f=r(2),d=(r(4),l.SEPARATOR),p=":",m={"=":"=0",".":"=1",":":"=2"},g=/[=.:]/g;e.exports=u},function(e,t,r){"use strict";var n=(r(5),r(26)),i=(r(4),n);e.exports=i},function(e,t,r){"use strict";function n(e){return{type:a.ROUTER_DID_CHANGE,payload:e}}function i(e){return{type:a.INIT_ROUTES,payload:e}}function o(e){return{type:a.REPLACE_ROUTES,payload:e}}function s(e){return function(){for(var t=arguments.length,r=Array(t),n=0;t>n;n++)r[n]=arguments[n];return{type:a.HISTORY_API,payload:{method:e,args:r}}}}t.__esModule=!0,t.routerDidChange=n,t.initRoutes=i,t.replaceRoutes=o,t.historyAPI=s;var a=r(46),u=s("pushState");t.pushState=u;var c=s("push");t.push=c;var l=s("replaceState");t.replaceState=l;var h=s("replace");t.replace=h;var f=s("setState");t.setState=f;var d=s("go");t.go=d;var p=s("goBack");t.goBack=p;var m=s("goForward");t.goForward=m},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){return n({},d.CALL_API,{types:[p,m,g],endpoint:"users/"+e,schema:d.Schemas.USER})}function o(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return function(r,n){var o=n().entities.users[e];return o&&t.every(function(e){return o.hasOwnProperty(e)})?null:r(i(e))}}function s(e){return n({},d.CALL_API,{types:[v,_,y],endpoint:"repos/"+e,schema:d.Schemas.REPO})}function a(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return function(r,n){var i=n().entities.repos[e];return i&&t.every(function(e){return i.hasOwnProperty(e)})?null:r(s(e))}}function u(e,t){return n({login:e},d.CALL_API,{types:[x,b,S],endpoint:t,schema:d.Schemas.REPO_ARRAY})}function c(e,t){return function(r,n){var i=n().pagination.starredByUser[e]||{},o=i.nextPageUrl,s=void 0===o?"users/"+e+"/starred":o,a=i.pageCount,c=void 0===a?0:a;return c>0&&!t?null:r(u(e,s))}}function l(e,t){return n({fullName:e},d.CALL_API,{types:[E,M,T],endpoint:t,schema:d.Schemas.USER_ARRAY})}function h(e,t){return function(r,n){var i=n().pagination.stargazersByRepo[e]||{},o=i.nextPageUrl,s=void 0===o?"repos/"+e+"/stargazers":o,a=i.pageCount,u=void 0===a?0:a;return u>0&&!t?null:r(l(e,s))}}function f(){return{type:P}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadUser=o,t.loadRepo=a,t.loadStarred=c,t.loadStargazers=h,t.resetErrorMessage=f;var d=r(136),p="USER_REQUEST";t.USER_REQUEST=p;var m="USER_SUCCESS";t.USER_SUCCESS=m;var g="USER_FAILURE";t.USER_FAILURE=g;var v="REPO_REQUEST";t.REPO_REQUEST=v;var _="REPO_SUCCESS";t.REPO_SUCCESS=_;var y="REPO_FAILURE";t.REPO_FAILURE=y;var x="STARRED_REQUEST";t.STARRED_REQUEST=x;var b="STARRED_SUCCESS";t.STARRED_SUCCESS=b;var S="STARRED_FAILURE";t.STARRED_FAILURE=S;var E="STARGAZERS_REQUEST";t.STARGAZERS_REQUEST=E;var M="STARGAZERS_SUCCESS";t.STARGAZERS_SUCCESS=M;var T="STARGAZERS_FAILURE";t.STARGAZERS_FAILURE=T;var P="RESET_ERROR_MESSAGE";t.RESET_ERROR_MESSAGE=P},function(e,t,r){"use strict";function n(e){var t=e.headers.get("link");if(!t)return null;var r=t.split(",").find(function(e){return e.indexOf('rel="next"')>-1});return r?r.split(";")[0].slice(1,-1):null}function i(e,t){var r=-1===e.indexOf(u)?u+e:e;return fetch(r).then(function(e){return e.json().then(function(t){return{json:t,response:e}})}).then(function(e){var r=e.json,i=e.response;if(!i.ok)return Promise.reject(r);var o=(0,a.camelizeKeys)(r),u=n(i);return Object.assign({},(0,s.normalize)(o,t),{nextPageUrl:u})})}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=r(423),a=r(373);r(374);var u="https://api.github.com/",c=new s.Schema("users",{idAttribute:"login"}),l=new s.Schema("repos",{idAttribute:"fullName"});l.define({owner:c});var h={USER:c,USER_ARRAY:(0,s.arrayOf)(c),REPO:l,REPO_ARRAY:(0,s.arrayOf)(l)};t.Schemas=h;var f=Symbol("Call API");t.CALL_API=f,t["default"]=function(e){return function(t){return function(r){function n(e){var t=Object.assign({},r,e);return delete t[f],t}var s=r[f];if("undefined"==typeof s)return t(r);var a=s.endpoint,u=s.schema,c=s.types;if("function"==typeof a&&(a=a(e.getState())),"string"!=typeof a)throw new Error("Specify a string endpoint URL.");if(!u)throw new Error("Specify one of the exported Schemas.");if(!Array.isArray(c)||3!==c.length)throw new Error("Expected an array of three action types.");if(!c.every(function(e){return"string"==typeof e}))throw new Error("Expected action types to be strings.");var l=o(c,3),h=l[0],d=l[1],p=l[2];return t(n({type:h})),i(a,u).then(function(e){return t(n({response:e,type:d}))},function(e){return t(n({type:p,error:e.message||"Something bad happened"}))})}}}},function(e,t){var r,n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};!function(e){var t=function(){function t(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this.r=e,this.g=t,this.b=r}return t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},t.prototype.toColor4=function(e){return void 0===e&&(e=1),new r(this.r,this.g,this.b,e)},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(e){return new t(this.r*e.r,this.g*e.g,this.b*e.b)},t.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},t.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},t.prototype.equalsFloats=function(e,t,r){return this.r===e&&this.g===t&&this.b===r},t.prototype.scale=function(e){return new t(this.r*e,this.g*e,this.b*e)},t.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},t.prototype.add=function(e){return new t(this.r+e.r,this.g+e.g,this.b+e.b)},t.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},t.prototype.subtract=function(e){return new t(this.r-e.r,this.g-e.g,this.b-e.b)},t.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},t.prototype.copyFromFloats=function(e,t,r){return this.r=e,this.g=t,this.b=r,this},t.prototype.toHexString=function(){var t=255*this.r|0,r=255*this.g|0,n=255*this.b|0;return"#"+e.Tools.ToHex(t)+e.Tools.ToHex(r)+e.Tools.ToHex(n)},t.FromHexString=function(r){if("#"!==r.substring(0,1)||7!==r.length)return e.Tools.Warn("Color3.FromHexString must be called with a string like #FFFFFF"),new t(0,0,0);var n=parseInt(r.substring(1,3),16),i=parseInt(r.substring(3,5),16),o=parseInt(r.substring(5,7),16);return t.FromInts(n,i,o)},t.FromArray=function(e,r){return void 0===r&&(r=0),new t(e[r],e[r+1],e[r+2])},t.FromInts=function(e,r,n){return new t(e/255,r/255,n/255)},t.Lerp=function(e,r,n){var i=e.r+(r.r-e.r)*n,o=e.g+(r.g-e.g)*n,s=e.b+(r.b-e.b)*n;return new t(i,o,s)},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t}();e.Color3=t;var r=function(){function t(e,t,r,n){this.r=e,this.g=t,this.b=r,this.a=n}return t.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},t.prototype.add=function(e){return new t(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)},t.prototype.subtract=function(e){return new t(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)},t.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},t.prototype.scale=function(e){return new t(this.r*e,this.g*e,this.b*e,this.a*e)},t.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},t.prototype.toHexString=function(){var t=255*this.r|0,r=255*this.g|0,n=255*this.b|0,i=255*this.a|0;return"#"+e.Tools.ToHex(t)+e.Tools.ToHex(r)+e.Tools.ToHex(n)+e.Tools.ToHex(i)},t.FromHexString=function(r){if("#"!==r.substring(0,1)||9!==r.length)return e.Tools.Warn("Color4.FromHexString must be called with a string like #FFFFFFFF"),new t(0,0,0,0);var n=parseInt(r.substring(1,3),16),i=parseInt(r.substring(3,5),16),o=parseInt(r.substring(5,7),16),s=parseInt(r.substring(7,9),16);return t.FromInts(n,i,o,s)},t.Lerp=function(e,r,n){var i=new t(0,0,0,0);return t.LerpToRef(e,r,n,i),i},t.LerpToRef=function(e,t,r,n){n.r=e.r+(t.r-e.r)*r,n.g=e.g+(t.g-e.g)*r,n.b=e.b+(t.b-e.b)*r,n.a=e.a+(t.a-e.a)*r},t.FromArray=function(e,r){return void 0===r&&(r=0),new t(e[r],e[r+1],e[r+2],e[r+3])},t.FromInts=function(e,r,n,i){return new t(e/255,r/255,n/255,i/255)},t}();e.Color4=r;var n=function(){function t(e,t){this.x=e,this.y=t}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},t.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.addVector3=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},t.prototype.multiplyByFloats=function(e,r){return new t(this.x*e,this.y*r)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},t.prototype.scale=function(e){return new t(this.x*e,this.y*e)},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},t.prototype.equalsWithEpsilon=function(t,r){return void 0===r&&(r=e.Engine.Epsilon),t&&e.Tools.WithinEpsilon(this.x,t.x,r)&&e.Tools.WithinEpsilon(this.y,t.y,r)},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.Zero=function(){return new t(0,0)},t.FromArray=function(e,r){return void 0===r&&(r=0),new t(e[r],e[r+1])},t.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1]},t.CatmullRom=function(e,r,n,i,o){var s=o*o,a=o*s,u=.5*(2*r.x+(-e.x+n.x)*o+(2*e.x-5*r.x+4*n.x-i.x)*s+(-e.x+3*r.x-3*n.x+i.x)*a),c=.5*(2*r.y+(-e.y+n.y)*o+(2*e.y-5*r.y+4*n.y-i.y)*s+(-e.y+3*r.y-3*n.y+i.y)*a);return new t(u,c)},t.Clamp=function(e,r,n){var i=e.x;i=i>n.x?n.x:i,i=i<r.x?r.x:i;var o=e.y;return o=o>n.y?n.y:o,o=o<r.y?r.y:o,new t(i,o)},t.Hermite=function(e,r,n,i,o){var s=o*o,a=o*s,u=2*a-3*s+1,c=-2*a+3*s,l=a-2*s+o,h=a-s,f=e.x*u+n.x*c+r.x*l+i.x*h,d=e.y*u+n.y*c+r.y*l+i.y*h;return new t(f,d)},t.Lerp=function(e,r,n){var i=e.x+(r.x-e.x)*n,o=e.y+(r.y-e.y)*n;return new t(i,o)},t.Dot=function(e,t){return e.x*t.x+e.y*t.y},t.Normalize=function(e){var t=e.clone();return t.normalize(),t},t.Minimize=function(e,r){var n=e.x<r.x?e.x:r.x,i=e.y<r.y?e.y:r.y;return new t(n,i)},t.Maximize=function(e,r){var n=e.x>r.x?e.x:r.x,i=e.y>r.y?e.y:r.y;return new t(n,i)},t.Transform=function(e,r){var n=e.x*r.m[0]+e.y*r.m[4],i=e.x*r.m[1]+e.y*r.m[5];return new t(n,i)},t.Distance=function(e,r){return Math.sqrt(t.DistanceSquared(e,r))},t.DistanceSquared=function(e,t){var r=e.x-t.x,n=e.y-t.y;return r*r+n*n},t}();e.Vector2=n;var i=function(){function t(e,t,r){this.x=e,this.y=t,this.z=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,this},t.prototype.toQuaternion=function(){var e=new s(0,0,0,1),t=Math.cos(.5*(this.x+this.z)),r=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),i=Math.sin(.5*(this.z-this.x)),o=Math.cos(.5*this.y),a=Math.sin(.5*this.y);return e.x=n*a,e.y=-i*a,e.z=r*o,e.w=t*o,e},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,this},t.prototype.subtractFromFloats=function(e,r,n){return new t(this.x-e,this.y-r,this.z-n)},t.prototype.subtractFromFloatsToRef=function(e,t,r,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-r,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.z*e)},t.prototype.scaleToRef=function(e,t){t.x=this.x*e,t.y=this.y*e,t.z=this.z*e},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},t.prototype.equalsWithEpsilon=function(t,r){return void 0===r&&(r=e.Engine.Epsilon),t&&e.Tools.WithinEpsilon(this.x,t.x,r)&&e.Tools.WithinEpsilon(this.y,t.y,r)&&e.Tools.WithinEpsilon(this.z,t.z,r)},t.prototype.equalsToFloats=function(e,t,r){return this.x===e&&this.y===t&&this.z===r},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z)},t.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,this},t.prototype.multiplyByFloats=function(e,r,n){return new t(this.x*e,this.y*r,this.z*n)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y,this.z/e.z)},t.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,this},t.prototype.MinimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),this},t.prototype.MaximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){var e=this.length();if(0===e||1===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},t.prototype.copyFromFloats=function(e,t,r){return this.x=e,this.y=t,this.z=r,this},t.GetClipFactor=function(e,r,n,i){var o=t.Dot(e,n)-i,s=t.Dot(r,n)-i,a=o/(o-s);return a},t.FromArray=function(e,r){return r||(r=0),new t(e[r],e[r+1],e[r+2])},t.FromFloatArray=function(e,r){return r||(r=0),new t(e[r],e[r+1],e[r+2])},t.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2]},t.FromFloatArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2]},t.FromFloatsToRef=function(e,t,r,n){n.x=e,n.y=t,n.z=r},t.Zero=function(){return new t(0,0,0)},t.Up=function(){return new t(0,1,0)},t.TransformCoordinates=function(e,r){var n=t.Zero();return t.TransformCoordinatesToRef(e,r,n),n},t.TransformCoordinatesToRef=function(e,t,r){var n=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8]+t.m[12],i=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9]+t.m[13],o=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10]+t.m[14],s=e.x*t.m[3]+e.y*t.m[7]+e.z*t.m[11]+t.m[15];r.x=n/s,r.y=i/s,r.z=o/s},t.TransformCoordinatesFromFloatsToRef=function(e,t,r,n,i){var o=e*n.m[0]+t*n.m[4]+r*n.m[8]+n.m[12],s=e*n.m[1]+t*n.m[5]+r*n.m[9]+n.m[13],a=e*n.m[2]+t*n.m[6]+r*n.m[10]+n.m[14],u=e*n.m[3]+t*n.m[7]+r*n.m[11]+n.m[15];i.x=o/u,i.y=s/u,i.z=a/u},t.TransformCoordinatesToRefSIMD=function(e,t,r){var n=SIMD.float32x4.loadXYZ(e._data,0),i=SIMD.float32x4.load(t.m,0),o=SIMD.float32x4.load(t.m,4),s=SIMD.float32x4.load(t.m,8),a=SIMD.float32x4.load(t.m,12),u=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),i),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),o)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),s),a));u=SIMD.float32x4.div(u,SIMD.float32x4.swizzle(u,3,3,3,3)),SIMD.float32x4.storeXYZ(r._data,0,u)},t.TransformCoordinatesFromFloatsToRefSIMD=function(e,t,r,n,i){var o=SIMD.float32x4.splat(e),s=SIMD.float32x4.splat(t),a=SIMD.float32x4.splat(r),u=SIMD.float32x4.load(n.m,0),c=SIMD.float32x4.load(n.m,4),l=SIMD.float32x4.load(n.m,8),h=SIMD.float32x4.load(n.m,12),f=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(o,u),SIMD.float32x4.mul(s,c)),SIMD.float32x4.add(SIMD.float32x4.mul(a,l),h));f=SIMD.float32x4.div(f,SIMD.float32x4.swizzle(f,3,3,3,3)),SIMD.float32x4.storeXYZ(i._data,0,f)},t.TransformNormal=function(e,r){var n=t.Zero();return t.TransformNormalToRef(e,r,n),n},t.TransformNormalToRef=function(e,t,r){r.x=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8],r.y=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9],r.z=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10]},t.TransformNormalFromFloatsToRef=function(e,t,r,n,i){i.x=e*n.m[0]+t*n.m[4]+r*n.m[8],i.y=e*n.m[1]+t*n.m[5]+r*n.m[9],i.z=e*n.m[2]+t*n.m[6]+r*n.m[10]},t.CatmullRom=function(e,r,n,i,o){var s=o*o,a=o*s,u=.5*(2*r.x+(-e.x+n.x)*o+(2*e.x-5*r.x+4*n.x-i.x)*s+(-e.x+3*r.x-3*n.x+i.x)*a),c=.5*(2*r.y+(-e.y+n.y)*o+(2*e.y-5*r.y+4*n.y-i.y)*s+(-e.y+3*r.y-3*n.y+i.y)*a),l=.5*(2*r.z+(-e.z+n.z)*o+(2*e.z-5*r.z+4*n.z-i.z)*s+(-e.z+3*r.z-3*n.z+i.z)*a);return new t(u,c,l)},t.Clamp=function(e,r,n){var i=e.x;i=i>n.x?n.x:i,i=i<r.x?r.x:i;var o=e.y;o=o>n.y?n.y:o,o=o<r.y?r.y:o;var s=e.z;return s=s>n.z?n.z:s,s=s<r.z?r.z:s,new t(i,o,s)},t.Hermite=function(e,r,n,i,o){var s=o*o,a=o*s,u=2*a-3*s+1,c=-2*a+3*s,l=a-2*s+o,h=a-s,f=e.x*u+n.x*c+r.x*l+i.x*h,d=e.y*u+n.y*c+r.y*l+i.y*h,p=e.z*u+n.z*c+r.z*l+i.z*h;return new t(f,d,p)},t.Lerp=function(e,r,n){var i=e.x+(r.x-e.x)*n,o=e.y+(r.y-e.y)*n,s=e.z+(r.z-e.z)*n;return new t(i,o,s)},t.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.Cross=function(e,r){var n=t.Zero();return t.CrossToRef(e,r,n),n},t.CrossToRef=function(e,t,r){r.x=e.y*t.z-e.z*t.y,r.y=e.z*t.x-e.x*t.z,r.z=e.x*t.y-e.y*t.x},t.Normalize=function(e){var r=t.Zero();return t.NormalizeToRef(e,r),r},t.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},t.Project=function(e,r,n,i){var o=i.width,s=i.height,u=i.x,c=i.y,l=a.FromValues(o/2,0,0,0,0,-s/2,0,0,0,0,1,0,u+o/2,s/2+c,0,1),h=r.multiply(n).multiply(l);return t.TransformCoordinates(e,h)},t.UnprojectFromTransform=function(r,n,i,o,s){var a=o.multiply(s);a.invert(),r.x=r.x/n*2-1,r.y=-(r.y/i*2-1);var u=t.TransformCoordinates(r,a),c=r.x*a.m[3]+r.y*a.m[7]+r.z*a.m[11]+a.m[15];return e.Tools.WithinEpsilon(c,1)&&(u=u.scale(1/c)),u},t.Unproject=function(r,n,i,o,s,a){var u=o.multiply(s).multiply(a);u.invert();var c=new t(r.x/n*2-1,-(r.y/i*2-1),r.z),l=t.TransformCoordinates(c,u),h=c.x*u.m[3]+c.y*u.m[7]+c.z*u.m[11]+u.m[15];return e.Tools.WithinEpsilon(h,1)&&(l=l.scale(1/h)),l},t.Minimize=function(e,t){var r=e.clone();return r.MinimizeInPlace(t),r},t.Maximize=function(e,t){var r=e.clone();return r.MaximizeInPlace(t),r},t.Distance=function(e,r){return Math.sqrt(t.DistanceSquared(e,r))},t.DistanceSquared=function(e,t){var r=e.x-t.x,n=e.y-t.y,i=e.z-t.z;return r*r+n*n+i*i},t.Center=function(e,t){var r=e.add(t);return r.scaleInPlace(.5),r},t.RotationFromAxis=function(e,r,n){var i=t.Zero();return t.RotationFromAxisToRef(e,r,n,i),i},t.RotationFromAxisToRef=function(r,n,i,o){var s,a,u,c=t.Normalize(r),l=t.Normalize(i),h=f.X,d=f.Y,p=0,m=0,g=0,v=0,_=0,y=0,x=0,b=-1,S=0,E=0;e.Tools.WithinEpsilon(l.z,0,e.Engine.Epsilon)?y=1:e.Tools.WithinEpsilon(l.x,0,e.Engine.Epsilon)?v=1:(x=l.z/l.x,v=-x*Math.sqrt(1/(1+x*x)),y=Math.sqrt(1/(1+x*x))),a=new t(v,_,y),a.normalize(),u=t.Cross(l,a),u.normalize(),s=t.Cross(c,a),s.normalize(),t.Dot(l,s)<0&&(b=1),E=t.Dot(c,a),E=Math.min(1,Math.max(-1,E)),g=Math.acos(E)*b,t.Dot(a,h)<0&&(g=Math.PI+g,a=a.scaleInPlace(-1),u=u.scaleInPlace(-1),S++);var M,T;v=0,_=0,y=0,b=-1,e.Tools.WithinEpsilon(l.z,0,e.Engine.Epsilon)?v=1:(x=a.z/a.x,v=-x*Math.sqrt(1/(1+x*x)),y=Math.sqrt(1/(1+x*x))),M=new t(v,_,y),M.normalize(),T=t.Cross(M,a),T.normalize(),s=t.Cross(l,M),s.normalize(),t.Dot(a,s)<0&&(b=1),E=t.Dot(l,M),E=Math.min(1,Math.max(-1,E)),m=Math.acos(E)*b,t.Dot(T,d)<0&&(m=Math.PI+m,T=T.scaleInPlace(-1),M=M.scaleInPlace(-1),S++),b=-1,s=t.Cross(h,a),s.normalize(),t.Dot(s,d)<0&&(b=1),E=t.Dot(a,h),E=Math.min(1,Math.max(-1,E)),p=-Math.acos(E)*b,0>E&&2>S&&(p=Math.PI+p),o.x=m,o.y=p,o.z=g},t}();e.Vector3=i;var o=function(){function t(e,t,r,n){this.x=e,this.y=t,this.z=r,this.w=n}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},t.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},t.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},t.prototype.subtractFromFloats=function(e,r,n,i){return new t(this.x-e,this.y-r,this.z-n,this.w-i)},t.prototype.subtractFromFloatsToRef=function(e,t,r,n,i){return i.x=this.x-e,i.y=this.y-t,i.z=this.z-r,i.w=this.w-n,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.z*e,this.w*e)},t.prototype.scaleToRef=function(e,t){t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},t.prototype.equalsWithEpsilon=function(t,r){return void 0===r&&(r=e.Engine.Epsilon),t&&e.Tools.WithinEpsilon(this.x,t.x,r)&&e.Tools.WithinEpsilon(this.y,t.y,r)&&e.Tools.WithinEpsilon(this.z,t.z,r)&&e.Tools.WithinEpsilon(this.w,t.w,r)},t.prototype.equalsToFloats=function(e,t,r,n){return this.x===e&&this.y===t&&this.z===r&&this.w===n},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},t.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},t.prototype.multiplyByFloats=function(e,r,n,i){return new t(this.x*e,this.y*r,this.z*n,this.w*i)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},t.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},t.prototype.MinimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},t.prototype.MaximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},t.prototype.copyFromFloats=function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},t.FromArray=function(e,r){return r||(r=0),new t(e[r],e[r+1],e[r+2],e[r+3])},t.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.w=e[t+3]},t.FromFloatArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.w=e[t+3]},t.FromFloatsToRef=function(e,t,r,n,i){i.x=e,i.y=t,i.z=r,i.w=n},t.Zero=function(){return new t(0,0,0,0)},t.Normalize=function(e){var r=t.Zero();return t.NormalizeToRef(e,r),r},t.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},t.Minimize=function(e,t){var r=e.clone();return r.MinimizeInPlace(t),r},t.Maximize=function(e,t){var r=e.clone();return r.MaximizeInPlace(t),r},t.Distance=function(e,r){return Math.sqrt(t.DistanceSquared(e,r))},t.DistanceSquared=function(e,t){var r=e.x-t.x,n=e.y-t.y,i=e.z-t.z,o=e.w-t.w;return r*r+n*n+i*i+o*o},t.Center=function(e,t){var r=e.add(t);return r.scaleInPlace(.5),r},t}();e.Vector4=o;var s=function(){function e(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=1),this.x=e,this.y=t,this.z=r,this.w=n}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.multiply=function(t){var r=new e(0,0,0,1);return this.multiplyToRef(t,r),r},e.prototype.multiplyToRef=function(e,t){var r=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,n=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,i=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,o=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w;return t.copyFromFloats(r,n,i,o),this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var e=1/this.length();return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.toEulerAngles=function(){var e=i.Zero();return this.toEulerAnglesToRef(e),e},e.prototype.toEulerAnglesToRef=function(e){var t=this.x,r=this.y,n=this.z,i=this.w,o=t*r,s=t*n,a=i*r,u=i*n,c=i*t,l=r*n,h=t*t,f=r*r,d=h+f;return 0!==d&&1!==d?(e.x=Math.atan2(s+a,c-l),e.y=Math.acos(1-2*d),e.z=Math.atan2(s-a,c+l)):0===d?(e.x=0,e.y=0,e.z=Math.atan2(o-u,.5-f-n*n)):(e.x=Math.atan2(o-u,.5-f-n*n),e.y=Math.PI,e.z=0),this},e.prototype.toRotationMatrix=function(e){var t=this.x*this.x,r=this.y*this.y,n=this.z*this.z,i=this.x*this.y,o=this.z*this.w,s=this.z*this.x,a=this.y*this.w,u=this.y*this.z,c=this.x*this.w;return e.m[0]=1-2*(r+n),e.m[1]=2*(i+o),e.m[2]=2*(s-a),e.m[3]=0,e.m[4]=2*(i-o),e.m[5]=1-2*(n+t),e.m[6]=2*(u+c),e.m[7]=0,e.m[8]=2*(s+a),e.m[9]=2*(u-c),e.m[10]=1-2*(r+t),e.m[11]=0,e.m[12]=0,e.m[13]=0,e.m[14]=0,e.m[15]=1,this},e.prototype.fromRotationMatrix=function(t){return e.FromRotationMatrixToRef(t,this),this},e.FromRotationMatrix=function(t){var r=new e;return e.FromRotationMatrixToRef(t,r),r},e.FromRotationMatrixToRef=function(e,t){var r,n=e.m,i=n[0],o=n[4],s=n[8],a=n[1],u=n[5],c=n[9],l=n[2],h=n[6],f=n[10],d=i+u+f;d>0?(r=.5/Math.sqrt(d+1),t.w=.25/r,t.x=(h-c)*r,t.y=(s-l)*r,t.z=(a-o)*r):i>u&&i>f?(r=2*Math.sqrt(1+i-u-f),t.w=(h-c)/r,t.x=.25*r,t.y=(o+a)/r,t.z=(s+l)/r):u>f?(r=2*Math.sqrt(1+u-i-f),t.w=(s-l)/r,t.x=(o+a)/r,t.y=.25*r,t.z=(c+h)/r):(r=2*Math.sqrt(1+f-i-u),t.w=(a-o)/r,t.x=(s+l)/r,t.y=(c+h)/r,t.z=.25*r)},e.Inverse=function(t){return new e(-t.x,-t.y,-t.z,t.w)},e.Identity=function(){return new e(0,0,0,1)},e.RotationAxis=function(t,r){var n=new e,i=Math.sin(r/2);return n.w=Math.cos(r/2),n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n},e.FromArray=function(t,r){return r||(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.RotationYawPitchRoll=function(t,r,n){var i=new e;return e.RotationYawPitchRollToRef(t,r,n,i),i},e.RotationYawPitchRollToRef=function(e,t,r,n){var i=.5*r,o=.5*t,s=.5*e,a=Math.sin(i),u=Math.cos(i),c=Math.sin(o),l=Math.cos(o),h=Math.sin(s),f=Math.cos(s);n.x=f*c*u+h*l*a,n.y=h*l*u-f*c*a,n.z=f*l*a-h*c*u,n.w=f*l*u+h*c*a},e.RotationAlphaBetaGamma=function(t,r,n){var i=new e;return e.RotationAlphaBetaGammaToRef(t,r,n,i),i},e.RotationAlphaBetaGammaToRef=function(e,t,r,n){var i=.5*(r+e),o=.5*(r-e),s=.5*t;n.x=Math.cos(o)*Math.sin(s),n.y=Math.sin(o)*Math.sin(s),n.z=Math.sin(i)*Math.cos(s),n.w=Math.cos(i)*Math.cos(s)},e.Slerp=function(t,r,n){
var i,o,s=n,a=t.x*r.x+t.y*r.y+t.z*r.z+t.w*r.w,u=!1;if(0>a&&(u=!0,a=-a),a>.999999)o=1-s,i=u?-s:s;else{var c=Math.acos(a),l=1/Math.sin(c);o=Math.sin((1-s)*c)*l,i=u?-Math.sin(s*c)*l:Math.sin(s*c)*l}return new e(o*t.x+i*r.x,o*t.y+i*r.y,o*t.z+i*r.z,o*t.w+i*r.w)},e}();e.Quaternion=s;var a=function(){function t(){this.m=new Float32Array(16)}return t.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?!1:!0},t.prototype.determinant=function(){var e=this.m[10]*this.m[15]-this.m[11]*this.m[14],t=this.m[9]*this.m[15]-this.m[11]*this.m[13],r=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],i=this.m[8]*this.m[14]-this.m[10]*this.m[12],o=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*e-this.m[6]*t+this.m[7]*r)-this.m[1]*(this.m[4]*e-this.m[6]*n+this.m[7]*i)+this.m[2]*(this.m[4]*t-this.m[5]*n+this.m[7]*o)-this.m[3]*(this.m[4]*r-this.m[5]*i+this.m[6]*o)},t.prototype.toArray=function(){return this.m},t.prototype.asArray=function(){return this.toArray()},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){for(var e=0;16>e;e++)this.m[e]=0;return this},t.prototype.add=function(e){var r=new t;return this.addToRef(e,r),r},t.prototype.addToRef=function(e,t){for(var r=0;16>r;r++)t.m[r]=this.m[r]+e.m[r];return this},t.prototype.addToSelf=function(e){for(var t=0;16>t;t++)this.m[t]+=e.m[t];return this},t.prototype.invertToRef=function(e){var t=this.m[0],r=this.m[1],n=this.m[2],i=this.m[3],o=this.m[4],s=this.m[5],a=this.m[6],u=this.m[7],c=this.m[8],l=this.m[9],h=this.m[10],f=this.m[11],d=this.m[12],p=this.m[13],m=this.m[14],g=this.m[15],v=h*g-f*m,_=l*g-f*p,y=l*m-h*p,x=c*g-f*d,b=c*m-h*d,S=c*p-l*d,E=s*v-a*_+u*y,M=-(o*v-a*x+u*b),T=o*_-s*x+u*S,P=-(o*y-s*b+a*S),C=1/(t*E+r*M+n*T+i*P),w=a*g-u*m,A=s*g-u*p,D=s*m-a*p,I=o*g-u*d,R=o*m-a*d,O=o*p-s*d,L=a*f-u*h,F=s*f-u*l,V=s*h-a*l,k=o*f-u*c,B=o*h-a*c,N=o*l-s*c;return e.m[0]=E*C,e.m[4]=M*C,e.m[8]=T*C,e.m[12]=P*C,e.m[1]=-(r*v-n*_+i*y)*C,e.m[5]=(t*v-n*x+i*b)*C,e.m[9]=-(t*_-r*x+i*S)*C,e.m[13]=(t*y-r*b+n*S)*C,e.m[2]=(r*w-n*A+i*D)*C,e.m[6]=-(t*w-n*I+i*R)*C,e.m[10]=(t*A-r*I+i*O)*C,e.m[14]=-(t*D-r*R+n*O)*C,e.m[3]=-(r*L-n*F+i*V)*C,e.m[7]=(t*L-n*k+i*B)*C,e.m[11]=-(t*F-r*k+i*N)*C,e.m[15]=(t*V-r*B+n*N)*C,this},t.prototype.invertToRefSIMD=function(e){var t,r,n,i,o,s,a,u,c,l,h=this.m,f=e.m,d=SIMD.float32x4.load(h,0),p=SIMD.float32x4.load(h,4),m=SIMD.float32x4.load(h,8),g=SIMD.float32x4.load(h,12);return o=SIMD.float32x4.shuffle(d,p,0,1,4,5),r=SIMD.float32x4.shuffle(m,g,0,1,4,5),t=SIMD.float32x4.shuffle(o,r,0,2,4,6),r=SIMD.float32x4.shuffle(r,o,1,3,5,7),o=SIMD.float32x4.shuffle(d,p,2,3,6,7),i=SIMD.float32x4.shuffle(m,g,2,3,6,7),n=SIMD.float32x4.shuffle(o,i,0,2,4,6),i=SIMD.float32x4.shuffle(i,o,1,3,5,7),o=SIMD.float32x4.mul(n,i),o=SIMD.float32x4.swizzle(o,1,0,3,2),s=SIMD.float32x4.mul(r,o),a=SIMD.float32x4.mul(t,o),o=SIMD.float32x4.swizzle(o,2,3,0,1),s=SIMD.float32x4.sub(SIMD.float32x4.mul(r,o),s),a=SIMD.float32x4.sub(SIMD.float32x4.mul(t,o),a),a=SIMD.float32x4.swizzle(a,2,3,0,1),o=SIMD.float32x4.mul(r,n),o=SIMD.float32x4.swizzle(o,1,0,3,2),s=SIMD.float32x4.add(SIMD.float32x4.mul(i,o),s),c=SIMD.float32x4.mul(t,o),o=SIMD.float32x4.swizzle(o,2,3,0,1),s=SIMD.float32x4.sub(s,SIMD.float32x4.mul(i,o)),c=SIMD.float32x4.sub(SIMD.float32x4.mul(t,o),c),c=SIMD.float32x4.swizzle(c,2,3,0,1),o=SIMD.float32x4.mul(SIMD.float32x4.swizzle(r,2,3,0,1),i),o=SIMD.float32x4.swizzle(o,1,0,3,2),n=SIMD.float32x4.swizzle(n,2,3,0,1),s=SIMD.float32x4.add(SIMD.float32x4.mul(n,o),s),u=SIMD.float32x4.mul(t,o),o=SIMD.float32x4.swizzle(o,2,3,0,1),s=SIMD.float32x4.sub(s,SIMD.float32x4.mul(n,o)),u=SIMD.float32x4.sub(SIMD.float32x4.mul(t,o),u),u=SIMD.float32x4.swizzle(u,2,3,0,1),o=SIMD.float32x4.mul(t,r),o=SIMD.float32x4.swizzle(o,1,0,3,2),u=SIMD.float32x4.add(SIMD.float32x4.mul(i,o),u),c=SIMD.float32x4.sub(SIMD.float32x4.mul(n,o),c),o=SIMD.float32x4.swizzle(o,2,3,0,1),u=SIMD.float32x4.sub(SIMD.float32x4.mul(i,o),u),c=SIMD.float32x4.sub(c,SIMD.float32x4.mul(n,o)),o=SIMD.float32x4.mul(t,i),o=SIMD.float32x4.swizzle(o,1,0,3,2),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(n,o)),u=SIMD.float32x4.add(SIMD.float32x4.mul(r,o),u),o=SIMD.float32x4.swizzle(o,2,3,0,1),a=SIMD.float32x4.add(SIMD.float32x4.mul(n,o),a),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(r,o)),o=SIMD.float32x4.mul(t,n),o=SIMD.float32x4.swizzle(o,1,0,3,2),a=SIMD.float32x4.add(SIMD.float32x4.mul(i,o),a),c=SIMD.float32x4.sub(c,SIMD.float32x4.mul(r,o)),o=SIMD.float32x4.swizzle(o,2,3,0,1),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(i,o)),c=SIMD.float32x4.add(SIMD.float32x4.mul(r,o),c),l=SIMD.float32x4.mul(t,s),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,2,3,0,1),l),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,0,3,2),l),o=SIMD.float32x4.reciprocalApproximation(l),l=SIMD.float32x4.sub(SIMD.float32x4.add(o,o),SIMD.float32x4.mul(l,SIMD.float32x4.mul(o,o))),l=SIMD.float32x4.swizzle(l,0,0,0,0),s=SIMD.float32x4.mul(l,s),a=SIMD.float32x4.mul(l,a),u=SIMD.float32x4.mul(l,u),c=SIMD.float32x4.mul(l,c),SIMD.float32x4.store(f,0,s),SIMD.float32x4.store(f,4,a),SIMD.float32x4.store(f,8,u),SIMD.float32x4.store(f,12,c),this},t.prototype.setTranslation=function(e){return this.m[12]=e.x,this.m[13]=e.y,this.m[14]=e.z,this},t.prototype.multiply=function(e){var r=new t;return this.multiplyToRef(e,r),r},t.prototype.copyFrom=function(e){for(var t=0;16>t;t++)this.m[t]=e.m[t];return this},t.prototype.copyToArray=function(e,t){void 0===t&&(t=0);for(var r=0;16>r;r++)e[t+r]=this.m[r];return this},t.prototype.multiplyToRef=function(e,t){return this.multiplyToArray(e,t.m,0),this},t.prototype.multiplyToArray=function(e,t,r){var n=this.m[0],i=this.m[1],o=this.m[2],s=this.m[3],a=this.m[4],u=this.m[5],c=this.m[6],l=this.m[7],h=this.m[8],f=this.m[9],d=this.m[10],p=this.m[11],m=this.m[12],g=this.m[13],v=this.m[14],_=this.m[15],y=e.m[0],x=e.m[1],b=e.m[2],S=e.m[3],E=e.m[4],M=e.m[5],T=e.m[6],P=e.m[7],C=e.m[8],w=e.m[9],A=e.m[10],D=e.m[11],I=e.m[12],R=e.m[13],O=e.m[14],L=e.m[15];return t[r]=n*y+i*E+o*C+s*I,t[r+1]=n*x+i*M+o*w+s*R,t[r+2]=n*b+i*T+o*A+s*O,t[r+3]=n*S+i*P+o*D+s*L,t[r+4]=a*y+u*E+c*C+l*I,t[r+5]=a*x+u*M+c*w+l*R,t[r+6]=a*b+u*T+c*A+l*O,t[r+7]=a*S+u*P+c*D+l*L,t[r+8]=h*y+f*E+d*C+p*I,t[r+9]=h*x+f*M+d*w+p*R,t[r+10]=h*b+f*T+d*A+p*O,t[r+11]=h*S+f*P+d*D+p*L,t[r+12]=m*y+g*E+v*C+_*I,t[r+13]=m*x+g*M+v*w+_*R,t[r+14]=m*b+g*T+v*A+_*O,t[r+15]=m*S+g*P+v*D+_*L,this},t.prototype.multiplyToArraySIMD=function(e,t,r){void 0===r&&(r=0);var n=this.m,i=e.m,o=SIMD.float32x4.load(i,0),s=SIMD.float32x4.load(i,4),a=SIMD.float32x4.load(i,8),u=SIMD.float32x4.load(i,12),c=SIMD.float32x4.load(n,0);SIMD.float32x4.store(t,r+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,0,0,0,0),o),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,1,1,1,1),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,3,3,3,3),u)))));var l=SIMD.float32x4.load(n,4);SIMD.float32x4.store(t,r+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),o),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),u)))));var h=SIMD.float32x4.load(n,8);SIMD.float32x4.store(t,r+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,0,0,0,0),o),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,1,1,1),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,3,3,3,3),u)))));var f=SIMD.float32x4.load(n,12);SIMD.float32x4.store(t,r+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),o),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),u)))))},t.prototype.equals=function(e){return e&&this.m[0]===e.m[0]&&this.m[1]===e.m[1]&&this.m[2]===e.m[2]&&this.m[3]===e.m[3]&&this.m[4]===e.m[4]&&this.m[5]===e.m[5]&&this.m[6]===e.m[6]&&this.m[7]===e.m[7]&&this.m[8]===e.m[8]&&this.m[9]===e.m[9]&&this.m[10]===e.m[10]&&this.m[11]===e.m[11]&&this.m[12]===e.m[12]&&this.m[13]===e.m[13]&&this.m[14]===e.m[14]&&this.m[15]===e.m[15]},t.prototype.clone=function(){return t.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},t.prototype.decompose=function(r,n,i){i.x=this.m[12],i.y=this.m[13],i.z=this.m[14];var o=e.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=e.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,u=e.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(r.x=o*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),r.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),r.z=u*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===r.x||0===r.y||0===r.z)return n.x=0,n.y=0,n.z=0,n.w=1,!1;var c=t.FromValues(this.m[0]/r.x,this.m[1]/r.x,this.m[2]/r.x,0,this.m[4]/r.y,this.m[5]/r.y,this.m[6]/r.y,0,this.m[8]/r.z,this.m[9]/r.z,this.m[10]/r.z,0,0,0,0,1);return s.FromRotationMatrixToRef(c,n),!0},t.FromArray=function(e,r){var n=new t;return r||(r=0),t.FromArrayToRef(e,r,n),n},t.FromArrayToRef=function(e,t,r){for(var n=0;16>n;n++)r.m[n]=e[n+t]},t.FromFloat32ArrayToRefScaled=function(e,t,r,n){for(var i=0;16>i;i++)n.m[i]=e[i+t]*r},t.FromValuesToRef=function(e,t,r,n,i,o,s,a,u,c,l,h,f,d,p,m,g){g.m[0]=e,g.m[1]=t,g.m[2]=r,g.m[3]=n,g.m[4]=i,g.m[5]=o,g.m[6]=s,g.m[7]=a,g.m[8]=u,g.m[9]=c,g.m[10]=l,g.m[11]=h,g.m[12]=f,g.m[13]=d,g.m[14]=p,g.m[15]=m},t.FromValues=function(e,r,n,i,o,s,a,u,c,l,h,f,d,p,m,g){var v=new t;return v.m[0]=e,v.m[1]=r,v.m[2]=n,v.m[3]=i,v.m[4]=o,v.m[5]=s,v.m[6]=a,v.m[7]=u,v.m[8]=c,v.m[9]=l,v.m[10]=h,v.m[11]=f,v.m[12]=d,v.m[13]=p,v.m[14]=m,v.m[15]=g,v},t.Compose=function(e,r,n){var i=t.FromValues(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),o=t.Identity();return r.toRotationMatrix(o),i=i.multiply(o),i.setTranslation(n),i},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(e){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(e){var r=new t;return t.RotationXToRef(e,r),r},t.Invert=function(e){var r=new t;return e.invertToRef(r),r},t.RotationXToRef=function(e,t){var r=Math.sin(e),n=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=n,t.m[10]=n,t.m[9]=-r,t.m[6]=r,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationY=function(e){var r=new t;return t.RotationYToRef(e,r),r},t.RotationYToRef=function(e,t){var r=Math.sin(e),n=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=n,t.m[2]=-r,t.m[8]=r,t.m[10]=n,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationZ=function(e){var r=new t;return t.RotationZToRef(e,r),r},t.RotationZToRef=function(e,t){var r=Math.sin(e),n=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=n,t.m[1]=r,t.m[4]=-r,t.m[5]=n,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},t.RotationAxis=function(e,r){var n=Math.sin(-r),i=Math.cos(-r),o=1-i;e.normalize();var s=t.Zero();return s.m[0]=e.x*e.x*o+i,s.m[1]=e.x*e.y*o-e.z*n,s.m[2]=e.x*e.z*o+e.y*n,s.m[3]=0,s.m[4]=e.y*e.x*o+e.z*n,s.m[5]=e.y*e.y*o+i,s.m[6]=e.y*e.z*o-e.x*n,s.m[7]=0,s.m[8]=e.z*e.x*o-e.y*n,s.m[9]=e.z*e.y*o+e.x*n,s.m[10]=e.z*e.z*o+i,s.m[11]=0,s.m[15]=1,s},t.RotationYawPitchRoll=function(e,r,n){var i=new t;return t.RotationYawPitchRollToRef(e,r,n,i),i},t.RotationYawPitchRollToRef=function(e,t,r,n){s.RotationYawPitchRollToRef(e,t,r,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},t.Scaling=function(e,r,n){var i=t.Zero();return t.ScalingToRef(e,r,n,i),i},t.ScalingToRef=function(e,t,r,n){n.m[0]=e,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=t,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=r,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},t.Translation=function(e,r,n){var i=t.Identity();return t.TranslationToRef(e,r,n,i),i},t.TranslationToRef=function(e,r,n,i){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,r,n,1,i)},t.LookAtLH=function(e,r,n){var i=t.Zero();return t.LookAtLHToRef(e,r,n,i),i},t.LookAtLHToRef=function(e,r,n,o){r.subtractToRef(e,this._zAxis),this._zAxis.normalize(),i.CrossToRef(n,this._zAxis,this._xAxis),this._xAxis.normalize(),i.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-i.Dot(this._xAxis,e),a=-i.Dot(this._yAxis,e),u=-i.Dot(this._zAxis,e);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,u,1,o)},t.LookAtLHToRefSIMD=function(e,t,r,n){var i=n.m,o=SIMD.float32x4(t.x,t.y,t.z,0),s=SIMD.float32x4(e.x,e.y,e.z,0),a=SIMD.float32x4(r.x,r.y,r.z,0),u=SIMD.float32x4.sub(o,s),c=SIMD.float32x4.mul(u,u);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),u=SIMD.float32x4.mul(u,SIMD.float32x4.reciprocalSqrtApproximation(c)),c=SIMD.float32x4.mul(a,a),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(c));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var h=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(u,1,2,0,3)));c=SIMD.float32x4.mul(l,l),c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(c));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var d=SIMD.float32x4.shuffle(l,h,0,1,4,5),p=SIMD.float32x4.shuffle(u,f,0,1,4,5),m=SIMD.float32x4.shuffle(d,p,0,2,4,6),g=SIMD.float32x4.shuffle(d,p,1,3,5,7);d=SIMD.float32x4.shuffle(l,h,2,3,6,7),p=SIMD.float32x4.shuffle(u,f,2,3,6,7);var v=SIMD.float32x4.shuffle(d,p,0,2,4,6),_=SIMD.float32x4(0,0,0,1),y=SIMD.float32x4(1,0,0,0),x=SIMD.float32x4(0,1,0,0),b=SIMD.float32x4(0,0,1,0),S=SIMD.float32x4.neg(s);S=SIMD.float32x4.withW(S,1),SIMD.float32x4.store(i,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,2,2,2,2),v),SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,3,3,3,3),_))))),SIMD.float32x4.store(i,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,2,2,2,2),v),SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,3,3,3,3),_))))),SIMD.float32x4.store(i,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),v),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),_))))),SIMD.float32x4.store(i,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(S,0,0,0,0),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(S,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(S,2,2,2,2),v),SIMD.float32x4.mul(SIMD.float32x4.swizzle(S,3,3,3,3),_)))))},t.OrthoLH=function(e,r,n,i){var o=t.Zero();return t.OrthoLHToRef(e,r,n,i,o),o},t.OrthoLHToRef=function(e,r,n,i,o){var s=2/e,a=2/r,u=1/(i-n),c=n/(n-i);t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,u,0,0,0,c,1,o)},t.OrthoOffCenterLH=function(e,r,n,i,o,s){var a=t.Zero();return t.OrthoOffCenterLHToRef(e,r,n,i,o,s,a),a},t.OrthoOffCenterLHToRef=function(e,t,r,n,i,o,s){s.m[0]=2/(t-e),s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2/(n-r),s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-1/(i-o),s.m[8]=s.m[9]=s.m[11]=0,s.m[12]=(e+t)/(e-t),s.m[13]=(n+r)/(r-n),s.m[14]=i/(i-o),s.m[15]=1},t.PerspectiveLH=function(e,r,n,i){var o=t.Zero();return o.m[0]=2*n/e,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2*n/r,o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-i/(n-i),o.m[8]=o.m[9]=0,o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=n*i/(n-i),o},t.PerspectiveFovLH=function(e,r,n,i){var o=t.Zero();return t.PerspectiveFovLHToRef(e,r,n,i,o),o},t.PerspectiveFovLHToRef=function(t,r,n,i,o,s){void 0===s&&(s=e.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*t),u=s===e.Camera.FOVMODE_VERTICAL_FIXED;o.m[0]=u?a/r:a,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=u?a:a*r,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-i/(n-i),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=n*i/(n-i)},t.GetFinalMatrix=function(e,r,n,i,o,s){var a=e.width,u=e.height,c=e.x,l=e.y,h=t.FromValues(a/2,0,0,0,0,-u/2,0,0,0,0,s-o,0,c+a/2,u/2+l,o,1);return r.multiply(n).multiply(i).multiply(h)},t.GetAsMatrix2x2=function(e){return new Float32Array([e.m[0],e.m[1],e.m[4],e.m[5]])},t.GetAsMatrix3x3=function(e){return new Float32Array([e.m[0],e.m[1],e.m[2],e.m[4],e.m[5],e.m[6],e.m[8],e.m[9],e.m[10]])},t.Transpose=function(e){var r=new t;return r.m[0]=e.m[0],r.m[1]=e.m[4],r.m[2]=e.m[8],r.m[3]=e.m[12],r.m[4]=e.m[1],r.m[5]=e.m[5],r.m[6]=e.m[9],r.m[7]=e.m[13],r.m[8]=e.m[2],r.m[9]=e.m[6],r.m[10]=e.m[10],r.m[11]=e.m[14],r.m[12]=e.m[3],r.m[13]=e.m[7],r.m[14]=e.m[11],r.m[15]=e.m[15],r},t.Reflection=function(e){var r=new t;return t.ReflectionToRef(e,r),r},t.ReflectionToRef=function(e,t){e.normalize();var r=e.normal.x,n=e.normal.y,i=e.normal.z,o=-2*r,s=-2*n,a=-2*i;t.m[0]=o*r+1,t.m[1]=s*r,t.m[2]=a*r,t.m[3]=0,t.m[4]=o*n,t.m[5]=s*n+1,t.m[6]=a*n,t.m[7]=0,t.m[8]=o*i,t.m[9]=s*i,t.m[10]=a*i+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1},t._tempQuaternion=new s,t._xAxis=i.Zero(),t._yAxis=i.Zero(),t._zAxis=i.Zero(),t}();e.Matrix=a;var u=function(){function e(e,t,r,n){this.normal=new i(e,t,r),this.d=n}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var r=a.Transpose(t),n=this.normal.x,i=this.normal.y,o=this.normal.z,s=this.d,u=n*r.m[0]+i*r.m[1]+o*r.m[2]+s*r.m[3],c=n*r.m[4]+i*r.m[5]+o*r.m[6]+s*r.m[7],l=n*r.m[8]+i*r.m[9]+o*r.m[10]+s*r.m[11],h=n*r.m[12]+i*r.m[13]+o*r.m[14]+s*r.m[15];return new e(u,c,l,h)},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,r){var n,i=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=r.x-e.x,u=r.y-e.y,c=r.z-e.z,l=o*c-s*u,h=s*a-i*c,f=i*u-o*a,d=Math.sqrt(l*l+h*h+f*f);return n=0!==d?1/d:0,this.normal.x=l*n,this.normal.y=h*n,this.normal.z=f*n,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){var r=i.Dot(this.normal,e);return t>=r},e.prototype.signedDistanceTo=function(e){return i.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,r,n){var i=new e(0,0,0,0);return i.copyFromPoints(t,r,n),i},e.FromPositionAndNormal=function(t,r){var n=new e(0,0,0,0);return r.normalize(),n.normal=r,n.d=-(r.x*t.x+r.y*t.y+r.z*t.z),n},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,r){var n=-(t.x*e.x+t.y*e.y+t.z*e.z);return i.Dot(r,t)+n},e}();e.Plane=u;var c=function(){function e(e,t,r,n){this.x=e,this.y=t,this.width=r,this.height=n}return e.prototype.toGlobal=function(t){var r=t.getRenderWidth(),n=t.getRenderHeight();return new e(this.x*r,this.y*n,this.width*r,this.height*n)},e}();e.Viewport=c;var l=function(){function e(){}return e.GetPlanes=function(t){for(var r=[],n=0;6>n;n++)r.push(new u(0,0,0,0));return e.GetPlanesToRef(t,r),r},e.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[11]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()},e}();e.Frustum=l;var h=function(){function t(e,t,r){void 0===r&&(r=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=r}return t.prototype.intersectsBoxMinMax=function(e,t){var r,n,i,o,s=0,a=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else if(r=1/this.direction.x,n=(e.x-this.origin.x)*r,i=(t.x-this.origin.x)*r,i===-(1/0)&&(i=1/0),n>i&&(o=n,n=i,i=o),s=Math.max(n,s),a=Math.min(i,a),s>a)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(r=1/this.direction.y,n=(e.y-this.origin.y)*r,i=(t.y-this.origin.y)*r,i===-(1/0)&&(i=1/0),n>i&&(o=n,n=i,i=o),s=Math.max(n,s),a=Math.min(i,a),s>a)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(r=1/this.direction.z,n=(e.z-this.origin.z)*r,i=(t.z-this.origin.z)*r,i===-(1/0)&&(i=1/0),n>i&&(o=n,n=i,i=o),s=Math.max(n,s),a=Math.min(i,a),s>a)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,r=e.center.y-this.origin.y,n=e.center.z-this.origin.z,i=t*t+r*r+n*n,o=e.radius*e.radius;if(o>=i)return!0;var s=t*this.direction.x+r*this.direction.y+n*this.direction.z;if(0>s)return!1;var a=i-s*s;return o>=a},t.prototype.intersectsTriangle=function(t,r,n){this._edge1||(this._edge1=i.Zero(),this._edge2=i.Zero(),this._pvec=i.Zero(),this._tvec=i.Zero(),this._qvec=i.Zero()),r.subtractToRef(t,this._edge1),n.subtractToRef(t,this._edge2),i.CrossToRef(this.direction,this._edge2,this._pvec);var o=i.Dot(this._edge1,this._pvec);if(0===o)return null;var s=1/o;this.origin.subtractToRef(t,this._tvec);var a=i.Dot(this._tvec,this._pvec)*s;if(0>a||a>1)return null;i.CrossToRef(this._tvec,this._edge1,this._qvec);var u=i.Dot(this.direction,this._qvec)*s;if(0>u||a+u>1)return null;var c=i.Dot(this._edge2,this._qvec)*s;return c>this.length?null:new e.IntersectionInfo(a,u,c)},t.CreateNew=function(e,r,n,o,s,a,u){var c=i.Unproject(new i(e,r,0),n,o,s,a,u),l=i.Unproject(new i(e,r,1),n,o,s,a,u),h=l.subtract(c);return h.normalize(),new t(c,h)},t.CreateNewFromTo=function(e,r,n){void 0===n&&(n=a.Identity());var i=r.subtract(e),o=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);return i.normalize(),t.Transform(new t(e,i,o),n)},t.Transform=function(e,r){var n=i.TransformCoordinates(e.origin,r),o=i.TransformNormal(e.direction,r);return new t(n,o,e.length)},t}();e.Ray=h,function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(e.Space||(e.Space={}));var f=(e.Space,function(){function e(){}return e.X=new i(1,0,0),e.Y=new i(0,1,0),e.Z=new i(0,0,1),e}());e.Axis=f;var d=function(){function e(){}return e.interpolate=function(e,t,r,n,i){for(var o=1-3*n+3*t,s=3*n-6*t,a=3*t,u=e,c=0;5>c;c++){var l=u*u,h=l*u,f=o*h+s*l+a*u,d=1/(3*o*l+2*s*u+a);u-=(f-e)*d,u=Math.min(1,Math.max(0,u))}return 3*Math.pow(1-u,2)*u*r+3*(1-u)*Math.pow(u,2)*i+Math.pow(u,3)},e}();e.BezierCurve=d,function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(e.Orientation||(e.Orientation={}));var p=e.Orientation,m=function(){function e(e){var t=this;this.degrees=function(){return 180*t._radians/Math.PI},this.radians=function(){return t._radians},this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.BetweenTwoPoints=function(t,r){var n=r.subtract(t),i=Math.atan2(n.y,n.x);return new e(i)},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=m;var g=function(){function e(e,t,r){this.startPoint=e,this.midPoint=t,this.endPoint=r;var i=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-i)/2,s=(i-Math.pow(r.x,2)-Math.pow(r.y,2))/2,a=(e.x-t.x)*(t.y-r.y)-(t.x-r.x)*(e.y-t.y);this.centerPoint=new n((o*(t.y-r.y)-s*(e.y-t.y))/a,((e.x-t.x)*s-(t.x-r.x)*o)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=m.BetweenTwoPoints(this.centerPoint,this.startPoint);var u=this.startAngle.degrees(),c=m.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=m.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-u>180&&(c-=360),-180>c-u&&(c+=360),l-c>180&&(l-=360),-180>l-c&&(l+=360),this.orientation=0>c-u?p.CW:p.CCW,this.angle=m.FromDegrees(this.orientation===p.CW?u-l:l-u)}return e}();e.Arc2=g;var v=function(){function e(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return e.prototype.getPoint=function(){var e=this.path.getPointAtLengthPosition(this.value);return new i(e.x,0,e.y)},e.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},e.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},e.prototype.move=function(e){if(Math.abs(e)>1)throw"step size should be less than 1.";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},e.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},e.prototype.markAsDirty=function(e){return this.ensureLimits(),this.raiseOnChange(),this},e.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},e.prototype.onchange=function(e){return this._onchange.push(e),this},e}();e.PathCursor=v;var _=function(){function t(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n(e,t))}return t.prototype.addLineTo=function(t,r){if(closed)return e.Tools.Error("cannot add lines to closed paths"),this;var i=new n(t,r),o=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(o).length(),this},t.prototype.addArcTo=function(t,r,i,o,s){if(void 0===s&&(s=36),closed)return e.Tools.Error("cannot add arcs to closed paths"),this;var a=this._points[this._points.length-1],u=new n(t,r),c=new n(i,o),l=new g(a,u,c),h=l.angle.radians()/s;l.orientation===p.CW&&(h*=-1);for(var f=l.startAngle.radians()+h,d=0;s>d;d++){var m=Math.cos(f)*l.radius+l.centerPoint.x,v=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(m,v),f+=h}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1],r=this._points[0];e+=r.subtract(t).length()}return e},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return e.Tools.Error("normalized length position should be between 0 and 1."),n.Zero();for(var r=t*this.length(),i=0,o=0;o<this._points.length;o++){var s=(o+1)%this._points.length,a=this._points[o],u=this._points[s],c=u.subtract(a),l=c.length()+i;if(r>=i&&l>=r){var h=c.normalize(),f=r-i;return new n(a.x+h.x*f,a.y+h.y*f)}i=l}return e.Tools.Error("internal error"),n.Zero()},t.StartingAt=function(e,r){return new t(e,r)},t}();e.Path2=_;var y=function(){function t(e,t,r){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var n=0;n<e.length;n++)this._curve[n]=e[n].clone();this._raw=r||!1,this._compute(t)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(e,t){for(var r=0;r<e.length;r++)this._curve[r].x=e[r].x,this._curve[r].y=e[r].y,this._curve[r].z=e[r].z;return this._compute(t),this},t.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._raw||this._tangents[t-1].normalize();var r=this._tangents[0],n=this._normalVector(this._curve[0],r,e);this._normals[0]=n,this._raw||this._normals[0].normalize(),this._binormals[0]=i.Cross(r,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var o,s,a,u,c=1;t>c;c++)o=this._getLastNonNullVector(c),t-1>c&&(s=this._getFirstNonNullVector(c),this._tangents[c]=o.add(s),this._tangents[c].normalize()),this._distances[c]=this._distances[c-1]+o.length(),a=this._tangents[c],u=this._binormals[c-1],this._normals[c]=i.Cross(u,a),this._raw||this._normals[c].normalize(),this._binormals[c]=i.Cross(a,this._normals[c]),this._raw||this._binormals[c].normalize()},t.prototype._getFirstNonNullVector=function(e){for(var t=1,r=this._curve[e+t].subtract(this._curve[e]);0===r.length()&&e+t+1<this._curve.length;)t++,r=this._curve[e+t].subtract(this._curve[e]);return r},t.prototype._getLastNonNullVector=function(e){for(var t=1,r=this._curve[e].subtract(this._curve[e-t]);0===r.length()&&e>t+1;)t++,r=this._curve[e].subtract(this._curve[e-t]);return r},t.prototype._normalVector=function(t,r,n){var o;if(void 0===n||null===n){var s;e.Tools.WithinEpsilon(r.y,1,e.Engine.Epsilon)?e.Tools.WithinEpsilon(r.x,1,e.Engine.Epsilon)?e.Tools.WithinEpsilon(r.z,1,e.Engine.Epsilon)||(s=new i(0,0,1)):s=new i(1,0,0):s=new i(0,-1,0),o=i.Cross(r,s)}else o=i.Cross(r,n),i.CrossToRef(o,r,o);return o.normalize(),o},t}();e.Path3D=y;var x=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,r,n,o){o=o>2?o:3;for(var s=new Array,a=function(e,t,r,n){var i=(1-e)*(1-e)*t+2*e*(1-e)*r+e*e*n;return i},u=0;o>=u;u++)s.push(new i(a(u/o,t.x,r.x,n.x),a(u/o,t.y,r.y,n.y),a(u/o,t.z,r.z,n.z)));return new e(s)},e.CreateCubicBezier=function(t,r,n,o,s){s=s>3?s:4;for(var a=new Array,u=function(e,t,r,n,i){var o=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*r+3*e*e*(1-e)*n+e*e*e*i;return o},c=0;s>=c;c++)a.push(new i(u(c/s,t.x,r.x,n.x,o.x),u(c/s,t.y,r.y,n.y,o.y),u(c/s,t.z,r.z,n.z,o.z)));return new e(a)},e.CreateHermiteSpline=function(t,r,n,o,s){for(var a=new Array,u=1/s,c=0;s>=c;c++)a.push(i.Hermite(t,r,n,o,c*u));return new e(a)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype["continue"]=function(t){for(var r=this._points[this._points.length-1],n=this._points.slice(),i=t.getPoints(),o=1;o<i.length;o++)n.push(i[o].subtract(i[0]).add(r));var s=new e(n);return s},e.prototype._computeLength=function(e){for(var t=0,r=1;r<e.length;r++)t+=e[r].subtract(e[r-1]).length();return t},e}();e.Curve3=x;var b=function(){function e(e,t){void 0===e&&(e=i.Zero()),void 0===t&&(t=i.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=b;var S=function(){
function e(e,t,r){void 0===e&&(e=i.Zero()),void 0===t&&(t=i.Up()),void 0===r&&(r=n.Zero()),this.position=e,this.normal=t,this.uv=r}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=S;var E=a.prototype.multiplyToArray,M=a.prototype.invertToRef,T=a.LookAtLHToRef,P=i.TransformCoordinatesToRef,C=i.TransformCoordinatesFromFloatsToRef,w=function(){function e(){}return Object.defineProperty(e,"IsEnabled",{get:function(){return e._isEnabled},enumerable:!0,configurable:!0}),e.DisableSIMD=function(){a.prototype.multiplyToArray=E,a.prototype.invertToRef=M,a.LookAtLHToRef=T,i.TransformCoordinatesToRef=P,i.TransformCoordinatesFromFloatsToRef=C,e._isEnabled=!1},e.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,i.TransformCoordinatesToRef=i.TransformCoordinatesToRefSIMD,i.TransformCoordinatesFromFloatsToRef=i.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(i.prototype,"x",{get:function(){return this._data[0]},set:function(e){this._data||(this._data=new Float32Array(3)),this._data[0]=e}}),Object.defineProperty(i.prototype,"y",{get:function(){return this._data[1]},set:function(e){this._data[1]=e}}),Object.defineProperty(i.prototype,"z",{get:function(){return this._data[2]},set:function(e){this._data[2]=e}}),e._isEnabled=!0)},e._isEnabled=!1,e}();e.SIMDHelper=w}(r||(r={}));var r;!function(e){var t=function(){function t(e,r){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=r,this.currentSceneUrl=t.ReturnFullUrlLocation(e),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return t.prototype.checkManifestFile=function(){function t(){n.enableSceneOffline=!1,n.enableTexturesOffline=!1,n.callbackManifestChecked(!1)}var r=this,n=this,i=this.currentSceneUrl+".manifest",o=new XMLHttpRequest,s=i+(null==i.match(/\?/)?"?":"&")+(new Date).getTime();o.open("GET",s,!0),o.addEventListener("load",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{var n=JSON.parse(o.response);r.enableSceneOffline=n.enableSceneOffline,r.enableTexturesOffline=n.enableTexturesOffline,n.version&&!isNaN(parseInt(n.version))&&(r.manifestVersionFound=n.version),r.callbackManifestChecked&&r.callbackManifestChecked(!0)}catch(i){t()}else t()},!1),o.addEventListener("error",function(e){t()},!1);try{o.send()}catch(a){e.Tools.Error("Error on XHR send request."),n.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,r){function n(){o.isSupported=!1,r&&r()}var i=this,o=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open("babylonjs",1);s.onerror=function(e){n()},s.onblocked=function(t){e.Tools.Error("IDB request blocked. Please reload the page."),n()},s.onsuccess=function(e){i.db=s.result,t()},s.onupgradeneeded=function(t){i.db=t.target.result;try{i.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),i.db.createObjectStore("versions",{keyPath:"sceneUrl"}),i.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(r){e.Tools.Error("Error while creating object stores. Exception: "+r.message),n()}}}else this.isSupported=!1,r&&r()},t.prototype.loadImageFromDB=function(e,r){var n=this,i=t.ReturnFullUrlLocation(e),o=function(){n.hasReachedQuota||null===n.db?r.src=e:n._saveImageIntoDBAsync(i,r)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(i,r,o)},t.prototype._loadImageFromDBAsync=function(t,r,n){if(this.isSupported&&null!==this.db){var i,o=this.db.transaction(["textures"]);o.onabort=function(e){r.src=t},o.oncomplete=function(o){var s;if(i){var a=window.URL||window.webkitURL;s=a.createObjectURL(i.data,{oneTimeOnly:!0}),r.onerror=function(){e.Tools.Error("Error loading image from blob URL: "+s+" switching back to web url: "+t),r.src=t},r.src=s}else n()};var s=o.objectStore("textures").get(t);s.onsuccess=function(e){i=e.target.result},s.onerror=function(n){e.Tools.Error("Error loading texture "+t+" from DB."),r.src=t}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),r.src=t},t.prototype._saveImageIntoDBAsync=function(r,n){var i=this;if(this.isSupported){var o=function(){var e;if(s){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(s,{oneTimeOnly:!0})}catch(r){e=t.createObjectURL(s)}}n.src=e};if(t.IsUASupportingBlobStorage){var s,a=new XMLHttpRequest;a.open("GET",r,!0),a.responseType="blob",a.addEventListener("load",function(){if(200===a.status){s=a.response;var e=i.db.transaction(["textures"],"readwrite");e.onabort=function(e){try{e.srcElement.error&&"QuotaExceededError"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}o()},e.oncomplete=function(e){o()};var u={textureUrl:r,data:s};try{var c=e.objectStore("textures").put(u);c.onsuccess=function(e){},c.onerror=function(e){o()}}catch(l){25===l.code&&(t.IsUASupportingBlobStorage=!1),n.src=r}}else n.src=r},!1),a.addEventListener("error",function(t){e.Tools.Error("Error in XHR request in BABYLON.Database."),n.src=r},!1),a.send()}else n.src=r}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),n.src=r},t.prototype._checkVersionFromDB=function(e,t){var r=this,n=function(n){r._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,n)},t.prototype._loadVersionFromDBAsync=function(t,r,n){var i=this;if(this.isSupported){var o;try{var s=this.db.transaction(["versions"]);s.oncomplete=function(e){o?i.manifestVersionFound>o.data?(i.mustUpdateRessources=!0,n()):r(o.data):(i.mustUpdateRessources=!0,n())},s.onabort=function(e){r(-1)};var a=s.objectStore("versions").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(n){e.Tools.Error("Error loading version for scene "+t+" from DB."),r(-1)}}catch(u){e.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+u.message),r(-1)}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),r(-1)},t.prototype._saveVersionIntoDBAsync=function(t,r){var n=this;if(this.isSupported&&!this.hasReachedQuota)try{var i=this.db.transaction(["versions"],"readwrite");i.onabort=function(e){try{e.srcElement.error&&"QuotaExceededError"===e.srcElement.error.name&&(n.hasReachedQuota=!0)}catch(t){}r(-1)},i.oncomplete=function(e){r(n.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=i.objectStore("versions").put(o);s.onsuccess=function(e){},s.onerror=function(t){e.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(a){e.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+a.message),r(-1)}else r(-1)},t.prototype.loadFileFromDB=function(e,r,n,i,o){var s=this,a=t.ReturnFullUrlLocation(e),u=function(e){s._saveFileIntoDBAsync(a,r,n)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,r,n,o):s._loadFileFromDBAsync(a,r,u,o):i()})},t.prototype._loadFileFromDBAsync=function(t,r,n,i){if(this.isSupported){var o;o=-1!==t.indexOf(".babylon")?"scenes":"textures";var s,a=this.db.transaction([o]);a.oncomplete=function(e){s?r(s.data):n()},a.onabort=function(e){n()};var u=a.objectStore(o).get(t);u.onsuccess=function(e){s=e.target.result},u.onerror=function(r){e.Tools.Error("Error loading file "+t+" from DB."),n()}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),r()},t.prototype._saveFileIntoDBAsync=function(t,r,n,i){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(".babylon")?"scenes":"textures";var a,u=new XMLHttpRequest;u.open("GET",t,!0),i&&(u.responseType="arraybuffer"),u.onprogress=n,u.addEventListener("load",function(){if(200===u.status||e.Tools.ValidateXHRData(u,i?6:1))if(a=i?u.response:u.responseText,o.hasReachedQuota)r(a);else{var n=o.db.transaction([s],"readwrite");n.onabort=function(e){try{e.srcElement.error&&"QuotaExceededError"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(t){}r(a)},n.oncomplete=function(e){r(a)};var c;c="scenes"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var l=n.objectStore(s).put(c);l.onsuccess=function(e){},l.onerror=function(t){e.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(h){r(a)}}else r()},!1),u.addEventListener("error",function(t){e.Tools.Error("error on XHR request."),r()},!1),u.send()}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),r()},t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t.parseURL=function(e){var t=document.createElement("a");t.href=e;var r=e.substring(0,e.lastIndexOf("#")),n=e.substring(r.lastIndexOf("/")+1,e.length),i=e.substring(0,e.indexOf(n,0));return i},t.ReturnFullUrlLocation=function(e){return-1===e.indexOf("http:/")?t.parseURL(window.location.href)+e:e},t}();e.Database=t}(r||(r={}));var r;!function(e){var t;!function(t){var r=function(){function t(){}return t.GetTGAHeader=function(e){var t=0,r={id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]};return r},t.UploadContent=function(r,n){if(n.length<19)return void e.Tools.Error("Unable to load TGA file - Not enough data to contain header");var i=18,o=t.GetTGAHeader(n);if(o.id_length+i>n.length)return void e.Tools.Error("Unable to load TGA file - Not enough data");i+=o.id_length;var s=!1,a=!1,u=!1,c=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:u=!0;break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:c=!0}var l,h,f=(15&o.flags,o.pixel_size>>3),d=o.width*o.height*f;if(a&&(h=n.subarray(i,i+=o.colormap_length*(o.colormap_size>>3))),s){l=new Uint8Array(d);for(var p,m,g,v=0,_=new Uint8Array(f);d>i&&d>v;)if(p=n[i++],m=(127&p)+1,128&p){for(g=0;f>g;++g)_[g]=n[i++];for(g=0;m>g;++g)l.set(_,v+g*f);v+=f*m}else{for(m*=f,g=0;m>g;++g)l[v+g]=n[i++];v+=m}}else l=n.subarray(i,i+=a?o.width*o.height:d);var y,x,b,S,E,M;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,b=1,M=o.width,x=0,S=1,E=o.height;break;case t._ORIGIN_BL:y=0,b=1,M=o.width,x=o.height-1,S=-1,E=-1;break;case t._ORIGIN_UR:y=o.width-1,b=-1,M=-1,x=0,S=1,E=o.height;break;case t._ORIGIN_BR:y=o.width-1,b=-1,M=-1,x=o.height-1,S=-1,E=-1}var T="_getImageData"+(c?"Grey":"")+o.pixel_size+"bits",P=t[T](o,h,l,x,S,E,y,b,M);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,o.width,o.height,0,r.RGBA,r.UNSIGNED_BYTE,P)},t._getImageData8bits=function(e,t,r,n,i,o,s,a,u){var c,l,h,f=r,d=t,p=e.width,m=e.height,g=0,v=new Uint8Array(p*m*4);for(h=n;h!==o;h+=i)for(l=s;l!==u;l+=a,g++)c=f[g],v[4*(l+p*h)+3]=255,v[4*(l+p*h)+2]=d[3*c+0],v[4*(l+p*h)+1]=d[3*c+1],v[4*(l+p*h)+0]=d[3*c+2];return v},t._getImageData16bits=function(e,t,r,n,i,o,s,a,u){var c,l,h,f=r,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(h=n;h!==o;h+=i)for(l=s;l!==u;l+=a,m+=2)c=f[m+0]+(f[m+1]<<8),g[4*(l+d*h)+0]=(31744&c)>>7,g[4*(l+d*h)+1]=(992&c)>>2,g[4*(l+d*h)+2]=(31&c)>>3,g[4*(l+d*h)+3]=32768&c?0:255;return g},t._getImageData24bits=function(e,t,r,n,i,o,s,a,u){var c,l,h=r,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=n;l!==o;l+=i)for(c=s;c!==u;c+=a,p+=3)m[4*(c+f*l)+3]=255,m[4*(c+f*l)+2]=h[p+0],m[4*(c+f*l)+1]=h[p+1],m[4*(c+f*l)+0]=h[p+2];return m},t._getImageData32bits=function(e,t,r,n,i,o,s,a,u){var c,l,h=r,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=n;l!==o;l+=i)for(c=s;c!==u;c+=a,p+=4)m[4*(c+f*l)+2]=h[p+0],m[4*(c+f*l)+1]=h[p+1],m[4*(c+f*l)+0]=h[p+2],m[4*(c+f*l)+3]=h[p+3];return m},t._getImageDataGrey8bits=function(e,t,r,n,i,o,s,a,u){var c,l,h,f=r,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(h=n;h!==o;h+=i)for(l=s;l!==u;l+=a,m++)c=f[m],g[4*(l+d*h)+0]=c,g[4*(l+d*h)+1]=c,g[4*(l+d*h)+2]=c,g[4*(l+d*h)+3]=255;return g},t._getImageDataGrey16bits=function(e,t,r,n,i,o,s,a,u){var c,l,h=r,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(l=n;l!==o;l+=i)for(c=s;c!==u;c+=a,p+=2)m[4*(c+f*l)+0]=h[p+0],m[4*(c+f*l)+1]=h[p+0],m[4*(c+f*l)+2]=h[p+0],m[4*(c+f*l)+3]=h[p+1];return m},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=r}(t=e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t;!function(t){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var i=542327876,o=131072,s=512,a=4,u=64,c=131072,l=r("DXT1"),h=r("DXT3"),f=r("DXT5"),d=31,p=0,m=1,g=2,v=3,_=4,y=7,x=20,b=21,S=22,E=28,M=function(){function t(){}return t.GetDDSInfo=function(e){var t=new Int32Array(e,0,d),r=1;return t[g]&o&&(r=Math.max(1,t[y])),{width:t[_],height:t[v],mipmapCount:r,isFourCC:(t[x]&a)===a,isRGB:(t[x]&u)===u,isLuminance:(t[x]&c)===c,isCube:(t[E]&s)===s}},t.GetRGBAArrayBuffer=function(e,t,r,n,i){for(var o=new Uint8Array(n),s=new Uint8Array(i),a=0,u=t-1;u>=0;u--)for(var c=0;e>c;c++){var l=r+4*(c+u*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],o[a+3]=s[l+3],a+=4}return o},t.GetRGBArrayBuffer=function(e,t,r,n,i){for(var o=new Uint8Array(n),s=new Uint8Array(i),a=0,u=t-1;u>=0;u--)for(var c=0;e>c;c++){var l=r+3*(c+u*e);o[a+2]=s[l],o[a+1]=s[l+1],o[a]=s[l+2],a+=3}return o},t.GetLuminanceArrayBuffer=function(e,t,r,n,i){for(var o=new Uint8Array(n),s=new Uint8Array(i),a=0,u=t-1;u>=0;u--)for(var c=0;e>c;c++){var l=r+(c+u*e);o[a]=s[l],a++}return o},t.UploadDDSLevels=function(r,s,a,u,c,x){var E,M,T,P,C,w,A,D,I,R,O=new Int32Array(a,0,d);if(O[p]!=i)return void e.Tools.Error("Invalid magic number in DDS header");if(!u.isFourCC&&!u.isRGB&&!u.isLuminance)return void e.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(u.isFourCC)switch(E=O[b]){case l:M=8,T=s.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case h:M=16,T=s.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case f:M=16,T=s.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error("Unsupported FourCC code:",n(E))}I=1,O[g]&o&&c!==!1&&(I=Math.max(1,O[y]));for(var L=O[S],F=0;x>F;F++){var V=1==x?r.TEXTURE_2D:r.TEXTURE_CUBE_MAP_POSITIVE_X+F;for(P=O[_],C=O[v],A=O[m]+4,R=0;I>R;++R){if(u.isRGB)24==L?(w=P*C*3,D=t.GetRGBArrayBuffer(P,C,A,w,a),r.texImage2D(V,R,r.RGB,P,C,0,r.RGB,r.UNSIGNED_BYTE,D)):(w=P*C*4,D=t.GetRGBAArrayBuffer(P,C,A,w,a),r.texImage2D(V,R,r.RGBA,P,C,0,r.RGBA,r.UNSIGNED_BYTE,D));else if(u.isLuminance){var k=r.getParameter(r.UNPACK_ALIGNMENT),B=P,N=Math.floor((P+k-1)/k)*k;w=N*(C-1)+B,D=t.GetLuminanceArrayBuffer(P,C,A,w,a),r.texImage2D(V,R,r.LUMINANCE,P,C,0,r.LUMINANCE,r.UNSIGNED_BYTE,D)}else w=Math.max(4,P)/4*Math.max(4,C)/4*M,D=new Uint8Array(a,A,w),r.compressedTexImage2D(V,R,T,P,C,0,D);A+=w,P*=.5,C*=.5,P=Math.max(1,P),C=Math.max(1,C)}}},t}();t.DDSTools=M}(t=e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(){function e(t){this.length=0,this._duplicateId=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(e){e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||this.push(e)},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0,this._duplicateId++},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var r=(e.data||e)[t];this.pushNoDuplicate(r)}}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e._GlobalId=0,e}();e.SmartArray=t}(r||(r={}));var r;!function(e){var t=function(){function e(e){void 0===e&&(e=10),this.count=0,this._initialCapacity=e,this.items={},this._keys=new Array(this._initialCapacity)}return e.prototype.add=function(e,t){return void 0!=this.items[e]?-1:(this.items[e]=t,this._keys[this.count++]=e,this.count>this._keys.length&&(this._keys.length*=2),this.count)},e.prototype.remove=function(e){return void 0==this.items[e]?-1:this.removeItemOfIndex(this.indexOf(e))},e.prototype.removeItemOfIndex=function(e){if(!(e<this.count&&e>-1))return-1;for(delete this.items[this._keys[e]];e<this.count;)this._keys[e]=this._keys[e+1],e++;return--this.count},e.prototype.indexOf=function(e){for(var t=0;t!==this.count;t++)if(this._keys[t]===e)return t;return-1},e.prototype.item=function(e){return this.items[e]},e.prototype.getAllKeys=function(){if(this.count>0){for(var e=new Array(this.count),t=0;t<this.count;t++)e[t]=this._keys[t];return e}},e.prototype.getKeyByIndex=function(e){return e<this.count&&e>-1?this._keys[e]:void 0},e.prototype.getItemByIndex=function(e){return e<this.count&&e>-1?this.items[this._keys[e]]:void 0},e.prototype.empty=function(){this.count>0&&(this.count=0,this.items={},this._keys=new Array(this._initialCapacity))},e.prototype.forEach=function(e){var t;for(t in this.items)this.items.hasOwnProperty(t)&&e(this.items[t])},e}();e.SmartCollection=t}(r||(r={}));var r;!function(e){var t,r=function(t,r){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(r):t.clone?t.clone():null:null},n=function(){function n(){}return n.ToHex=function(e){var t=e.toString(16);return 15>=e?("0"+t).toUpperCase():t.toUpperCase()},n.SetImmediate=function(e){window.setImmediate?window.setImmediate(e):setTimeout(e,1)},n.IsExponantOfTwo=function(e){var t=1;do t*=2;while(e>t);return t===e},n.GetExponantOfTwo=function(e,t){var r=1;do r*=2;while(e>r);return r>t&&(r=t),r},n.GetFilename=function(e){var t=e.lastIndexOf("/");return 0>t?e:e.substring(t+1)},n.GetDOMTextContent=function(e){for(var t="",r=e.firstChild;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t},n.ToDegrees=function(e){return 180*e/Math.PI},n.ToRadians=function(e){return e*Math.PI/180},n.ExtractMinAndMaxIndexed=function(t,r,n,i){for(var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=n;n+i>a;a++){var u=new e.Vector3(t[3*r[a]],t[3*r[a]+1],t[3*r[a]+2]);o=e.Vector3.Minimize(u,o),s=e.Vector3.Maximize(u,s)}return{minimum:o,maximum:s}},n.ExtractMinAndMax=function(t,r,n){for(var i=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=r;r+n>s;s++){var a=new e.Vector3(t[3*s],t[3*s+1],t[3*s+2]);i=e.Vector3.Minimize(a,i),o=e.Vector3.Maximize(a,o)}return{minimum:i,maximum:o}},n.MakeArray=function(e,t){return t===!0||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:void 0},n.GetPointerPrefix=function(){var e="pointer";return navigator.pointerEnabled||(e="mouse"),e},n.QueueNewFrame=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):window.setTimeout(e,16)},n.RequestFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()},n.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},n.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},n.LoadImage=function(t,r,i,o){t=n.CleanUrl(t);var s=new Image;"data:"!==t.substr(0,5)&&(s.crossOrigin="anonymous"),s.onload=function(){r(s)},s.onerror=function(e){n.Error("Error while trying to load texture: "+t),s.src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",r(s)};var a=function(){s.src=t},u=function(){o.loadImageFromDB(t,s)};if(o&&o.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)o.openAsync(u,a);else if(-1===t.indexOf("file:"))a();else try{var c,l=t.substring(5);try{c=URL.createObjectURL(e.FilesInput.FilesTextures[l],{oneTimeOnly:!0})}catch(h){c=URL.createObjectURL(e.FilesInput.FilesTextures[l])}s.src=c}catch(f){s.src=null}return s},n.LoadFile=function(t,r,i,o,s,a){t=n.CleanUrl(t);var u=function(){var e=new XMLHttpRequest,o=n.BaseUrl+t;e.open("GET",o,!0),s&&(e.responseType="arraybuffer"),e.onprogress=i,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||n.ValidateXHRData(e,s?6:1))r(s?e.response:e.responseText);else{if(!a)throw new Error("Error status: "+e.status+" - Unable to load "+o);a()}},e.send(null)},c=function(){o.loadFileFromDB(t,r,i,u,s)};if(-1!==t.indexOf("file:")){var l=t.substring(5);n.ReadFile(e.FilesInput.FilesToLoad[l],r,i,!0)}else o&&o.enableSceneOffline?o.openAsync(c,u):u()},n.ReadFileAsDataURL=function(e,t,r){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onprogress=r,n.readAsDataURL(e)},n.ReadFile=function(e,t,r,i){var o=new FileReader;o.onerror=function(r){n.Log("Error while reading file: "+e.name),t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){t(e.target.result)},o.onprogress=r,i?o.readAsArrayBuffer(e):o.readAsText(e)},n.Clamp=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),Math.min(r,Math.max(t,e))},n.Sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},n.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},n.CheckExtends=function(e,t,r){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>r.x&&(r.x=e.x),e.y>r.y&&(r.y=e.y),e.z>r.z&&(r.z=e.z)},n.WithinEpsilon=function(e,t,r){void 0===r&&(r=1.401298e-45);var n=e-t;return n>=-r&&r>=n},n.DeepCopy=function(e,t,n,i){for(var o in e)if(("_"!==o[0]||i&&-1!==i.indexOf(o))&&(!n||-1===n.indexOf(o))){var s=e[o],a=typeof s;if("function"!==a)if("object"===a)if(s instanceof Array){if(t[o]=[],s.length>0)if("object"==typeof s[0])for(var u=0;u<s.length;u++){var c=r(s[u],t);-1===t[o].indexOf(c)&&t[o].push(c)}else t[o]=s.slice(0)}else t[o]=r(s,t);else t[o]=s}},n.IsEmpty=function(e){for(var t in e)return!1;return!0},n.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var r=e[t];window.addEventListener(r.name,r.handler,!1);try{window.parent&&window.parent.addEventListener(r.name,r.handler,!1)}catch(n){}}},n.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var r=e[t];window.removeEventListener(r.name,r.handler);try{window.parent&&window.parent.removeEventListener(r.name,r.handler)}catch(n){}}},n.DumpFramebuffer=function(e,r,n,i){for(var o=4*e,s=r/2,a=n.readPixels(0,0,e,r),u=0;s>u;u++)for(var c=0;o>c;c++){var l=c+u*o,h=r-u-1,f=c+h*o,d=a[l];a[l]=a[f],a[f]=d}t||(t=document.createElement("canvas")),t.width=e,t.height=r;var p=t.getContext("2d"),m=p.createImageData(e,r),g=m.data;g.set(a),p.putImageData(m,0,0);var v=t.toDataURL();if(i)i(v);else if("download"in document.createElement("a")){var _=window.document.createElement("a");_.href=v;var y=new Date,x=y.getFullYear()+"-"+y.getMonth()+"-"+y.getDate()+"_"+y.getHours()+"-"+("0"+y.getMinutes()).slice(-2);_.setAttribute("download","screenshot_"+x+".png"),window.document.body.appendChild(_),_.addEventListener("click",function(){_.parentElement.removeChild(_)}),_.click()}else{var b=window.open(""),S=b.document.createElement("img");S.src=v,b.document.body.appendChild(S)}},n.CreateScreenshot=function(t,r,i,o){var s,a,u=r.getScene(),c=null;if(u.activeCamera!==r&&(c=u.activeCamera,u.activeCamera=r),i.precision)s=Math.round(t.getRenderWidth()*i.precision),a=Math.round(s/t.getAspectRatio(r)),i={width:s,height:a};else if(i.width&&i.height)s=i.width,a=i.height;else if(i.width&&!i.height)s=i.width,a=Math.round(s/t.getAspectRatio(r)),i={width:s,height:a};else if(i.height&&!i.width)a=i.height,s=Math.round(a*t.getAspectRatio(r)),i={width:s,height:a};else{if(isNaN(i))return void n.Error("Invalid 'size' parameter !");a=i,s=i}var l=new e.RenderTargetTexture("screenShot",i,u,!1,!1);l.renderList=u.meshes,l.onAfterRender=function(){n.DumpFramebuffer(s,a,t,o)},u.incrementRenderId(),l.render(!0),l.dispose(),c&&(u.activeCamera=c)},n.ValidateXHRData=function(t,r){void 0===r&&(r=7);try{if(1&r){if(t.responseText&&t.responseText.length>0)return!0;if(1===r)return!1}if(2&r){var n=e.Internals.TGATools.GetTGAHeader(t.response);if(n.width&&n.height&&n.width>0&&n.height>0)return!0;if(2===r)return!1}if(4&r){var i=new Uint8Array(t.response,0,3);return 68===i[0]&&68===i[1]&&83===i[2]?!0:!1}}catch(o){}return!1},Object.defineProperty(n,"NoneLogLevel",{get:function(){return n._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(n,"MessageLogLevel",{get:function(){return n._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(n,"WarningLogLevel",{get:function(){return n._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ErrorLogLevel",{get:function(){return n._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(n,"AllLogLevel",{get:function(){return n._MessageLogLevel|n._WarningLogLevel|n._ErrorLogLevel},enumerable:!0,configurable:!0}),n._AddLogEntry=function(e){n._LogCache=e+n._LogCache,n.OnNewCacheEntry&&n.OnNewCacheEntry(e)},n._FormatMessage=function(e){var t=function(e){return 10>e?"0"+e:""+e},r=new Date;return"["+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds())+"]: "+e},n._LogDisabled=function(e){},n._LogEnabled=function(e){var t=n._FormatMessage(e);console.log("BJS - "+t);var r="<div style='color:white'>"+t+"</div><br>";n._AddLogEntry(r)},n._WarnDisabled=function(e){},n._WarnEnabled=function(e){var t=n._FormatMessage(e);console.warn("BJS - "+t);var r="<div style='color:orange'>"+t+"</div><br>";n._AddLogEntry(r)},n._ErrorDisabled=function(e){},n._ErrorEnabled=function(e){n.errorsCount++;var t=n._FormatMessage(e);console.error("BJS - "+t);var r="<div style='color:red'>"+t+"</div><br>";n._AddLogEntry(r)},Object.defineProperty(n,"LogCache",{get:function(){return n._LogCache},enumerable:!0,configurable:!0}),n.ClearLogCache=function(){n._LogCache="",n.errorsCount=0},Object.defineProperty(n,"LogLevels",{set:function(e){n.Log=(e&n.MessageLogLevel)===n.MessageLogLevel?n._LogEnabled:n._LogDisabled,n.Warn=(e&n.WarningLogLevel)===n.WarningLogLevel?n._WarnEnabled:n._WarnDisabled,n.Error=(e&n.ErrorLogLevel)===n.ErrorLogLevel?n._ErrorEnabled:n._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(n,"PerformanceNoneLogLevel",{get:function(){return n._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(n,"PerformanceUserMarkLogLevel",{get:function(){return n._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(n,"PerformanceConsoleLogLevel",{get:function(){return n._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(n,"PerformanceLogLevel",{set:function(e){return(e&n.PerformanceUserMarkLogLevel)===n.PerformanceUserMarkLogLevel?(n.StartPerformanceCounter=n._StartUserMark,void(n.EndPerformanceCounter=n._EndUserMark)):(e&n.PerformanceConsoleLogLevel)===n.PerformanceConsoleLogLevel?(n.StartPerformanceCounter=n._StartPerformanceConsole,void(n.EndPerformanceCounter=n._EndPerformanceConsole)):(n.StartPerformanceCounter=n._StartPerformanceCounterDisabled,void(n.EndPerformanceCounter=n._EndPerformanceCounterDisabled));
},enumerable:!0,configurable:!0}),n._StartPerformanceCounterDisabled=function(e,t){},n._EndPerformanceCounterDisabled=function(e,t){},n._StartUserMark=function(e,t){void 0===t&&(t=!0),t&&n._performance.mark&&n._performance.mark(e+"-Begin")},n._EndUserMark=function(e,t){void 0===t&&(t=!0),t&&n._performance.mark&&(n._performance.mark(e+"-End"),n._performance.measure(e,e+"-Begin",e+"-End"))},n._StartPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(n._StartUserMark(e,t),console.time&&console.time(e))},n._EndPerformanceConsole=function(e,t){void 0===t&&(t=!0),t&&(n._EndUserMark(e,t),console.time&&console.timeEnd(e))},Object.defineProperty(n,"Now",{get:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),n.GetFps=function(){return n.Warn("Tools.GetFps() is deprecated. Please use engine.getFps() instead"),0},n.BaseUrl="",n._NoneLogLevel=0,n._MessageLogLevel=1,n._WarningLogLevel=2,n._ErrorLogLevel=4,n._LogCache="",n.errorsCount=0,n.Log=n._LogEnabled,n.Warn=n._WarnEnabled,n.Error=n._ErrorEnabled,n._PerformanceNoneLogLevel=0,n._PerformanceUserMarkLogLevel=1,n._PerformanceConsoleLogLevel=2,n._performance=window.performance,n.StartPerformanceCounter=n._StartPerformanceCounterDisabled,n.EndPerformanceCounter=n._EndPerformanceCounterDisabled,n}();e.Tools=n;var i=function(){function e(e,t,r,n){void 0===n&&(n=0),this.iterations=e,this._fn=t,this._successCallback=r,this.index=n-1,this._done=!1}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,r,n,i){void 0===i&&(i=0);var o=new e(t,r,n,i);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,r,n,i,o,s){void 0===s&&(s=0),e.Run(Math.ceil(t/r),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var i=0;r>i;++i){var s=e.index*r+i;if(s>=t)break;if(n(s),o&&o()){e.breakLoop();break}}e.executeNext()},s)},i)},e}();e.AsyncLoop=i}(r||(r={}));var r;!function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cull=null,this._cullFace=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},e}();e._DepthCullingState=t;var r=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4)}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendFunctionParameters=function(e,t,r,n){(this._blendFunctionParameters[0]!==e||this._blendFunctionParameters[1]!==t||this._blendFunctionParameters[2]!==r||this._blendFunctionParameters[3]!==n)&&(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=r,this._blendFunctionParameters[3]=n,this._isBlendFunctionParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},e}();e._AlphaState=r;var n=function(e,t,r,n){var i=e.createShader("vertex"===r?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(i,(n?n+"\n":"")+t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(i));return i},i=function(e,t){var r=e.UNSIGNED_BYTE;return t===l.TEXTURETYPE_FLOAT&&(r=e.FLOAT),r},o=function(t,r,n){var i=n.NEAREST,o=n.NEAREST;return t===e.Texture.BILINEAR_SAMPLINGMODE?(i=n.LINEAR,o=r?n.LINEAR_MIPMAP_NEAREST:n.LINEAR):t===e.Texture.TRILINEAR_SAMPLINGMODE?(i=n.LINEAR,o=r?n.LINEAR_MIPMAP_LINEAR:n.LINEAR):t===e.Texture.NEAREST_SAMPLINGMODE&&(i=n.NEAREST,o=r?n.NEAREST_MIPMAP_LINEAR:n.NEAREST),{min:o,mag:i}},s=function(t,r,n,i,s,a,u,c,l,h){void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE);var f=n.getEngine(),d=e.Tools.GetExponantOfTwo(i,f.getCaps().maxTextureSize),p=e.Tools.GetExponantOfTwo(s,f.getCaps().maxTextureSize);r.bindTexture(r.TEXTURE_2D,t),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,void 0===a?1:a?1:0),t._baseWidth=i,t._baseHeight=s,t._width=d,t._height=p,t.isReady=!0,l(d,p);var m=o(h,!u,r);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,m.mag),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,m.min),u||c||r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null),f._activeTexturesCache=[],n._removePendingData(t)},a=function(t,r,n,i,o){var s=function(){n[r]=u,n._internalCount++,i._removePendingData(u),6===n._internalCount&&o(n)},a=function(){i._removePendingData(u)},u=e.Tools.LoadImage(t,s,a,i.database);i._addPendingData(u)},u=function(e,t,r,n){var i=[];i._internalCount=0;for(var o=0;6>o;o++)a(e+n[o],o,i,t,r)},c=function(){function e(){}return e}();e.EngineCapabilities=c;var l=function(){function a(n,i,o){var s=this;this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.enableOfflineSupport=!0,this.scenes=new Array,this._windowIsBackground=!1,this._loadingDivBackgroundColor="black",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new t,this._alphaState=new r,this._alphaMode=a.ALPHA_DISABLE,this._loadedTexturesCache=new Array,this._activeTexturesCache=new Array,this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._renderingCanvas=n,o=o||{},o.antialias=i,void 0===o.preserveDrawingBuffer&&(o.preserveDrawingBuffer=!1);try{this._gl=n.getContext("webgl",o)||n.getContext("experimental-webgl",o)}catch(u){throw new Error("WebGL not supported")}if(!this._gl)throw new Error("WebGL not supported");this._onBlur=function(){s._windowIsBackground=!0},this._onFocus=function(){s._windowIsBackground=!1},window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus),this._hardwareScalingLevel=1/(window.devicePixelRatio||1),this.resize(),this._caps=new c,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._glVersion=this._gl.getParameter(this._gl.VERSION);var l=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=l&&(this._glRenderer=this._gl.getParameter(l.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(l.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._caps.standardDerivatives=null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._caps.textureFloat=null!==this._gl.getExtension("OES_texture_float"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._caps.uintIndices=null!==this._gl.getExtension("OES_element_index_uint"),this._caps.highPrecisionShaderSupported=!0,this._gl.getShaderPrecisionFormat){var h=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._caps.highPrecisionShaderSupported=0!=h.precision}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&(n.requestPointerLock=n.requestPointerLock||n.msRequestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,n.requestPointerLock&&n.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===n||document.webkitPointerLockElement===n||document.msPointerLockElement===n||document.pointerLockElement===n},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),a.audioEngine||(a.audioEngine=new e.AudioEngine),e.Tools.Log("Babylon.js engine (v"+a.Version+") launched")}return Object.defineProperty(a,"ALPHA_DISABLE",{get:function(){return a._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ALPHA_ONEONE",{get:function(){return a._ALPHA_ONEONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ALPHA_ADD",{get:function(){return a._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ALPHA_COMBINE",{get:function(){return a._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ALPHA_SUBTRACT",{get:function(){return a._ALPHA_SUBTRACT},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ALPHA_MULTIPLY",{get:function(){return a._ALPHA_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ALPHA_MAXIMIZED",{get:function(){return a._ALPHA_MAXIMIZED},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DELAYLOADSTATE_NONE",{get:function(){return a._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DELAYLOADSTATE_LOADED",{get:function(){return a._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DELAYLOADSTATE_LOADING",{get:function(){return a._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DELAYLOADSTATE_NOTLOADED",{get:function(){return a._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(a,"TEXTUREFORMAT_ALPHA",{get:function(){return a._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,"TEXTUREFORMAT_LUMINANCE",{get:function(){return a._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"TEXTUREFORMAT_LUMINANCE_ALPHA",{get:function(){return a._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(a,"TEXTUREFORMAT_RGB",{get:function(){return a._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(a,"TEXTUREFORMAT_RGBA",{get:function(){return a._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(a,"TEXTURETYPE_UNSIGNED_INT",{get:function(){return a._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(a,"TEXTURETYPE_FLOAT",{get:function(){return a._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Version",{get:function(){return"2.2.0"},enumerable:!0,configurable:!0}),a.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"),this._workingContext=this._workingCanvas.getContext("2d"))},a.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},a.prototype.getAspectRatio=function(e){var t=e.viewport;return this.getRenderWidth()*t.width/(this.getRenderHeight()*t.height)},a.prototype.getRenderWidth=function(){return this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},a.prototype.getRenderHeight=function(){return this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},a.prototype.getRenderingCanvas=function(){return this._renderingCanvas},a.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},a.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},a.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},a.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},a.prototype.getCaps=function(){return this._caps},Object.defineProperty(a.prototype,"drawCalls",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),a.prototype.resetDrawCalls=function(){this._drawCalls=0},a.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},a.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},a.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},a.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},a.prototype.stopRenderLoop=function(e){if(!e)return void(this._activeRenderLoops=[]);var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},a.prototype._renderLoop=function(){var t=this,r=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(r=!1),r){this.beginFrame();for(var n=0;n<this._activeRenderLoops.length;n++){var i=this._activeRenderLoops[n];i()}this.endFrame()}this._activeRenderLoops.length>0?e.Tools.QueueNewFrame(function(){t._renderLoop()}):this._renderingQueueLaunched=!1},a.prototype.runRenderLoop=function(t){var r=this;-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,e.Tools.QueueNewFrame(function(){r._renderLoop()})))},a.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,e.Tools.RequestFullscreen(this._renderingCanvas))},a.prototype.clear=function(e,t,r){this.applyStates(),this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),this._depthCullingState.depthMask&&this._gl.clearDepth(1);var n=0;t&&(n|=this._gl.COLOR_BUFFER_BIT),r&&this._depthCullingState.depthMask&&(n|=this._gl.DEPTH_BUFFER_BIT),this._gl.clear(n)},a.prototype.setViewport=function(e,t,r){var n=t||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width),i=r||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*n,s*i,n*e.width,i*e.height)},a.prototype.setDirectViewport=function(e,t,r,n){this._cachedViewport=null,this._gl.viewport(e,t,r,n)},a.prototype.beginFrame=function(){this._measureFps()},a.prototype.endFrame=function(){},a.prototype.resize=function(){var e=navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth,t=navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},a.prototype.setSize=function(e,t){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var r=0;r<this.scenes.length;r++)for(var n=this.scenes[r],i=0;i<n.cameras.length;i++){var o=n.cameras[i];o._currentRenderId=0}},a.prototype.bindFramebuffer=function(e){this._currentRenderTarget=e;var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,e._framebuffer),this._gl.viewport(0,0,e._width,e._height),this.wipeCaches()},a.prototype.unBindFramebuffer=function(e){if(this._currentRenderTarget=null,e.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_2D,e),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},a.prototype.flushFramebuffer=function(){this._gl.flush()},a.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},a.prototype._resetVertexBufferBinding=function(){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._cachedVertexBuffers=null},a.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},a.prototype.updateDynamicVertexBuffer=function(e,t,r){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),void 0===r&&(r=0),t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,new Float32Array(t)),this._resetVertexBufferBinding()},a.prototype._resetIndexBufferBinding=function(){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._cachedIndexBuffer=null},a.prototype.createIndexBuffer=function(e){var t=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t);var r,n=!1;if(this._caps.uintIndices){for(var i=0;i<e.length;i++)if(e[i]>65535){n=!0;break}r=n?new Uint32Array(e):new Uint16Array(e)}else r=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t.is32Bits=n,t},a.prototype.bindBuffers=function(e,t,r,n,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var o=0,s=0;s<r.length;s++){var a=i.getAttributeLocation(s);a>=0&&this._gl.vertexAttribPointer(a,r[s],this._gl.FLOAT,!1,n,o),o+=4*r[s]}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype.bindMultiBuffers=function(e,t,r){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==r){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r;for(var n=r.getAttributesNames(),i=0;i<n.length;i++){var o=r.getAttributeLocation(i);if(o>=0){var s=e[n[i]];if(!s)continue;var a=s.getStrideSize();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.getBuffer()),this._gl.vertexAttribPointer(o,a,this._gl.FLOAT,!1,4*a,0)}}}null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t),this._uintIndicesCurrentlySet=t.is32Bits)},a.prototype._releaseBuffer=function(e){return e.references--,0===e.references?(this._gl.deleteBuffer(e),!0):!1},a.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();return t.capacity=e,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},a.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},a.prototype.updateAndBindInstancesBuffer=function(e,t,r){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t);for(var n=0;4>n;n++){var i=r[n];this._gl.enableVertexAttribArray(i),this._gl.vertexAttribPointer(i,4,this._gl.FLOAT,!1,64,16*n),this._caps.instancedArrays.vertexAttribDivisorANGLE(i,1)}},a.prototype.unBindInstancesBuffer=function(e,t){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e);for(var r=0;4>r;r++){var n=t[r];this._gl.disableVertexAttribArray(n),this._caps.instancedArrays.vertexAttribDivisorANGLE(n,0)}},a.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._alphaState.apply(this._gl)},a.prototype.draw=function(e,t,r,n){this.applyStates(),this._drawCalls++;var i=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;return n?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,r,i,t*o,n):void this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,r,i,t*o)},a.prototype.drawPointClouds=function(e,t,r){return this.applyStates(),this._drawCalls++,r?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,e,t,r):void this._gl.drawArrays(this._gl.POINTS,e,t)},a.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],e.getProgram()&&this._gl.deleteProgram(e.getProgram()))},a.prototype.createEffect=function(t,r,n,i,o,s,a,u){var c=t.vertexElement||t.vertex||t,l=t.fragmentElement||t.fragment||t,h=c+"+"+l+"@"+o;if(this._compiledEffects[h])return this._compiledEffects[h];var f=new e.Effect(t,r,n,i,this,o,s,a,u);return f._key=h,this._compiledEffects[h]=f,f},a.prototype.createEffectForParticles=function(e,t,r,n,i,o,s){return void 0===t&&(t=[]),void 0===r&&(r=[]),void 0===n&&(n=""),this.createEffect({vertex:"particles",fragmentElement:e},["position","color","options"],["view","projection"].concat(t),["diffuseSampler"].concat(r),n,i,o,s)},a.prototype.createShaderProgram=function(e,t,r){var i=n(this._gl,e,"vertex",r),o=n(this._gl,t,"fragment",r),s=this._gl.createProgram();this._gl.attachShader(s,i),this._gl.attachShader(s,o),this._gl.linkProgram(s);var a=this._gl.getProgramParameter(s,this._gl.LINK_STATUS);if(!a){var u=this._gl.getProgramInfoLog(s);if(u)throw new Error(u)}return this._gl.deleteShader(i),this._gl.deleteShader(o),s},a.prototype.getUniforms=function(e,t){for(var r=[],n=0;n<t.length;n++)r.push(this._gl.getUniformLocation(e,t[n]));return r},a.prototype.getAttributes=function(e,t){for(var r=[],n=0;n<t.length;n++)try{r.push(this._gl.getAttribLocation(e,t[n]))}catch(i){r.push(-1)}return r},a.prototype.enableEffect=function(e){if(!e||!e.getAttributesCount()||this._currentEffect===e)return void(e&&e.onBind&&e.onBind(e));this._vertexAttribArrays=this._vertexAttribArrays||[],this._gl.useProgram(e.getProgram());for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||(this._vertexAttribArrays[t]=!1,this._gl.disableVertexAttribArray(t));for(var r=e.getAttributesCount(),n=0;r>n;n++){var i=e.getAttributeLocation(n);i>=0&&(this._vertexAttribArrays[i]=!0,this._gl.enableVertexAttribArray(i))}this._currentEffect=e,e.onBind&&e.onBind(e)},a.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},a.prototype.setArray2=function(e,t){e&&t.length%2===0&&this._gl.uniform2fv(e,t)},a.prototype.setArray3=function(e,t){e&&t.length%3===0&&this._gl.uniform3fv(e,t)},a.prototype.setArray4=function(e,t){e&&t.length%4===0&&this._gl.uniform4fv(e,t)},a.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},a.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},a.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},a.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},a.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},a.prototype.setFloat2=function(e,t,r){e&&this._gl.uniform2f(e,t,r)},a.prototype.setFloat3=function(e,t,r,n){e&&this._gl.uniform3f(e,t,r,n)},a.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},a.prototype.setFloat4=function(e,t,r,n,i){e&&this._gl.uniform4f(e,t,r,n,i)},a.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},a.prototype.setColor4=function(e,t,r){e&&this._gl.uniform4f(e,t.r,t.g,t.b,r)},a.prototype.setState=function(e,t,r){void 0===t&&(t=0),(this._depthCullingState.cull!==e||r)&&(e?(this._depthCullingState.cullFace=this.cullBackFaces?this._gl.BACK:this._gl.FRONT,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this._depthCullingState.zOffset=t},a.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},a.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},a.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},a.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e)},a.prototype.setAlphaMode=function(e){if(this._alphaMode!=e){switch(e){case a.ALPHA_DISABLE:this.setDepthWrite(!0),this._alphaState.alphaBlend=!1;break;case a.ALPHA_COMBINE:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_ONEONE:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_ADD:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_SUBTRACT:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_MULTIPLY:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case a.ALPHA_MAXIMIZED:this.setDepthWrite(!1),this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0}this._alphaMode=e}},a.prototype.getAlphaMode=function(){return this._alphaMode},a.prototype.setAlphaTesting=function(e){this._alphaTest=e},a.prototype.getAlphaTesting=function(){return this._alphaTest},a.prototype.wipeCaches=function(){this._activeTexturesCache=[],this._currentEffect=null,this._depthCullingState.reset(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},a.prototype.setSamplingMode=function(t,r){var n=this._gl;n.bindTexture(n.TEXTURE_2D,t);var i=n.NEAREST,o=n.NEAREST;r===e.Texture.BILINEAR_SAMPLINGMODE?(i=n.LINEAR,o=n.LINEAR):r===e.Texture.TRILINEAR_SAMPLINGMODE&&(i=n.LINEAR,o=n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,o),n.bindTexture(n.TEXTURE_2D,null),t.samplingMode=r},a.prototype.createTexture=function(t,r,n,i,o,a,u,c){var l=this;void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===u&&(u=null),void 0===c&&(c=null);var h,f=this._gl.createTexture(),d=!1;if("data:"===t.substr(0,5)&&(d=!0),d){var p=t;d=p.split(":"),t=p,h=d[1].substr(d[1].length-4,4).toLowerCase()}else h=t.substr(t.length-4,4).toLowerCase();var m=this.getCaps().s3tc&&".dds"===h,g=".tga"===h;i._addPendingData(f),f.url=t,f.noMipmap=r,f.references=1,f.samplingMode=o,this._loadedTexturesCache.push(f);var v=function(){i._removePendingData(f),u&&u()};if(g){var _=function(t){var u=new Uint8Array(t),c=e.Internals.TGATools.GetTGAHeader(u);s(f,l._gl,i,c.width,c.height,n,r,!1,function(){e.Internals.TGATools.UploadContent(l._gl,u),a&&a()},o)};d instanceof Array?_(c):e.Tools.LoadFile(t,function(e){_(e)},v,i.database,!0)}else if(m)_=function(t){var u=e.Internals.DDSTools.GetDDSInfo(t),c=(u.isRGB||u.isLuminance||u.mipmapCount>1)&&!r&&u.width>>u.mipmapCount-1===1;s(f,l._gl,i,u.width,u.height,n,!c,u.isFourCC,function(){e.Internals.DDSTools.UploadDDSLevels(l._gl,l.getCaps().s3tc,t,u,c,1),a&&a()},o)},d instanceof Array?_(c):e.Tools.LoadFile(t,function(e){_(e)},v,i.database,!0);else{var y=function(t){s(f,l._gl,i,t.width,t.height,n,r,!1,function(r,n){var i=t.width===r&&t.height===n;i||(l._prepareWorkingCanvas(),l._workingCanvas.width=r,l._workingCanvas.height=n,o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!1,l._workingContext.mozImageSmoothingEnabled=!1,l._workingContext.oImageSmoothingEnabled=!1,l._workingContext.webkitImageSmoothingEnabled=!1,l._workingContext.msImageSmoothingEnabled=!1),l._workingContext.drawImage(t,0,0,t.width,t.height,0,0,r,n),o===e.Texture.NEAREST_SAMPLINGMODE&&(l._workingContext.imageSmoothingEnabled=!0,l._workingContext.mozImageSmoothingEnabled=!0,l._workingContext.oImageSmoothingEnabled=!0,l._workingContext.webkitImageSmoothingEnabled=!0,l._workingContext.msImageSmoothingEnabled=!0)),l._gl.texImage2D(l._gl.TEXTURE_2D,0,l._gl.RGBA,l._gl.RGBA,l._gl.UNSIGNED_BYTE,i?t:l._workingCanvas),a&&a()},o)};d instanceof Array?e.Tools.LoadImage(c,y,v,i.database):e.Tools.LoadImage(t,y,v,i.database)}return f},a.prototype.updateRawTexture=function(e,t,r,n,i){void 0===i&&(i=null);var o=this._gl.RGBA;switch(r){case a.TEXTUREFORMAT_ALPHA:o=this._gl.ALPHA;break;case a.TEXTUREFORMAT_LUMINANCE:o=this._gl.LUMINANCE;break;case a.TEXTUREFORMAT_LUMINANCE_ALPHA:o=this._gl.LUMINANCE_ALPHA;break;case a.TEXTUREFORMAT_RGB:o=this._gl.RGB;break;case a.TEXTUREFORMAT_RGBA:o=this._gl.RGBA;
}this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===n?1:n?1:0),i?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[i],e._width,e._height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,e._width,e._height,0,o,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.createRawTexture=function(e,t,r,n,i,s,a,u){void 0===u&&(u=null);var c=this._gl.createTexture();c._baseWidth=t,c._baseHeight=r,c._width=t,c._height=r,c.references=1,this.updateRawTexture(c,e,n,s,u),this._gl.bindTexture(this._gl.TEXTURE_2D,c);var l=o(a,i,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,l.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,l.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),c.samplingMode=a,this._loadedTexturesCache.push(c),c},a.prototype.createDynamicTexture=function(t,r,n,i,o){void 0===o&&(o=!0);var s=this._gl.createTexture();return s._baseWidth=t,s._baseHeight=r,o&&(t=e.Tools.GetExponantOfTwo(t,this._caps.maxTextureSize),r=e.Tools.GetExponantOfTwo(r,this._caps.maxTextureSize)),this._activeTexturesCache=[],s._width=t,s._height=r,s.isReady=!1,s.generateMipMaps=n,s.references=1,s.samplingMode=i,this.updateTextureSamplingMode(i,s),this._loadedTexturesCache.push(s),s},a.prototype.updateTextureSamplingMode=function(e,t){var r=o(e,t.generateMipMaps,this._gl);this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,r.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,r.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},a.prototype.updateDynamicTexture=function(e,t,r){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,r?1:0),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0},a.prototype.updateVideoTexture=function(e,t,r){if(!e._isDisabled){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,r?0:1);try{void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._videoTextureSupported=0!==this._gl.getError()?!1:!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t):(e._workingCanvas||(e._workingCanvas=document.createElement("canvas"),e._workingContext=e._workingCanvas.getContext("2d"),e._workingCanvas.width=e._width,e._workingCanvas.height=e._height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e._width,e._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._activeTexturesCache=[],e.isReady=!0}catch(n){e._isDisabled=!0}}},a.prototype.createRenderTargetTexture=function(t,r){var n=!1,s=!0,u=a.TEXTURETYPE_UNSIGNED_INT,c=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==r&&(n=void 0===r.generateMipMaps?r:r.generateMipmaps,s=void 0===r.generateDepthBuffer?!0:r.generateDepthBuffer,u=void 0===r.type?u:r.type,void 0!==r.samplingMode&&(c=r.samplingMode),u===a.TEXTURETYPE_FLOAT&&(c=e.Texture.NEAREST_SAMPLINGMODE));var l=this._gl,h=l.createTexture();l.bindTexture(l.TEXTURE_2D,h);var f=t.width||t,d=t.height||t,p=o(c,n,l);u!==a.TEXTURETYPE_FLOAT||this._caps.textureFloat||(u=a.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,p.mag),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,p.min),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,f,d,0,l.RGBA,i(l,u),null);var m;s&&(m=l.createRenderbuffer(),l.bindRenderbuffer(l.RENDERBUFFER,m),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,f,d));var g=l.createFramebuffer();return l.bindFramebuffer(l.FRAMEBUFFER,g),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,h,0),s&&l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,m),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),h._framebuffer=g,s&&(h._depthBuffer=m),h._width=f,h._height=d,h.isReady=!0,h.generateMipMaps=n,h.references=1,h.samplingMode=c,this._activeTexturesCache=[],this._loadedTexturesCache.push(h),h},a.prototype.createCubeTexture=function(t,r,n,i){var o=this,s=this._gl,a=s.createTexture();a.isCube=!0,a.url=t,a.references=1,this._loadedTexturesCache.push(a);var c=t.substr(t.length-4,4).toLowerCase(),l=this.getCaps().s3tc&&".dds"===c;return l?e.Tools.LoadFile(t,function(t){var r=e.Internals.DDSTools.GetDDSInfo(t),n=(r.isRGB||r.isLuminance||r.mipmapCount>1)&&!i;s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,1),e.Internals.DDSTools.UploadDDSLevels(o._gl,o.getCaps().s3tc,t,r,n,6),i||r.isFourCC||1!==r.mipmapCount||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,n?s.LINEAR_MIPMAP_LINEAR:s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=r.width,a._height=r.height,a.isReady=!0},null,null,!0):u(t,r,function(t){var r=e.Tools.GetExponantOfTwo(t[0].width,o._caps.maxCubemapTextureSize),n=r;o._prepareWorkingCanvas(),o._workingCanvas.width=r,o._workingCanvas.height=n;var u=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];s.bindTexture(s.TEXTURE_CUBE_MAP,a),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0);for(var c=0;c<u.length;c++)o._workingContext.drawImage(t[c],0,0,t[c].width,t[c].height,0,0,r,n),s.texImage2D(u[c],0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,o._workingCanvas);i||s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,i?s.LINEAR:s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_CUBE_MAP,null),o._activeTexturesCache=[],a._width=r,a._height=n,a.isReady=!0},n),a},a.prototype._releaseTexture=function(e){var t=this._gl;e._framebuffer&&t.deleteFramebuffer(e._framebuffer),e._depthBuffer&&t.deleteRenderbuffer(e._depthBuffer),t.deleteTexture(e);for(var r=0;r<this._caps.maxTexturesImageUnits;r++)this._gl.activeTexture(this._gl["TEXTURE"+r]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[r]=null;var n=this._loadedTexturesCache.indexOf(e);-1!==n&&this._loadedTexturesCache.splice(n,1)},a.prototype.bindSamplers=function(e){this._gl.useProgram(e.getProgram());for(var t=e.getSamplers(),r=0;r<t.length;r++){var n=e.getUniform(t[r]);this._gl.uniform1i(n,r)}this._currentEffect=null},a.prototype._bindTexture=function(e,t){this._gl.activeTexture(this._gl["TEXTURE"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._activeTexturesCache[e]=null},a.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},a.prototype.setTexture=function(t,r){if(!(0>t)){if(!r||!r.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl["TEXTURE"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));if(r instanceof e.VideoTexture)r.update()&&(this._activeTexturesCache[t]=null);else if(r.delayLoadState===a.DELAYLOADSTATE_NOTLOADED)return void r.delayLoad();if(this._activeTexturesCache[t]!==r){this._activeTexturesCache[t]=r;var n=r.getInternalTexture();if(this._gl.activeTexture(this._gl["TEXTURE"+t]),n.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,n),n._cachedCoordinatesMode!==r.coordinatesMode){n._cachedCoordinatesMode=r.coordinatesMode;var i=r.coordinatesMode!==e.Texture.CUBIC_MODE&&r.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,i),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,i)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,r)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,n),n._cachedWrapU!==r.wrapU)switch(n._cachedWrapU=r.wrapU,r.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(n._cachedWrapV!==r.wrapV)switch(n._cachedWrapV=r.wrapV,r.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,r)}}}},a.prototype._setAnisotropicLevel=function(t,r){var n=this._caps.textureAnisotropicFilterExtension,i=r.anisotropicFilteringLevel;r.getInternalTexture().samplingMode===e.Texture.NEAREST_SAMPLINGMODE&&(i=1),n&&r._cachedAnisotropicFilteringLevel!==i&&(this._gl.texParameterf(t,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy)),r._cachedAnisotropicFilteringLevel=i)},a.prototype.readPixels=function(e,t,r,n){var i=new Uint8Array(n*r*4);return this._gl.readPixels(e,t,r,n,this._gl.RGBA,this._gl.UNSIGNED_BYTE,i),i},a.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();a.audioEngine.dispose();for(var e in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[e]._program);for(var t in this._vertexAttribArrays)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArrays[t]||this._gl.disableVertexAttribArray(t);this._gl=null,window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)},a.prototype.displayLoadingUI=function(){var e=this;this._loadingDiv=document.createElement("div"),this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv);var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==",t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.marginLeft="-50px",t.style.marginTop="-50px",t.style.transition="transform 1.0s ease",t.style.webkitTransition="-webkit-transform 1.0s ease";var r=360,n=function(){r+=360,t.style.transform="rotateZ("+r+"deg)",t.style.webkitTransform="rotateZ("+r+"deg)"};t.addEventListener("transitionend",n),t.addEventListener("webkitTransitionEnd",n),this._loadingDiv.appendChild(t);var i=new Image;i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=",i.style.position="absolute",i.style.left="50%",i.style.top="50%",i.style.marginLeft="-50px",i.style.marginTop="-50px",this._loadingDiv.appendChild(i),this._resizeLoadingUI=function(){var t=e.getRenderingCanvasClientRect();e._loadingDiv.style.position="absolute",e._loadingDiv.style.left=t.left+"px",e._loadingDiv.style.top=t.top+"px",e._loadingDiv.style.width=t.width+"px",e._loadingDiv.style.height=t.height+"px"},this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),setTimeout(function(){e._loadingDiv.style.opacity="1",t.style.transform="rotateZ(360deg)",t.style.webkitTransform="rotateZ(360deg)"},0)},Object.defineProperty(a.prototype,"loadingUIText",{set:function(e){this._loadingDiv&&(this._loadingTextDiv.innerHTML=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),a.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){var t=function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener("resize",e._resizeLoadingUI),e._loadingDiv=null)};this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",t)}},a.prototype.getFps=function(){return this.fps},a.prototype.getDeltaTime=function(){return this.deltaTime},a.prototype._measureFps=function(){this.previousFramesDuration.push(e.Tools.Now);var t=this.previousFramesDuration.length;if(t>=2&&(this.deltaTime=this.previousFramesDuration[t-1]-this.previousFramesDuration[t-2]),t>=this.fpsRange){t>this.fpsRange&&(this.previousFramesDuration.splice(0,1),t=this.previousFramesDuration.length);for(var r=0,n=0;t-1>n;n++)r+=this.previousFramesDuration[n+1]-this.previousFramesDuration[n];this.fps=1e3/(r/(t-1))}},a.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return null!=t&&!!window.WebGLRenderingContext}catch(r){return!1}},a._ALPHA_DISABLE=0,a._ALPHA_ADD=1,a._ALPHA_COMBINE=2,a._ALPHA_SUBTRACT=3,a._ALPHA_MULTIPLY=4,a._ALPHA_MAXIMIZED=5,a._ALPHA_ONEONE=6,a._DELAYLOADSTATE_NONE=0,a._DELAYLOADSTATE_LOADED=1,a._DELAYLOADSTATE_LOADING=2,a._DELAYLOADSTATE_NOTLOADED=4,a._TEXTUREFORMAT_ALPHA=0,a._TEXTUREFORMAT_LUMINANCE=1,a._TEXTUREFORMAT_LUMINANCE_ALPHA=2,a._TEXTUREFORMAT_RGB=4,a._TEXTUREFORMAT_RGBA=5,a._TEXTURETYPE_UNSIGNED_INT=0,a._TEXTURETYPE_FLOAT=1,a.Epsilon=.001,a.CollisionsEpsilon=.001,a.CodeRepository="src/",a.ShadersRepository="src/Shaders/",a}();e.Engine=l}(r||(r={}));var r;!function(e){var t=function(){function t(e,t){this.state="",this.animations=new Array,this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.name=e,this.id=e,this._scene=t,this._initCache()}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){(e||!this.isSynchronized())&&(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},t.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent===this.parent?!1:(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1},t.prototype._getDescendants=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];n.isDescendantOf(this)&&t.push(n)}},t.prototype.getDescendants=function(){var e=[];return this._getDescendants(this._scene.meshes,e),this._getDescendants(this._scene.lights,e),this._getDescendants(this._scene.cameras,e),e},t.prototype._setReady=function(e){if(e!=this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t}();e.Node=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a){this._engine=e,this._canvas=r,this._currentScene=t,this._sceneLoadedCallback=n,this._progressCallback=i,this._additionnalRenderLoopLogicCallback=o,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._elementToMonitor.addEventListener("dragenter",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener("dragover",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener("drop",function(e){t.drop(e)},!1))},t.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype.loadFiles=function(e){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var r=0;r<this._filesToLoad.length;r++)switch(this._filesToLoad[r].type){case"image/jpeg":case"image/png":case"image/bmp":t.FilesTextures[this._filesToLoad[r].name]=this._filesToLoad[r];break;case"image/targa":case"image/vnd.ms-dds":case"audio/wav":case"audio/x-wav":case"audio/mp3":case"audio/mpeg":case"audio/mpeg3":case"audio/x-mpeg-3":case"audio/ogg":t.FilesToLoad[this._filesToLoad[r].name]=this._filesToLoad[r];break;default:-1!==this._filesToLoad[r].name.indexOf(".babylon")&&-1===this._filesToLoad[r].name.indexOf(".manifest")&&-1===this._filesToLoad[r].name.indexOf(".incremental")&&-1===this._filesToLoad[r].name.indexOf(".babylonmeshdata")&&-1===this._filesToLoad[r].name.indexOf(".babylongeometrydata")&&-1===this._filesToLoad[r].name.indexOf(".babylonbinarymeshdata")&&-1===this._filesToLoad[r].name.indexOf(".binary.babylon")&&(this._sceneFileToLoad=this._filesToLoad[r])}this.reload()}},t.prototype.reload=function(){var t=this,r=this;this._sceneFileToLoad?(this._currentScene&&(e.Tools.errorsCount>0&&(e.Tools.ClearLogCache(),e.Tools.Log("Babylon.js engine (v"+e.Engine.Version+") launched")),this._engine.stopRenderLoop(),this._currentScene.dispose()),e.SceneLoader.Load("file:",this._sceneFileToLoad,this._engine,function(e){r._currentScene=e,r._currentScene.executeWhenReady(function(){r._currentScene.activeCamera&&0!==r._currentScene.lights.length||r._currentScene.createDefaultCameraOrLight(),r._currentScene.activeCamera.attachControl(r._canvas),r._sceneLoadedCallback&&r._sceneLoadedCallback(t._sceneFileToLoad,r._currentScene),r._engine.runRenderLoop(function(){r.renderFunction()})})},function(e){t._progressCallback&&t._progressCallback(e)})):e.Tools.Error("Please provide a valid .babylon file.")},t.FilesTextures=new Array,t.FilesToLoad=new Array,t}();e.FilesInput=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,r){this.bu=e,this.bv=t,this.distance=r,this.faceId=0,this.subMeshId=0}return e}();e.IntersectionInfo=t;var r=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0}return t.prototype.getNormal=function(t,r){if(void 0===t&&(t=!1),void 0===r&&(r=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var n,i=this.pickedMesh.getIndices();if(r){var o=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),s=e.Vector3.FromArray(o,3*i[3*this.faceId]),a=e.Vector3.FromArray(o,3*i[3*this.faceId+1]),u=e.Vector3.FromArray(o,3*i[3*this.faceId+2]);s=s.scale(this.bu),a=a.scale(this.bv),u=u.scale(1-this.bu-this.bv),n=new e.Vector3(s.x+a.x+u.x,s.y+a.y+u.y,s.z+a.z+u.z)}else{var c=this.pickedMesh.getVerticesData(e.VertexBuffer.PositionKind),l=e.Vector3.FromArray(c,3*i[3*this.faceId]),h=e.Vector3.FromArray(c,3*i[3*this.faceId+1]),f=e.Vector3.FromArray(c,3*i[3*this.faceId+2]),d=l.subtract(h),p=f.subtract(h);n=e.Vector3.Cross(d,p)}return t&&(n=e.Vector3.TransformNormal(n,this.pickedMesh.getWorldMatrix())),e.Vector3.Normalize(n)},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices(),r=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind),n=e.Vector2.FromArray(r,2*t[3*this.faceId]),i=e.Vector2.FromArray(r,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(r,2*t[3*this.faceId+2]);return n=n.scale(1-this.bu-this.bv),i=i.scale(this.bu),o=o.scale(this.bv),new e.Vector2(n.x+i.x+o.x,n.y+i.y+o.y)},t}();e.PickingInfo=r}(r||(r={}));var r;!function(e){var t=function(){function t(t,r){this.minimum=t,this.maximum=r,this._tempRadiusVector=e.Vector3.Zero();var n=e.Vector3.Distance(t,r);this.center=e.Vector3.Lerp(t,r,.5),this.radius=.5*n,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;6>t;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var r=this.centerWorld.x-t.x,n=this.centerWorld.y-t.y,i=this.centerWorld.z-t.z,o=Math.sqrt(r*r+n*n+i*i);return Math.abs(this.radiusWorld-o)<e.Engine.Epsilon?!1:!0},t.Intersects=function(e,t){var r=e.centerWorld.x-t.centerWorld.x,n=e.centerWorld.y-t.centerWorld.y,i=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(r*r+n*n+i*i);return e.radiusWorld+t.radiusWorld<o?!1:!0},t}();e.BoundingSphere=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r){this.minimum=t,this.maximum=r,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var n=0;n<this.vectors.length;n++)this.vectorsWorld[n]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var r=0;r<this.vectors.length;r++){var n=this.vectorsWorld[r];e.Vector3.TransformCoordinatesToRef(this.vectors[r],t,n),n.x<this.minimumWorld.x&&(this.minimumWorld.x=n.x),n.y<this.minimumWorld.y&&(this.minimumWorld.y=n.y),n.z<this.minimumWorld.z&&(this.minimumWorld.z=n.z),n.x>this.maximumWorld.x&&(this.maximumWorld.x=n.x),n.y>this.maximumWorld.y&&(this.maximumWorld.y=n.y),n.z>this.maximumWorld.z&&(this.maximumWorld.z=n.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var r=-e.Engine.Epsilon;return this.maximumWorld.x-t.x<r||r>t.x-this.minimumWorld.x?!1:this.maximumWorld.y-t.y<r||r>t.y-this.minimumWorld.y?!1:this.maximumWorld.z-t.z<r||r>t.z-this.minimumWorld.z?!1:!0},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return this.maximumWorld.x<e.x||this.minimumWorld.x>t.x?!1:this.maximumWorld.y<e.y||this.minimumWorld.y>t.y?!1:this.maximumWorld.z<e.z||this.minimumWorld.z>t.z?!1:!0},t.Intersects=function(e,t){return e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x?!1:e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y?!1:e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z?!1:!0},t.IntersectsSphere=function(t,r,n,i){var o=e.Vector3.Clamp(n,t,r),s=e.Vector3.DistanceSquared(n,o);return i*i>=s},t.IsCompletelyInFrustum=function(e,t){for(var r=0;6>r;r++)for(var n=0;8>n;n++)if(t[r].dotCoordinate(e[n])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var r=0;6>r;r++){for(var n=8,i=0;8>i&&t[r].dotCoordinate(e[i])<0;i++)--n;if(0===n)return!1}return!0},t}();e.BoundingBox=t}(r||(r={}));var r;!function(e){var t=function(t,r){var n=e.Vector3.Dot(r.center,t),i=Math.abs(e.Vector3.Dot(r.directions[0],t))*r.extendSize.x,o=Math.abs(e.Vector3.Dot(r.directions[1],t))*r.extendSize.y,s=Math.abs(e.Vector3.Dot(r.directions[2],t))*r.extendSize.z,a=i+o+s;return{min:n-a,max:n+a}},r=function(e,t,r,n){return!(e>n||r>t)},n=function(e,n,i){var o=t(e,n),s=t(e,i);return r(o.min,o.max,s.min,s.max)},i=function(){function t(t,r){this.minimum=t,this.maximum=r,this.boundingBox=new e.BoundingBox(t,r),this.boundingSphere=new e.BoundingSphere(t,r)}return t.prototype._update=function(e){this.boundingBox._update(e),this.boundingSphere._update(e)},t.prototype.isInFrustum=function(e){
return this.boundingSphere.isInFrustum(e)?this.boundingBox.isInFrustum(e):!1},t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(e)&&this.boundingBox.intersectsPoint(e)?!0:!1},t.prototype.intersects=function(t,r){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!r)return!0;var i=this.boundingBox,o=t.boundingBox;return n(i.directions[0],i,o)&&n(i.directions[1],i,o)&&n(i.directions[2],i,o)&&n(o.directions[0],i,o)&&n(o.directions[1],i,o)&&n(o.directions[2],i,o)&&n(e.Vector3.Cross(i.directions[0],o.directions[0]),i,o)&&n(e.Vector3.Cross(i.directions[0],o.directions[1]),i,o)&&n(e.Vector3.Cross(i.directions[0],o.directions[2]),i,o)&&n(e.Vector3.Cross(i.directions[1],o.directions[0]),i,o)&&n(e.Vector3.Cross(i.directions[1],o.directions[1]),i,o)&&n(e.Vector3.Cross(i.directions[1],o.directions[2]),i,o)&&n(e.Vector3.Cross(i.directions[2],o.directions[0]),i,o)&&n(e.Vector3.Cross(i.directions[2],o.directions[1]),i,o)&&n(e.Vector3.Cross(i.directions[2],o.directions[2]),i,o)?!0:!1},t}();e.BoundingInfo=i}(r||(r={}));var r;!function(e){var t=function(t){function r(n,i){var o=this;t.call(this,n,i),this.definedFacingForward=!0,this.position=new e.Vector3(0,0,0),this.rotation=new e.Vector3(0,0,0),this.scaling=new e.Vector3(1,1,1),this.billboardMode=r.BILLBOARDMODE_NONE,this.visibility=1,this.alphaIndex=Number.MAX_VALUE,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.onDispose=null,this.isBlocker=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.renderOutline=!1,this.outlineColor=e.Color3.Red(),this.outlineWidth=.02,this.renderOverlay=!1,this.overlayColor=e.Color3.Red(),this.overlayAlpha=.5,this.hasVertexAlpha=!1,this.useVertexColors=!0,this.applyFog=!0,this.computeBonesUsingShaders=!0,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=268435455,this.alwaysSelectAsActiveMesh=!1,this._physicImpostor=e.PhysicsEngine.NoImpostor,this._checkCollisions=!1,this.ellipsoid=new e.Vector3(.5,1,.5),this.ellipsoidOffset=new e.Vector3(0,0,0),this._collider=new e.Collider,this._oldPositionForCollisions=new e.Vector3(0,0,0),this._diffPositionForCollisions=new e.Vector3(0,0,0),this._newPositionForCollisions=new e.Vector3(0,0,0),this.edgesWidth=1,this.edgesColor=new e.Color4(1,0,0,1),this._localScaling=e.Matrix.Zero(),this._localRotation=e.Matrix.Zero(),this._localTranslation=e.Matrix.Zero(),this._localBillboard=e.Matrix.Zero(),this._localPivotScaling=e.Matrix.Zero(),this._localPivotScalingRotation=e.Matrix.Zero(),this._localWorld=e.Matrix.Zero(),this._worldMatrix=e.Matrix.Zero(),this._rotateYByPI=e.Matrix.RotationY(Math.PI),this._absolutePosition=e.Vector3.Zero(),this._collisionsTransformMatrix=e.Matrix.Zero(),this._collisionsScalingMatrix=e.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=e.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,this._onAfterWorldMatrixUpdate=new Array,this._isWorldMatrixFrozen=!1,this._onCollisionPositionChange=function(t,r,n){void 0===n&&(n=null),o.getScene().workerCollisions&&r.multiplyInPlace(o._collider.radius),r.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions),o.onCollide&&n&&o.onCollide(n)},i.addMesh(this)}return n(r,t),Object.defineProperty(r,"BILLBOARDMODE_NONE",{get:function(){return r._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BILLBOARDMODE_X",{get:function(){return r._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BILLBOARDMODE_Y",{get:function(){return r._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BILLBOARDMODE_Z",{get:function(){return r._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BILLBOARDMODE_ALL",{get:function(){return r._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),r.prototype.disableEdgesRendering=function(){void 0!==this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=void 0)},r.prototype.enableEdgesRendering=function(t,r){void 0===t&&(t=.95),void 0===r&&(r=!1),this.disableEdgesRendering(),this._edgesRenderer=new e.EdgesRenderer(this,t,r)},Object.defineProperty(r.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),r.prototype.getLOD=function(e){return this},r.prototype.getTotalVertices=function(){return 0},r.prototype.getIndices=function(){return null},r.prototype.getVerticesData=function(e){return null},r.prototype.isVerticesDataPresent=function(e){return!1},r.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(r.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),r.prototype._preActivate=function(){},r.prototype._activate=function(e){this._renderId=e},r.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},Object.defineProperty(r.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),r.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},r.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},Object.defineProperty(r.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),r.prototype.rotate=function(t,r,n){if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero()),n&&n!==e.Space.LOCAL){if(this.parent){var i=this.parent.getWorldMatrix().clone();i.invert(),t=e.Vector3.TransformNormal(t,i)}o=e.Quaternion.RotationAxis(t,r),this.rotationQuaternion=o.multiply(this.rotationQuaternion)}else{var o=e.Quaternion.RotationAxis(t,r);this.rotationQuaternion=this.rotationQuaternion.multiply(o)}},r.prototype.translate=function(t,r,n){var i=t.scale(r);if(n&&n!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(i));else{var o=this.getPositionExpressedInLocalSpace().add(i);this.setPositionWithLocalVector(o)}},r.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},r.prototype.setAbsolutePosition=function(t){if(t){var r,n,i;if(void 0===t.x){if(arguments.length<3)return;r=arguments[0],n=arguments[1],i=arguments[2]}else r=t.x,n=t.y,i=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(r,n,i);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=r,this.position.y=n,this.position.z=i}},r.prototype.movePOV=function(e,t,r){this.position.addInPlace(this.calcMovePOV(e,t,r))},r.prototype.calcMovePOV=function(t,r,n){var i=new e.Matrix,o=this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);o.toRotationMatrix(i);var s=e.Vector3.Zero(),a=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*a,r,n*a,i,s),s},r.prototype.rotatePOV=function(e,t,r){this.rotation.addInPlace(this.calcRotatePOV(e,t,r))},r.prototype.calcRotatePOV=function(t,r,n){var i=this.definedFacingForward?1:-1;return new e.Vector3(t*i,r,n*i)},r.prototype.setPivotMatrix=function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},r.prototype.getPivotMatrix=function(){return this._pivotMatrix},r.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==r.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return this._cache.scaling.equals(this.scaling)?!0:!1},r.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0)},r.prototype.markAsDirty=function(e){"rotation"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},r.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo._update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},r.prototype._updateSubMeshesBoundingInfo=function(e){if(this.subMeshes)for(var t=0;t<this.subMeshes.length;t++){var r=this.subMeshes[t];r.updateBoundingInfo(e)}},r.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x,this.scaling.y,this.scaling.z,this._localScaling),this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._localRotation),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._localRotation),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var n=this.getScene().activeCamera;if(n){var i=n.getWorldMatrix(),o=new e.Vector3(i.m[12],i.m[13],i.m[14]);e.Matrix.TranslationToRef(this.position.x+o.x,this.position.y+o.y,this.position.z+o.z,this._localTranslation)}}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._localTranslation);if(this._pivotMatrix.multiplyToRef(this._localScaling,this._localPivotScaling),this._localPivotScaling.multiplyToRef(this._localRotation,this._localPivotScalingRotation),this.billboardMode!==r.BILLBOARDMODE_NONE&&this.getScene().activeCamera){var s=this.position.clone(),a=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(s.addInPlace(this.parent.position),e.Matrix.TranslationToRef(s.x,s.y,s.z,this._localTranslation)),(this.billboardMode&r.BILLBOARDMODE_ALL)!=r.BILLBOARDMODE_ALL&&(this.billboardMode&r.BILLBOARDMODE_X&&(a.x=s.x+e.Engine.Epsilon),this.billboardMode&r.BILLBOARDMODE_Y&&(a.y=s.y+.001),this.billboardMode&r.BILLBOARDMODE_Z&&(a.z=s.z+.001)),e.Matrix.LookAtLHToRef(s,a,e.Vector3.Up(),this._localBillboard),this._localBillboard.m[12]=this._localBillboard.m[13]=this._localBillboard.m[14]=0,this._localBillboard.invert(),this._localPivotScalingRotation.multiplyToRef(this._localBillboard,this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,this._localPivotScalingRotation)}this._localPivotScalingRotation.multiplyToRef(this._localTranslation,this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===r.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._meshToBoneReferal?(this._localMeshReferalTransform||(this._localMeshReferalTransform=e.Matrix.Zero()),this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._localMeshReferalTransform),this._localMeshReferalTransform.multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);for(var u=0;u<this._onAfterWorldMatrixUpdate.length;u++)this._onAfterWorldMatrixUpdate[u](this);return this._worldMatrix},r.prototype.registerAfterWorldMatrixUpdate=function(e){this._onAfterWorldMatrixUpdate.push(e)},r.prototype.unregisterAfterWorldMatrixUpdate=function(e){var t=this._onAfterWorldMatrixUpdate.indexOf(e);t>-1&&this._onAfterWorldMatrixUpdate.splice(t,1)},r.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld)},r.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},r.prototype.locallyTranslate=function(t){this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld)},r.prototype.lookAt=function(t,r,n,i){r=r||0,n=n||0,i=i||0;var o=t.subtract(this.position),s=-Math.atan2(o.z,o.x)-Math.PI/2,a=Math.sqrt(o.x*o.x+o.z*o.z),u=Math.atan2(o.y,a);this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(s+r,u+n,i)},r.prototype.attachToBone=function(e,t){this._meshToBoneReferal=t,this.parent=e},r.prototype.detachFromBone=function(){this._meshToBoneReferal=null,this.parent=null},r.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},r.prototype.isCompletelyInFrustum=function(t){t||(t=this.getScene().activeCamera);var r=t.getViewMatrix().multiply(t.getProjectionMatrix());return this._boundingInfo.isCompletelyInFrustum(e.Frustum.GetPlanes(r))?!0:!1},r.prototype.intersectsMesh=function(e,t){return this._boundingInfo&&e._boundingInfo?this._boundingInfo.intersects(e._boundingInfo,t):!1},r.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},r.prototype.setPhysicsState=function(t,r){var n=this.getScene().getPhysicsEngine();return n?(t=t||e.PhysicsEngine.NoImpostor,t.impostor&&(r=t,t=t.impostor),t===e.PhysicsEngine.NoImpostor?void n._unregisterMesh(this):(r?(r.mass||0===r.mass||(r.mass=0),r.friction||0===r.friction||(r.friction=.2),r.restitution||0===r.restitution||(r.restitution=.2)):r={mass:0,friction:.2,restitution:.2},this._physicImpostor=t,this._physicsMass=r.mass,this._physicsFriction=r.friction,this._physicRestitution=r.restitution,n._registerMesh(this,t,r))):void 0},r.prototype.getPhysicsImpostor=function(){return this._physicImpostor?this._physicImpostor:e.PhysicsEngine.NoImpostor},r.prototype.getPhysicsMass=function(){return this._physicsMass?this._physicsMass:0},r.prototype.getPhysicsFriction=function(){return this._physicsFriction?this._physicsFriction:0},r.prototype.getPhysicsRestitution=function(){return this._physicRestitution?this._physicRestitution:0},r.prototype.getPositionInCameraSpace=function(t){return t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},r.prototype.getDistanceToCamera=function(e){return e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},r.prototype.applyImpulse=function(e,t){this._physicImpostor&&this.getScene().getPhysicsEngine()._applyImpulse(this,e,t)},r.prototype.setPhysicsLinkWith=function(e,t,r,n){this._physicImpostor&&this.getScene().getPhysicsEngine()._createLink(this,e,t,r,n)},r.prototype.updatePhysicsBodyPosition=function(){this._physicImpostor&&this.getScene().getPhysicsEngine()._updateBodyPosition(this)},Object.defineProperty(r.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),r.prototype.moveWithCollisions=function(e){var t=this.getAbsolutePosition();t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,e,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId)},r.prototype.createOrUpdateSubmeshesOctree=function(t,r){void 0===t&&(t=64),void 0===r&&(r=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,r)),this.computeWorldMatrix(!0);var n=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(n.minimumWorld,n.maximumWorld,this.subMeshes),this._submeshesOctree},r.prototype._collideForSubMesh=function(t,r,n){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(r)){t._lastColliderTransformMatrix=r.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var i=t.verticesStart,o=t.verticesStart+t.verticesCount,s=i;o>s;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],r))}n._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),n.collisionFound&&(n.collidedMesh=this)},r.prototype._processCollisionsForSubMeshes=function(e,t){var r,n;if(this._submeshesOctree&&this.useOctreeForCollisions){var i=e.velocityWorldLength+Math.max(e.radius.x,e.radius.y,e.radius.z),o=this._submeshesOctree.intersects(e.basePointWorld,i);n=o.length,r=o.data}else r=this.subMeshes,n=r.length;for(var s=0;n>s;s++){var a=r[s];n>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}},r.prototype._checkCollision=function(t){this._boundingInfo._checkCollision(t)&&(e.Matrix.ScalingToRef(1/t.radius.x,1/t.radius.y,1/t.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(t,this._collisionsTransformMatrix))},r.prototype._generatePointsArray=function(){return!1},r.prototype.intersects=function(t,r){var n=new e.PickingInfo;if(!(this.subMeshes&&this._boundingInfo&&t.intersectsSphere(this._boundingInfo.boundingSphere)&&t.intersectsBox(this._boundingInfo.boundingBox)))return n;if(!this._generatePointsArray())return n;var i,o,s=null;if(this._submeshesOctree&&this.useOctreeForPicking){var a=e.Ray.Transform(t,this.getWorldMatrix()),u=this._submeshesOctree.intersectsRay(a);o=u.length,i=u.data}else i=this.subMeshes,o=i.length;for(var c=0;o>c;c++){var l=i[c];if(!(o>1)||l.canIntersects(t)){var h=l.intersects(t,this._positions,this.getIndices(),r);if(h&&(r||!s||h.distance<s.distance)&&(s=h,s.subMeshId=c,r))break}}if(s){var f=this.getWorldMatrix(),d=e.Vector3.TransformCoordinates(t.origin,f),p=t.direction.clone();p=p.scale(s.distance);var m=e.Vector3.TransformNormal(p,f),g=d.add(m);return n.hit=!0,n.distance=e.Vector3.Distance(d,g),n.pickedPoint=g,n.pickedMesh=this,n.bu=s.bu,n.bv=s.bv,n.faceId=s.faceId,n.subMeshId=s.subMeshId,n}return n},r.prototype.clone=function(e,t,r){return null},r.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array},r.prototype.dispose=function(t){var r;for(this.getPhysicsImpostor()!==e.PhysicsEngine.NoImpostor&&this.setPhysicsState(e.PhysicsEngine.NoImpostor),r=0;r<this._intersectionsInProgress.length;r++){var n=this._intersectionsInProgress[r],i=n._intersectionsInProgress.indexOf(this);n._intersectionsInProgress.splice(i,1)}if(this._intersectionsInProgress=[],this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this.releaseSubMeshes(),this.getScene().removeMesh(this),t)for(r=0;r<this.getScene().meshes.length;r++){var o=this.getScene().meshes[r];o.parent===this&&(o.parent=null,o.computeWorldMatrix(!0))}else{for(r=0;r<this.getScene().particleSystems.length;r++)this.getScene().particleSystems[r].emitter===this&&(this.getScene().particleSystems[r].dispose(),r--);var s=this.getScene().meshes.slice(0);for(r=0;r<s.length;r++)s[r].parent===this&&s[r].dispose()}this._onAfterWorldMatrixUpdate=[],this._isDisposed=!0,this.onDispose&&this.onDispose()},r._BILLBOARDMODE_NONE=0,r._BILLBOARDMODE_X=1,r._BILLBOARDMODE_Y=2,r._BILLBOARDMODE_Z=4,r._BILLBOARDMODE_ALL=7,r}(e.Node);e.AbstractMesh=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n){t.call(this,r,n),this.diffuse=new e.Color3(1,1,1),this.specular=new e.Color3(1,1,1),this.intensity=1,this.range=Number.MAX_VALUE,this.includeOnlyWithLayerMask=0,this.includedOnlyMeshes=new Array,this.excludedMeshes=new Array,this.excludeWithLayerMask=0,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,n.addLight(this)}return n(r,t),r.prototype.getShadowGenerator=function(){return this._shadowGenerator},r.prototype.getAbsolutePosition=function(){return e.Vector3.Zero()},r.prototype.transferToEffect=function(e,t,r){},r.prototype._getWorldMatrix=function(){return e.Matrix.Identity()},r.prototype.canAffectMesh=function(e){return e?this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e)?!1:this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!1:0!==this.includeOnlyWithLayerMask&&0===(this.includeOnlyWithLayerMask&e.layerMask)?!1:0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask?!1:!0:!0},r.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var t=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=e.Matrix.Identity()),t.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._markSyncedWithParent(),this._parentedWorldMatrix):t},r.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().removeLight(this)},r}(e.Node);e.Light=t}(r||(r={}));var r;!function(e){var t=function(t){function r(e,r,n){t.call(this,e,n),this.position=r}return n(r,t),r.prototype.getAbsolutePosition=function(){return this._transformedPosition?this._transformedPosition:this.position},r.prototype.transferToEffect=function(t,r){return this.parent&&this.parent.getWorldMatrix?(this._transformedPosition||(this._transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this._transformedPosition),void t.setFloat4(r,this._transformedPosition.x,this._transformedPosition.y,this._transformedPosition.z,0)):void t.setFloat4(r,this.position.x,this.position.y,this.position.z,0)},r.prototype.getShadowGenerator=function(){return null},r.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},r}(e.Light);e.PointLight=t}(r||(r={}));var r;!function(e){var t=function(t){function r(e,r,n,i,o,s){t.call(this,e,s),this.position=r,this.direction=n,this.angle=i,this.exponent=o}return n(r,t),r.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},r.prototype.setShadowProjectionMatrix=function(t,r,n){var i=this.getScene().activeCamera;e.Matrix.PerspectiveFovLHToRef(this.angle,1,i.minZ,i.maxZ,t)},r.prototype.supportsVSM=function(){return!0},r.prototype.needRefreshPerFrame=function(){return!1},r.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},r.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},r.prototype.transferToEffect=function(t,r,n){var i;this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),this.computeTransformedPosition(),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),t.setFloat4(r,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent),i=e.Vector3.Normalize(this._transformedDirection)):(t.setFloat4(r,this.position.x,this.position.y,this.position.z,this.exponent),i=e.Vector3.Normalize(this.direction)),t.setFloat4(n,i.x,i.y,i.z,Math.cos(.5*this.angle))},r.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},r}(e.Light);e.SpotLight=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i){t.call(this,r,i),this.direction=n,this.groundColor=new e.Color3(0,0,0)}return n(r,t),r.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(e.Vector3.Zero())),this.direction},r.prototype.getShadowGenerator=function(){return null},r.prototype.transferToEffect=function(t,r,n){var i=e.Vector3.Normalize(this.direction);t.setFloat4(r,i.x,i.y,i.z,0),t.setColor3(n,this.groundColor.scale(this.intensity))},r.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix},r}(e.Light);e.HemisphericLight=t}(r||(r={}));var r;!function(e){var t=function(t){function r(e,r,n){t.call(this,e,n),this.direction=r,this.shadowOrthoScale=.5,this.position=r.scale(-1)}return n(r,t),r.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},r.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},r.prototype.setShadowProjectionMatrix=function(t,r,n){for(var i=Number.MAX_VALUE,o=Number.MIN_VALUE,s=Number.MIN_VALUE,a=Number.MAX_VALUE,u=e.Vector3.Zero(),c=this.getScene().activeCamera,l=0;l<n.length;l++){var h=n[l];if(h){var f=h.getBoundingInfo();if(f)for(var d=f.boundingBox,p=0;p<d.vectorsWorld.length;p++)e.Vector3.TransformCoordinatesToRef(d.vectorsWorld[p],r,u),u.x<i&&(i=u.x),u.y<a&&(a=u.y),u.x>o&&(o=u.x),u.y>s&&(s=u.y)}}var m=o-i,g=s-a;e.Matrix.OrthoOffCenterLHToRef(i-m*this.shadowOrthoScale,o+m*this.shadowOrthoScale,a-g*this.shadowOrthoScale,s+g*this.shadowOrthoScale,-c.maxZ,c.maxZ,t)},r.prototype.supportsVSM=function(){return!0},r.prototype.needRefreshPerFrame=function(){return!0},r.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},r.prototype.transferToEffect=function(t,r){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void t.setFloat4(r,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void t.setFloat4(r,this.direction.x,this.direction.y,this.direction.z,1)},r.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},r}(e.Light);e.DirectionalLight=t}(r||(r={}));var r;!function(e){var t=function(){function t(r,n){var i=this;this._filter=t.FILTER_NONE,this.blurScale=2,this._blurBoxOffset=0,this._bias=5e-5,this._lightDirection=e.Vector3.Zero(),this._darkness=0,this._transparencyShadow=!1,this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._light=n,this._scene=n.getScene(),this._mapSize=r,n._shadowGenerator=this,this._shadowMap=new e.RenderTargetTexture(n.name+"_shadowMap",r,this._scene,!1),this._shadowMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.onAfterUnbind=function(){i.useBlurVarianceShadowMap&&(i._shadowMap2||(i._shadowMap2=new e.RenderTargetTexture(n.name+"_shadowMap",r,i._scene,!1),i._shadowMap2.wrapU=e.Texture.CLAMP_ADDRESSMODE,i._shadowMap2.wrapV=e.Texture.CLAMP_ADDRESSMODE,i._shadowMap2.updateSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE),i._downSamplePostprocess=new e.PassPostProcess("downScale",1/i.blurScale,null,e.Texture.BILINEAR_SAMPLINGMODE,i._scene.getEngine()),i._downSamplePostprocess.onApply=function(e){e.setTexture("textureSampler",i._shadowMap)},i.blurBoxOffset=1),i._scene.postProcessManager.directRender([i._downSamplePostprocess,i._boxBlurPostprocess],i._shadowMap2.getInternalTexture()))};var o=function(t){var r=t.getRenderingMesh(),n=i._scene,o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=r._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(i.isReady(t,a)){o.enableEffect(i._effect),r._bind(t,i._effect,e.Material.TriangleFillMode);var u=t.getMaterial();if(i._effect.setMatrix("viewProjection",i.getTransformMatrix()),u&&u.needAlphaTesting()){var c=u.getAlphaTestTexture();i._effect.setTexture("diffuseSampler",c),i._effect.setMatrix("diffuseMatrix",c.getTextureMatrix())}r.useBones&&r.computeBonesUsingShaders&&i._effect.setMatrices("mBones",r.skeleton.getTransformMatrices()),r._processRendering(t,i._effect,e.Material.TriangleFillMode,s,a,function(e,t){return i._effect.setMatrix("world",t)})}else i._shadowMap.resetRefreshCounter()}};this._shadowMap.customRenderFunction=function(e,t,r){var n;for(n=0;n<e.length;n++)o(e.data[n]);for(n=0;n<t.length;n++)o(t.data[n]);if(i._transparencyShadow)for(n=0;n<r.length;n++)o(r.data[n])},this._shadowMap.onClear=function(t){i.useBlurVarianceShadowMap||i.useVarianceShadowMap?t.clear(new e.Color4(0,0,0,0),!0,!0):t.clear(new e.Color4(1,1,1,1),!0,!0)}}return Object.defineProperty(t,"FILTER_NONE",{get:function(){return t._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_VARIANCESHADOWMAP",{get:function(){return t._FILTER_VARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_POISSONSAMPLING",{get:function(){return t._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_BLURVARIANCESHADOWMAP",{get:function(){return t._FILTER_BLURVARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(t){var r=this;this._blurBoxOffset!==t&&(this._blurBoxOffset=t,this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=new e.PostProcess("DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1/this.blurScale,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define OFFSET "+t),this._boxBlurPostprocess.onApply=function(e){e.setFloat2("screenSize",r._mapSize/r.blurScale,r._mapSize/r.blurScale);
})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(t){this._filter!==t&&(this._filter=t,this.useVarianceShadowMap||this.useBlurVarianceShadowMap?(this._shadowMap.anisotropicFilteringLevel=16,this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE)):(this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVarianceShadowMap",{get:function(){return this.filter===t.FILTER_VARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(e){this.filter=e?t.FILTER_VARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePoissonSampling",{get:function(){return this.filter===t.FILTER_POISSONSAMPLING||!this._light.supportsVSM()&&(this.filter===t.FILTER_VARIANCESHADOWMAP||this.filter===t.FILTER_BLURVARIANCESHADOWMAP)},set:function(e){this.filter=e?t.FILTER_POISSONSAMPLING:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBlurVarianceShadowMap",{get:function(){return this.filter===t.FILTER_BLURVARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(e){this.filter=e?t.FILTER_BLURVARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,r){var n=[];(this.useVarianceShadowMap||this.useBlurVarianceShadowMap)&&n.push("#define VSM");var i=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(i.push(e.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(i.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),o.useBones&&o.computeBonesUsingShaders&&(i.push(e.VertexBuffer.MatricesIndicesKind),i.push(e.VertexBuffer.MatricesWeightsKind),n.push("#define BONES"),n.push("#define BonesPerMesh "+(o.skeleton.bones.length+1))),r&&(n.push("#define INSTANCES"),i.push("world0"),i.push("world1"),i.push("world2"),i.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("shadowMap",i,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],a)),this._effect.isReady()},t.prototype.getShadowMap=function(){return this._shadowMap},t.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},t.prototype.getLight=function(){return this._light},t.prototype.getTransformMatrix=function(){var t=this._scene;if(this._currentRenderID===t.getRenderId())return this._transformMatrix;this._currentRenderID=t.getRenderId();var r=this._light.position;return e.Vector3.NormalizeToRef(this._light.direction,this._lightDirection),1==Math.abs(e.Vector3.Dot(this._lightDirection,e.Vector3.Up()))&&(this._lightDirection.z=1e-13),this._light.computeTransformedPosition()&&(r=this._light.transformedPosition),!this._light.needRefreshPerFrame()&&this._cachedPosition&&this._cachedDirection&&r.equals(this._cachedPosition)&&this._lightDirection.equals(this._cachedDirection)||(this._cachedPosition=r.clone(),this._cachedDirection=this._lightDirection.clone(),e.Matrix.LookAtLHToRef(r,this._light.position.add(this._lightDirection),e.Vector3.Up(),this._viewMatrix),this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,this.getShadowMap().renderList),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix},t.prototype.getDarkness=function(){return this._darkness},t.prototype.setDarkness=function(e){this._darkness=e>=1?1:0>=e?0:e},t.prototype.setTransparencyShadow=function(e){this._transparencyShadow=e},t.prototype._packHalf=function(t){var r=255*t,n=r-Math.floor(r);return new e.Vector2(t-n/255,n)},t.prototype.dispose=function(){this._shadowMap.dispose(),this._shadowMap2&&this._shadowMap2.dispose(),this._downSamplePostprocess&&this._downSamplePostprocess.dispose(),this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose()},t._FILTER_NONE=0,t._FILTER_VARIANCESHADOWMAP=1,t._FILTER_POISSONSAMPLING=2,t._FILTER_BLURVARIANCESHADOWMAP=3,t}();e.ShadowGenerator=t}(r||(r={}));var r;!function(e){var t=function(e,t,r,n){return e.x>r.x+n?!1:r.x-n>t.x?!1:e.y>r.y+n?!1:r.y-n>t.y?!1:e.z>r.z+n?!1:r.z-n>t.z?!1:!0},r=function(e,t,r,n){var i=t*t-4*e*r,o={root:0,found:!1};if(0>i)return o;var s=Math.sqrt(i),a=(-t-s)/(2*e),u=(-t+s)/(2*e);if(a>u){var c=u;u=a,a=c}return a>0&&n>a?(o.root=a,o.found=!0,o):u>0&&n>u?(o.root=u,o.found=!0,o):o},n=function(){function n(){this.radius=new e.Vector3(1,1,1),this.retry=0,this.basePointWorld=e.Vector3.Zero(),this.velocityWorld=e.Vector3.Zero(),this.normalizedVelocity=e.Vector3.Zero(),this._collisionPoint=e.Vector3.Zero(),this._planeIntersectionPoint=e.Vector3.Zero(),this._tempVector=e.Vector3.Zero(),this._tempVector2=e.Vector3.Zero(),this._tempVector3=e.Vector3.Zero(),this._tempVector4=e.Vector3.Zero(),this._edge=e.Vector3.Zero(),this._baseToVertex=e.Vector3.Zero(),this._destinationPoint=e.Vector3.Zero(),this._slidePlaneNormal=e.Vector3.Zero(),this._displacementVector=e.Vector3.Zero()}return n.prototype._initialize=function(t,r,n){this.velocity=r,e.Vector3.NormalizeToRef(r,this.normalizedVelocity),this.basePoint=t,t.multiplyToRef(this.radius,this.basePointWorld),r.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=n,this.collisionFound=!1},n.prototype._checkPointInTriangle=function(t,r,n,i,o){r.subtractToRef(t,this._tempVector),n.subtractToRef(t,this._tempVector2),e.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var s=e.Vector3.Dot(this._tempVector4,o);return 0>s?!1:(i.subtractToRef(t,this._tempVector3),e.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),0>s?!1:(e.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),s>=0))},n.prototype._canDoCollision=function(r,n,i,o){var s=e.Vector3.Distance(this.basePointWorld,r),a=Math.max(this.radius.x,this.radius.y,this.radius.z);return s>this.velocityWorldLength+a+n?!1:t(i,o,this.basePointWorld,this.velocityWorldLength+a)?!0:!1},n.prototype._testTriangle=function(t,n,i,o,s,a){var u,c=!1;n||(n=[]),n[t]||(n[t]=new e.Plane(0,0,0,0),n[t].copyFromPoints(i,o,s));var l=n[t];if(a||l.isFrontFacingTo(this.normalizedVelocity,0)){var h=l.signedDistanceTo(this.basePoint),f=e.Vector3.Dot(l.normal,this.velocity);if(0==f){if(Math.abs(h)>=1)return;c=!0,u=0}else{u=(-1-h)/f;var d=(1-h)/f;if(u>d){var p=d;d=u,u=p}if(u>1||0>d)return;0>u&&(u=0),u>1&&(u=1)}this._collisionPoint.copyFromFloats(0,0,0);var m=!1,g=1;if(c||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(u,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,i,o,s,l.normal)&&(m=!0,g=u,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!m){var v=this.velocity.lengthSquared(),_=v;this.basePoint.subtractToRef(i,this._tempVector);var y=2*e.Vector3.Dot(this.velocity,this._tempVector),x=this._tempVector.lengthSquared()-1,b=r(_,y,x,g);b.found&&(g=b.root,m=!0,this._collisionPoint.copyFrom(i)),this.basePoint.subtractToRef(o,this._tempVector),y=2*e.Vector3.Dot(this.velocity,this._tempVector),x=this._tempVector.lengthSquared()-1,b=r(_,y,x,g),b.found&&(g=b.root,m=!0,this._collisionPoint.copyFrom(o)),this.basePoint.subtractToRef(s,this._tempVector),y=2*e.Vector3.Dot(this.velocity,this._tempVector),x=this._tempVector.lengthSquared()-1,b=r(_,y,x,g),b.found&&(g=b.root,m=!0,this._collisionPoint.copyFrom(s)),o.subtractToRef(i,this._edge),i.subtractToRef(this.basePoint,this._baseToVertex);var S=this._edge.lengthSquared(),E=e.Vector3.Dot(this._edge,this.velocity),M=e.Vector3.Dot(this._edge,this._baseToVertex);if(_=S*-v+E*E,y=2*S*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*E*M,x=S*(1-this._baseToVertex.lengthSquared())+M*M,b=r(_,y,x,g),b.found){var T=(E*b.root-M)/S;T>=0&&1>=T&&(g=b.root,m=!0,this._edge.scaleInPlace(T),i.addToRef(this._edge,this._collisionPoint))}s.subtractToRef(o,this._edge),o.subtractToRef(this.basePoint,this._baseToVertex),S=this._edge.lengthSquared(),E=e.Vector3.Dot(this._edge,this.velocity),M=e.Vector3.Dot(this._edge,this._baseToVertex),_=S*-v+E*E,y=2*S*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*E*M,x=S*(1-this._baseToVertex.lengthSquared())+M*M,b=r(_,y,x,g),b.found&&(T=(E*b.root-M)/S,T>=0&&1>=T&&(g=b.root,m=!0,this._edge.scaleInPlace(T),o.addToRef(this._edge,this._collisionPoint))),i.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex),S=this._edge.lengthSquared(),E=e.Vector3.Dot(this._edge,this.velocity),M=e.Vector3.Dot(this._edge,this._baseToVertex),_=S*-v+E*E,y=2*S*e.Vector3.Dot(this.velocity,this._baseToVertex)-2*E*M,x=S*(1-this._baseToVertex.lengthSquared())+M*M,b=r(_,y,x,g),b.found&&(T=(E*b.root-M)/S,T>=0&&1>=T&&(g=b.root,m=!0,this._edge.scaleInPlace(T),s.addToRef(this._edge,this._collisionPoint)))}if(m){var P=g*this.velocity.length();(!this.collisionFound||P<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=P,this.collisionFound=!0)}}},n.prototype._collide=function(e,t,r,n,i,o,s){for(var a=n;i>a;a+=3){var u=t[r[a]-o],c=t[r[a+1]-o],l=t[r[a+2]-o];this._testTriangle(a,e,l,c,u,s)}},n.prototype._getResponse=function(t,r){t.addToRef(r,this._destinationPoint),r.scaleInPlace(this.nearestDistance/r.length()),this.basePoint.addToRef(r,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(e.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,r)},n}();e.Collider=n}(r||(r={}));var r;!function(e){e.CollisionWorker="",function(e){e[e.INIT=0]="INIT",e[e.UPDATE=1]="UPDATE",e[e.COLLIDE=2]="COLLIDE"}(e.WorkerTaskType||(e.WorkerTaskType={}));var t=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(e.WorkerReplyType||(e.WorkerReplyType={}));var r=e.WorkerReplyType,n=function(){function n(){var i=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){i._addUpdateMeshesList[e.uniqueId]=n.SerializeMesh(e)},this.onGeometryUpdated=function(e){i._addUpdateGeometriesList[e.id]=n.SerializeGeometry(e)},this._afterRender=function(){if(i._init&&!(0==i._toRemoveGeometryArray.length&&0==i._toRemoveMeshesArray.length&&0==Object.keys(i._addUpdateGeometriesList).length&&0==Object.keys(i._addUpdateMeshesList).length||i._runningUpdated>4)){++i._runningUpdated;var e={updatedMeshes:i._addUpdateMeshesList,updatedGeometries:i._addUpdateGeometriesList,removedGeometries:i._toRemoveGeometryArray,removedMeshes:i._toRemoveMeshesArray},r={payload:e,taskType:t.UPDATE},n=[];for(var o in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(o)&&(n.push(r.payload.updatedGeometries[o].indices.buffer),n.push(r.payload.updatedGeometries[o].normals.buffer),n.push(r.payload.updatedGeometries[o].positions.buffer));i._worker.postMessage(r,n),i._addUpdateMeshesList={},i._addUpdateGeometriesList={},i._toRemoveGeometryArray=[],i._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(n){var o=n.data;if(o.error!=r.SUCCESS)return void e.Tools.Warn("error returned from worker!");switch(o.taskType){case t.INIT:i._init=!0,i._scene.meshes.forEach(function(e){i.onMeshAdded(e)}),i._scene.getGeometries().forEach(function(e){i.onGeometryAdded(e)});break;case t.UPDATE:i._runningUpdated--;break;case t.COLLIDE:i._runningCollisionTask=!1;var s=o.payload;if(!i._collisionsCallbackArray[s.collisionId])return;i._collisionsCallbackArray[s.collisionId](s.collisionId,e.Vector3.FromArray(s.newPosition),i._scene.getMeshByUniqueID(s.collidedMeshUniqueId)),i._collisionsCallbackArray[s.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return n.prototype.getNewPosition=function(e,r,n,i,o,s,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(n.radius,this._scaledPosition),r.divideToRef(n.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=s;var u={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:n.radius.asArray()},collisionId:a,excludedMeshUniqueId:o?o.uniqueId:null,maximumRetry:i},c={payload:u,taskType:t.COLLIDE};this._worker.postMessage(c)}},n.prototype.init=function(r){this._scene=r,this._scene.registerAfterRender(this._afterRender);var n=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(n),this._worker.onmessage=this._onMessageFromWorker;var i={payload:{},taskType:t.INIT};this._worker.postMessage(i)},n.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},n.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},n.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},n.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},n.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},n.SerializeMesh=function(t){var r=[];t.subMeshes&&(r=t.subMeshes.map(function(e,t){return{position:t,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var n=null;return t instanceof e.Mesh?n=t.geometry?t.geometry.id:null:t instanceof e.InstancedMesh&&(n=t.sourceMesh.geometry?t.sourceMesh.geometry.id:null),{uniqueId:t.uniqueId,id:t.id,name:t.name,geometryId:n,sphereCenter:t.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:t.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:t.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:t.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:t.worldMatrixFromCache.asArray(),subMeshes:r,checkCollisions:t.checkCollisions}},n.SerializeGeometry=function(t){return{id:t.id,positions:new Float32Array(t.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(t.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(t.getIndices()||[])}},n}();e.CollisionCoordinatorWorker=n;var i=function(){function t(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return t.prototype.getNewPosition=function(e,t,r,n,i,o,s){e.divideToRef(r.radius,this._scaledPosition),t.divideToRef(r.radius,this._scaledVelocity),r.collidedMesh=null,r.retry=0,r.initialVelocity=this._scaledVelocity,r.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,r,n,this._finalPosition,i),this._finalPosition.multiplyInPlace(r.radius),o(s,this._finalPosition,r.collidedMesh)},t.prototype.init=function(e){this._scene=e},t.prototype.destroy=function(){},t.prototype.onMeshAdded=function(e){},t.prototype.onMeshUpdated=function(e){},t.prototype.onMeshRemoved=function(e){},t.prototype.onGeometryAdded=function(e){},t.prototype.onGeometryUpdated=function(e){},t.prototype.onGeometryDeleted=function(e){},t.prototype._collideWithWorld=function(t,r,n,i,o,s){void 0===s&&(s=null);var a=10*e.Engine.CollisionsEpsilon;if(n.retry>=i)return void o.copyFrom(t);n._initialize(t,r,a);for(var u=0;u<this._scene.meshes.length;u++){var c=this._scene.meshes[u];c.isEnabled()&&c.checkCollisions&&c.subMeshes&&c!==s&&c._checkCollision(n)}return n.collisionFound?((0!==r.x||0!==r.y||0!==r.z)&&n._getResponse(t,r),r.length()<=a?void o.copyFrom(t):(n.retry++,void this._collideWithWorld(t,r,n,i,o,s))):void t.addToRef(r,o)},t}();e.CollisionCoordinatorLegacy=i}(r||(r={}));var r;!function(e){var t=function(){function t(){this.compensateDistorsion=!0}return Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftHMatrix",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,r=4*t/this.hScreenSize;return e.Matrix.Translation(r,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightHMatrix",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,r=4*t/this.hScreenSize;return e.Matrix.Translation(-r,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftPreViewMatrix",{get:function(){return e.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightPreViewMatrix",{get:function(){return e.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),t.GetDefault=function(){var e=new t;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e},t}();e.VRCameraMetrics=t;var r=function(r){function i(t,n,o){r.call(this,t,o),this.position=n,this.upVector=e.Vector3.Up(),this.orthoLeft=null,this.orthoRight=null,this.orthoBottom=null,this.orthoTop=null,this.fov=.8,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this.mode=i.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new e.Viewport(0,0,1,1),this.layerMask=268435455,this.fovMode=i.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=i.RIG_MODE_NONE,this._rigCameras=new Array,this._computedViewMatrix=e.Matrix.Identity(),this._projectionMatrix=new e.Matrix,this._postProcesses=new Array,this._postProcessesTakenIndices=[],this._activeMeshes=new e.SmartArray(256),this._globalPosition=e.Vector3.Zero(),o.addCamera(this),o.activeCamera||(o.activeCamera=this)}return n(i,r),Object.defineProperty(i,"PERSPECTIVE_CAMERA",{get:function(){return i._PERSPECTIVE_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ORTHOGRAPHIC_CAMERA",{get:function(){return i._ORTHOGRAPHIC_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOVMODE_VERTICAL_FIXED",{get:function(){return i._FOVMODE_VERTICAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOVMODE_HORIZONTAL_FIXED",{get:function(){return i._FOVMODE_HORIZONTAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_NONE",{get:function(){return i._RIG_MODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_ANAGLYPH",{get:function(){return i._RIG_MODE_STEREOSCOPIC_ANAGLYPH},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL",{get:function(){return i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED",{get:function(){return i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_OVERUNDER",{get:function(){return i._RIG_MODE_STEREOSCOPIC_OVERUNDER},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_VR",{get:function(){return i._RIG_MODE_VR},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),i.prototype.getActiveMeshes=function(){return this._activeMeshes},i.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},i.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache.position=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},i.prototype._updateCache=function(e){e||r.prototype._updateCache.call(this);var t=this.getEngine();this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector),this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._cache.fov=this.fov,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()},i.prototype._updateFromScene=function(){this.updateCache(),this._update()},i.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},i.prototype._isSynchronizedViewMatrix=function(){return r.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},i.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===i.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===t.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()},i.prototype.attachControl=function(e){},i.prototype.detachControl=function(e){},i.prototype._update=function(){this.cameraRigMode!==i.RIG_MODE_NONE&&this._updateRigCameras(),this._checkInputs()},i.prototype._checkInputs=function(){},i.prototype.attachPostProcess=function(t,r){if(void 0===r&&(r=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1)return e.Tools.Error("You're trying to reuse a post process not defined as reusable."),0;if(null==r||0>r)return this._postProcesses.push(t),this._postProcessesTakenIndices.push(this._postProcesses.length-1),this._postProcesses.length-1;var n=0;if(this._postProcesses[r]){for(var i=this._postProcesses.length-1,o=i;o>=r+1;--o)this._postProcesses[o+1]=this._postProcesses[o];n=1}for(o=0;o<this._postProcessesTakenIndices.length;++o)if(!(this._postProcessesTakenIndices[o]<r)){i=this._postProcessesTakenIndices.length-1;for(var s=i;s>=o;--s)this._postProcessesTakenIndices[s+1]=this._postProcessesTakenIndices[s]+n;this._postProcessesTakenIndices[o]=r;break}n||-1!=this._postProcessesTakenIndices.indexOf(r)||this._postProcessesTakenIndices.push(r);var a=r+n;return this._postProcesses[a]=t,a},i.prototype.detachPostProcess=function(e,t){void 0===t&&(t=null);var r=[];if(t)for(t=t instanceof Array?t:[t],o=0;o<t.length;o++){var n=this._postProcesses[t[o]];n===e?(delete this._postProcesses[t[o]],s=this._postProcessesTakenIndices.indexOf(t[o]),this._postProcessesTakenIndices.splice(s,1)):r.push(o)}else for(var i=this._postProcesses.length,o=0;i>o;o++)if(this._postProcesses[o]===e){delete this._postProcesses[o];var s=this._postProcessesTakenIndices.indexOf(o);this._postProcessesTakenIndices.splice(s,1)}return r},i.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=e.Matrix.Identity());var t=this.getViewMatrix();return t.invertToRef(this._worldMatrix),this._worldMatrix},i.prototype._getViewMatrix=function(){return e.Matrix.Identity()},i.prototype.getViewMatrix=function(t){return this._computedViewMatrix=this._computeViewMatrix(t),!t&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},i.prototype._computeViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},i.prototype.getProjectionMatrix=function(t){if(!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;var r=this.getEngine();if(this.mode===i.PERSPECTIVE_CAMERA)return this.minZ<=0&&(this.minZ=.1),e.Matrix.PerspectiveFovLHToRef(this.fov,r.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode),this._projectionMatrix;var n=r.getRenderWidth()/2,o=r.getRenderHeight()/2;return e.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-n,this.orthoRight||n,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix},i.prototype.dispose=function(){for(this.getScene().removeCamera(this);this._rigCameras.length>0;)this._rigCameras.pop().dispose();for(var e=0;e<this._postProcessesTakenIndices.length;++e)this._postProcesses[this._postProcessesTakenIndices[e]].dispose(this)},i.prototype.setCameraRigMode=function(r,n){for(;this._rigCameras.length>0;)this._rigCameras.pop().dispose();switch(this.cameraRigMode=r,this._cameraRigParams={},this.cameraRigMode){case i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case i.RIG_MODE_STEREOSCOPIC_OVERUNDER:this._cameraRigParams.interaxialDistance=n.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this._rigCameras.push(this.createRigCamera(this.name+"_L",0)),this._rigCameras.push(this.createRigCamera(this.name+"_R",1))}var o=new Array;switch(this.cameraRigMode){case i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:o.push(new e.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0])),this._rigCameras[0].isIntermediate=!0,o.push(new e.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras[1])),o[1].onApply=function(e){e.setTextureFromPostProcess("leftSampler",o[0])};break;case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case i.RIG_MODE_STEREOSCOPIC_OVERUNDER:var s=this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,a=this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:0,u=1-a;o.push(new e.PassPostProcess(this.name+"_passthru",1,this._rigCameras[a])),this._rigCameras[a].isIntermediate=!0,o.push(new e.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras[u],o[0],s));break;case i.RIG_MODE_VR:this._rigCameras.push(this.createRigCamera(this.name+"_L",0)),this._rigCameras.push(this.createRigCamera(this.name+"_R",1));var c=n.vrCameraMetrics||t.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=c,this._rigCameras[0].viewport=new e.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=c.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=c.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,c.compensateDistorsion&&o.push(new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[0],!1,c)),this._rigCameras[1]._cameraRigParams.vrMetrics=this._rigCameras[0]._cameraRigParams.vrMetrics,this._rigCameras[1].viewport=new e.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=c.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=c.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,c.compensateDistorsion&&o.push(new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,c))}this._update()},i.prototype._getVRProjectionMatrix=function(){return e.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},i.prototype.setCameraRigParameter=function(t,r){this._cameraRigParams[t]=r,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(r/.0637))},i.prototype.createRigCamera=function(e,t){return null},i.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov;this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},i._PERSPECTIVE_CAMERA=0,i._ORTHOGRAPHIC_CAMERA=1,i._FOVMODE_VERTICAL_FIXED=0,i._FOVMODE_HORIZONTAL_FIXED=1,i._RIG_MODE_NONE=0,i._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,i._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,i._RIG_MODE_VR=20,i}(e.Node);e.Camera=r}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i){t.call(this,r,n,i),this.cameraDirection=new e.Vector3(0,0,0),this.cameraRotation=new e.Vector2(0,0),this.rotation=new e.Vector3(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.lockedTarget=null,this._currentTarget=e.Vector3.Zero(),this._viewMatrix=e.Matrix.Zero(),this._camMatrix=e.Matrix.Zero(),this._cameraTransformMatrix=e.Matrix.Zero(),this._cameraRotationMatrix=e.Matrix.Zero(),this._referencePoint=new e.Vector3(0,0,1),this._transformedReferencePoint=e.Vector3.Zero(),this._lookAtTemp=e.Matrix.Zero(),this._tempMatrix=e.Matrix.Zero()}return n(r,t),r.prototype.getFrontPosition=function(e){var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)},r.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null},r.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.lockedTarget=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},r.prototype._updateCache=function(e){
e||t.prototype._updateCache.call(this);var r=this._getLockedTargetPosition();r?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(r):this._cache.lockedTarget=r.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation)},r.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&this._cache.rotation.equals(this.rotation)},r.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*(e.getDeltaTime()/(10*e.getFps()))},r.prototype.setTarget=function(t){this.upVector.normalize(),e.Matrix.LookAtLHToRef(this.position,t,this.upVector,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var r=t.subtract(this.position);this.rotation.y=r.x>=0?-Math.atan(r.z/r.x)+Math.PI/2:-Math.atan(r.z/r.x)-Math.PI/2,this.rotation.z=-Math.acos(e.Vector3.Dot(new e.Vector3(0,1,0),this.upVector)),isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0)},r.prototype.getTarget=function(){return this._currentTarget},r.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},r.prototype._updatePosition=function(){this.position.addInPlace(this.cameraDirection)},r.prototype._checkInputs=function(){var r=this._decideIfNeedsToMove(),n=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(r&&this._updatePosition(),n&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){var i=Math.PI/2*.95;this.rotation.x>i&&(this.rotation.x=i),this.rotation.x<-i&&(this.rotation.x=-i)}r&&(Math.abs(this.cameraDirection.x)<e.Engine.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<e.Engine.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<e.Engine.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),n&&(Math.abs(this.cameraRotation.x)<e.Engine.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<e.Engine.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),t.prototype._checkInputs.call(this)},r.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(0!==this.upVector.x||1!==this.upVector.y||0!==this.upVector.z?(e.Matrix.LookAtLHToRef(e.Vector3.Zero(),this._referencePoint,this.upVector,this._lookAtTemp),e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),this._lookAtTemp.multiplyToRef(this._cameraRotationMatrix,this._tempMatrix),this._lookAtTemp.invert(),this._tempMatrix.multiplyToRef(this._lookAtTemp,this._cameraRotationMatrix)):e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget)),e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},r.prototype._getVRViewMatrix=function(){return e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),e.Vector3.TransformNormalToRef(this.upVector,this._cameraRotationMatrix,this._cameraRigParams.vrActualUp),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this._cameraRigParams.vrActualUp,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._viewMatrix),this._viewMatrix},r.prototype.createRigCamera=function(t,n){if(this.cameraRigMode!==e.Camera.RIG_MODE_NONE){var i=new r(t,this.position.clone(),this.getScene());return this.cameraRigMode===e.Camera.RIG_MODE_VR&&(i._cameraRigParams={},i._cameraRigParams.vrActualUp=new e.Vector3(0,0,0),i._getViewMatrix=i._getVRViewMatrix),i}return null},r.prototype._updateRigCameras=function(){switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:var r=this._rigCameras[0],n=this._rigCameras[1];this.cameraRigMode===e.Camera.RIG_MODE_VR?(r.rotation.x=n.rotation.x=this.rotation.x,r.rotation.y=n.rotation.y=this.rotation.y,r.rotation.z=n.rotation.z=this.rotation.z,r.position.copyFrom(this.position),n.position.copyFrom(this.position)):(this._getRigCamPosition(-this._cameraRigParams.stereoHalfAngle,r.position),this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle,n.position),r.setTarget(this.getTarget()),n.setTarget(this.getTarget()))}t.prototype._updateRigCameras.call(this)},r.prototype._getRigCamPosition=function(t,r){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new e.Matrix);var n=this.getTarget();e.Matrix.Translation(-n.x,-n.y,-n.z).multiplyToRef(e.Matrix.RotationY(t),this._rigCamTransformMatrix),this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(e.Matrix.Translation(n.x,n.y,n.z)),e.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,r)},r}(e.Camera);e.TargetCamera=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i){var o=this;t.call(this,r,n,i),this.ellipsoid=new e.Vector3(.5,1,.5),this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.checkCollisions=!1,this.applyGravity=!1,this.angularSensibility=2e3,this._keys=[],this._collider=new e.Collider,this._needMoveForGravity=!1,this._oldPosition=e.Vector3.Zero(),this._diffPosition=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this._onCollisionPositionChange=function(t,r,n){void 0===n&&(n=null),o.getScene().workerCollisions&&r.multiplyInPlace(o._collider.radius);var i=function(t){o._newPosition.copyFrom(t),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition),o.position.clone(),o._diffPosition.length()>e.Engine.CollisionsEpsilon&&(o.position.addInPlace(o._diffPosition),o.onCollide&&n&&o.onCollide(n))};i(r)}}return n(r,t),r.prototype.attachControl=function(t,r){var n,i=this,o=this.getEngine();this._attachedElement||(this._attachedElement=t,void 0===this._onMouseDown&&(this._onMouseDown=function(e){n={x:e.clientX,y:e.clientY},r||e.preventDefault()},this._onMouseUp=function(e){n=null,r||e.preventDefault()},this._onMouseOut=function(e){n=null,i._keys=[],r||e.preventDefault()},this._onMouseMove=function(e){if(n||o.isPointerLock){var t,s;o.isPointerLock?(t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,s=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0):(t=e.clientX-n.x,s=e.clientY-n.y),i.cameraRotation.y+=t/i.angularSensibility,i.cameraRotation.x+=s/i.angularSensibility,n={x:e.clientX,y:e.clientY},r||e.preventDefault()}},this._onKeyDown=function(e){if(-1!==i.keysUp.indexOf(e.keyCode)||-1!==i.keysDown.indexOf(e.keyCode)||-1!==i.keysLeft.indexOf(e.keyCode)||-1!==i.keysRight.indexOf(e.keyCode)){var t=i._keys.indexOf(e.keyCode);-1===t&&i._keys.push(e.keyCode),r||e.preventDefault()}},this._onKeyUp=function(e){if(-1!==i.keysUp.indexOf(e.keyCode)||-1!==i.keysDown.indexOf(e.keyCode)||-1!==i.keysLeft.indexOf(e.keyCode)||-1!==i.keysRight.indexOf(e.keyCode)){var t=i._keys.indexOf(e.keyCode);t>=0&&i._keys.splice(t,1),r||e.preventDefault()}},this._onLostFocus=function(){i._keys=[]},this._reset=function(){i._keys=[],n=null,i.cameraDirection=new e.Vector3(0,0,0),i.cameraRotation=new e.Vector2(0,0)}),t.addEventListener("mousedown",this._onMouseDown,!1),t.addEventListener("mouseup",this._onMouseUp,!1),t.addEventListener("mouseout",this._onMouseOut,!1),t.addEventListener("mousemove",this._onMouseMove,!1),e.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]))},r.prototype.detachControl=function(t){this._attachedElement==t&&(t.removeEventListener("mousedown",this._onMouseDown),t.removeEventListener("mouseup",this._onMouseUp),t.removeEventListener("mouseout",this._onMouseOut),t.removeEventListener("mousemove",this._onMouseMove),e.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._attachedElement=null,this._reset&&this._reset())},r.prototype._collideWithWorld=function(t){var r;r=this.parent?e.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,r.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._collider.radius=this.ellipsoid,this.applyGravity&&t.addInPlace(this.getScene().gravity),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,t,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},r.prototype._checkInputs=function(){this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero());for(var r=0;r<this._keys.length;r++){var n=this._keys[r],i=this._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(n)?this._localDirection.copyFromFloats(-i,0,0):-1!==this.keysUp.indexOf(n)?this._localDirection.copyFromFloats(0,0,i):-1!==this.keysRight.indexOf(n)?this._localDirection.copyFromFloats(i,0,0):-1!==this.keysDown.indexOf(n)&&this._localDirection.copyFromFloats(0,0,-i),this.getViewMatrix().invertToRef(this._cameraTransformMatrix),e.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.cameraDirection.addInPlace(this._transformedDirection)}t.prototype._checkInputs.call(this)},r.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},r.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):this.position.addInPlace(this.cameraDirection)},r}(e.TargetCamera);e.FreeCamera=t}(r||(r={}));var r;!function(e){var t=function(t){function r(e,r,n){t.call(this,e,r,n),this.radius=12,this.rotationOffset=0,this.heightOffset=4,this.cameraAcceleration=.05,this.maxCameraSpeed=20}return n(r,t),r.prototype.getRadians=function(e){return e*Math.PI/180},r.prototype.follow=function(t){if(t){var r;if(t.rotationQuaternion){var n=new e.Matrix;t.rotationQuaternion.toRotationMatrix(n),r=Math.atan2(n.m[8],n.m[10])}else r=t.rotation.y;var i=this.getRadians(this.rotationOffset)+r,o=t.position.x+Math.sin(i)*this.radius,s=t.position.z+Math.cos(i)*this.radius,a=o-this.position.x,u=t.position.y+this.heightOffset-this.position.y,c=s-this.position.z,l=a*this.cameraAcceleration*2,h=u*this.cameraAcceleration,f=c*this.cameraAcceleration*2;(l>this.maxCameraSpeed||l<-this.maxCameraSpeed)&&(l=1>l?-this.maxCameraSpeed:this.maxCameraSpeed),(h>this.maxCameraSpeed||h<-this.maxCameraSpeed)&&(h=1>h?-this.maxCameraSpeed:this.maxCameraSpeed),(f>this.maxCameraSpeed||f<-this.maxCameraSpeed)&&(f=1>f?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new e.Vector3(this.position.x+l,this.position.y+h,this.position.z+f),this.setTarget(t.position)}},r.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this.follow(this.target)},r}(e.TargetCamera);e.FollowCamera=t;var r=function(t){function r(r,n,i,o,s,a){t.call(this,r,e.Vector3.Zero(),a),this.alpha=n,this.beta=i,this.radius=o,this.target=s,this._cartesianCoordinates=e.Vector3.Zero(),this.follow()}return n(r,t),r.prototype.follow=function(){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta),this.position=this.target.position.add(this._cartesianCoordinates),this.setTarget(this.target.position)},r.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this.follow()},r}(e.TargetCamera);e.ArcFollowCamera=r}(r||(r={}));var r;!function(e){var t=function(t){function r(e,r,n){t.call(this,e,r,n),this._offsetX=null,this._offsetY=null,this._pointerCount=0,this._pointerPressed=[],this.angularSensibility=2e5,this.moveSensibility=500}return n(r,t),r.prototype.attachControl=function(t,r){var n,i=this;this._attachedCanvas||(this._attachedCanvas=t,void 0===this._onPointerDown&&(this._onPointerDown=function(e){r||e.preventDefault(),i._pointerPressed.push(e.pointerId),1===i._pointerPressed.length&&(n={x:e.clientX,y:e.clientY})},this._onPointerUp=function(e){r||e.preventDefault();var t=i._pointerPressed.indexOf(e.pointerId);-1!==t&&(i._pointerPressed.splice(t,1),0==t&&(n=null,i._offsetX=null,i._offsetY=null))},this._onPointerMove=function(e){if(r||e.preventDefault(),n){var t=i._pointerPressed.indexOf(e.pointerId);0==t&&(i._offsetX=e.clientX-n.x,i._offsetY=-(e.clientY-n.y))}},this._onLostFocus=function(){i._offsetX=null,i._offsetY=null}),t.addEventListener("pointerdown",this._onPointerDown),t.addEventListener("pointerup",this._onPointerUp),t.addEventListener("pointerout",this._onPointerUp),t.addEventListener("pointermove",this._onPointerMove),e.Tools.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]))},r.prototype.detachControl=function(t){this._attachedCanvas==t&&(t.removeEventListener("pointerdown",this._onPointerDown),t.removeEventListener("pointerup",this._onPointerUp),t.removeEventListener("pointerout",this._onPointerUp),t.removeEventListener("pointermove",this._onPointerMove),e.Tools.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),this._attachedCanvas=null)},r.prototype._checkInputs=function(){if(this._offsetX)if(this.cameraRotation.y+=this._offsetX/this.angularSensibility,this._pointerPressed.length>1)this.cameraRotation.x+=-this._offsetY/this.angularSensibility;else{var r=this._computeLocalCameraSpeed(),n=new e.Vector3(0,0,r*this._offsetY/this.moveSensibility);e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix),this.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(n,this._cameraRotationMatrix))}t.prototype._checkInputs.call(this)},r}(e.FreeCamera);e.TouchCamera=t}(r||(r={}));var r;!function(e){var t=e.Tools.GetPointerPrefix(),r=function(r){function i(t,n,i,o,s,a){var u=this;r.call(this,t,e.Vector3.Zero(),a),this.alpha=n,this.beta=i,this.radius=o,this.target=s,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.wheelPrecision=3,this.pinchPrecision=2,this.panningSensibility=50,this.inertialPanningX=0,this.inertialPanningY=0,this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.zoomOnFactor=1,this.targetScreenOffset=e.Vector2.Zero(),this.pinchInwards=!0,this.allowUpsideDown=!0,this._keys=[],this._viewMatrix=new e.Matrix,this._isRightClick=!1,this._isCtrlPushed=!1,this.checkCollisions=!1,this.collisionRadius=new e.Vector3(.5,.5,.5),this._collider=new e.Collider,this._previousPosition=e.Vector3.Zero(),this._collisionVelocity=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this._onCollisionPositionChange=function(t,r,n){void 0===n&&(n=null),u.getScene().workerCollisions&&u.checkCollisions&&r.multiplyInPlace(u._collider.radius),n?(u.setPosition(u.position),u.onCollide&&u.onCollide(n)):u._previousPosition.copyFrom(u.position);var i=Math.cos(u.alpha),o=Math.sin(u.alpha),s=Math.cos(u.beta),a=Math.sin(u.beta),c=u._getTargetPosition();c.addToRef(new e.Vector3(u.radius*i*a,u.radius*s,u.radius*o*a),u._newPosition),u.position.copyFrom(u._newPosition);var l=u.upVector;if(u.allowUpsideDown&&u.beta<0){var l=l.clone();l=l.negate()}e.Matrix.LookAtLHToRef(u.position,c,l,u._viewMatrix),u._viewMatrix.m[12]+=u.targetScreenOffset.x,u._viewMatrix.m[13]+=u.targetScreenOffset.y,u._collisionTriggered=!1},this.target||(this.target=e.Vector3.Zero()),this.getViewMatrix()}return n(i,r),Object.defineProperty(i.prototype,"angularSensibility",{get:function(){return e.Tools.Warn("Warning: angularSensibility is deprecated, use angularSensibilityX and angularSensibilityY instead."),Math.max(this.angularSensibilityX,this.angularSensibilityY)},set:function(t){e.Tools.Warn("Warning: angularSensibility is deprecated, use angularSensibilityX and angularSensibilityY instead."),this.angularSensibilityX=t,this.angularSensibilityY=t},enumerable:!0,configurable:!0}),i.prototype._getTargetPosition=function(){return this.target.position||this.target},i.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache.target=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=void 0},i.prototype._updateCache=function(e){e||r.prototype._updateCache.call(this),this._cache.target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset=this.targetScreenOffset.clone()},i.prototype._isSynchronizedViewMatrix=function(){return r.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},i.prototype.attachControl=function(r,n,i){var o=this;void 0===i&&(i=!0);var s,a=0,u=new e.SmartCollection;if(!this._attachedElement){this._attachedElement=r;var c=this.getEngine();void 0===this._onPointerDown&&(this._onPointerDown=function(e){o._isRightClick=2===e.button?!0:!1,u.add(e.pointerId,{x:e.clientX,y:e.clientY,type:e.pointerType}),s=u.item(e.pointerId),n||e.preventDefault()},this._onPointerUp=function(e){s=null,a=0,u.empty(),n||e.preventDefault()},this._onContextMenu=function(e){e.preventDefault()},this._onPointerMove=function(e){switch(n||e.preventDefault(),u.count){case 1:if(o._isCtrlPushed&&i||!i&&o._isRightClick)o.inertialPanningX+=-(e.clientX-s.x)/o.panningSensibility,o.inertialPanningY+=(e.clientY-s.y)/o.panningSensibility;else{var t=e.clientX-s.x,r=e.clientY-s.y;o.inertialAlphaOffset-=t/o.angularSensibilityX,o.inertialBetaOffset-=r/o.angularSensibilityY}s.x=e.clientX,s.y=e.clientY;break;case 2:u.item(e.pointerId).x=e.clientX,u.item(e.pointerId).y=e.clientY;var c=o.pinchInwards?1:-1,l=u.getItemByIndex(0).x-u.getItemByIndex(1).x,h=u.getItemByIndex(0).y-u.getItemByIndex(1).y,f=l*l+h*h;if(0===a)return void(a=f);f!==a&&(o.inertialRadiusOffset+=(f-a)/(o.pinchPrecision*o.wheelPrecision*((o.angularSensibilityX+o.angularSensibilityY)/2)*c),a=f);break;default:u.item(e.pointerId)&&(u.item(e.pointerId).x=e.clientX,u.item(e.pointerId).y=e.clientY)}},this._onMouseMove=function(e){if(c.isPointerLock){var t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;o.inertialAlphaOffset-=t/o.angularSensibilityX,o.inertialBetaOffset-=r/o.angularSensibilityY,n||e.preventDefault()}},this._wheel=function(e){var t=0;e.wheelDelta?t=e.wheelDelta/(40*o.wheelPrecision):e.detail&&(t=-e.detail/o.wheelPrecision),t&&(o.inertialRadiusOffset+=t),e.preventDefault&&(n||e.preventDefault())},this._onKeyDown=function(e){if(o._isCtrlPushed=e.ctrlKey,-1!==o.keysUp.indexOf(e.keyCode)||-1!==o.keysDown.indexOf(e.keyCode)||-1!==o.keysLeft.indexOf(e.keyCode)||-1!==o.keysRight.indexOf(e.keyCode)){var t=o._keys.indexOf(e.keyCode);-1===t&&o._keys.push(e.keyCode),e.preventDefault&&(n||e.preventDefault())}},this._onKeyUp=function(e){if(o._isCtrlPushed=e.ctrlKey,-1!==o.keysUp.indexOf(e.keyCode)||-1!==o.keysDown.indexOf(e.keyCode)||-1!==o.keysLeft.indexOf(e.keyCode)||-1!==o.keysRight.indexOf(e.keyCode)){var t=o._keys.indexOf(e.keyCode);t>=0&&o._keys.splice(t,1),e.preventDefault&&(n||e.preventDefault())}},this._onLostFocus=function(){o._keys=[],u.empty(),a=0,s=null},this._onGestureStart=function(e){void 0!==window.MSGesture&&(o._MSGestureHandler||(o._MSGestureHandler=new MSGesture,o._MSGestureHandler.target=r),o._MSGestureHandler.addPointer(e.pointerId))},this._onGesture=function(e){o.radius*=e.scale,e.preventDefault&&(n||(e.stopPropagation(),e.preventDefault()))},this._reset=function(){o._keys=[],o.inertialAlphaOffset=0,o.inertialBetaOffset=0,o.inertialRadiusOffset=0,u.empty(),a=0,s=null}),i||r.addEventListener("contextmenu",this._onContextMenu,!1),r.addEventListener(t+"down",this._onPointerDown,!1),r.addEventListener(t+"up",this._onPointerUp,!1),r.addEventListener(t+"out",this._onPointerUp,!1),r.addEventListener(t+"move",this._onPointerMove,!1),r.addEventListener("mousemove",this._onMouseMove,!1),r.addEventListener("MSPointerDown",this._onGestureStart,!1),r.addEventListener("MSGestureChange",this._onGesture,!1),r.addEventListener("mousewheel",this._wheel,!1),r.addEventListener("DOMMouseScroll",this._wheel,!1),e.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])}},i.prototype.detachControl=function(r){this._attachedElement===r&&(r.removeEventListener("contextmenu",this._onContextMenu),r.removeEventListener(t+"down",this._onPointerDown),r.removeEventListener(t+"up",this._onPointerUp),r.removeEventListener(t+"out",this._onPointerUp),r.removeEventListener(t+"move",this._onPointerMove),r.removeEventListener("mousemove",this._onMouseMove),r.removeEventListener("MSPointerDown",this._onGestureStart),r.removeEventListener("MSGestureChange",this._onGesture),r.removeEventListener("mousewheel",this._wheel),r.removeEventListener("DOMMouseScroll",this._wheel),e.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._MSGestureHandler=null,this._attachedElement=null,this._reset&&this._reset())},i.prototype._checkInputs=function(){if(!this._collisionTriggered){for(var t=0;t<this._keys.length;t++){var n=this._keys[t];-1!==this.keysLeft.indexOf(n)?this.inertialAlphaOffset-=.01:-1!==this.keysUp.indexOf(n)?this.inertialBetaOffset-=.01:-1!==this.keysRight.indexOf(n)?this.inertialAlphaOffset+=.01:-1!==this.keysDown.indexOf(n)&&(this.inertialBetaOffset+=.01)}(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!=this.inertialRadiusOffset)&&(this.alpha+=this.beta<=0?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.Engine.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.Engine.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<e.Engine.Epsilon&&(this.inertialRadiusOffset=0)),(0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero()),this.inertialPanningX*=this.inertia,this.inertialPanningY*=this.inertia,Math.abs(this.inertialPanningX)<e.Engine.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<e.Engine.Epsilon&&(this.inertialPanningY=0),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,0),this._viewMatrix.invertToRef(this._cameraTransformMatrix),e.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.target.addInPlace(this._transformedDirection)),this._checkLimits(),r.prototype._checkInputs.call(this)}},i.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},i.prototype.setPosition=function(e){var t=e.subtract(this._getTargetPosition());this.radius=t.length(),this.alpha=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2))),t.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(t.y/this.radius),this._checkLimits()},i.prototype.setTarget=function(e){this.target=e},i.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),r=Math.sin(this.alpha),n=Math.cos(this.beta),i=Math.sin(this.beta),o=this._getTargetPosition();if(o.addToRef(new e.Vector3(this.radius*t*i,this.radius*n,this.radius*r*i),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider.radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var s=this.upVector;if(this.allowUpsideDown&&this.beta<0){var s=s.clone();s=s.negate()}e.Matrix.LookAtLHToRef(this.position,o,s,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y}return this._viewMatrix},i.prototype.zoomOn=function(t,r){void 0===r&&(r=!1),t=t||this.getScene().meshes;var n=e.Mesh.MinMax(t),i=e.Vector3.Distance(n.min,n.max);this.radius=i*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:i},r)},i.prototype.focusOn=function(t,r){void 0===r&&(r=!1);var n,i;void 0===t.min?(n=t||this.getScene().meshes,n=e.Mesh.MinMax(n),i=e.Vector3.Distance(n.min,n.max)):(n=t,i=t.distance),this.target=e.Mesh.Center(n),r||(this.maxZ=2*i)},i.prototype.createRigCamera=function(t,r){switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:var n=this._cameraRigParams.stereoHalfAngle*(0===r?1:-1);return new i(t,this.alpha+n,this.beta,this.radius,this.target,this.getScene())}},i.prototype._updateRigCameras=function(){switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:var t=this._rigCameras[0],n=this._rigCameras[1];t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.beta=n.beta=this.beta,t.radius=n.radius=this.radius}r.prototype._updateRigCameras.call(this)},i}(e.TargetCamera);e.ArcRotateCamera=r}(r||(r={}));var r;!function(e){var t=function(t){function r(e,r,n){var i=this;t.call(this,e,r,n),this._offsetX=null,this._offsetY=null,this._orientationGamma=0,this._orientationBeta=0,this._initialOrientationGamma=0,this._initialOrientationBeta=0,this.angularSensibility=1e4,this.moveSensibility=50,window.addEventListener("resize",function(){i._initialOrientationGamma=null},!1)}return n(r,t),r.prototype.attachControl=function(e,t){var r=this;this._attachedCanvas||(this._attachedCanvas=e,this._orientationChanged||(this._orientationChanged=function(e){r._initialOrientationGamma||(r._initialOrientationGamma=e.gamma,r._initialOrientationBeta=e.beta),r._orientationGamma=e.gamma,r._orientationBeta=e.beta,r._offsetY=r._initialOrientationBeta-r._orientationBeta,r._offsetX=r._initialOrientationGamma-r._orientationGamma}),window.addEventListener("deviceorientation",this._orientationChanged))},r.prototype.detachControl=function(e){this._attachedCanvas==e&&(window.removeEventListener("deviceorientation",this._orientationChanged),this._attachedCanvas=null,this._orientationGamma=0,this._orientationBeta=0,this._initialOrientationGamma=0,this._initialOrientationBeta=0)},r.prototype._checkInputs=function(){if(this._offsetX){this.cameraRotation.y-=this._offsetX/this.angularSensibility;var r=this._computeLocalCameraSpeed(),n=new e.Vector3(0,0,r*this._offsetY/this.moveSensibility);e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,0,this._cameraRotationMatrix),this.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(n,this._cameraRotationMatrix)),t.prototype._checkInputs.call(this)}},r}(e.FreeCamera);e.DeviceOrientationCamera=t}(r||(r={}));var r;!function(e){var t=function(){function e(e){var t=this;this.babylonGamepads=[],this.oneGamepadConnected=!1,this.isMonitoring=!1,this.gamepadEventSupported="GamepadEvent"in window,this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads,this.buttonADataURL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAA9aSURBVHja7FtpbBzneX7m3otcihSpm9Z9UJalxPKhVLZlp6ktNzEaxE0CtAnQAgnSoPWPBi3syuiPwordFi5Qt2haFygCoylSV4Vby6os1I3kOLYrS65kXXQoypJJSaFEUTyXy925+rzfzC6HFFlL1kpAIe7i5czO7H7zPs97ft8MtTAMcSu/dNzirxkCZgiYIWCGgBkCZgi4hV/mDR5fSxAt+0ZiX0ucDxMSTJLK+f83BFSA6TFgK75OclshouKBFbA+xaV4k7Z+fD6sNRlmjYFXQMu4NiUVS/oHe5/ecnHo3MYxd7QthN9UcsdW6FqEPwgDOFbqpAajL2VlTrTULzj4Ow8+s4+nipSxWMoxIUkyrl/pGswFtIR7WzHgDCX77K7vfHNkbOA+AryjYZadb27OIJdzCNZBKmXw4kbk35qPsTEfJbeEkZESentHMdBfGtY142gu1bDvqV/925f4tQJlNCaj4hXX7RHXS0AFuJEAXvfHr/zmk67vPjir0V68aFEe8xtuQ6O1FHlrEXLmHBiaDUtzYBlpNYjrF+GFZfhhCcPeBQy53ehzT+H8QBe6uwfRf7l8xjKsvX/y5X98jl8fThDhJ4i46QQkrS5I6v7oX7/++77vPtLUlFnZtnIRlubvxRxnHbJmE79sxD/SqG0oZk8MFarRqufUkQAFrxcXSkfx0eB+nOggKX2jHYZhvf79r/z4L2IiipO84aYRkASfefnAX695p3P3c9mM/UufuaMVdzRvxVx7A0xaWdOMqVULJ6Z3TZv6KmHo0ztK6CkfxpHe3Th0pAuF0fLbn1u+9cmv3vW77bE3fGoSPi0BVfAvvPEHm9rPv//iooWz5m9Z/wCWZx+Go9UrN48QTD9IGMZ1cJIzTPisRQclPMrhME4W9mDfB2+i+2z/+TXz7/z2E7/85+9OIuGGE6BV3H77zm/d33nx6Ktr18zFg2t+DQude2n1tLJ8tcJ90vDhpG5Am7qTkJAQErywiLOld7G3/d9xvL0Hy1vWPbbtS3//00Q4hDeaAFXintrx1fu7+jp2r13bgofX/gaazbVkJQdLT9P6VqRFDSu2hIgXlBUBLgtCr3cce47/CMePX0Rr08qtzz7+8k8TpfKGtcKq1jPZre7oObyjdWkGd628l7AXwvMCeL7HjO6qrS8S1E5kTE9tfbiur665ccU9EB1EF9Ep0WXesEZIJb9j5/b/XUtzNrt29Rw0og2lchmBVqLo8LSAHlCixbTpddGm8Y7pjkttCCUP+JQy3FiatNuxdvUx9F4ayopO/OL9sQeEN4oA/eHn577oWPbGVes11PsrUBxjDafze1Te1VzouqnK2TgmLQljQqmrnAsT+iaPVb5b2co7EC+QhBgUeM1R1AcrsGp9Jy6+4W8U3fZ8r+e3EnOI2uaAX3l+zgNB4O9rW5/B8tY5WGo9BtOrJ4uMfUl+uj0B8HTmPXj8Pex86xVEnTDBBSE2r78fX9i09RPyZfT2A5ceIMSPwDOH8JH7Kk5+fAHtR0Zh6MZ9e7534Wc3wgO0sXLhD9OpFOa0egjGMhguD8BgTJooMfPbV1h/umz25ondcFP90IzY2iTgrfY9uH31aqSc9CeSEHkBEyITv28M8XMGc2/z0HGCpWCs8BS/9sWrDYOrJuCBZ+vu5sUfXbicia5kYGzUw4DWTwJKbApSjHuTBBjT2H68zg0MD4KlEwabZi0Y7wd85u/3O9/B6sVrPlEXeiF9nMmRxPt6Qf4y/HyIbh3HwkdF1zefGt5fUwK8wP2WAGwh02MFE/5ogYr3Qg/STL0W3d8aB1ppa+Pw0uI2Tz6/134Mg+UoIGZlZ2HMLaJYHkPICr6//RBamvPj/UA4dYKsegGrXqAXMaqNsDT6SreOY5Gu/FptCeBFN+caAphGiKFiGaOjA3AJHoGt6r7GgNbjqjo5yQkBUVHQ8PaJExjiaZ2yue12nO27gCNdHSptvf/xGdw11I2UZSmvCIJgQiJMhoEfeqpNDvUSRvUB5hMX9fUecg0aBi+Hm2uaAz633bmbm1VN8+h07LfKJdkOkQB2fL4BTlsj8No4YLG2putMSjwjp3QNvZdH8YsiExV501isFjU30lpF7D8dVfCA8sFHp7BuWYtaIwiCsCrCSDVhh9IX8k0CoHsoMQ84FrfFAE3zQAK0VaLzO9tK79XKAxSj+aYALt3XLfNipZD1v492YexrE/sP0zBgUIQIoYaflAXbz16CzyY6YKqYl8uheTarRioD7xAxCQHUpv18L1Yud+Iloujtk4zQo9WZcKURqjbHclzKvj0Gvcw8UA6oY2WqonSuGQGb5I+TJgEFEsB4daXzc0eopabcX13W0BXwgAnRZL4Q62s8ppnR/pFz/QjF+tRvxeIsY/cizGwRt83P4czACL8HdA1JUivCNGVogvdkNkgaGDNe4CvXFyJ8n+B5XGLJ1FmJXJ53AzjZKgGbatkKL5c/liNWIPO8uM/4VO2uKCQZjLmBqQAGJ4EmI8NMabDTOuyUobYXmPlCEpiqA1IkYdWSBpjpEDl6wsrF9aAjqHNOPXDyXAGprAknY5B0btOGGk/GlfE1taqofCNuuYNIJ+omOiZ1rpUHtEYWjkpWoP5EWV2sb5isA7aIQTHHxaIniNADui8PIs0Eb6SY/Z0UQc+j+mXYuoM7Vy/Age7zkBUyCZGLhRLSOYcWpfXFA1wPhqup8JNKq5UkKeoqSHxPLSoqnUQtw5ioc60IyE/VkOji8mYE2nZELNgCXLaOkGDFJBg4OzCMDEcxCfAzS1pQX5fHSNDLClLGwmwzls6vQ09hGFJYegdZ1hha2bqIBNelB5Qjog02TzpFNVEquYpMuTSYr/lcQPKPJHoRQ8W1GYO3lDgpO9pPWTEZEQGnuodg5Hyk66Lyd8fKOQQ6gqyWict7GeuWz8HQyWEFw+bB7ksF3Nk2V1nfpZTLQqSLslzXlDmHpsQ1osVoy/Solwf/GpdErpaAQUqjWxL2GWcWaSfAMIis7RBwiuCdtD1OgmNHBJCg7r4uZBnbdjaaq+3YewB+USYicY8juYPnMtloqdCjG3f39eO+3JKIAFadSiiZigBdgdcqItMxsmZbIbvUIKlzzQjoEgLGRjU2KTp8AjRCkzEnAG0mtQh8Ku0oAqok8JzP+Lw0MkB3jpKjKpapaL5WKZxafDdBqoC6O8LtyMAQhoZdzG7MwLU8FUYKPINcl+qimismRj26v2I71I3jDxfdpM41I6CTsmG4X0djKyc8RYu9t0Vl2QJbBJ5xFPiICJIg1hdhR3fs5HnWeldleZXABLA98b7Y5HtjkgwNEtbTN4iFC5oI3I1CTsAbsfVjAizJB3Qbx9HphRp6eqr3TDprSYA0FI/3ntOxbpUNM2OjpEcE6HYEWkhIKw+ICeBxi+T09F1WZU+iJq2n8fRDf4Ymu3XSrcOIgg8H9uOFn31fNUVC0oddZ7B5YxtDwlTgo66SEici2fokwCJjju0hw7J54WypQsB7tSRAza+H+nld30Y+m2b7SS+Qn9PKFl1egRciHIfWpxC8x+7tdA97+3zUcNyWX4Ci/THOoD2x/hmlQTox+3gDjWYeg/4gmF853xjBpUsjaGnJR24fu36FNzX5pmfY7EPStlSLIgb6gwk616QRYk8tS88/l/2PT/loyqbQkEmhPpNGNp1CmvtieQHvONGtL4sdy9Hjp5kkpTWmSzM7L529hErHs0cCpt2qW00BymDV3JXSU8HkAXKIjtNnedxS48m4Mr5cR9YlMrx+XTqNRmbP2ZkMOjvHKir/PNa5pouiitFjH44iZ6YwO5tFAy+eo6SdpOUJyhBQTJR+HT9HYLJaFve0PqQmTQLaVOCdmIRIWE+wrmWTzG8iAugF7qgWjSWkGbYa32EjJQTkGFv5dBZNJKCeHdb77UPXZP1rWhKLZ4Rqjv2Fz86lLMNlpusCY9BnqTNUIyTgrVhhs7rVq2KoW2TSxWlXLOCqWX4svmpzZdEjWvgQcdVWPnu+i4ClUS+HyLIFnsVf/9eBduw8eKYy2D1XMxO8Jg+IB9wl+3s/uAC3qKMpXY88m/ecnUHaSis3Na8Ab1UtaCh3j1y+sm8m9o0J+9Fv9MR4Zhw6DufTWasOebsOs+xZKHJOtvtQtertulrwV+0BtH5yWvyW7CxubsCTX9+KUQZ4ga7qmdGUFmrya8QWHwcxlReMF8Mw4QETrR8oy7tq2ivH5Tvya8n8aXZMGc4An/nRDpy52FfR8b5KCJCImt8YkYF/KDtnegfwz3sPodGajQajCTk9z/4mQ6iphMWv9AA9IeMWdyYdn+gBkVc5amwHWV6lHvVaI2YZzfinN95Ngv/htcT/p31CRNbdV8l8e++xD5HPNeHxhx5Bgf18kTN5T1kvjBfEjGjBJCai4gnjHqAnlvqS8e9NeujEjEul/NokDbai4V/2voafHD1S0evdWLeb8ojMNyly5fS//ffbcD0L33j4K4RX4rtMh/UUGLXmr6BWXN9MEFAhYfzmZ6hcXI+TpISRH8061Ui68gTWGUJP4aU9P8ZrB39S+Xkx1ummPSMkbebnJcxU1jm4D5eGhvB7j32HJcpUJHhxLIfxTZpxwGa8eKrHC51a9Tmp+N5P1RsQ01cJAwEflHw8/+pfYn/HgaQ+n7/a1vd6k+BUS2XvVD401TXhu488gQ0r71QUuLJsrWT8mSYtfkBMm0BAmFhNrgDX4oRqqeaJMw4c6TyIv/qPP0Xf8KUJ6sXuP1XluuEEyGsD5TXKgsqBNQvW4RtbnkDb4ttJQlGt/IQqLMJE7tWqOSBZCSrL6dFSqq3AnzhzDC/tewHt5w4nr3suvgN0+P8o3TeegFe3vYDHtj+xhLt/Q3kkeW5d693YuuHXsWHZPcixW4tCwo+trVU9QEs8G6HFqW5kdBiHTu3H64dfxpGuK8r665Tv7tz2D6e/tP23cT0E1OA5QR2iiIbs1i9u/9qTPPC12CtwlIofjZVvW/BZ3LVsC5bPW4u5DQuxaPay2NpRIuy61IkLA+dw8hdHceDUPpw49z9TXUysvWPXtl3bQ4yQtMJ1a18DAsbvRO/atvM5DXXPPbp9yzP8+GXBXTkngKYBdTWvE5RXdm87+HQEfLh2T57UIAdM95Js9+04LKSDbLzG31+Omxpx9xfxKR6AukkhMP0aKuUHsag5VEzE3fGSddsUVu6KFzIE+H/iJry0mX+bu8VfMwTMEDBDwAwBMwTMEHALv/5XgAEASpR5N6rB30UAAAAASUVORK5CYII=",
this._callbackGamepadConnected=e,this.gamepadSupportAvailable?(this.gamepadEventSupported?(window.addEventListener("gamepadconnected",function(e){t._onGamepadConnected(e)},!1),window.addEventListener("gamepaddisconnected",function(e){t._onGamepadDisconnected(e)},!1)):this._startMonitoringGamepads(),this.oneGamepadConnected||this._insertGamepadDOMInstructions()):this._insertGamepadDOMNotSupported()}return e.prototype._insertGamepadDOMInstructions=function(){e.gamepadDOMInfo=document.createElement("div");var t=document.createElement("img");t.src=this.buttonADataURL;var r=document.createElement("span");r.innerHTML="<strong>to activate gamepad</strong>",e.gamepadDOMInfo.appendChild(t),e.gamepadDOMInfo.appendChild(r),e.gamepadDOMInfo.style.position="absolute",e.gamepadDOMInfo.style.width="100%",e.gamepadDOMInfo.style.height="48px",e.gamepadDOMInfo.style.bottom="0px",e.gamepadDOMInfo.style.backgroundColor="rgba(1, 1, 1, 0.15)",e.gamepadDOMInfo.style.textAlign="center",e.gamepadDOMInfo.style.zIndex="10",t.style.position="relative",t.style.bottom="8px",r.style.position="relative",r.style.fontSize="32px",r.style.bottom="32px",r.style.color="green",document.body.appendChild(e.gamepadDOMInfo)},e.prototype._insertGamepadDOMNotSupported=function(){e.gamepadDOMInfo=document.createElement("div");var t=document.createElement("span");t.innerHTML="<strong>gamepad not supported</strong>",e.gamepadDOMInfo.appendChild(t),e.gamepadDOMInfo.style.position="absolute",e.gamepadDOMInfo.style.width="100%",e.gamepadDOMInfo.style.height="40px",e.gamepadDOMInfo.style.bottom="0px",e.gamepadDOMInfo.style.backgroundColor="rgba(1, 1, 1, 0.15)",e.gamepadDOMInfo.style.textAlign="center",e.gamepadDOMInfo.style.zIndex="10",t.style.position="relative",t.style.fontSize="32px",t.style.color="red",document.body.appendChild(e.gamepadDOMInfo)},e.prototype.dispose=function(){e.gamepadDOMInfo&&document.body.removeChild(e.gamepadDOMInfo)},e.prototype._onGamepadConnected=function(e){var t=this._addNewGamepad(e.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(t),this._startMonitoringGamepads()},e.prototype._addNewGamepad=function(t){this.oneGamepadConnected||(this.oneGamepadConnected=!0,e.gamepadDOMInfo&&(document.body.removeChild(e.gamepadDOMInfo),e.gamepadDOMInfo=null));var r;return r=-1!==t.id.search("Xbox 360")||-1!==t.id.search("xinput")?new u(t.id,t.index,t):new o(t.id,t.index,t),this.babylonGamepads.push(r),r},e.prototype._onGamepadDisconnected=function(e){for(var t in this.babylonGamepads)if(this.babylonGamepads[t].index==e.gamepad.index){this.babylonGamepads.splice(t,1);break}0==this.babylonGamepads.length&&this._stopMonitoringGamepads()},e.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this.isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var e=this;this._updateGamepadObjects();for(var t in this.babylonGamepads)this.babylonGamepads[t].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){e._checkGamepadsStatus()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){e._checkGamepadsStatus()}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){e._checkGamepadsStatus()}))},e.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++)if(e[t])if(e[t].index in this.babylonGamepads)this.babylonGamepads[t].browserGamepad=e[t];else{var r=this._addNewGamepad(e[t]);this._callbackGamepadConnected&&this._callbackGamepadConnected(r)}},e}();e.Gamepads=t;var r=function(){function e(e,t){this.x=e,this.y=t}return e}();e.StickValues=r;var i=function(){function e(e,t,r){this.id=e,this.index=t,this.browserGamepad=r,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})}return e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})},e}();e.Gamepad=i;var o=function(e){function t(t,r,n){e.call(this,t,r,n),this.id=t,this.index=r,this.gamepad=n,this._buttons=new Array(n.buttons.length)}return n(t,e),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,t,r){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(r),this._onbuttonup&&0===e&&this._onbuttonup(r)),e},t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.gamepad.buttons[t].value,this._buttons[t],t)},t}(i);e.GenericPad=o,function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.Start=4]="Start",e[e.Back=5]="Back",e[e.LB=6]="LB",e[e.RB=7]="RB",e[e.LeftStick=8]="LeftStick",e[e.RightStick=9]="RightStick"}(e.Xbox360Button||(e.Xbox360Button={}));var s=e.Xbox360Button;!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(e.Xbox360Dpad||(e.Xbox360Dpad={}));var a=e.Xbox360Dpad,u=function(e){function t(){e.apply(this,arguments),this._leftTrigger=0,this._rightTrigger=0,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0}return n(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,r){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(r),this._onbuttonup&&0===e&&this._onbuttonup(r)),e},t.prototype._setDPadValue=function(e,t,r){return e!==t&&(this._ondpaddown&&1===e&&this._ondpaddown(r),this._ondpadup&&0===e&&this._ondpadup(r)),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,s.A)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,s.B)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,s.X)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,s.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,s.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,s.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,s.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,s.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,s.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,s.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,a.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,a.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,a.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,a.Right)},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t}(i);e.Xbox360Pad=u}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i){var o=this;t.call(this,r,n,i),this.angularSensibility=200,this.moveSensibility=75,this._gamepads=new e.Gamepads(function(e){o._onNewGameConnected(e)})}return n(r,t),r.prototype._onNewGameConnected=function(e){0===e.index&&(this._gamepad=e)},r.prototype._checkInputs=function(){if(this._gamepad){var r=this._gamepad.leftStick,n=r.x/this.moveSensibility,i=r.y/this.moveSensibility;r.x=Math.abs(n)>.005?0+n:0,r.y=Math.abs(i)>.005?0+i:0;var o=this._gamepad.rightStick,s=o.x/this.angularSensibility,a=o.y/this.angularSensibility;o.x=Math.abs(s)>.001?0+s:0,o.y=Math.abs(a)>.001?0+a:0;var u=e.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,0),c=50*this._computeLocalCameraSpeed(),l=e.Vector3.TransformCoordinates(new e.Vector3(r.x*c,0,-r.y*c),u);this.cameraDirection=this.cameraDirection.add(l),this.cameraRotation=this.cameraRotation.add(new e.Vector2(o.y,o.x))}t.prototype._checkInputs.call(this)},r.prototype.dispose=function(){this._gamepads.dispose(),t.prototype.dispose.call(this)},r}(e.FreeCamera);e.GamepadCamera=t}(r||(r={}));var r;!function(e){var t=function(){function t(e){this._renderingGroups=new Array,this._scene=e}return t.prototype._renderParticles=function(t,r){if(0!==this._scene._activeParticleSystems.length){for(var n=this._scene.activeCamera,i=e.Tools.Now,o=0;o<this._scene._activeParticleSystems.length;o++){var s=this._scene._activeParticleSystems.data[o];s.renderingGroupId===t&&0!==(n.layerMask&s.layerMask)&&(this._clearDepthBuffer(),s.emitter.position&&r&&-1===r.indexOf(s.emitter)||(this._scene._activeParticles+=s.render()))}this._scene._particlesDuration+=e.Tools.Now-i}},t.prototype._renderSprites=function(t){if(this._scene.spritesEnabled&&0!==this._scene.spriteManagers.length){for(var r=this._scene.activeCamera,n=e.Tools.Now,i=0;i<this._scene.spriteManagers.length;i++){var o=this._scene.spriteManagers[i];o.renderingGroupId===t&&0!==(r.layerMask&o.layerMask)&&(this._clearDepthBuffer(),o.render())}this._scene._spritesDuration+=e.Tools.Now-n}},t.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,!1,!0),this._depthBufferAlreadyCleaned=!0)},t.prototype.render=function(e,r,n,i){for(var o=0;o<t.MAX_RENDERINGGROUPS;o++){this._depthBufferAlreadyCleaned=!1;var s=this._renderingGroups[o],a=!1;s&&(this._clearDepthBuffer(),s.render(e)||(this._renderingGroups.splice(o,1),a=!0)),i&&this._renderSprites(o),n&&this._renderParticles(o,r),a&&o--}},t.prototype.reset=function(){this._renderingGroups.forEach(function(e,t,r){e&&e.prepare()})},t.prototype.dispatch=function(t){var r=t.getMesh(),n=r.renderingGroupId||0;this._renderingGroups[n]||(this._renderingGroups[n]=new e.RenderingGroup(n,this._scene)),this._renderingGroups[n].dispatch(t)},t.MAX_RENDERINGGROUPS=4,t}();e.RenderingManager=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r){this.index=t,this._opaqueSubMeshes=new e.SmartArray(256),this._transparentSubMeshes=new e.SmartArray(256),this._alphaTestSubMeshes=new e.SmartArray(256),this._scene=r}return t.prototype.render=function(t){if(t)return t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return!1;var r,n,i=this._scene.getEngine();for(r=0;r<this._opaqueSubMeshes.length;r++)n=this._opaqueSubMeshes.data[r],n.render(!1);for(i.setAlphaTesting(!0),r=0;r<this._alphaTestSubMeshes.length;r++)n=this._alphaTestSubMeshes.data[r],n.render(!1);if(i.setAlphaTesting(!1),this._transparentSubMeshes.length){for(r=0;r<this._transparentSubMeshes.length;r++)n=this._transparentSubMeshes.data[r],n._alphaIndex=n.getMesh().alphaIndex,n._distanceToCamera=n.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.globalPosition).length();var o=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length);for(o.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),r=0;r<o.length;r++)n=o[r],n.render(!0);i.setAlphaMode(e.Engine.ALPHA_DISABLE)}return!0},t.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset()},t.prototype.dispatch=function(e){var t=e.getMaterial(),r=e.getMesh();t.needAlphaBlending()||r.visibility<1||r.hasVertexAlpha?this._transparentSubMeshes.push(e):t.needAlphaTesting()?this._alphaTestSubMeshes.push(e):this._opaqueSubMeshes.push(e)},t}();e.RenderingGroup=t}(r||(r={}));var r;!function(e){var t=function(){function t(r){this.autoClear=!0,this.clearColor=new e.Color3(.2,.2,.3),this.ambientColor=new e.Color3(0,0,0),this.forceWireframe=!1,this.forcePointsCloud=!1,this.forceShowBoundingBoxes=!1,this.animationsEnabled=!0,this.cameraToUseForPointers=null,this.fogEnabled=!0,this.fogMode=t.FOGMODE_NONE,this.fogColor=new e.Color3(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.shadowsEnabled=!0,this.lightsEnabled=!0,this.lights=new Array,this.cameras=new Array,this.activeCameras=new Array,this.meshes=new Array,this._geometries=new Array,this.materials=new Array,this.multiMaterials=new Array,this.defaultMaterial=new e.StandardMaterial("default material",this),this.texturesEnabled=!0,this.textures=new Array,this.particlesEnabled=!0,this.particleSystems=new Array,this.spritesEnabled=!0,this.spriteManagers=new Array,this.layers=new Array,this.skeletonsEnabled=!0,this.skeletons=new Array,this.lensFlaresEnabled=!0,this.lensFlareSystems=new Array,this.collisionsEnabled=!0,this.gravity=new e.Vector3(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=new Array,this.importedMeshesFiles=new Array,this._actionManagers=new Array,this._meshesForIntersections=new e.SmartArray(256),this.proceduralTexturesEnabled=!0,this._proceduralTextures=new Array,this.soundTracks=new Array,this._audioEnabled=!0,this._headphone=!1,this._totalVertices=0,this._activeIndices=0,this._activeParticles=0,this._lastFrameDuration=0,this._evaluateActiveMeshesDuration=0,this._renderTargetsDuration=0,this._particlesDuration=0,this._renderDuration=0,this._spritesDuration=0,this._animationRatio=0,this._renderId=0,this._executeWhenReadyTimeoutId=-1,this._toBeDisposed=new e.SmartArray(256),this._onReadyCallbacks=new Array,this._pendingData=[],this._onBeforeRenderCallbacks=new Array,this._onAfterRenderCallbacks=new Array,this._activeMeshes=new e.SmartArray(256),this._processedMaterials=new e.SmartArray(256),this._renderTargets=new e.SmartArray(256),this._activeParticleSystems=new e.SmartArray(256),this._activeSkeletons=new e.SmartArray(32),this._softwareSkinnedMeshes=new e.SmartArray(32),this._activeBones=0,this._activeAnimatables=new Array,this._transformMatrix=e.Matrix.Zero(),this._edgesRenderers=new e.SmartArray(16),this._uniqueIdCounter=0,this._engine=r,r.scenes.push(this),this._renderingManager=new e.RenderingManager(this),this.postProcessManager=new e.PostProcessManager(this),this.postProcessRenderPipelineManager=new e.PostProcessRenderPipelineManager,this._boundingBoxRenderer=new e.BoundingBoxRenderer(this),this._outlineRenderer=new e.OutlineRenderer(this),this.attachControl(),this._debugLayer=new e.DebugLayer(this),this.mainSoundTrack=new e.SoundTrack(this,{mainTrack:!0}),this.simplificationQueue=new e.SimplificationQueue,this.workerCollisions=!1}return Object.defineProperty(t,"FOGMODE_NONE",{get:function(){return t._FOGMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FOGMODE_EXP",{get:function(){return t._FOGMODE_EXP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FOGMODE_EXP2",{get:function(){return t._FOGMODE_EXP2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FOGMODE_LINEAR",{get:function(){return t._FOGMODE_LINEAR},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"debugLayer",{get:function(){return this._debugLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"workerCollisions",{get:function(){return this._workerCollisions},set:function(t){t=t&&!!Worker,this._workerCollisions=t,this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=t?new e.CollisionCoordinatorWorker:new e.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"SelectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer},t.prototype.getOutlineRenderer=function(){return this._outlineRenderer},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices},t.prototype.getActiveIndices=function(){return this._activeIndices},t.prototype.getActiveParticles=function(){return this._activeParticles},t.prototype.getActiveBones=function(){return this._activeBones},t.prototype.getLastFrameDuration=function(){return this._lastFrameDuration},t.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration},t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getRenderTargetsDuration=function(){return this._renderTargetsDuration},t.prototype.getRenderDuration=function(){return this._renderDuration},t.prototype.getParticlesDuration=function(){return this._particlesDuration},t.prototype.getSpritesDuration=function(){return this._spritesDuration},t.prototype.getAnimationRatio=function(){return this._animationRatio},t.prototype.getRenderId=function(){return this._renderId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._updatePointerPosition=function(e){var t=this._engine.getRenderingCanvasClientRect();this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this.cameraToUseForPointers&&(this._pointerX=this._pointerX-this.cameraToUseForPointers.viewport.x*this._engine.getRenderWidth(),this._pointerY=this._pointerY-this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},t.prototype.attachControl=function(){var t=this;this._onPointerMove=function(e){var r=t._engine.getRenderingCanvas();t._updatePointerPosition(e);var n=t.pick(t._pointerX,t._pointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()},!1,t.cameraToUseForPointers);n.hit?(t._meshUnderPointer=n.pickedMesh,t.setPointerOverMesh(n.pickedMesh),r.style.cursor=t._meshUnderPointer.actionManager&&t._meshUnderPointer.actionManager.hasPointerTriggers?"pointer":""):(t.setPointerOverMesh(null),r.style.cursor="",t._meshUnderPointer=null)},this._onPointerDown=function(r){var n=null;t.onPointerDown||(n=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasPickTriggers}),t._updatePointerPosition(r);var i=t.pick(t._pointerX,t._pointerY,n,!1,t.cameraToUseForPointers);if(i.hit&&i.pickedMesh.actionManager){switch(r.button){case 0:i.pickedMesh.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNew(i.pickedMesh,r));break;case 1:i.pickedMesh.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNew(i.pickedMesh,r));break;case 2:i.pickedMesh.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNew(i.pickedMesh,r))}i.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNew(i.pickedMesh,r))}t.onPointerDown&&t.onPointerDown(r,i)},this._onPointerUp=function(r){var n=null;t.onPointerUp||(n=function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.actionManager&&t.actionManager.hasSpecificTrigger(e.ActionManager.OnPickUpTrigger)}),t._updatePointerPosition(r);var i=t.pick(t._pointerX,t._pointerY,n,!1,t.cameraToUseForPointers);i.hit&&i.pickedMesh.actionManager&&i.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,e.ActionEvent.CreateNew(i.pickedMesh,r)),t.onPointerUp&&t.onPointerUp(r,i)},this._onKeyDown=function(r){t.actionManager&&t.actionManager.processTrigger(e.ActionManager.OnKeyDownTrigger,e.ActionEvent.CreateNewFromScene(t,r))},this._onKeyUp=function(r){t.actionManager&&t.actionManager.processTrigger(e.ActionManager.OnKeyUpTrigger,e.ActionEvent.CreateNewFromScene(t,r))};var r=e.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().addEventListener(r+"move",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener(r+"down",this._onPointerDown,!1),this._engine.getRenderingCanvas().addEventListener(r+"up",this._onPointerUp,!1),this._engine.getRenderingCanvas().addEventListener("mousewheel",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("DOMMouseScroll",this._onPointerMove,!1),e.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}])},t.prototype.detachControl=function(){var t=e.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(t+"move",this._onPointerMove),this._engine.getRenderingCanvas().removeEventListener(t+"down",this._onPointerDown),this._engine.getRenderingCanvas().removeEventListener(t+"up",this._onPointerUp),this._engine.getRenderingCanvas().removeEventListener("mousewheel",this._onPointerMove),this._engine.getRenderingCanvas().removeEventListener("DOMMouseScroll",this._onPointerMove),e.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}])},t.prototype.isReady=function(){if(this._pendingData.length>0)return!1;var t;for(t=0;t<this._geometries.length;t++){var r=this._geometries[t];if(r.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING)return!1}for(t=0;t<this.meshes.length;t++){var n=this.meshes[t];if(!n.isReady())return!1;var i=n.material;if(i&&!i.isReady(n))return!1}return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null},t.prototype.registerBeforeRender=function(e){this._onBeforeRenderCallbacks.push(e)},t.prototype.unregisterBeforeRender=function(e){var t=this._onBeforeRenderCallbacks.indexOf(e);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},t.prototype.registerAfterRender=function(e){this._onAfterRenderCallbacks.push(e)},t.prototype.unregisterAfterRender=function(e){var t=this._onAfterRenderCallbacks.indexOf(e);t>-1&&this._onAfterRenderCallbacks.splice(t,1)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var t=this._pendingData.indexOf(e);-1!==t&&this._pendingData.splice(t,1)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},t.prototype.executeWhenReady=function(e){var t=this;this._onReadyCallbacks.push(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},t.prototype._checkIsReady=function(){var e=this;return this.isReady()?(this._onReadyCallbacks.forEach(function(e){e()}),this._onReadyCallbacks=[],void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150))},t.prototype.beginAnimation=function(t,r,n,i,o,s,a){if(void 0===o&&(o=1),this.stopAnimation(t),a||(a=new e.Animatable(this,t,r,n,i,o,s)),t.animations&&a.appendAnimations(t,t.animations),t.getAnimatables)for(var u=t.getAnimatables(),c=0;c<u.length;c++)this.beginAnimation(u[c],r,n,i,o,s,a);return a},t.prototype.beginDirectAnimation=function(t,r,n,i,o,s,a){void 0===s&&(s=1);var u=new e.Animatable(this,t,n,i,o,s,a,r);return u},t.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},t.prototype.stopAnimation=function(e){var t=this.getAnimatableByTarget(e);t&&t.stop()},t.prototype._animate=function(){if(this.animationsEnabled){this._animationStartDate||(this._animationStartDate=e.Tools.Now);for(var t=e.Tools.Now,r=t-this._animationStartDate,n=0;n<this._activeAnimatables.length;n++)this._activeAnimatables[n]._animate(r)}},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,t){this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)},t.prototype.addMesh=function(e){e.uniqueId=this._uniqueIdCounter++;var t=this.meshes.push(e);this.collisionCoordinator.onMeshAdded(e),this.onNewMeshAdded&&this.onNewMeshAdded(e,t,this)},t.prototype.removeMesh=function(e){var t=this.meshes.indexOf(e);return-1!==t&&this.meshes.splice(t,1),this.collisionCoordinator.onMeshRemoved(e),this.onMeshRemoved&&this.onMeshRemoved(e),t},t.prototype.removeLight=function(e){var t=this.lights.indexOf(e);return-1!==t&&this.lights.splice(t,1),this.onLightRemoved&&this.onLightRemoved(e),t},t.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&this.cameras.splice(t,1);var r=this.activeCameras.indexOf(e);return-1!==r&&this.activeCameras.splice(r,1),this.activeCamera===e&&(this.activeCamera=this.cameras.length>0?this.cameras[0]:null),this.onCameraRemoved&&this.onCameraRemoved(e),t},t.prototype.addLight=function(e){e.uniqueId=this._uniqueIdCounter++;var t=this.lights.push(e);this.onNewLightAdded&&this.onNewLightAdded(e,t,this)},t.prototype.addCamera=function(e){e.uniqueId=this._uniqueIdCounter++;var t=this.cameras.push(e);this.onNewCameraAdded&&this.onNewCameraAdded(e,t,this)},t.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},t.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},t.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},t.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},t.prototype.getLensFlareSystemByName=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===e)return this.lensFlareSystems[t];return null},t.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},t.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},t.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},t.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},t.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},t.prototype.getGeometryByID=function(e){for(var t=0;t<this._geometries.length;t++)if(this._geometries[t].id===e)return this._geometries[t];return null},t.prototype.pushGeometry=function(e,t){return!t&&this.getGeometryByID(e.id)?!1:(this._geometries.push(e),this.collisionCoordinator.onGeometryAdded(e),this.onGeometryAdded&&this.onGeometryAdded(e),!0)},t.prototype.removeGeometry=function(e){var t=this._geometries.indexOf(e);return t>-1?(this._geometries.splice(t,1),this.collisionCoordinator.onGeometryDeleted(e),this.onGeometryRemoved&&this.onGeometryRemoved(e),!0):!1},t.prototype.getGeometries=function(){return this._geometries},t.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},t.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastEntryByID=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];
for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var r=this.getLightByID(e);return r?r:this.getCameraByID(e)},t.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var r=this.getLightByName(e);return r?r:this.getCameraByName(e)},t.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},t.prototype.getSoundByName=function(e){var t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===e)return this.mainSoundTrack.soundCollection[t];for(var r=0;r<this.soundTracks.length;r++)for(t=0;t<this.soundTracks[r].soundCollection.length;t++)if(this.soundTracks[r].soundCollection[t].name===e)return this.soundTracks[r].soundCollection[t];return null},t.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},t.prototype._evaluateSubMesh=function(e,t){if(t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){var r=e.getMaterial();t.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),r&&(r.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(r)&&(this._processedMaterials.push(r),this._renderTargets.concat(r.getRenderTargetTextures())),this._activeIndices+=e.indexCount,this._renderingManager.dispatch(e))}},t.prototype._evaluateActiveMeshes=function(){this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._boundingBoxRenderer.reset(),this._edgesRenderers.reset(),this._frustumPlanes?e.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.Frustum.GetPlanes(this._transformMatrix);var t,r;if(this._selectionOctree){var n=this._selectionOctree.select(this._frustumPlanes);t=n.data,r=n.length}else r=this.meshes.length,t=this.meshes;for(var i=0;r>i;i++){var o=t[i];if(!o.isBlocked&&(this._totalVertices+=o.getTotalVertices(),o.isReady()&&o.isEnabled())){o.computeWorldMatrix(),o.actionManager&&o.actionManager.hasSpecificTriggers([e.ActionManager.OnIntersectionEnterTrigger,e.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(o);var s=o.getLOD(this.activeCamera);s&&(o._preActivate(),(o.alwaysSelectAsActiveMesh||o.isVisible&&o.visibility>0&&0!==(o.layerMask&this.activeCamera.layerMask)&&o.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(o),this.activeCamera._activeMeshes.push(o),o._activate(this._renderId),this._activeMesh(s)))}}var a=e.Tools.Now;if(this.particlesEnabled){e.Tools.StartPerformanceCounter("Particles",this.particleSystems.length>0);for(var u=0;u<this.particleSystems.length;u++){var c=this.particleSystems[u];c.isStarted()&&(!c.emitter.position||c.emitter&&c.emitter.isEnabled())&&(this._activeParticleSystems.push(c),c.animate())}e.Tools.EndPerformanceCounter("Particles",this.particleSystems.length>0)}this._particlesDuration+=e.Tools.Now-a},t.prototype._activeMesh=function(e){if(e.skeleton&&this.skeletonsEnabled&&(this._activeSkeletons.pushNoDuplicate(e.skeleton),e.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(e)),(e.showBoundingBox||this.forceShowBoundingBoxes)&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),e._edgesRenderer&&this._edgesRenderers.push(e._edgesRenderer),e&&e.subMeshes){var t,r;if(e._submeshesOctree&&e.useOctreeForRenderingSelection){var n=e._submeshesOctree.select(this._frustumPlanes);t=n.length,r=n.data}else r=e.subMeshes,t=r.length;for(var i=0;t>i;i++){var o=r[i];this._evaluateSubMesh(o,e)}}},t.prototype.updateTransformMatrix=function(e){this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._renderForCamera=function(t){var r=this._engine;if(this.activeCamera=t,!this.activeCamera)throw new Error("Active camera not set");e.Tools.StartPerformanceCounter("Rendering camera "+this.activeCamera.name),r.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.updateTransformMatrix(),this.beforeCameraRender&&this.beforeCameraRender(this.activeCamera);var n=e.Tools.Now;e.Tools.StartPerformanceCounter("Active meshes evaluation"),this._evaluateActiveMeshes(),this._evaluateActiveMeshesDuration+=e.Tools.Now-n,e.Tools.EndPerformanceCounter("Active meshes evaluation");for(var i=0;i<this._activeSkeletons.length;i++){var o=this._activeSkeletons.data[i];o.prepare()}for(var s=0;s<this._softwareSkinnedMeshes.length;s++){var a=this._softwareSkinnedMeshes.data[s];a.applySkeleton(a.skeleton)}var u=e.Tools.Now;if(this.renderTargetsEnabled){e.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var c=0;c<this._renderTargets.length;c++){var l=this._renderTargets.data[c];if(l._shouldRender()){this._renderId++;var h=l.activeCamera&&l.activeCamera!==this.activeCamera;l.render(h,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}this._renderTargets.length>0&&r.restoreDefaultFramebuffer(),this._renderTargetsDuration+=e.Tools.Now-u,this.postProcessManager._prepareFrame();var f,d,p=e.Tools.Now;if(this.layers.length){for(r.setDepthBuffer(!1),f=0;f<this.layers.length;f++)d=this.layers[f],d.isBackground&&d.render();r.setDepthBuffer(!0)}e.Tools.StartPerformanceCounter("Main render"),this._renderingManager.render(null,null,!0,!0),e.Tools.EndPerformanceCounter("Main render"),this._boundingBoxRenderer.render();for(var m=0;m<this._edgesRenderers.length;m++)this._edgesRenderers.data[m].render();if(this.lensFlaresEnabled){e.Tools.StartPerformanceCounter("Lens flares",this.lensFlareSystems.length>0);for(var g=0;g<this.lensFlareSystems.length;g++){var v=this.lensFlareSystems[g];0!==(t.layerMask&v.layerMask)&&v.render()}e.Tools.EndPerformanceCounter("Lens flares",this.lensFlareSystems.length>0)}if(this.layers.length){for(r.setDepthBuffer(!1),f=0;f<this.layers.length;f++)d=this.layers[f],d.isBackground||d.render();r.setDepthBuffer(!0)}this._renderDuration+=e.Tools.Now-p,this.postProcessManager._finalizeFrame(t.isIntermediate),this.activeCamera._updateFromScene(),this._renderTargets.reset(),this.afterCameraRender&&this.afterCameraRender(this.activeCamera),e.Tools.EndPerformanceCounter("Rendering camera "+this.activeCamera.name)},t.prototype._processSubCameras=function(t){if(t.cameraRigMode===e.Camera.RIG_MODE_NONE)return void this._renderForCamera(t);for(var r=0;r<t._rigCameras.length;r++)this._renderForCamera(t._rigCameras[r]);this.activeCamera=t,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this.activeCamera._updateFromScene()},t.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++)for(var r=this._meshesForIntersections.data[t],n=0;n<r.actionManager.actions.length;n++){var i=r.actionManager.actions[n];if(i.trigger===e.ActionManager.OnIntersectionEnterTrigger||i.trigger===e.ActionManager.OnIntersectionExitTrigger){var o=i.getTriggerParameter(),s=o instanceof e.AbstractMesh?o:o.mesh,a=s.intersectsMesh(r,o.usePreciseIntersection),u=r._intersectionsInProgress.indexOf(s);a&&-1===u?i.trigger===e.ActionManager.OnIntersectionEnterTrigger?(i._executeCurrent(e.ActionEvent.CreateNew(r,null,s)),r._intersectionsInProgress.push(s)):i.trigger===e.ActionManager.OnIntersectionExitTrigger&&r._intersectionsInProgress.push(s):!a&&u>-1&&(i.trigger===e.ActionManager.OnIntersectionExitTrigger&&i._executeCurrent(e.ActionEvent.CreateNew(r,null,s)),r.actionManager.hasSpecificTrigger(e.ActionManager.OnIntersectionExitTrigger)&&i.trigger!==e.ActionManager.OnIntersectionExitTrigger||r._intersectionsInProgress.splice(u,1))}}},t.prototype.render=function(){var r=e.Tools.Now;this._particlesDuration=0,this._spritesDuration=0,this._activeParticles=0,this._renderDuration=0,this._renderTargetsDuration=0,this._evaluateActiveMeshesDuration=0,this._totalVertices=0,this._activeIndices=0,this._activeBones=0,this.getEngine().resetDrawCalls(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),e.Tools.StartPerformanceCounter("Scene rendering"),this.actionManager&&this.actionManager.processTrigger(e.ActionManager.OnEveryFrameTrigger,null),this.simplificationQueue.running||this.simplificationQueue.executeNext(),this.beforeRender&&this.beforeRender();var n;for(n=0;n<this._onBeforeRenderCallbacks.length;n++)this._onBeforeRenderCallbacks[n]();var i=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime));this._animationRatio=.06*i,this._animate(),this._physicsEngine&&(e.Tools.StartPerformanceCounter("Physics"),this._physicsEngine._runOneStep(i/1e3),e.Tools.EndPerformanceCounter("Physics"));var o=e.Tools.Now,s=this.getEngine(),a=this.activeCamera;if(this.renderTargetsEnabled){e.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(var u=0;u<this.customRenderTargets.length;u++){var c=this.customRenderTargets[u];if(c._shouldRender()){if(this._renderId++,this.activeCamera=c.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");s.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),c.render(a!==this.activeCamera,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}if(this.customRenderTargets.length>0&&s.restoreDefaultFramebuffer(),this._renderTargetsDuration+=e.Tools.Now-o,this.activeCamera=a,this.proceduralTexturesEnabled){e.Tools.StartPerformanceCounter("Procedural textures",this._proceduralTextures.length>0);for(var l=0;l<this._proceduralTextures.length;l++){var h=this._proceduralTextures[l];h._shouldRender()&&h.render()}e.Tools.EndPerformanceCounter("Procedural textures",this._proceduralTextures.length>0)}if(this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,!0),this.shadowsEnabled)for(var f=0;f<this.lights.length;f++){var d=this.lights[f],p=d.getShadowGenerator();d.isEnabled()&&p&&-1!==p.getShadowMap().getScene().textures.indexOf(p.getShadowMap())&&this._renderTargets.push(p.getShadowMap())}if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this.postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(var m=this._renderId,g=0;g<this.activeCameras.length;g++)this._renderId=m,this._processSubCameras(this.activeCameras[g]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}for(this._checkIntersections(),this._updateAudioParameters(),this.afterRender&&this.afterRender(),n=0;n<this._onAfterRenderCallbacks.length;n++)this._onAfterRenderCallbacks[n]();for(var v=0;v<this._toBeDisposed.length;v++)this._toBeDisposed.data[v].dispose(),this._toBeDisposed[v]=null;this._toBeDisposed.reset(),this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),e.Tools.EndPerformanceCounter("Scene rendering"),this._lastFrameDuration=e.Tools.Now-r},t.prototype._updateAudioParameters=function(){if(this.audioEnabled&&(0!==this.mainSoundTrack.soundCollection.length||0!==this.soundTracks.length)){var t,r=e.Engine.audioEngine;if(t=this.activeCameras.length>0?this.activeCameras[0]:this.activeCamera,t&&r.canUseWebAudio){r.audioContext.listener.setPosition(t.position.x,t.position.y,t.position.z);var n=e.Matrix.Invert(t.getViewMatrix()),i=e.Vector3.TransformNormal(new e.Vector3(0,0,-1),n);i.normalize(),r.audioContext.listener.setOrientation(i.x,i.y,i.z,0,1,0);var o;for(o=0;o<this.mainSoundTrack.soundCollection.length;o++){var s=this.mainSoundTrack.soundCollection[o];s.useCustomAttenuation&&s.updateDistanceFromListener()}for(o=0;o<this.soundTracks.length;o++)for(var a=0;a<this.soundTracks[o].soundCollection.length;a++)s=this.soundTracks[o].soundCollection[a],s.useCustomAttenuation&&s.updateDistanceFromListener()}}},Object.defineProperty(t.prototype,"audioEnabled",{get:function(){return this._audioEnabled},set:function(e){this._audioEnabled=e,this._audioEnabled?this._enableAudio():this._disableAudio()},enumerable:!0,configurable:!0}),t.prototype._disableAudio=function(){var e;for(e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].pause();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].pause()},t.prototype._enableAudio=function(){var e;for(e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].isPaused&&this.mainSoundTrack.soundCollection[e].play();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].isPaused&&this.soundTracks[e].soundCollection[t].play()},Object.defineProperty(t.prototype,"headphone",{get:function(){return this._headphone},set:function(e){this._headphone=e,this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),t.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToHRTF()},t.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToEqualPower()},t.prototype.enableDepthRenderer=function(){return this._depthRenderer?this._depthRenderer:(this._depthRenderer=new e.DepthRenderer(this),this._depthRenderer)},t.prototype.disableDepthRenderer=function(){this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null)},t.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this._boundingBoxRenderer.dispose(),this._depthRenderer&&this._depthRenderer.dispose(),this.debugLayer.hide(),this.onDispose&&this.onDispose(),this._onBeforeRenderCallbacks=[],this._onAfterRenderCallbacks=[],this.detachControl(),this.disposeSounds();var e,t=this._engine.getRenderingCanvas();for(e=0;e<this.cameras.length;e++)this.cameras[e].detachControl(t);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose(),this._physicsEngine&&this.disablePhysicsEngine(),e=this._engine.scenes.indexOf(this),e>-1&&this._engine.scenes.splice(e,1),this._engine.wipeCaches()},t.prototype.disposeSounds=function(){this.mainSoundTrack.dispose();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].dispose()},t.prototype.getWorldExtends=function(){for(var t=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n=0;n<this.meshes.length;n++){var i=this.meshes[n];i.computeWorldMatrix(!0);var o=i.getBoundingInfo().boundingBox.minimumWorld,s=i.getBoundingInfo().boundingBox.maximumWorld;e.Tools.CheckExtends(o,t,r),e.Tools.CheckExtends(s,t,r)}return{min:t,max:r}},t.prototype.createOrUpdateSelectionOctree=function(t,r){void 0===t&&(t=64),void 0===r&&(r=2),this._selectionOctree||(this._selectionOctree=new e.Octree(e.Octree.CreationFuncForMeshes,t,r));var n=this.getWorldExtends();return this._selectionOctree.update(n.min,n.max,this.meshes),this._selectionOctree},t.prototype.createPickingRay=function(t,r,n,i){var o=this._engine;if(!i){if(!this.activeCamera)throw new Error("Active camera not set");i=this.activeCamera}var s=i.viewport,a=s.toGlobal(o);return t=t/this._engine.getHardwareScalingLevel()-a.x,r=r/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-a.y-a.height),e.Ray.CreateNew(t,r,a.width,a.height,n?n:e.Matrix.Identity(),i.getViewMatrix(),i.getProjectionMatrix())},t.prototype._internalPick=function(t,r,n){for(var i=null,o=0;o<this.meshes.length;o++){var s=this.meshes[o];if(r){if(!r(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var a=s.getWorldMatrix(),u=t(a),c=s.intersects(u,n);if(c&&c.hit&&(n||null==i||!(c.distance>=i.distance))&&(i=c,n))break}return i||new e.PickingInfo},t.prototype.pick=function(e,t,r,n,i){var o=this;return this._internalPick(function(r){return o.createPickingRay(e,t,r,i)},r,n)},t.prototype.pickWithRay=function(t,r,n){var i=this;return this._internalPick(function(r){return i._pickWithRayInverseMatrix||(i._pickWithRayInverseMatrix=e.Matrix.Identity()),r.invertToRef(i._pickWithRayInverseMatrix),e.Ray.Transform(t,i._pickWithRayInverseMatrix)},r,n)},t.prototype.setPointerOverMesh=function(t){this._pointerOverMesh!==t&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=t,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)))},t.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},t.prototype.getPhysicsEngine=function(){return this._physicsEngine},t.prototype.enablePhysics=function(t,r){return this._physicsEngine?!0:(this._physicsEngine=new e.PhysicsEngine(r),this._physicsEngine.isSupported()?(this._physicsEngine._initialize(t),!0):(this._physicsEngine=null,!1))},t.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0)},t.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},t.prototype.setGravity=function(e){this._physicsEngine&&this._physicsEngine._setGravity(e)},t.prototype.createCompoundImpostor=function(e,t){if(e.parts&&(t=e,e=e.parts),!this._physicsEngine)return null;for(var r=0;r<e.length;r++){var n=e[r].mesh;n._physicImpostor=e[r].impostor,n._physicsMass=t.mass/e.length,n._physicsFriction=t.friction,n._physicRestitution=t.restitution}return this._physicsEngine._registerMeshesAsCompound(e,t)},t.prototype.deleteCompoundImpostor=function(t){for(var r=0;r<t.parts.length;r++){var n=t.parts[r].mesh;n._physicImpostor=e.PhysicsEngine.NoImpostor,this._physicsEngine._unregisterMesh(n)}},t.prototype.createDefaultCameraOrLight=function(){if(0===this.lights.length&&new e.HemisphericLight("default light",e.Vector3.Up(),this),!this.activeCamera){var t=new e.FreeCamera("default camera",e.Vector3.Zero(),this),r=this.getWorldExtends(),n=r.min.add(r.max.subtract(r.min).scale(.5));t.position=new e.Vector3(n.x,n.y,r.min.z-(r.max.z-r.min.z)),t.setTarget(n),this.activeCamera=t}},t.prototype._getByTags=function(t,r,n){if(void 0===r)return t;var i=[];n=n||function(e){};for(var o in t){var s=t[o];e.Tags.MatchesQuery(s,r)&&(i.push(s),n(s))}return i},t.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},t.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},t.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},t.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},t._FOGMODE_NONE=0,t._FOGMODE_EXP=1,t._FOGMODE_EXP2=2,t._FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}();e.Scene=t}(r||(r={}));var r;!function(e){var t=function(){function t(r,n,i,o,s,a){if(this._engine=r instanceof e.Mesh?r.getScene().getEngine():r,this._updatable=o,this._data=n,s||this.create(),this._kind=i,a)return void(this._strideSize=a);switch(i){case t.PositionKind:this._strideSize=3;break;case t.NormalKind:this._strideSize=3;break;case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:this._strideSize=2;break;case t.ColorKind:this._strideSize=4;break;case t.MatricesIndicesKind:this._strideSize=4;break;case t.MatricesWeightsKind:this._strideSize=4}}return t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this._strideSize},t.prototype.create=function(e){(e||!this._buffer)&&(e=e||this._data,this._buffer||(this._buffer=this._updatable?this._engine.createDynamicVertexBuffer(4*e.length):this._engine.createVertexBuffer(e)),this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e))},t.prototype.update=function(e){this.create(e)},t.prototype.updateDirectly=function(e,t){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,t),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},Object.defineProperty(t,"PositionKind",{get:function(){return t._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"NormalKind",{get:function(){return t._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UVKind",{get:function(){return t._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV2Kind",{get:function(){return t._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV3Kind",{get:function(){return t._UV3Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV4Kind",{get:function(){return t._UV4Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV5Kind",{get:function(){return t._UV5Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV6Kind",{get:function(){return t._UV6Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColorKind",{get:function(){return t._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesIndicesKind",{get:function(){return t._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesWeightsKind",{get:function(){return t._MatricesWeightsKind},enumerable:!0,configurable:!0}),t._PositionKind="position",t._NormalKind="normal",t._UVKind="uv",t._UV2Kind="uv2",t._UV3Kind="uv3",t._UV4Kind="uv4",t._UV5Kind="uv5",t._UV6Kind="uv6",t._ColorKind="color",t._MatricesIndicesKind="matricesIndices",t._MatricesWeightsKind="matricesWeights",t}();e.VertexBuffer=t}(r||(r={}));var r;!function(e){var t=function(t){function r(e,r){t.call(this,e,r.getScene()),r.instances.push(this),this._sourceMesh=r,this.position.copyFrom(r.position),this.rotation.copyFrom(r.rotation),this.scaling.copyFrom(r.scaling),r.rotationQuaternion&&(this.rotationQuaternion=r.rotationQuaternion.clone()),this.infiniteDistance=r.infiniteDistance,this.setPivotMatrix(r.getPivotMatrix()),this.refreshBoundingInfo(),this._syncSubMeshes()}return n(r,t),Object.defineProperty(r.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),r.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(r.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),r.prototype.getVerticesData=function(e){return this._sourceMesh.getVerticesData(e)},r.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},r.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(r.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),r.prototype.refreshBoundingInfo=function(){var t=this._sourceMesh.getVerticesData(e.VertexBuffer.PositionKind);if(t){var r=e.Tools.ExtractMinAndMax(t,0,this._sourceMesh.getTotalVertices());this._boundingInfo=new e.BoundingInfo(r.minimum,r.maximum)}this._updateBoundingInfo()},r.prototype._preActivate=function(){this._currentLOD&&this._currentLOD._preActivate()},r.prototype._activate=function(e){this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e)},r.prototype.getLOD=function(e){return this._currentLOD=this.sourceMesh.getLOD(this.getScene().activeCamera,this.getBoundingInfo().boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},r.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh)},r.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},r.prototype.clone=function(t,r,n){var i=this._sourceMesh.createInstance(t);if(e.Tools.DeepCopy(this,i,["name"],[]),this.refreshBoundingInfo(),r&&(i.parent=r),!n)for(var o=0;o<this.getScene().meshes.length;o++){var s=this.getScene().meshes[o];s.parent===this&&s.clone(s.name,i)}return i.computeWorldMatrix(!0),i},r.prototype.dispose=function(e){var r=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(r,1),t.prototype.dispose.call(this,e)},r}(e.AbstractMesh);e.InstancedMesh=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}return e}();e._InstancesBatch=t;var r=function(r){function i(n,o,s,a,u){if(void 0===s&&(s=null),r.call(this,n,o),this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.instances=new Array,this._LODLevels=new Array,this._onBeforeRenderCallbacks=new Array,this._onAfterRenderCallbacks=new Array,this._visibleInstances={},this._renderIdForInstances=new Array,this._batchCache=new t,this._instancesBufferSize=2048,this._sideOrientation=i._DEFAULTSIDE,this._areNormalsFrozen=!1,a){if(a._geometry&&a._geometry.applyToMesh(this),e.Tools.DeepCopy(a,this,["name","material","skeleton","instances"],[]),this.id=n+"."+a.id,this.material=a.material,!u)for(var c=0;c<o.meshes.length;c++){var l=o.meshes[c];l.parent===a&&l.clone(n+"."+l.name,this,u)}for(c=0;c<o.particleSystems.length;c++){var h=o.particleSystems[c];h.emitter===a&&h.clone(h.name,this)}this.computeWorldMatrix(!0)}null!==s&&(this.parent=s)}return n(i,r),Object.defineProperty(i,"FRONTSIDE",{get:function(){return i._FRONTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BACKSIDE",{get:function(){return i._BACKSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"DOUBLESIDE",{get:function(){return i._DOUBLESIDE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"DEFAULTSIDE",{get:function(){return i._DEFAULTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"NO_CAP",{get:function(){return i._NO_CAP},enumerable:!0,configurable:!0}),Object.defineProperty(i,"CAP_START",{get:function(){return i._CAP_START},enumerable:!0,configurable:!0}),Object.defineProperty(i,"CAP_END",{get:function(){return i._CAP_END},enumerable:!0,configurable:!0}),Object.defineProperty(i,"CAP_ALL",{get:function(){return i._CAP_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),i.prototype._sortLODLevels=function(){this._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},i.prototype.addLODLevel=function(t,r){if(r&&r._masterMesh)return e.Tools.Warn("You cannot use a mesh as LOD level twice"),this;var n=new e.Internals.MeshLODLevel(t,r);return this._LODLevels.push(n),r&&(r._masterMesh=this),this._sortLODLevels(),this},i.prototype.getLODLevelAtDistance=function(e){for(var t=0;t<this._LODLevels.length;t++){var r=this._LODLevels[t];if(r.distance===e)return r.mesh}return null},i.prototype.removeLODLevel=function(e){for(var t=0;t<this._LODLevels.length;t++)this._LODLevels[t].mesh===e&&(this._LODLevels.splice(t,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},i.prototype.getLOD=function(e,t){if(!this._LODLevels||0===this._LODLevels.length)return this;var r=(t?t:this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.position).length();if(this._LODLevels[this._LODLevels.length-1].distance>r)return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var n=0;n<this._LODLevels.length;n++){var i=this._LODLevels[n];if(i.distance<r)return i.mesh&&(i.mesh._preActivate(),i.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(r,this,i.mesh),i.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this},Object.defineProperty(i.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},i.prototype.getVerticesData=function(e,t){return this._geometry?this._geometry.getVerticesData(e,t):null},i.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):void 0},i.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},i.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=[];if(this._delayInfo)for(var t in this._delayInfo)e.push(t);return e}return this._geometry.getVerticesDataKinds()},i.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},i.prototype.getIndices=function(e){return this._geometry?this._geometry.getIndices(e):[]},Object.defineProperty(i.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),i.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING?!1:r.prototype.isReady.call(this)},i.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(i.prototype,"sideOrientation",{get:function(){return this._sideOrientation},set:function(e){this._sideOrientation=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),i.prototype.freezeNormals=function(){this._areNormalsFrozen=!0},i.prototype.unfreezeNormals=function(){this._areNormalsFrozen=!1},i.prototype._preActivate=function(){var e=this.getScene().getRenderId();this._preActivateId!==e&&(this._preActivateId=e,this._visibleInstances=null)},i.prototype._registerInstanceForRenderId=function(e,t){this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=t,this._visibleInstances.selfDefaultRenderId=this._renderId),this._visibleInstances[t]||(this._visibleInstances[t]=new Array),this._visibleInstances[t].push(e)},i.prototype.refreshBoundingInfo=function(){var t=this.getVerticesData(e.VertexBuffer.PositionKind);
if(t){var r=e.Tools.ExtractMinAndMax(t,0,this.getTotalVertices());this._boundingInfo=new e.BoundingInfo(r.minimum,r.maximum)}if(this.subMeshes)for(var n=0;n<this.subMeshes.length;n++)this.subMeshes[n].refreshBoundingInfo();this._updateBoundingInfo()},i.prototype._createGlobalSubMesh=function(){var t=this.getTotalVertices();return t&&this.getIndices()?(this.releaseSubMeshes(),new e.SubMesh(0,0,t,0,this.getTotalIndices(),this)):null},i.prototype.subdivide=function(t){if(!(1>t)){for(var r=this.getTotalIndices(),n=r/t|0,i=0;n%3!==0;)n++;this.releaseSubMeshes();for(var o=0;t>o&&!(i>=r);o++)e.SubMesh.CreateFromIndices(0,i,Math.min(n,r-i),this),i+=n;this.synchronizeInstances()}},i.prototype.setVerticesData=function(t,r,n,i){if(t instanceof Array){var o=r;r=t,t=o,e.Tools.Warn("Deprecated usage of setVerticesData detected (since v1.12). Current signature is setVerticesData(kind, data, updatable).")}if(this._geometry)this._geometry.setVerticesData(t,r,n,i);else{var s=new e.VertexData;s.set(r,t);var a=this.getScene();new e.Geometry(e.Geometry.RandomId(),a,s,n,this)}},i.prototype.updateVerticesData=function(e,t,r,n){this._geometry&&(n?(this.makeGeometryUnique(),this.updateVerticesData(e,t,r,!1)):this._geometry.updateVerticesData(e,t,r))},i.prototype.updateVerticesDataDirectly=function(e,t,r,n){this._geometry&&(n?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(e,t,r,!1)):this._geometry.updateVerticesDataDirectly(e,t,r))},i.prototype.updateMeshPositions=function(t,r){void 0===r&&(r=!0);var n=this.getVerticesData(e.VertexBuffer.PositionKind);if(t(n),this.updateVerticesData(e.VertexBuffer.PositionKind,n,!1,!1),r){var i=this.getIndices(),o=this.getVerticesData(e.VertexBuffer.NormalKind);e.VertexData.ComputeNormals(n,i,o),this.updateVerticesData(e.VertexBuffer.NormalKind,o,!1,!1)}},i.prototype.makeGeometryUnique=function(){if(this._geometry){var t=this._geometry.copy(e.Geometry.RandomId());t.applyToMesh(this)}},i.prototype.setIndices=function(t,r){if(this._geometry)this._geometry.setIndices(t,r);else{var n=new e.VertexData;n.indices=t;var i=this.getScene();new e.Geometry(e.Geometry.RandomId(),i,n,!1,this)}},i.prototype._bind=function(t,r,n){var i,o=this.getScene().getEngine();switch(n){case e.Material.PointFillMode:i=null;break;case e.Material.WireFrameFillMode:i=t.getLinesIndexBuffer(this.getIndices(),o);break;default:case e.Material.TriangleFillMode:i=this._geometry.getIndexBuffer()}o.bindMultiBuffers(this._geometry.getVertexBuffers(),i,r)},i.prototype._draw=function(t,r,n){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var i=this.getScene().getEngine();switch(r){case e.Material.PointFillMode:i.drawPointClouds(t.verticesStart,t.verticesCount,n);break;case e.Material.WireFrameFillMode:i.draw(!1,0,t.linesIndexCount,n);break;default:i.draw(!0,t.indexStart,t.indexCount,n)}}},i.prototype.registerBeforeRender=function(e){this._onBeforeRenderCallbacks.push(e)},i.prototype.unregisterBeforeRender=function(e){var t=this._onBeforeRenderCallbacks.indexOf(e);t>-1&&this._onBeforeRenderCallbacks.splice(t,1)},i.prototype.registerAfterRender=function(e){this._onAfterRenderCallbacks.push(e)},i.prototype.unregisterAfterRender=function(e){var t=this._onAfterRenderCallbacks.indexOf(e);t>-1&&this._onAfterRenderCallbacks.splice(t,1)},i.prototype._getInstancesRenderList=function(e){var t=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[e]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[e]=null,this._visibleInstances){var r=t.getRenderId();this._batchCache.visibleInstances[e]=this._visibleInstances[r];var n=this._renderId;if(!this._batchCache.visibleInstances[e]&&this._visibleInstances.defaultRenderId&&(this._batchCache.visibleInstances[e]=this._visibleInstances[this._visibleInstances.defaultRenderId],r=Math.max(this._visibleInstances.defaultRenderId,r),n=Math.max(this._visibleInstances.selfDefaultRenderId,r)),this._batchCache.visibleInstances[e]&&this._batchCache.visibleInstances[e].length){if(this._renderIdForInstances[e]===r)return this._batchCache.mustReturn=!0,this._batchCache;r!==n&&(this._batchCache.renderSelf[e]=!1)}this._renderIdForInstances[e]=r}return this._batchCache},i.prototype._renderWithInstances=function(e,t,r,n,i){for(var o=r.visibleInstances[e._id],s=o.length+1,a=16*s*4;this._instancesBufferSize<a;)this._instancesBufferSize*=2;(!this._worldMatricesInstancesBuffer||this._worldMatricesInstancesBuffer.capacity<this._instancesBufferSize)&&(this._worldMatricesInstancesBuffer&&i.deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=i.createInstancesBuffer(this._instancesBufferSize),this._worldMatricesInstancesArray=new Float32Array(this._instancesBufferSize/4));var u=0,c=0,l=this.getWorldMatrix();if(r.renderSelf[e._id]&&(l.copyToArray(this._worldMatricesInstancesArray,u),u+=16,c++),o)for(var h=0;h<o.length;h++){var f=o[h];f.getWorldMatrix().copyToArray(this._worldMatricesInstancesArray,u),u+=16,c++}var d=n.getAttributeLocationByName("world0"),p=n.getAttributeLocationByName("world1"),m=n.getAttributeLocationByName("world2"),g=n.getAttributeLocationByName("world3"),v=[d,p,m,g];i.updateAndBindInstancesBuffer(this._worldMatricesInstancesBuffer,this._worldMatricesInstancesArray,v),this._draw(e,t,c),i.unBindInstancesBuffer(this._worldMatricesInstancesBuffer,v)},i.prototype._processRendering=function(e,t,r,n,i,o){var s=this.getScene(),a=s.getEngine();if(i)this._renderWithInstances(e,r,n,t,a);else if(n.renderSelf[e._id]&&(o&&o(!1,this.getWorldMatrix()),this._draw(e,r)),n.visibleInstances[e._id])for(var u=0;u<n.visibleInstances[e._id].length;u++){var c=n.visibleInstances[e._id][u],l=c.getWorldMatrix();o&&o(!0,l),this._draw(e,r)}},i.prototype.render=function(t,r){var n=this.getScene(),i=this._getInstancesRenderList(t._id);if(!i.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var o;for(o=0;o<this._onBeforeRenderCallbacks.length;o++)this._onBeforeRenderCallbacks[o](this);var s=n.getEngine(),a=null!==s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id],u=t.getMaterial();if(u&&u.isReady(this,a)){var c=s.getDepthWrite();this.renderOutline&&(s.setDepthWrite(!1),n.getOutlineRenderer().render(t,i),s.setDepthWrite(c)),u._preBind();var l=u.getEffect(),h=n.forcePointsCloud?e.Material.PointFillMode:n.forceWireframe?e.Material.WireFrameFillMode:u.fillMode;this._bind(t,l,h);var f=this.getWorldMatrix();if(u.bind(f,this),r&&s.setAlphaMode(u.alphaMode),this._processRendering(t,l,h,i,a,function(e,t){e&&u.bindOnlyWorldMatrix(t)}),u.unbind(),this.renderOutline&&c&&(s.setDepthWrite(!0),s.setColorWrite(!1),n.getOutlineRenderer().render(t,i),s.setColorWrite(!0)),this.renderOverlay){var d=s.getAlphaMode();s.setAlphaMode(e.Engine.ALPHA_COMBINE),n.getOutlineRenderer().render(t,i,!0),s.setAlphaMode(d)}for(o=0;o<this._onAfterRenderCallbacks.length;o++)this._onAfterRenderCallbacks[o](this)}}},i.prototype.getEmittedParticleSystems=function(){for(var e=new Array,t=0;t<this.getScene().particleSystems.length;t++){var r=this.getScene().particleSystems[t];r.emitter===this&&e.push(r)}return e},i.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array,t=this.getDescendants();t.push(this);for(var r=0;r<this.getScene().particleSystems.length;r++){var n=this.getScene().particleSystems[r];-1!==t.indexOf(n.emitter)&&e.push(n)}return e},i.prototype.getChildren=function(){for(var e=[],t=0;t<this.getScene().meshes.length;t++){var r=this.getScene().meshes[t];r.parent===this&&e.push(r)}return e},i.prototype._checkDelayState=function(){var t=this,r=this,n=this.getScene();if(this._geometry)this._geometry.load(n);else if(r.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED){r.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,n._addPendingData(r);var i=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");e.Tools.LoadFile(this.delayLoadingFile,function(r){r instanceof ArrayBuffer?t._delayLoadingFunction(r,t):t._delayLoadingFunction(JSON.parse(r),t),t.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,n._removePendingData(t)},function(){},n.database,i)}},i.prototype.isInFrustum=function(t){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING?!1:r.prototype.isInFrustum.call(this,t)?(this._checkDelayState(),!0):!1},i.prototype.setMaterialByID=function(e){var t,r=this.getScene().materials;for(t=0;t<r.length;t++)if(r[t].id===e)return void(this.material=r[t]);var n=this.getScene().multiMaterials;for(t=0;t<n.length;t++)if(n[t].id===e)return void(this.material=n[t])},i.prototype.getAnimatables=function(){var e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},i.prototype.bakeTransformIntoVertices=function(t){if(this.isVerticesDataPresent(e.VertexBuffer.PositionKind)){this._resetPointsArrayCache();var r,n=this.getVerticesData(e.VertexBuffer.PositionKind),i=[];for(r=0;r<n.length;r+=3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(n,r),t).toArray(i,r);if(this.setVerticesData(e.VertexBuffer.PositionKind,i,this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(e.VertexBuffer.NormalKind)){for(n=this.getVerticesData(e.VertexBuffer.NormalKind),i=[],r=0;r<n.length;r+=3)e.Vector3.TransformNormal(e.Vector3.FromArray(n,r),t).normalize().toArray(i,r);this.setVerticesData(e.VertexBuffer.NormalKind,i,this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable()),t.m[0]*t.m[5]*t.m[10]<0&&this.flipFaces()}}},i.prototype.bakeCurrentTransformIntoVertices=function(){this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=e.Quaternion.Identity()),this._worldMatrix=e.Matrix.Identity()},i.prototype._resetPointsArrayCache=function(){this._positions=null},i.prototype._generatePointsArray=function(){if(this._positions)return!0;this._positions=[];var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return!1;for(var r=0;r<t.length;r+=3)this._positions.push(e.Vector3.FromArray(t,r));return!0},i.prototype.clone=function(e,t,r){return new i(e,this.getScene(),t,this,r)},i.prototype.dispose=function(e){for(this._geometry&&this._geometry.releaseForMesh(this,!0),this._worldMatricesInstancesBuffer&&(this.getEngine().deleteInstancesBuffer(this._worldMatricesInstancesBuffer),this._worldMatricesInstancesBuffer=null);this.instances.length;)this.instances[0].dispose();r.prototype.dispose.call(this,e)},i.prototype.applyDisplacementMap=function(t,r,n,i){var o=this,s=this.getScene(),a=function(e){var t=document.createElement("canvas"),s=t.getContext("2d"),a=e.width,u=e.height;t.width=a,t.height=u,s.drawImage(e,0,0);var c=s.getImageData(0,0,a,u).data;o.applyDisplacementMapFromBuffer(c,a,u,r,n),i&&i(o)};e.Tools.LoadImage(t,a,function(){},s.database)},i.prototype.applyDisplacementMapFromBuffer=function(t,r,n,i,o){if(!this.isVerticesDataPresent(e.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(e.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(e.VertexBuffer.UVKind))return void e.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing");for(var s=this.getVerticesData(e.VertexBuffer.PositionKind),a=this.getVerticesData(e.VertexBuffer.NormalKind),u=this.getVerticesData(e.VertexBuffer.UVKind),c=e.Vector3.Zero(),l=e.Vector3.Zero(),h=e.Vector2.Zero(),f=0;f<s.length;f+=3){e.Vector3.FromArrayToRef(s,f,c),e.Vector3.FromArrayToRef(a,f,l),e.Vector2.FromArrayToRef(u,f/3*2,h);var d=Math.abs(h.x)*r%r|0,p=Math.abs(h.y)*n%n|0,m=4*(d+p*r),g=t[m]/255,v=t[m+1]/255,_=t[m+2]/255,y=.3*g+.59*v+.11*_;l.normalize(),l.scaleInPlace(i+(o-i)*y),c=c.add(l),c.toArray(s,f)}e.VertexData.ComputeNormals(s,this.getIndices(),a),this.updateVerticesData(e.VertexBuffer.PositionKind,s),this.updateVerticesData(e.VertexBuffer.NormalKind,a)},i.prototype.convertToFlatShadedMesh=function(){var t,r,n=this.getVerticesDataKinds(),i=[],o=[],s=[],a=!1;for(t=0;t<n.length;t++){r=n[t];var u=this.getVertexBuffer(r);r!==e.VertexBuffer.NormalKind?(i[r]=u,o[r]=i[r].getData(),s[r]=[]):(a=u.isUpdatable(),n.splice(t,1),t--)}var c,l=this.subMeshes.slice(0),h=this.getIndices(),f=this.getTotalIndices();for(c=0;f>c;c++){var d=h[c];for(t=0;t<n.length;t++){r=n[t];for(var p=i[r].getStrideSize(),m=0;p>m;m++)s[r].push(o[r][d*p+m])}}var g=[],v=s[e.VertexBuffer.PositionKind];for(c=0;f>c;c+=3){h[c]=c,h[c+1]=c+1,h[c+2]=c+2;for(var _=e.Vector3.FromArray(v,3*c),y=e.Vector3.FromArray(v,3*(c+1)),x=e.Vector3.FromArray(v,3*(c+2)),b=_.subtract(y),S=x.subtract(y),E=e.Vector3.Normalize(e.Vector3.Cross(b,S)),M=0;3>M;M++)g.push(E.x),g.push(E.y),g.push(E.z)}for(this.setIndices(h),this.setVerticesData(e.VertexBuffer.NormalKind,g,a),t=0;t<n.length;t++)r=n[t],this.setVerticesData(r,s[r],i[r].isUpdatable());this.releaseSubMeshes();for(var T=0;T<l.length;T++){var P=l[T];new e.SubMesh(P.materialIndex,P.indexStart,P.indexCount,P.indexStart,P.indexCount,this)}this.synchronizeInstances()},i.prototype.flipFaces=function(t){void 0===t&&(t=!1);var r,n=e.VertexData.ExtractFromMesh(this);if(t&&this.isVerticesDataPresent(e.VertexBuffer.NormalKind))for(r=0;r<n.normals.length;r++)n.normals[r]*=-1;var i;for(r=0;r<n.indices.length;r+=3)i=n.indices[r+1],n.indices[r+1]=n.indices[r+2],n.indices[r+2]=i;n.applyToMesh(this)},i.prototype.createInstance=function(t){return new e.InstancedMesh(t,this)},i.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){var t=this.instances[e];t._syncSubMeshes()}},i.prototype.simplify=function(t,r,n,i){void 0===r&&(r=!0),void 0===n&&(n=e.SimplificationType.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:t,parallelProcessing:r,mesh:this,simplificationType:n,successCallback:i})},i.prototype.optimizeIndices=function(t){for(var r=this,n=this.getIndices(),i=this.getVerticesData(e.VertexBuffer.PositionKind),o=[],s=0;s<i.length;s+=3)o.push(e.Vector3.FromArray(i,s));var a=[];e.AsyncLoop.SyncAsyncForLoop(o.length,40,function(e){for(var t=o.length-1-e,r=o[t],n=0;t>n;++n){var i=o[n];if(r.equals(i)){a[t]=n;break}}},function(){for(var e=0;e<n.length;++e)n[e]=a[n[e]]||n[e];var i=r.subMeshes.slice(0);r.setIndices(n),r.subMeshes=i,t&&t(r)})},i.CreateRibbon=function(t,r,n,o,s,a,u,c,l){if(void 0===c&&(c=i.DEFAULTSIDE),void 0===l&&(l=null),l){var h=function(e){for(var t=r[0].length,n=0,o=l.sideOrientation===i.DOUBLESIDE?2:1,s=1;o>=s;s++)for(var a=0;a<r.length;a++){var u=r[a],c=u.length;t=c>t?t:c;for(var h=0;t>h;)e[n]=u[h].x,e[n+1]=u[h].y,e[n+2]=u[h].z,h++,n+=3;l._closePath&&(e[n]=u[0].x,e[n+1]=u[0].y,e[n+2]=u[0].z,n+=3)}},f=l.getVerticesData(e.VertexBuffer.PositionKind);if(h(f),l.updateVerticesData(e.VertexBuffer.PositionKind,f,!1,!1),!l.areNormalsFrozen){var d=l.getIndices(),p=l.getVerticesData(e.VertexBuffer.NormalKind);if(e.VertexData.ComputeNormals(f,d,p),l._closePath)for(var m=0,g=0,v=0;v<r.length;v++)m=3*l._idx[v],g=v+1<r.length?3*(l._idx[v+1]-1):p.length-3,p[m]=.5*(p[m]+p[g]),p[m+1]=.5*(p[m+1]+p[g+1]),p[m+2]=.5*(p[m+2]+p[g+2]),p[g]=p[m],p[g+1]=p[m+1],p[g+2]=p[m+2];l.updateVerticesData(e.VertexBuffer.NormalKind,p,!1,!1)}return l}var _=new i(t,a);_.sideOrientation=c;var y=e.VertexData.CreateRibbon(r,n,o,s,c);return o&&(_._idx=y._idx),_._closePath=o,y.applyToMesh(_,u),_},i.CreateDisc=function(t,r,n,o,s,a){void 0===a&&(a=i.DEFAULTSIDE);var u=new i(t,o),c=e.VertexData.CreateDisc(r,n,a);return c.applyToMesh(u,s),u},i.CreateBox=function(t,r,n,o,s){void 0===s&&(s=i.DEFAULTSIDE),o=o||r.updatable;var a=new i(t,n),u=e.VertexData.CreateBox(r,s);return u.applyToMesh(a,o),a},i.CreateSphere=function(t,r,n,o,s,a){if(void 0===a&&(a=i.DEFAULTSIDE),n instanceof e.Scene)o=n,s=r.updatable;else{var u=r;r={segments:u,diameterX:n,diameterY:n,diameterZ:n,sideOrientation:a}}var c=new i(t,o),l=e.VertexData.CreateSphere(r);return l.applyToMesh(c,s),c},i.CreateCylinder=function(t,r,n,o,s,a,u,c,l){void 0===l&&(l=i.DEFAULTSIDE),void 0!==u&&u instanceof e.Scene||(void 0!==u&&(c=u),u=a,a=1);var h=new i(t,u),f=e.VertexData.CreateCylinder(r,n,o,s,a,l);return f.applyToMesh(h,c),h},i.CreateTorus=function(t,r,n,o,s,a,u){void 0===u&&(u=i.DEFAULTSIDE);var c=new i(t,s),l=e.VertexData.CreateTorus(r,n,o,u);return l.applyToMesh(c,a),c},i.CreateTorusKnot=function(t,r,n,o,s,a,u,c,l,h){void 0===h&&(h=i.DEFAULTSIDE);var f=new i(t,c),d=e.VertexData.CreateTorusKnot(r,n,o,s,a,u,h);return d.applyToMesh(f,l),f},i.CreateLines=function(t,r,n,i,o){if(void 0===o&&(o=null),o){var s=function(e){for(var t=0,n=0;n<r.length;n++)e[t]=r[n].x,e[t+1]=r[n].y,e[t+2]=r[n].z,t+=3};return o.updateMeshPositions(s,!1),o}var a=new e.LinesMesh(t,n),u=e.VertexData.CreateLines(r);return u.applyToMesh(a,i),a},i.CreateDashedLines=function(t,r,n,i,o,s,a,u){if(void 0===u&&(u=null),u){var c=function(t){var n=e.Vector3.Zero(),i=t.length/6,o=0,s=0,a=0,c=0,l=0,h=0,f=0,d=0;for(f=0;f<r.length-1;f++)r[f+1].subtractToRef(r[f],n),o+=n.length();for(a=o/i,c=u.dashSize*a/(u.dashSize+u.gapSize),f=0;f<r.length-1;f++)for(r[f+1].subtractToRef(r[f],n),s=Math.floor(n.length()/a),n.normalize(),d=0;s>d&&h<t.length;)l=a*d,t[h]=r[f].x+l*n.x,t[h+1]=r[f].y+l*n.y,t[h+2]=r[f].z+l*n.z,t[h+3]=r[f].x+(l+c)*n.x,t[h+4]=r[f].y+(l+c)*n.y,t[h+5]=r[f].z+(l+c)*n.z,h+=6,d++;for(;h<t.length;)t[h]=r[f].x,t[h+1]=r[f].y,t[h+2]=r[f].z,h+=3};return u.updateMeshPositions(c,!1),u}var l=new e.LinesMesh(t,s),h=e.VertexData.CreateDashedLines(r,n,i,o);return h.applyToMesh(l,a),l.dashSize=n,l.gapSize=i,l},i.ExtrudeShape=function(e,t,r,n,o,s,a,u,c,l){void 0===c&&(c=i.DEFAULTSIDE),void 0===l&&(l=null),n=n||1,o=o||0;var h=i._ExtrudeShapeGeneric(e,t,r,n,o,null,null,!1,!1,s,!1,a,u,c,l);return h},i.ExtrudeShapeCustom=function(e,t,r,n,o,s,a,u,c,l,h,f){void 0===h&&(h=i.DEFAULTSIDE),void 0===f&&(f=null);var d=i._ExtrudeShapeGeneric(e,t,r,null,null,n,o,s,a,u,!0,c,l,h,f);return d},i._ExtrudeShapeGeneric=function(t,r,n,o,s,a,u,c,l,h,f,d,p,m,g){var v,_,y=function(t,r,n,o,s,a,u,c,l,h){for(var f=n.getTangents(),d=n.getNormals(),p=n.getBinormals(),m=n.getDistances(),g=0,v=function(e,t){return s},_=function(e,t){return a},y=h?c:_,x=h?u:v,b=0,S=0;S<r.length;S++){for(var E=new Array,M=y(S,m[S]),T=x(S,m[S]),P=0;P<t.length;P++){var C=e.Matrix.RotationAxis(f[S],g),w=f[S].scale(t[P].z).add(d[S].scale(t[P].x)).add(p[S].scale(t[P].y)),A=e.Vector3.TransformCoordinates(w,C).scaleInPlace(T).add(r[S]);E.push(A)}o[b]=E,g+=M,b++}var D=function(t){var r,n=Array(),i=e.Vector3.Zero();for(r=0;r<t.length;r++)i.addInPlace(t[r]);for(i.scaleInPlace(1/t.length),r=0;r<t.length;r++)n.push(i);return n};switch(l){case i.NO_CAP:break;case i.CAP_START:o.unshift(D(o[0]));break;case i.CAP_END:o.push(D(o[o.length-1]));break;case i.CAP_ALL:o.unshift(D(o[0])),o.push(D(o[o.length-1]))}return o};if(g)return v=g.path3D.update(n),_=y(r,n,g.path3D,g.pathArray,o,s,a,u,g.cap,f),g=i.CreateRibbon(null,_,null,null,null,null,null,null,g);v=new e.Path3D(n);var x=new Array;h=0>h||h>3?0:h,_=y(r,n,v,x,o,s,a,u,h,f);var b=i.CreateRibbon(t,_,c,l,0,d,p,m);return b.pathArray=_,b.path3D=v,b.cap=h,b},i.CreateLathe=function(t,r,n,o,s,a,u){void 0===u&&(u=i.DEFAULTSIDE),n=n||1,o=o||60*n;for(var c=2*Math.PI,l=new Array,h=0;0===r[h].x;)h++;var f=r[h];for(h=0;h<r.length;h++)l.push(r[h].subtract(f));var d,p=c/o,m=new Array;for(h=0;o>h;h++)d=new e.Vector3(Math.cos(h*p)*n,0,Math.sin(h*p)*n),m.push(d);m.push(m[0]);var g=function(){return 1},v=function(){return 0},_=i.ExtrudeShapeCustom(t,l,m,g,v,!0,!1,i.NO_CAP,s,a,u);return _},i.CreatePlane=function(t,r,n,o,s){void 0===s&&(s=i.DEFAULTSIDE);var a=new i(t,n),u=e.VertexData.CreatePlane(r,s);return u.applyToMesh(a,o||r.updatable),a},i.CreateGround=function(t,r,n,i,o,s){if(n instanceof e.Scene)o=n,s=r.updatable;else{var a=r;r={width:a,height:n,subdivisions:i}}var u=new e.GroundMesh(t,o);u._setReady(!1),u._subdivisions=r.subdivisions||1;var c=e.VertexData.CreateGround(r);return c.applyToMesh(u,s||r.updatable),u._setReady(!0),u},i.CreateTiledGround=function(t,r,n,o,s,a,u,c,l){var h=new i(t,c),f=e.VertexData.CreateTiledGround(r,n,o,s,a,u);return f.applyToMesh(h,l),h},i.CreateGroundFromHeightMap=function(t,r,n,i,o,s,a,u,c,l){var h=new e.GroundMesh(t,u);h._subdivisions=o,h._setReady(!1);var f=function(t){var r=document.createElement("canvas"),u=r.getContext("2d"),f=t.width,d=t.height;r.width=f,r.height=d,u.drawImage(t,0,0);var p=u.getImageData(0,0,f,d).data,m=e.VertexData.CreateGroundFromHeightMap(n,i,o,s,a,p,f,d);m.applyToMesh(h,c),h._setReady(!0),l&&l(h)};return e.Tools.LoadImage(r,f,function(){},u.database),h},i.CreateTube=function(t,r,n,o,s,a,u,c,l,h){void 0===l&&(l=i.DEFAULTSIDE),void 0===h&&(h=null);var f,d,p=function(t,r,n,o,s,a,u){for(var c,l,h,f,d,p=r.getTangents(),m=r.getNormals(),g=r.getDistances(),v=2*Math.PI,_=v/s,y=function(e,t){return o},x=a||y,b=0,S=0;S<t.length;S++){l=x(S,g[S]),c=Array(),h=m[S];for(var E=0;s>E;E++)d=e.Matrix.RotationAxis(p[S],_*E),f=e.Vector3.TransformCoordinates(h,d).scaleInPlace(l).add(t[S]),c.push(f);n[b]=c,b++}var M=function(e,r){for(var n=Array(),i=0;e>i;i++)n.push(t[r]);return n};switch(u){case i.NO_CAP:break;case i.CAP_START:n.unshift(M(s+1,0));break;case i.CAP_END:n.push(M(s+1,t.length-1));break;case i.CAP_ALL:n.unshift(M(s+1,0)),n.push(M(s+1,t.length-1))}return n};if(h)return f=h.path3D.update(r),d=p(r,f,h.pathArray,n,h.tessellation,s,h.cap),h=i.CreateRibbon(null,d,null,null,null,null,null,null,h);f=new e.Path3D(r);var m=new Array;a=0>a||a>3?0:a,d=p(r,f,m,n,o,s,a);var g=i.CreateRibbon(t,d,!1,!0,0,u,c,l);return g.pathArray=d,g.path3D=f,g.tessellation=o,g.cap=a,g},i.CreateDecal=function(t,r,n,o,s,a){void 0===a&&(a=0);var u=r.getIndices(),c=r.getVerticesData(e.VertexBuffer.PositionKind),l=r.getVerticesData(e.VertexBuffer.NormalKind);if(!o){var h=new e.Vector3(0,0,1),f=r.getScene().activeCamera,d=e.Vector3.TransformCoordinates(h,f.getWorldMatrix());o=f.globalPosition.subtract(d)}var p=-Math.atan2(o.z,o.x)-Math.PI/2,m=Math.sqrt(o.x*o.x+o.z*o.z),g=Math.atan2(o.y,m),v=e.Matrix.RotationYawPitchRoll(p,g,a).multiply(e.Matrix.Translation(n.x,n.y,n.z)),_=e.Matrix.Invert(v),y=r.getWorldMatrix(),x=y.multiply(_),b=new e.VertexData;b.indices=[],b.positions=[],b.normals=[],b.uvs=[];for(var S=0,E=function(t){var r=u[t],n=new e.PositionNormalVertex;return n.position=new e.Vector3(c[3*r],c[3*r+1],c[3*r+2]),n.position=e.Vector3.TransformCoordinates(n.position,x),n.normal=new e.Vector3(l[3*r],l[3*r+1],l[3*r+2]),n},M=function(t,r){if(0===t.length)return t;for(var n=.5*Math.abs(e.Vector3.Dot(s,r)),i=function(t,i){var o=e.Vector3.GetClipFactor(t.position,i.position,r,n);return new e.PositionNormalVertex(e.Vector3.Lerp(t.position,i.position,o),e.Vector3.Lerp(t.normal,i.normal,o))},o=new Array,a=0;a<t.length;a+=3){var u,c,l,h,f,d,p,m=0,g=e.Vector3.Dot(t[a].position,r)-n,v=e.Vector3.Dot(t[a+1].position,r)-n,_=e.Vector3.Dot(t[a+2].position,r)-n;switch(u=g>0,c=v>0,l=_>0,m=(u?1:0)+(c?1:0)+(l?1:0)){case 0:o.push(t[a]),o.push(t[a+1]),o.push(t[a+2]);break;case 1:if(u&&(h=t[a+1],f=t[a+2],d=i(t[a],h),p=i(t[a],f)),c){h=t[a],f=t[a+2],d=i(t[a+1],h),p=i(t[a+1],f),o.push(d),o.push(f.clone()),o.push(h.clone()),o.push(f.clone()),o.push(d.clone()),o.push(p);break}l&&(h=t[a],f=t[a+1],d=i(t[a+2],h),p=i(t[a+2],f)),o.push(h.clone()),o.push(f.clone()),o.push(d),o.push(p),o.push(d.clone()),o.push(f.clone());break;case 2:u||(h=t[a].clone(),f=i(h,t[a+1]),d=i(h,t[a+2]),o.push(h),o.push(f),o.push(d)),c||(h=t[a+1].clone(),f=i(h,t[a+2]),d=i(h,t[a]),o.push(h),o.push(f),o.push(d)),l||(h=t[a+2].clone(),f=i(h,t[a]),d=i(h,t[a+1]),o.push(h),o.push(f),o.push(d));break;case 3:}}return o},T=0;T<u.length;T+=3){var P=new Array;if(P.push(E(T)),P.push(E(T+1)),P.push(E(T+2)),P=M(P,new e.Vector3(1,0,0)),P=M(P,new e.Vector3(-1,0,0)),P=M(P,new e.Vector3(0,1,0)),P=M(P,new e.Vector3(0,-1,0)),P=M(P,new e.Vector3(0,0,1)),P=M(P,new e.Vector3(0,0,-1)),0!==P.length)for(var C=0;C<P.length;C++){var w=P[C];b.indices.push(S),w.position.toArray(b.positions,3*S),w.normal.toArray(b.normals,3*S),b.uvs.push(.5+w.position.x/s.x),b.uvs.push(.5+w.position.y/s.y),S++}}var A=new i(t,r.getScene());return b.applyToMesh(A),A.position=n.clone(),A.rotation=new e.Vector3(g,p,a),A},i.prototype.applySkeleton=function(t){if(!this.isVerticesDataPresent(e.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind))return this;var r;this._sourcePositions||(r=this.getVerticesData(e.VertexBuffer.PositionKind),this._sourcePositions=new Float32Array(r),this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()||this.setVerticesData(e.VertexBuffer.PositionKind,r,!0)),this._sourceNormals||(r=this.getVerticesData(e.VertexBuffer.NormalKind),this._sourceNormals=new Float32Array(r),this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable()||this.setVerticesData(e.VertexBuffer.NormalKind,r,!0));for(var n=this.getVerticesData(e.VertexBuffer.PositionKind),i=this.getVerticesData(e.VertexBuffer.NormalKind),o=this.getVerticesData(e.VertexBuffer.MatricesIndicesKind),s=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind),a=t.getTransformMatrices(),u=e.Vector3.Zero(),c=new e.Matrix,l=new e.Matrix,h=0;h<n.length;h+=3){var f=h/3*4,d=s[f],p=s[f+1],m=s[f+2],g=s[f+3];d>0&&(e.Matrix.FromFloat32ArrayToRefScaled(a,16*o[f],d,l),c.addToSelf(l)),p>0&&(e.Matrix.FromFloat32ArrayToRefScaled(a,16*o[f+1],p,l),c.addToSelf(l)),m>0&&(e.Matrix.FromFloat32ArrayToRefScaled(a,16*o[f+2],m,l),c.addToSelf(l)),g>0&&(e.Matrix.FromFloat32ArrayToRefScaled(a,16*o[f+3],g,l),c.addToSelf(l)),e.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[h],this._sourcePositions[h+1],this._sourcePositions[h+2],c,u),u.toArray(n,h),e.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[h],this._sourceNormals[h+1],this._sourceNormals[h+2],c,u),u.toArray(i,h),c.reset()}return this.updateVerticesData(e.VertexBuffer.PositionKind,n),this.updateVerticesData(e.VertexBuffer.NormalKind,i),this},i.MinMax=function(e){var t=null,r=null;for(var n in e){var i=e[n],o=i.getBoundingInfo().boundingBox;t?(t.MinimizeInPlace(o.minimumWorld),r.MaximizeInPlace(o.maximumWorld)):(t=o.minimumWorld,r=o.maximumWorld)}return{min:t,max:r}},i.Center=function(t){var r=void 0!==t.min?t:i.MinMax(t);return e.Vector3.Center(r.min,r.max)},i.MergeMeshes=function(t,r,n,o){void 0===r&&(r=!0);var s;if(!n){var a=0;for(s=0;s<t.length;s++)if(t[s]&&(a+=t[s].getTotalVertices(),a>65536))return e.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var u,c,l;for(s=0;s<t.length;s++)t[s]&&(t[s].computeWorldMatrix(!0),c=e.VertexData.ExtractFromMesh(t[s],!0),c.transform(t[s].getWorldMatrix()),u?u.merge(c):(u=c,l=t[s]));if(o||(o=new i(l.name+"_merged",l.getScene())),u.applyToMesh(o),o.material=l.material,o.checkCollisions=l.checkCollisions,r)for(s=0;s<t.length;s++)t[s]&&t[s].dispose();return o},i._FRONTSIDE=0,i._BACKSIDE=1,i._DOUBLESIDE=2,i._DEFAULTSIDE=0,i._NO_CAP=0,i._CAP_START=1,i._CAP_END=2,i._CAP_ALL=3,i}(e.AbstractMesh);e.Mesh=r}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a){void 0===a&&(a=!0),this.materialIndex=e,this.verticesStart=t,this.verticesCount=r,this.indexStart=n,this.indexCount=i,this._renderId=0,this._mesh=o,this._renderingMesh=s||o,o.subMeshes.push(this),this._trianglePlanes=[],this._id=o.subMeshes.length-1,a&&(this.refreshBoundingInfo(),o.computeWorldMatrix(!0))}return t.prototype.getBoundingInfo=function(){return this._boundingInfo},t.prototype.getMesh=function(){return this._mesh},t.prototype.getRenderingMesh=function(){return this._renderingMesh},t.prototype.getMaterial=function(){var t=this._renderingMesh.material;if(t&&t instanceof e.MultiMaterial){var r=t;return r.getSubMaterial(this.materialIndex)}return t?t:this._mesh.getScene().defaultMaterial},t.prototype.refreshBoundingInfo=function(){var t=this._renderingMesh.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return void(this._boundingInfo=this._mesh._boundingInfo);var r,n=this._renderingMesh.getIndices();r=0===this.indexStart&&this.indexCount===n.length?e.Tools.ExtractMinAndMax(t,this.verticesStart,this.verticesCount):e.Tools.ExtractMinAndMaxIndexed(t,n,this.indexStart,this.indexCount),this._boundingInfo=new e.BoundingInfo(r.minimum,r.maximum)},t.prototype._checkCollision=function(e){return this._boundingInfo._checkCollision(e)},t.prototype.updateBoundingInfo=function(e){this._boundingInfo||this.refreshBoundingInfo(),this._boundingInfo._update(e)},t.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},t.prototype.render=function(e){this._renderingMesh.render(this,e)},t.prototype.getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var r=[],n=this.indexStart;n<this.indexStart+this.indexCount;n+=3)r.push(e[n],e[n+1],e[n+1],e[n+2],e[n+2],e[n]);this._linesIndexBuffer=t.createIndexBuffer(r),this.linesIndexCount=r.length}return this._linesIndexBuffer},t.prototype.canIntersects=function(e){return e.intersectsBox(this._boundingInfo.boundingBox)},t.prototype.intersects=function(e,t,r,n){for(var i=null,o=this.indexStart;o<this.indexStart+this.indexCount;o+=3){var s=t[r[o]],a=t[r[o+1]],u=t[r[o+2]],c=e.intersectsTriangle(s,a,u);if(c){if(c.distance<0)continue;if((n||!i||c.distance<i.distance)&&(i=c,i.faceId=o/3,n))break}}return i},t.prototype.clone=function(r,n){var i=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,r,n,!1);return i._boundingInfo=new e.BoundingInfo(this._boundingInfo.minimum,this._boundingInfo.maximum),i},t.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},t.CreateFromIndices=function(e,r,n,i,o){var s=Number.MAX_VALUE,a=-Number.MAX_VALUE;o=o||i;for(var u=o.getIndices(),c=r;r+n>c;c++){var l=u[c];s>l&&(s=l),l>a&&(a=l)}return new t(e,s,a-s+1,r,n,i,o)},t}();e.SubMesh=t}(r||(r={}));var r;!function(e){var t=function(){function t(t){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.isCube=!1,this.isRenderTarget=!1,this.animations=new Array,this.coordinatesIndex=0,this.coordinatesMode=e.Texture.EXPLICIT_MODE,this.wrapU=e.Texture.WRAP_ADDRESSMODE,this.wrapV=e.Texture.WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=4,this._scene=t,this._scene.textures.push(this)}return t.prototype.getScene=function(){return this._scene},t.prototype.getTextureMatrix=function(){return null},t.prototype.getReflectionTextureMatrix=function(){return null},t.prototype.getInternalTexture=function(){return this._texture},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED?!0:this._texture?this._texture.isReady:!1},t.prototype.getSize=function(){return this._texture._width?{width:this._texture._width,height:this._texture._height}:this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:0,height:0}},t.prototype.getBaseSize=function(){return this.isReady()?this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:this._texture._baseWidth,height:this._texture._baseHeight}:{width:0,height:0}},t.prototype.scale=function(e){},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype._removeFromCache=function(e,t){for(var r=this._scene.getEngine().getLoadedTexturesCache(),n=0;n<r.length;n++){var i=r[n];if(i.url===e&&i.noMipmap===t)return void r.splice(n,1)}},t.prototype._getFromCache=function(e,t,r){for(var n=this._scene.getEngine().getLoadedTexturesCache(),i=0;i<n.length;i++){var o=n[i];if(o.url===e&&o.noMipmap===t&&(!r||r===o.samplingMode))return o.references++,o}return null},t.prototype.delayLoad=function(){},t.prototype.releaseInternalTexture=function(){if(this._texture){var e=this._scene.getEngine().getLoadedTexturesCache();
if(this._texture.references--,0===this._texture.references){var t=e.indexOf(this._texture);e.splice(t,1),this._scene.getEngine()._releaseTexture(this._texture),delete this._texture}}},t.prototype.clone=function(){return null},t.prototype.dispose=function(){var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDispose&&this.onDispose())},t}();e.BaseTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function r(n,i,o,s,a,u,c,l,h){void 0===a&&(a=r.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null),void 0===c&&(c=null),void 0===l&&(l=null),void 0===h&&(h=!1),t.call(this,i),this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.name=n,this.url=n,this._noMipmap=o,this._invertY=s,this._samplingMode=a,this._buffer=l,this._deleteBuffer=h,n&&(this._texture=this._getFromCache(n,o,a),this._texture?e.Tools.SetImmediate(function(){u&&u()}):i.useDelayedTextureLoading?this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:(this._texture=i.getEngine().createTexture(n,o,s,i,this._samplingMode,u,c,this._buffer),h&&delete this._buffer))}return n(r,t),r.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture||(this._texture=this.getScene().getEngine().createTexture(this.url,this._noMipmap,this._invertY,this.getScene(),this._samplingMode,null,null,this._buffer),this._deleteBuffer&&delete this._buffer))},r.prototype.updateSamplingMode=function(e){this._texture&&this.getScene().getEngine().updateTextureSamplingMode(e,this._texture)},r.prototype._prepareRowForTextureGeneration=function(t,r,n,i){t-=this.uOffset+.5,r-=this.vOffset+.5,n-=.5,e.Vector3.TransformCoordinatesFromFloatsToRef(t,r,n,this._rowGenerationMatrix,i),i.x*=this.uScale,i.y*=this.vScale,i.x+=.5,i.y+=.5,i.z+=.5},r.prototype.getTextureMatrix=function(){return this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng?this._cachedTextureMatrix:(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero(),this._rowGenerationMatrix=new e.Matrix,this._t0=e.Vector3.Zero(),this._t1=e.Vector3.Zero(),this._t2=e.Vector3.Zero()),e.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z,this._cachedTextureMatrix)},r.prototype.getReflectionTextureMatrix=function(){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero(),this._projectionModeMatrix=e.Matrix.Zero()),this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case r.SPHERICAL_MODE:e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=-.5*this.uScale,this._cachedTextureMatrix[5]=-.5*this.vScale,this._cachedTextureMatrix[12]=.5+this.uOffset,this._cachedTextureMatrix[13]=.5+this.vOffset;break;case r.PLANAR_MODE:e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case r.PROJECTION_MODE:e.Matrix.IdentityToRef(this._projectionModeMatrix),this._projectionModeMatrix.m[0]=.5,this._projectionModeMatrix.m[5]=-.5,this._projectionModeMatrix.m[10]=0,this._projectionModeMatrix.m[12]=.5,this._projectionModeMatrix.m[13]=.5,this._projectionModeMatrix.m[14]=1,this._projectionModeMatrix.m[15]=1,this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:e.Matrix.IdentityToRef(this._cachedTextureMatrix)}return this._cachedTextureMatrix},r.prototype.clone=function(){var e=new r(this._texture.url,this.getScene(),this._noMipmap,this._invertY,this._samplingMode);return e.hasAlpha=this.hasAlpha,e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e.uOffset=this.uOffset,e.vOffset=this.vOffset,e.uScale=this.uScale,e.vScale=this.vScale,e.uAng=this.uAng,e.vAng=this.vAng,e.wAng=this.wAng,e},r.CreateFromBase64String=function(e,t,n,i,o,s,a,u){return void 0===s&&(s=r.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===u&&(u=null),new r("data:"+t,n,i,o,s,a,u,e)},r.NEAREST_SAMPLINGMODE=1,r.BILINEAR_SAMPLINGMODE=2,r.TRILINEAR_SAMPLINGMODE=3,r.EXPLICIT_MODE=0,r.SPHERICAL_MODE=1,r.PLANAR_MODE=2,r.CUBIC_MODE=3,r.PROJECTION_MODE=4,r.SKYBOX_MODE=5,r.CLAMP_ADDRESSMODE=0,r.WRAP_ADDRESSMODE=1,r.MIRROR_ADDRESSMODE=2,r}(e.BaseTexture);e.Texture=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o){t.call(this,n),this.coordinatesMode=e.Texture.CUBIC_MODE,this.name=r,this.url=r,this._noMipmap=o,this.hasAlpha=!1,this._texture=this._getFromCache(r,o),i||(i=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._extensions=i,this._texture||(n.useDelayedTextureLoading?this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:this._texture=n.getEngine().createCubeTexture(r,n,i,o)),this.isCube=!0,this._textureMatrix=e.Matrix.Identity()}return n(r,t),r.prototype.clone=function(){var e=new r(this.url,this.getScene(),this._extensions,this._noMipmap);return e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e},r.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createCubeTexture(this.url,this.getScene(),this._extensions)))},r.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},r}(e.BaseTexture);e.CubeTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s,a){void 0===s&&(s=!0),void 0===a&&(a=e.Engine.TEXTURETYPE_UNSIGNED_INT),t.call(this,null,i,!o),this.renderList=new Array,this.renderParticles=!0,this.renderSprites=!1,this.coordinatesMode=e.Texture.PROJECTION_MODE,this._currentRefreshId=-1,this._refreshRate=1,this.name=r,this.isRenderTarget=!0,this._size=n,this._generateMipMaps=o,this._doNotChangeAspectRatio=s,this._texture=i.getEngine().createRenderTargetTexture(n,{generateMipMaps:o,type:a}),this._renderingManager=new e.RenderingManager(i)}return n(r,t),r.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(r.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),r.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},r.prototype.isReady=function(){return this.getScene().renderTargetsEnabled?t.prototype.isReady.call(this):!1},r.prototype.getRenderSize=function(){return this._size},Object.defineProperty(r.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),r.prototype.scale=function(e){var t=this._size*e;this.resize(t,this._generateMipMaps)},r.prototype.resize=function(e,t){this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(e,t)},r.prototype.render=function(t,r){var n=this.getScene(),i=n.getEngine();if(this._waitingRenderList){this.renderList=[];for(var o=0;o<this._waitingRenderList.length;o++){var s=this._waitingRenderList[o];this.renderList.push(n.getMeshByID(s))}delete this._waitingRenderList}if(!this.renderList||0!==this.renderList.length){t&&n.postProcessManager._prepareFrame(this._texture)||i.bindFramebuffer(this._texture),this._renderingManager.reset();for(var a=this.renderList?this.renderList:n.getActiveMeshes().data,u=0;u<a.length;u++){var c=a[u];if(c){if(!c.isReady()){this.resetRefreshCounter();continue}if(c.isEnabled()&&c.isVisible&&c.subMeshes&&0!==(c.layerMask&n.activeCamera.layerMask)){c._activate(n.getRenderId());for(var l=0;l<c.subMeshes.length;l++){var h=c.subMeshes[l];n._activeIndices+=h.indexCount,this._renderingManager.dispatch(h)}}}}this.onBeforeRender&&this.onBeforeRender(),this.onClear?this.onClear(i):i.clear(n.clearColor,!0,!0),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0),this._renderingManager.render(this.customRenderFunction,a,this.renderParticles,this.renderSprites),t&&n.postProcessManager._finalizeFrame(!1,this._texture),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0),this.onAfterRender&&this.onAfterRender(),r&&e.Tools.DumpFramebuffer(this._size,this._size,i),i.unBindFramebuffer(this._texture),this.onAfterUnbind&&this.onAfterUnbind()}},r.prototype.clone=function(){var e=this.getSize(),t=new r(this.name,e.width,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t.renderList=this.renderList.slice(0),t},r}(e.Texture);e.RenderTargetTexture=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r,n,i,o,s){void 0===s&&(s=!0),e.call(this,null,i,!s),this.isEnabled=!0,this._currentRefreshId=-1,this._refreshRate=1,this._vertexDeclaration=[2],this._vertexStrideSize=8,this._uniforms=new Array,this._samplers=new Array,this._textures=new Array,this._floats=new Array,this._floatsArrays={},this._colors3=new Array,this._colors4=new Array,this._vectors2=new Array,this._vectors3=new Array,this._matrices=new Array,this._fallbackTextureUsed=!1,i._proceduralTextures.push(this),this.name=t,this.isRenderTarget=!0,this._size=r,this._generateMipMaps=s,this.setFragment(n),this._fallbackTexture=o,this._texture=i.getEngine().createRenderTargetTexture(r,s);var a=[];a.push(1,1),a.push(-1,1),a.push(-1,-1),a.push(1,-1),this._vertexBuffer=i.getEngine().createVertexBuffer(a);var u=[];u.push(0),u.push(1),u.push(2),u.push(0),u.push(2),u.push(3),this._indexBuffer=i.getEngine().createIndexBuffer(u)}return n(t,e),t.prototype.reset=function(){if(void 0!==this._effect){var e=this.getScene().getEngine();e._releaseEffect(this._effect)}},t.prototype.isReady=function(){var e,t=this,r=this.getScene().getEngine();return this._fragment?this._fallbackTextureUsed?!0:(e=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._effect=r.createEffect(e,["position"],this._uniforms,this._samplers,"",null,null,function(){t.releaseInternalTexture(),t._fallbackTexture&&(t._texture=t._fallbackTexture._texture,t._texture.references++),t._fallbackTextureUsed=!0}),this._effect.isReady()):!1},t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},t.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),t.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?this._fallbackTextureUsed?!1:-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1):!1},t.prototype.getRenderSize=function(){return this._size},t.prototype.resize=function(e,t){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(e,t))},t.prototype._checkUniform=function(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)},t.prototype.setTexture=function(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this},t.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},t.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},t.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},t.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},t.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},t.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},t.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},t.prototype.render=function(e){var t=this.getScene(),r=t.getEngine();r.bindFramebuffer(this._texture),r.clear(t.clearColor,!0,!0),r.enableEffect(this._effect),r.setState(!1);for(var n in this._textures)this._effect.setTexture(n,this._textures[n]);for(n in this._floats)this._effect.setFloat(n,this._floats[n]);for(n in this._floatsArrays)this._effect.setArray(n,this._floatsArrays[n]);for(n in this._colors3)this._effect.setColor3(n,this._colors3[n]);for(n in this._colors4){var i=this._colors4[n];this._effect.setFloat4(n,i.r,i.g,i.b,i.a)}for(n in this._vectors2)this._effect.setVector2(n,this._vectors2[n]);for(n in this._vectors3)this._effect.setVector3(n,this._vectors3[n]);for(n in this._matrices)this._effect.setMatrix(n,this._matrices[n]);r.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect),r.draw(!0,0,6),r.unBindFramebuffer(this._texture)},t.prototype.clone=function(){var e=this.getSize(),r=new t(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.coordinatesMode=this.coordinatesMode,r},t.prototype.dispose=function(){var t=this.getScene()._proceduralTextures.indexOf(this);t>=0&&this.getScene()._proceduralTextures.splice(t,1),e.prototype.dispose.call(this)},t}(e.Texture);e.ProceduralTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o){var s=this;t.call(this,r,n,i,o,!0),this.mirrorPlane=new e.Plane(0,1,0,1),this._transformMatrix=e.Matrix.Zero(),this._mirrorMatrix=e.Matrix.Zero(),this.onBeforeRender=function(){e.Matrix.ReflectionToRef(s.mirrorPlane,s._mirrorMatrix),s._savedViewMatrix=i.getViewMatrix(),s._mirrorMatrix.multiplyToRef(s._savedViewMatrix,s._transformMatrix),i.setTransformMatrix(s._transformMatrix,i.getProjectionMatrix()),i.clipPlane=s.mirrorPlane,i.getEngine().cullBackFaces=!1},this.onAfterRender=function(){i.setTransformMatrix(s._savedViewMatrix,i.getProjectionMatrix()),i.getEngine().cullBackFaces=!0,delete i.clipPlane}}return n(r,t),r.prototype.clone=function(){var e=this.getSize(),t=new r(this.name,e.width,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.mirrorPlane=this.mirrorPlane.clone(),t.renderList=this.renderList.slice(0),t},r}(e.RenderTargetTexture);e.MirrorTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,i,!o),this.name=r,this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=o,n.getContext?(this._canvas=n,this._texture=i.getEngine().createDynamicTexture(n.width,n.height,o,s)):(this._canvas=document.createElement("canvas"),this._texture=n.width?i.getEngine().createDynamicTexture(n.width,n.height,o,s):i.getEngine().createDynamicTexture(n,n,o,s));var a=this.getSize();this._canvas.width=a.width,this._canvas.height=a.height,this._context=this._canvas.getContext("2d")}return n(r,t),Object.defineProperty(r.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),r.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._canvas.width=t.width,this._canvas.height=t.height,this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createDynamicTexture(t.width,t.height,this._generateMipMaps,this._samplingMode)},r.prototype.getContext=function(){return this._context},r.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},r.prototype.update=function(e){this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e?!0:e)},r.prototype.drawText=function(e,t,r,n,i,o,s,a){void 0===a&&(a=!0);var u=this.getSize();if(o&&(this._context.fillStyle=o,this._context.fillRect(0,0,u.width,u.height)),this._context.font=n,null===t){var c=this._context.measureText(e);t=(u.width-c.width)/2}this._context.fillStyle=i,this._context.fillText(e,t,r),a&&this.update(s)},r.prototype.clone=function(){var e=this.getSize(),t=new r(this.name,e.width,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t},r}(e.Texture);e.DynamicTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s,a){var u=this;void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===a&&(a=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,i,!o,s),this._autoLaunch=!0,this.name=r,this.video=document.createElement("video"),this.video.autoplay=!1,this.video.loop=!0,this.video.addEventListener("canplaythrough",function(){e.Tools.IsExponantOfTwo(u.video.videoWidth)&&e.Tools.IsExponantOfTwo(u.video.videoHeight)?(u.wrapU=e.Texture.WRAP_ADDRESSMODE,u.wrapV=e.Texture.WRAP_ADDRESSMODE):(u.wrapU=e.Texture.CLAMP_ADDRESSMODE,u.wrapV=e.Texture.CLAMP_ADDRESSMODE,o=!1),u._texture=i.getEngine().createDynamicTexture(u.video.videoWidth,u.video.videoHeight,o,a,!1),u._texture.isReady=!0}),n.forEach(function(e){var t=document.createElement("source");t.src=e,u.video.appendChild(t)}),this._lastUpdate=e.Tools.Now}return n(r,t),r.prototype.update=function(){this._autoLaunch&&(this._autoLaunch=!1,this.video.play());var t=e.Tools.Now;return t-this._lastUpdate<15||this.video.readyState!==this.video.HAVE_ENOUGH_DATA?!1:(this._lastUpdate=t,this.getScene().getEngine().updateVideoTexture(this._texture,this.video,this._invertY),!0)},r}(e.Texture);e.VideoTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function r(e,r,n,i,o,s){t.call(this,e,n,null,i,o,s),this._animate=!0,this._time=0,this._texturePath=r,this.loadJson(r),this.refreshRate=1}return n(r,t),r.prototype.loadJson=function(t){function r(){e.Tools.Log("No config file found in "+t+" trying to use ShadersStore or DOM element");try{i.setFragment(i._texturePath)}catch(r){e.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}}var n=this,i=this,o=t+"/config.json",s=new XMLHttpRequest;s.open("GET",o,!0),s.addEventListener("load",function(){if(200===s.status||e.Tools.ValidateXHRData(s,1))try{n._config=JSON.parse(s.response),n.updateShaderUniforms(),n.updateTextures(),n.setFragment(n._texturePath+"/custom"),n._animate=n._config.animate,n.refreshRate=n._config.refreshrate}catch(t){r()}else r()},!1),s.addEventListener("error",function(){r()},!1);try{s.send()}catch(a){e.Tools.Error("CustomProceduralTexture: Error on XHR send request.")}},r.prototype.isReady=function(){if(!t.prototype.isReady.call(this))return!1;for(var e in this._textures){var r=this._textures[e];if(!r.isReady())return!1}return!0},r.prototype.render=function(e){this._animate&&(this._time+=.03*this.getScene().getAnimationRatio(),this.updateShaderUniforms()),t.prototype.render.call(this,e)},r.prototype.updateTextures=function(){for(var t=0;t<this._config.sampler2Ds.length;t++)this.setTexture(this._config.sampler2Ds[t].sample2Dname,new e.Texture(this._texturePath+"/"+this._config.sampler2Ds[t].textureRelativeUrl,this.getScene()))},r.prototype.updateShaderUniforms=function(){if(this._config)for(var t=0;t<this._config.uniforms.length;t++){var r=this._config.uniforms[t];switch(r.type){case"float":this.setFloat(r.name,r.value);break;case"color3":this.setColor3(r.name,new e.Color3(r.r,r.g,r.b));break;case"color4":this.setColor4(r.name,new e.Color4(r.r,r.g,r.b,r.a));break;case"vector2":this.setVector2(r.name,new e.Vector2(r.x,r.y));break;case"vector3":this.setVector3(r.name,new e.Vector3(r.x,r.y,r.z))}}this.setFloat("time",this._time)},Object.defineProperty(r.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!0,configurable:!0}),r}(e.ProceduralTexture);e.CustomProceduralTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s){t.call(this,r,n,"wood",i,o,s),this._ampScale=100,this._woodColor=new e.Color3(.32,.17,.09),this.updateShaderUniforms(),this.refreshRate=0}return n(r,t),r.prototype.updateShaderUniforms=function(){this.setFloat("ampScale",this._ampScale),this.setColor3("woodColor",this._woodColor)},Object.defineProperty(r.prototype,"ampScale",{get:function(){return this._ampScale},set:function(e){this._ampScale=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"woodColor",{get:function(){return this._woodColor},set:function(e){this._woodColor=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),r}(e.ProceduralTexture);e.WoodProceduralTexture=t;var r=function(t){function r(n,i,o,s,a){t.call(this,n,i,"fire",o,s,a),this._time=0,this._speed=new e.Vector2(.5,.3),this._autoGenerateTime=!0,this._alphaThreshold=.5,this._fireColors=r.RedFireColors,this.updateShaderUniforms(),this.refreshRate=1}return n(r,t),r.prototype.updateShaderUniforms=function(){this.setFloat("time",this._time),this.setVector2("speed",this._speed),this.setColor3("c1",this._fireColors[0]),this.setColor3("c2",this._fireColors[1]),this.setColor3("c3",this._fireColors[2]),this.setColor3("c4",this._fireColors[3]),this.setColor3("c5",this._fireColors[4]),this.setColor3("c6",this._fireColors[5]),this.setFloat("alphaThreshold",this._alphaThreshold)},r.prototype.render=function(e){this._autoGenerateTime&&(this._time+=.03*this.getScene().getAnimationRatio(),this.updateShaderUniforms()),t.prototype.render.call(this,e)},Object.defineProperty(r,"PurpleFireColors",{get:function(){return[new e.Color3(.5,0,1),new e.Color3(.9,0,1),new e.Color3(.2,0,1),new e.Color3(1,.9,1),new e.Color3(.1,.1,1),new e.Color3(.9,.9,1)]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"GreenFireColors",{get:function(){return[new e.Color3(.5,1,0),new e.Color3(.5,1,0),new e.Color3(.3,.4,0),new e.Color3(.5,1,0),new e.Color3(.2,0,0),new e.Color3(.5,1,0)]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"RedFireColors",{get:function(){return[new e.Color3(.5,0,.1),new e.Color3(.9,0,0),new e.Color3(.2,0,0),new e.Color3(1,.9,0),new e.Color3(.1,.1,.1),new e.Color3(.9,.9,.9)]},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BlueFireColors",{get:function(){return[new e.Color3(.1,0,.5),new e.Color3(0,0,.5),new e.Color3(.1,0,.2),new e.Color3(0,0,1),new e.Color3(.1,.2,.3),new e.Color3(0,.2,.9)]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fireColors",{get:function(){return this._fireColors},set:function(e){this._fireColors=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"time",{get:function(){return this._time},set:function(e){this._time=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"alphaThreshold",{get:function(){return this._alphaThreshold},set:function(e){this._alphaThreshold=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),r}(e.ProceduralTexture);e.FireProceduralTexture=r;var i=function(t){function r(r,n,i,o,s){t.call(this,r,n,"cloud",i,o,s),this._skyColor=new e.Color4(.15,.68,1,1),this._cloudColor=new e.Color4(1,1,1,1),this.updateShaderUniforms(),this.refreshRate=0}return n(r,t),r.prototype.updateShaderUniforms=function(){this.setColor4("skyColor",this._skyColor),this.setColor4("cloudColor",this._cloudColor)},Object.defineProperty(r.prototype,"skyColor",{get:function(){return this._skyColor},set:function(e){this._skyColor=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cloudColor",{get:function(){return this._cloudColor},set:function(e){this._cloudColor=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),r}(e.ProceduralTexture);e.CloudProceduralTexture=i;var o=function(t){function r(r,n,i,o,s){t.call(this,r,n,"grass",i,o,s),this._herb1=new e.Color3(.29,.38,.02),this._herb2=new e.Color3(.36,.49,.09),this._herb3=new e.Color3(.51,.6,.28),this._groundColor=new e.Color3(1,1,1),this._grassColors=[new e.Color3(.29,.38,.02),new e.Color3(.36,.49,.09),new e.Color3(.51,.6,.28)],this.updateShaderUniforms(),this.refreshRate=0}return n(r,t),r.prototype.updateShaderUniforms=function(){this.setColor3("herb1Color",this._grassColors[0]),this.setColor3("herb2Color",this._grassColors[1]),this.setColor3("herb3Color",this._grassColors[2]),this.setColor3("groundColor",this._groundColor)},Object.defineProperty(r.prototype,"grassColors",{get:function(){return this._grassColors},set:function(e){this._grassColors=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"groundColor",{get:function(){return this._groundColor},set:function(e){this.groundColor=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),r}(e.ProceduralTexture);e.GrassProceduralTexture=o;var s=function(t){function r(r,n,i,o,s){t.call(this,r,n,"road",i,o,s),this._roadColor=new e.Color3(.53,.53,.53),this.updateShaderUniforms(),this.refreshRate=0}return n(r,t),r.prototype.updateShaderUniforms=function(){this.setColor3("roadColor",this._roadColor)},Object.defineProperty(r.prototype,"roadColor",{get:function(){return this._roadColor},set:function(e){this._roadColor=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),r}(e.ProceduralTexture);e.RoadProceduralTexture=s;var a=function(t){function r(r,n,i,o,s){t.call(this,r,n,"brick",i,o,s),this._numberOfBricksHeight=15,this._numberOfBricksWidth=5,this._jointColor=new e.Color3(.72,.72,.72),this._brickColor=new e.Color3(.77,.47,.4),this.updateShaderUniforms(),this.refreshRate=0}return n(r,t),r.prototype.updateShaderUniforms=function(){this.setFloat("numberOfBricksHeight",this._numberOfBricksHeight),this.setFloat("numberOfBricksWidth",this._numberOfBricksWidth),this.setColor3("brickColor",this._brickColor),this.setColor3("jointColor",this._jointColor)},Object.defineProperty(r.prototype,"numberOfBricksHeight",{get:function(){return this._numberOfBricksHeight},set:function(e){this._numberOfBricksHeight=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"numberOfBricksWidth",{get:function(){return this._numberOfBricksWidth},set:function(e){this._numberOfBricksWidth=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"jointColor",{get:function(){return this._jointColor},set:function(e){this._jointColor=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"brickColor",{get:function(){return this._brickColor},set:function(e){this._brickColor=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),r}(e.ProceduralTexture);e.BrickProceduralTexture=a;var u=function(t){function r(r,n,i,o,s){t.call(this,r,n,"marble",i,o,s),this._numberOfTilesHeight=3,this._numberOfTilesWidth=3,this._amplitude=9,this._marbleColor=new e.Color3(.77,.47,.4),this._jointColor=new e.Color3(.72,.72,.72),this.updateShaderUniforms(),this.refreshRate=0}return n(r,t),r.prototype.updateShaderUniforms=function(){this.setFloat("numberOfTilesHeight",this._numberOfTilesHeight),this.setFloat("numberOfTilesWidth",this._numberOfTilesWidth),this.setFloat("amplitude",this._amplitude),this.setColor3("marbleColor",this._marbleColor),this.setColor3("jointColor",this._jointColor)},Object.defineProperty(r.prototype,"numberOfTilesHeight",{get:function(){return this._numberOfTilesHeight},set:function(e){this._numberOfTilesHeight=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"numberOfTilesWidth",{get:function(){return this._numberOfTilesWidth},set:function(e){this._numberOfTilesWidth=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"jointColor",{get:function(){return this._jointColor},set:function(e){this._jointColor=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marbleColor",{get:function(){return this._marbleColor},set:function(e){this._marbleColor=e,this.updateShaderUniforms()},enumerable:!0,configurable:!0}),r}(e.ProceduralTexture);e.MarbleProceduralTexture=u}(r||(r={}));var r;!function(e){var t=function(){function e(){this._defines={},this._currentRank=32,this._maxRank=-1}return e.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},Object.defineProperty(e.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),e.prototype.reduce=function(e){for(var t=this._defines[this._currentRank],r=0;r<t.length;r++)e=e.replace("#define "+t[r],"");return this._currentRank++,e},e}();e.EffectFallbacks=t;var r=function(){function t(e,t,r,n,i,o,s,a,u){var c=this;this._isReady=!1,this._compilationError="",this._valueCache=[],this._engine=i,this.name=e,this.defines=o,this._uniformsNames=r.concat(n),this._samplers=n,this._attributesNames=t,this.onError=u,this.onCompiled=a;var l,h;e.vertexElement?(l=document.getElementById(e.vertexElement),l||(l=e.vertexElement)):l=e.vertex||e,e.fragmentElement?(h=document.getElementById(e.fragmentElement),h||(h=e.fragmentElement)):h=e.fragment||e,this._loadVertexShader(l,function(e){c._loadFragmentShader(h,function(r){c._prepareEffect(e,r,t,o,s)})})}return t.prototype.isReady=function(){return this._isReady},t.prototype.getProgram=function(){return this._program},t.prototype.getAttributesNames=function(){return this._attributesNames},t.prototype.getAttributeLocation=function(e){return this._attributes[e]},t.prototype.getAttributeLocationByName=function(e){var t=this._attributesNames.indexOf(e);return this._attributes[t]},t.prototype.getAttributesCount=function(){return this._attributes.length},t.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},t.prototype.getUniform=function(e){return this._uniforms[this._uniformsNames.indexOf(e)]},t.prototype.getSamplers=function(){return this._samplers},t.prototype.getCompilationError=function(){return this._compilationError},t.prototype._loadVertexShader=function(r,n){if(r instanceof HTMLElement){var i=e.Tools.GetDOMTextContent(r);return void n(i)}if(t.ShadersStore[r+"VertexShader"])return void n(t.ShadersStore[r+"VertexShader"]);var o;o="."===r[0]||"/"===r[0]?r:e.Engine.ShadersRepository+r,e.Tools.LoadFile(o+".vertex.fx",n)},t.prototype._loadFragmentShader=function(r,n){if(r instanceof HTMLElement){
var i=e.Tools.GetDOMTextContent(r);return void n(i)}if(t.ShadersStore[r+"PixelShader"])return void n(t.ShadersStore[r+"PixelShader"]);if(t.ShadersStore[r+"FragmentShader"])return void n(t.ShadersStore[r+"FragmentShader"]);var o;o="."===r[0]||"/"===r[0]?r:e.Engine.ShadersRepository+r,e.Tools.LoadFile(o+".fragment.fx",n)},t.prototype._prepareEffect=function(t,r,n,i,o){try{var s=this._engine;s.getCaps().highPrecisionShaderSupported||(t=t.replace("precision highp float","precision mediump float"),r=r.replace("precision highp float","precision mediump float")),this._program=s.createShaderProgram(t,r,i),this._uniforms=s.getUniforms(this._program,this._uniformsNames),this._attributes=s.getAttributes(this._program,n);for(var a=0;a<this._samplers.length;a++){var u=this.getUniform(this._samplers[a]);null==u&&(this._samplers.splice(a,1),a--)}s.bindSamplers(this),this._isReady=!0,this.onCompiled&&this.onCompiled(this)}catch(c){if(-1!==c.message.indexOf("highp"))return t=t.replace("precision highp float","precision mediump float"),r=r.replace("precision highp float","precision mediump float"),void this._prepareEffect(t,r,n,i,o);o&&o.isMoreFallbacks?(i=o.reduce(i),this._prepareEffect(t,r,n,i,o)):(e.Tools.Error("Unable to compile effect: "),this.name.vertexElement?(e.Tools.Error("Vertex shader:"+this.name.vertexElement),e.Tools.Error("Fragment shader:"+this.name.fragmentElement)):this.name.vertex?(e.Tools.Error("Vertex shader:"+this.name.vertex),e.Tools.Error("Fragment shader:"+this.name.fragment)):(e.Tools.Error("Vertex shader:"+this.name),e.Tools.Error("Fragment shader:"+this.name)),e.Tools.Error("Defines: "+i),e.Tools.Error("Error: "+c.message),this._compilationError=c.message,this.onError&&this.onError(this,this._compilationError))}},t.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers.indexOf(e),t)},t.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers.indexOf(e),t)},t.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers.indexOf(e),t)},t.prototype._cacheFloat2=function(e,t,r){return this._valueCache[e]?(this._valueCache[e][0]=t,void(this._valueCache[e][1]=r)):void(this._valueCache[e]=[t,r])},t.prototype._cacheFloat3=function(e,t,r,n){return this._valueCache[e]?(this._valueCache[e][0]=t,this._valueCache[e][1]=r,void(this._valueCache[e][2]=n)):void(this._valueCache[e]=[t,r,n])},t.prototype._cacheFloat4=function(e,t,r,n,i){return this._valueCache[e]?(this._valueCache[e][0]=t,this._valueCache[e][1]=r,this._valueCache[e][2]=n,void(this._valueCache[e][3]=i)):void(this._valueCache[e]=[t,r,n,i])},t.prototype.setArray=function(e,t){return this._engine.setArray(this.getUniform(e),t),this},t.prototype.setArray2=function(e,t){return this._engine.setArray2(this.getUniform(e),t),this},t.prototype.setArray3=function(e,t){return this._engine.setArray3(this.getUniform(e),t),this},t.prototype.setArray4=function(e,t){return this._engine.setArray4(this.getUniform(e),t),this},t.prototype.setMatrices=function(e,t){return this._engine.setMatrices(this.getUniform(e),t),this},t.prototype.setMatrix=function(e,t){return this._engine.setMatrix(this.getUniform(e),t),this},t.prototype.setMatrix3x3=function(e,t){return this._engine.setMatrix3x3(this.getUniform(e),t),this},t.prototype.setMatrix2x2=function(e,t){return this._engine.setMatrix2x2(this.getUniform(e),t),this},t.prototype.setFloat=function(e,t){return this._valueCache[e]&&this._valueCache[e]===t?this:(this._valueCache[e]=t,this._engine.setFloat(this.getUniform(e),t),this)},t.prototype.setBool=function(e,t){return this._valueCache[e]&&this._valueCache[e]===t?this:(this._valueCache[e]=t,this._engine.setBool(this.getUniform(e),t?1:0),this)},t.prototype.setVector2=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]===t.x&&this._valueCache[e][1]===t.y?this:(this._cacheFloat2(e,t.x,t.y),this._engine.setFloat2(this.getUniform(e),t.x,t.y),this)},t.prototype.setFloat2=function(e,t,r){return this._valueCache[e]&&this._valueCache[e][0]===t&&this._valueCache[e][1]===r?this:(this._cacheFloat2(e,t,r),this._engine.setFloat2(this.getUniform(e),t,r),this)},t.prototype.setVector3=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]===t.x&&this._valueCache[e][1]===t.y&&this._valueCache[e][2]===t.z?this:(this._cacheFloat3(e,t.x,t.y,t.z),this._engine.setFloat3(this.getUniform(e),t.x,t.y,t.z),this)},t.prototype.setFloat3=function(e,t,r,n){return this._valueCache[e]&&this._valueCache[e][0]===t&&this._valueCache[e][1]===r&&this._valueCache[e][2]===n?this:(this._cacheFloat3(e,t,r,n),this._engine.setFloat3(this.getUniform(e),t,r,n),this)},t.prototype.setVector4=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]===t.x&&this._valueCache[e][1]===t.y&&this._valueCache[e][2]===t.z&&this._valueCache[e][3]===t.w?this:(this._cacheFloat4(e,t.x,t.y,t.z,t.w),this._engine.setFloat4(this.getUniform(e),t.x,t.y,t.z,t.w),this)},t.prototype.setFloat4=function(e,t,r,n,i){return this._valueCache[e]&&this._valueCache[e][0]===t&&this._valueCache[e][1]===r&&this._valueCache[e][2]===n&&this._valueCache[e][3]===i?this:(this._cacheFloat4(e,t,r,n,i),this._engine.setFloat4(this.getUniform(e),t,r,n,i),this)},t.prototype.setColor3=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]===t.r&&this._valueCache[e][1]===t.g&&this._valueCache[e][2]===t.b?this:(this._cacheFloat3(e,t.r,t.g,t.b),this._engine.setColor3(this.getUniform(e),t),this)},t.prototype.setColor4=function(e,t,r){return this._valueCache[e]&&this._valueCache[e][0]===t.r&&this._valueCache[e][1]===t.g&&this._valueCache[e][2]===t.b&&this._valueCache[e][3]===r?this:(this._cacheFloat4(e,t.r,t.g,t.b,r),this._engine.setColor4(this.getUniform(e),t,r),this)},t.ShadersStore={},t}();e.Effect=r}(r||(r={}));var r;!function(e){var t=function(){function t(r,n,i){this.name=r,this.checkReadyOnEveryCall=!0,this.checkReadyOnlyOnce=!1,this.state="",this.alpha=1,this.backFaceCulling=!0,this.alphaMode=e.Engine.ALPHA_COMBINE,this.disableDepthWrite=!1,this._wasPreviouslyReady=!1,this._fillMode=t.TriangleFillMode,this.pointSize=1,this.zOffset=0,this.id=r,this._scene=n,i||n.materials.push(this)}return Object.defineProperty(t,"TriangleFillMode",{get:function(){return t._TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WireFrameFillMode",{get:function(){return t._WireFrameFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointFillMode",{get:function(){return t._PointFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wireframe",{get:function(){return this._fillMode===t.WireFrameFillMode},set:function(e){this._fillMode=e?t.WireFrameFillMode:t.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointsCloud",{get:function(){return this._fillMode===t.PointFillMode},set:function(e){this._fillMode=e?t.PointFillMode:t.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillMode",{get:function(){return this._fillMode},set:function(e){this._fillMode=e},enumerable:!0,configurable:!0}),t.prototype.isReady=function(e,t){return!0},t.prototype.getEffect=function(){return this._effect},t.prototype.getScene=function(){return this._scene},t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.trackCreation=function(e,t){},t.prototype._preBind=function(){var e=this._scene.getEngine();e.enableEffect(this._effect),e.setState(this.backFaceCulling,this.zOffset)},t.prototype.bind=function(e,t){if(this._scene._cachedMaterial=this,this.onBind&&this.onBind(this,t),this.disableDepthWrite){var r=this._scene.getEngine();this._cachedDepthWriteState=r.getDepthWrite(),r.setDepthWrite(!1)}},t.prototype.bindOnlyWorldMatrix=function(e){},t.prototype.unbind=function(){if(this.disableDepthWrite){var e=this._scene.getEngine();e.setDepthWrite(this._cachedDepthWriteState)}},t.prototype.clone=function(e){return null},t.prototype.dispose=function(e){var t=this._scene.materials.indexOf(this);this._scene.materials.splice(t,1),e&&this._effect&&(this._scene.getEngine()._releaseEffect(this._effect),this._effect=null),this.onDispose&&this.onDispose()},t._TriangleFillMode=0,t._WireFrameFillMode=1,t._PointFillMode=2,t}();e.Material=t}(r||(r={}));var r;!function(e){var t=4,r=function(){function t(){this.isEnabled=!0,this.leftColor=e.Color3.White(),this.rightColor=e.Color3.Black(),this.bias=0,this.power=1}return t}();e.FresnelParameters=r;var i=function(){function e(){this.DIFFUSE=!1,this.AMBIENT=!1,this.OPACITY=!1,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.SPECULAR=!1,this.BUMP=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.ALPHATEST=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.LIGHT0=!1,this.LIGHT1=!1,this.LIGHT2=!1,this.LIGHT3=!1,this.SPOTLIGHT0=!1,this.SPOTLIGHT1=!1,this.SPOTLIGHT2=!1,this.SPOTLIGHT3=!1,this.HEMILIGHT0=!1,this.HEMILIGHT1=!1,this.HEMILIGHT2=!1,this.HEMILIGHT3=!1,this.POINTDIRLIGHT0=!1,this.POINTDIRLIGHT1=!1,this.POINTDIRLIGHT2=!1,this.POINTDIRLIGHT3=!1,this.SPECULARTERM=!1,this.SHADOW0=!1,this.SHADOW1=!1,this.SHADOW2=!1,this.SHADOW3=!1,this.SHADOWS=!1,this.SHADOWVSM0=!1,this.SHADOWVSM1=!1,this.SHADOWVSM2=!1,this.SHADOWVSM3=!1,this.SHADOWPCF0=!1,this.SHADOWPCF1=!1,this.SHADOWPCF2=!1,this.SHADOWPCF3=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.BONES=!1,this.BONES4=!1,this.BonesPerMesh=0,this.INSTANCES=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this._keys=Object.keys(this)}return e.prototype.isEqual=function(e){for(var t=0;t<this._keys.length;t++){var r=this._keys[t];if(this[r]!==e[r])return!1}return!0},e.prototype.cloneTo=function(e){for(var t=0;t<this._keys.length;t++){var r=this._keys[t];e[r]=this[r]}},e.prototype.reset=function(){for(var e=0;e<this._keys.length;e++){var t=this._keys[e];this[t]="BonesPerMesh"!==t?!1:0}},e.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var r=this._keys[t];"BonesPerMesh"===r&&this[r]>0?e+="#define BonesPerMesh "+this[r]+"\n":this[r]&&(e+="#define "+r+"\n")}return e},e}(),o=function(r){function o(t,n){var o=this;r.call(this,t,n),this.ambientColor=new e.Color3(0,0,0),this.diffuseColor=new e.Color3(1,1,1),this.specularColor=new e.Color3(1,1,1),this.specularPower=64,this.emissiveColor=new e.Color3(0,0,0),this.useAlphaFromDiffuseTexture=!1,this.useEmissiveAsIllumination=!1,this.useReflectionFresnelFromSpecular=!1,this.useSpecularOverAlpha=!0,this.fogEnabled=!0,this.roughness=0,this.useGlossinessFromSpecularMapAlpha=!1,this._renderTargets=new e.SmartArray(16),this._worldViewProjectionMatrix=e.Matrix.Zero(),this._globalAmbientColor=new e.Color3(0,0,0),this._scaledDiffuse=new e.Color3,this._scaledSpecular=new e.Color3,this._defines=new i,this._cachedDefines=new i,this._cachedDefines.BonesPerMesh=-1,this.getRenderTargetTextures=function(){return o._renderTargets.reset(),o.reflectionTexture&&o.reflectionTexture.isRenderTarget&&o._renderTargets.push(o.reflectionTexture),o._renderTargets}}return n(o,r),o.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this.opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},o.prototype.needAlphaTesting=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha},o.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha&&this.useAlphaFromDiffuseTexture},o.prototype.getAlphaTestTexture=function(){return this.diffuseTexture},o.prototype.isReady=function(r,n){if(this.checkReadyOnlyOnce&&this._wasPreviouslyReady)return!0;var i=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===i.getRenderId())return!0;var s=i.getEngine(),a=!1,u=!1;if(this._defines.reset(),i.texturesEnabled){if(this.diffuseTexture&&o.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;u=!0,this._defines.DIFFUSE=!0}if(this.ambientTexture&&o.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;u=!0,this._defines.AMBIENT=!0}if(this.opacityTexture&&o.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;u=!0,this._defines.OPACITY=!0,this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=!0)}if(this.reflectionTexture&&o.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;a=!0,u=!0,this._defines.REFLECTION=!0,this.roughness>0&&(this._defines.ROUGHNESS=!0)}if(this.emissiveTexture&&o.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;u=!0,this._defines.EMISSIVE=!0}if(this.specularTexture&&o.SpecularTextureEnabled){if(!this.specularTexture.isReady())return!1;u=!0,this._defines.SPECULAR=!0,this._defines.GLOSSINESS=this.useGlossinessFromSpecularMapAlpha}}if(i.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&o.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;u=!0,this._defines.BUMP=!0}i.clipPlane&&(this._defines.CLIPPLANE=!0),s.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromDiffuseTexture()&&(this._defines.ALPHAFROMDIFFUSE=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.useReflectionFresnelFromSpecular&&(this._defines.REFLECTIONFRESNELFROMSPECULAR=!0),(this.pointsCloud||i.forcePointsCloud)&&(this._defines.POINTSIZE=!0),i.fogEnabled&&r&&r.applyFog&&i.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0);var c=0;if(i.lightsEnabled)for(var l=0;l<i.lights.length;l++){var h=i.lights[l];if(h.isEnabled()){if(h._excludedMeshesIds.length>0){for(var f=0;f<h._excludedMeshesIds.length;f++){var d=i.getMeshByID(h._excludedMeshesIds[f]);d&&h.excludedMeshes.push(d)}h._excludedMeshesIds=[]}if(h._includedOnlyMeshesIds.length>0){for(var p=0;p<h._includedOnlyMeshesIds.length;p++){var m=i.getMeshByID(h._includedOnlyMeshesIds[p]);m&&h.includedOnlyMeshes.push(m)}h._includedOnlyMeshesIds=[]}if(h.canAffectMesh(r)){a=!0,this._defines["LIGHT"+c]=!0;var g;if(g=h instanceof e.SpotLight?"SPOTLIGHT"+c:h instanceof e.HemisphericLight?"HEMILIGHT"+c:"POINTDIRLIGHT"+c,this._defines[g]=!0,h.specular.equalsFloats(0,0,0)||(this._defines.SPECULARTERM=!0),i.shadowsEnabled){var v=h.getShadowGenerator();r&&r.receiveShadows&&v&&(this._defines["SHADOW"+c]=!0,this._defines.SHADOWS=!0,(v.useVarianceShadowMap||v.useBlurVarianceShadowMap)&&(this._defines["SHADOWVSM"+c]=!0),v.usePoissonSampling&&(this._defines["SHADOWPCF"+c]=!0))}if(c++,c===t)break}}}if(o.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled||this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled)&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._defines.DIFFUSEFRESNEL=!0),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._defines.REFLECTIONFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),a=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),r&&(a&&r.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),u&&(r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(this._defines.UV1=!0),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),r.useVertexColors&&r.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,r.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),r.useBones&&r.computeBonesUsingShaders&&(this._defines.BONES=!0,this._defines.BonesPerMesh=r.skeleton.bones.length+1,this._defines.BONES4=!0),n&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines),i.resetCachedMaterial();var _=new e.EffectFallbacks;this._defines.REFLECTION&&_.addFallback(0,"REFLECTION"),this._defines.SPECULAR&&_.addFallback(0,"SPECULAR"),this._defines.BUMP&&_.addFallback(0,"BUMP"),this._defines.SPECULAROVERALPHA&&_.addFallback(0,"SPECULAROVERALPHA"),this._defines.FOG&&_.addFallback(1,"FOG");for(var c=0;t>c;c++)this._defines["LIGHT"+c]&&(c>0&&_.addFallback(c,"LIGHT"+c),this._defines["SHADOW"+c]&&_.addFallback(0,"SHADOW"+c),this._defines["SHADOWPCF"+c]&&_.addFallback(0,"SHADOWPCF"+c),this._defines["SHADOWVSM"+c]&&_.addFallback(0,"SHADOWVSM"+c));this._defines.SPECULARTERM&&_.addFallback(0,"SPECULARTERM"),this._defines.DIFFUSEFRESNEL&&_.addFallback(1,"DIFFUSEFRESNEL"),this._defines.OPACITYFRESNEL&&_.addFallback(2,"OPACITYFRESNEL"),this._defines.REFLECTIONFRESNEL&&_.addFallback(3,"REFLECTIONFRESNEL"),this._defines.EMISSIVEFRESNEL&&_.addFallback(4,"EMISSIVEFRESNEL"),this._defines.FRESNEL&&_.addFallback(4,"FRESNEL"),this._defines.BONES4&&_.addFallback(0,"BONES4");var y=[e.VertexBuffer.PositionKind];this._defines.NORMAL&&y.push(e.VertexBuffer.NormalKind),this._defines.UV1&&y.push(e.VertexBuffer.UVKind),this._defines.UV2&&y.push(e.VertexBuffer.UV2Kind),this._defines.VERTEXCOLOR&&y.push(e.VertexBuffer.ColorKind),this._defines.BONES&&(y.push(e.VertexBuffer.MatricesIndicesKind),y.push(e.VertexBuffer.MatricesWeightsKind)),this._defines.INSTANCES&&(y.push("world0"),y.push("world1"),y.push("world2"),y.push("world3"));var x="default";i.getEngine().getCaps().standardDerivatives||(x="legacydefault");var b=this._defines.toString();this._effect=i.getEngine().createEffect(x,y,["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vLightData0","vLightDiffuse0","vLightSpecular0","vLightDirection0","vLightGround0","lightMatrix0","vLightData1","vLightDiffuse1","vLightSpecular1","vLightDirection1","vLightGround1","lightMatrix1","vLightData2","vLightDiffuse2","vLightSpecular2","vLightDirection2","vLightGround2","lightMatrix2","vLightData3","vLightDiffuse3","vLightSpecular3","vLightDirection3","vLightGround3","lightMatrix3","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","mBones","vClipPlane","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","shadowsInfo0","shadowsInfo1","shadowsInfo2","shadowsInfo3","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","roughness"],["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","shadowSampler0","shadowSampler1","shadowSampler2","shadowSampler3"],b,_,this.onCompiled,this.onError)}return this._effect.isReady()?(this._renderId=i.getRenderId(),this._wasPreviouslyReady=!0,!0):!1},o.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null),r.prototype.unbind.call(this)},o.prototype.bindOnlyWorldMatrix=function(e){this._effect.setMatrix("world",e)},o.prototype.bind=function(n,i){var s=this.getScene();if(this.bindOnlyWorldMatrix(n),this._effect.setMatrix("viewProjection",s.getTransformMatrix()),i&&i.useBones&&i.computeBonesUsingShaders&&this._effect.setMatrices("mBones",i.skeleton.getTransformMatrices()),s.getCachedMaterial()!==this){if(o.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._effect.setColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._effect.setColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new e.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._effect.setColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._effect.setColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),this.diffuseTexture&&o.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.ambientTexture&&o.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&o.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&o.ReflectionTextureEnabled&&(this.reflectionTexture.isCube?(this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture),this._defines.ROUGHNESS&&this._effect.setFloat("roughness",this.roughness)):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat3("vReflectionInfos",this.reflectionTexture.coordinatesMode,this.reflectionTexture.level,this.reflectionTexture.isCube?1:0)),this.emissiveTexture&&o.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.specularTexture&&o.SpecularTextureEnabled&&(this._effect.setTexture("specularSampler",this.specularTexture),this._effect.setFloat2("vSpecularInfos",this.specularTexture.coordinatesIndex,this.specularTexture.level),this._effect.setMatrix("specularMatrix",this.specularTexture.getTextureMatrix())),this.bumpTexture&&s.getEngine().getCaps().standardDerivatives&&o.BumpTextureEnabled&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat2("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),s.clipPlane){var a=s.clipPlane;this._effect.setFloat4("vClipPlane",a.normal.x,a.normal.y,a.normal.z,a.d)}this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize),s.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),this._scaledSpecular.r=this.specularColor.r*e.Tools.Clamp(1-this.emissiveColor.r),this._scaledSpecular.g=this.specularColor.g*e.Tools.Clamp(1-this.emissiveColor.g),this._scaledSpecular.b=this.specularColor.b*e.Tools.Clamp(1-this.emissiveColor.b),this._effect.setVector3("vEyePosition",s.activeCamera.position),this._effect.setColor3("vAmbientColor",this._globalAmbientColor),this._defines.SPECULARTERM&&this._effect.setColor4("vSpecularColor",this._scaledSpecular,this.specularPower),this._effect.setColor3("vEmissiveColor",this.emissiveColor)}if(this._scaledDiffuse.r=this.diffuseColor.r*e.Tools.Clamp(1-this.emissiveColor.r),this._scaledDiffuse.g=this.diffuseColor.g*e.Tools.Clamp(1-this.emissiveColor.g),this._scaledDiffuse.b=this.diffuseColor.b*e.Tools.Clamp(1-this.emissiveColor.b),this._effect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*i.visibility),s.lightsEnabled)for(var u=0,c=0;c<s.lights.length;c++){var l=s.lights[c];if(l.isEnabled()&&l.canAffectMesh(i)){if(l instanceof e.PointLight?l.transferToEffect(this._effect,"vLightData"+u):l instanceof e.DirectionalLight?l.transferToEffect(this._effect,"vLightData"+u):l instanceof e.SpotLight?l.transferToEffect(this._effect,"vLightData"+u,"vLightDirection"+u):l instanceof e.HemisphericLight&&l.transferToEffect(this._effect,"vLightData"+u,"vLightGround"+u),l.diffuse.scaleToRef(l.intensity,this._scaledDiffuse),this._effect.setColor4("vLightDiffuse"+u,this._scaledDiffuse,l.range),this._defines.SPECULARTERM&&(l.specular.scaleToRef(l.intensity,this._scaledSpecular),this._effect.setColor3("vLightSpecular"+u,this._scaledSpecular)),s.shadowsEnabled){var h=l.getShadowGenerator();i.receiveShadows&&h&&(this._effect.setMatrix("lightMatrix"+u,h.getTransformMatrix()),this._effect.setTexture("shadowSampler"+u,h.getShadowMapForRendering()),this._effect.setFloat3("shadowsInfo"+u,h.getDarkness(),h.getShadowMap().getSize().width,h.bias))}if(u++,u===t)break}}(s.fogEnabled&&i.applyFog&&s.fogMode!==e.Scene.FOGMODE_NONE||this.reflectionTexture)&&this._effect.setMatrix("view",s.getViewMatrix()),s.fogEnabled&&i.applyFog&&s.fogMode!==e.Scene.FOGMODE_NONE&&(this._effect.setFloat4("vFogInfos",s.fogMode,s.fogStart,s.fogEnd,s.fogDensity),this._effect.setColor3("vFogColor",s.fogColor)),r.prototype.bind.call(this,n,i)},o.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.ambientTexture&&this.ambientTexture.animations&&this.ambientTexture.animations.length>0&&e.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&this.opacityTexture.animations.length>0&&e.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&this.reflectionTexture.animations.length>0&&e.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&this.emissiveTexture.animations.length>0&&e.push(this.emissiveTexture),this.specularTexture&&this.specularTexture.animations&&this.specularTexture.animations.length>0&&e.push(this.specularTexture),this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),e},o.prototype.dispose=function(e){this.diffuseTexture&&this.diffuseTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.specularTexture&&this.specularTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),r.prototype.dispose.call(this,e)},o.prototype.clone=function(e){var t=new o(e,this.getScene());return t.checkReadyOnEveryCall=this.checkReadyOnEveryCall,t.alpha=this.alpha,t.fillMode=this.fillMode,t.backFaceCulling=this.backFaceCulling,this.diffuseTexture&&this.diffuseTexture.clone&&(t.diffuseTexture=this.diffuseTexture.clone()),this.ambientTexture&&this.ambientTexture.clone&&(t.ambientTexture=this.ambientTexture.clone()),this.opacityTexture&&this.opacityTexture.clone&&(t.opacityTexture=this.opacityTexture.clone()),this.reflectionTexture&&this.reflectionTexture.clone&&(t.reflectionTexture=this.reflectionTexture.clone()),this.emissiveTexture&&this.emissiveTexture.clone&&(t.emissiveTexture=this.emissiveTexture.clone()),this.specularTexture&&this.specularTexture.clone&&(t.specularTexture=this.specularTexture.clone()),this.bumpTexture&&this.bumpTexture.clone&&(t.bumpTexture=this.bumpTexture.clone()),t.ambientColor=this.ambientColor.clone(),t.diffuseColor=this.diffuseColor.clone(),t.specularColor=this.specularColor.clone(),t.specularPower=this.specularPower,t.emissiveColor=this.emissiveColor.clone(),t},o.DiffuseTextureEnabled=!0,o.AmbientTextureEnabled=!0,o.OpacityTextureEnabled=!0,o.ReflectionTextureEnabled=!0,o.EmissiveTextureEnabled=!0,o.SpecularTextureEnabled=!0,o.BumpTextureEnabled=!0,o.FresnelEnabled=!0,o}(e.Material);e.StandardMaterial=o}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r){e.call(this,t,r,!0),this.subMaterials=new Array,r.multiMaterials.push(this)}return n(t,e),t.prototype.getSubMaterial=function(e){return 0>e||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},t.prototype.isReady=function(e){for(var t=0;t<this.subMaterials.length;t++){var r=this.subMaterials[t];if(r&&!this.subMaterials[t].isReady(e))return!1}return!0},t.prototype.clone=function(e){for(var r=new t(e,this.getScene()),n=0;n<this.subMaterials.length;n++){var i=this.subMaterials[n];r.subMaterials.push(i)}return r},t}(e.Material);e.MultiMaterial=t}(r||(r={}));var r;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"ForceFullSceneLoadingForIncremental",{get:function(){return t._ForceFullSceneLoadingForIncremental},set:function(e){t._ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ShowLoadingScreen",{get:function(){return t._ShowLoadingScreen},set:function(e){t._ShowLoadingScreen=e},enumerable:!0,configurable:!0}),t._getPluginForFilename=function(e){var t=e.lastIndexOf("."),r=e.indexOf("?");-1===r&&(r=e.length);for(var n=e.substring(t,r).toLowerCase(),i=0;i<this._registeredPlugins.length;i++){var o=this._registeredPlugins[i];if(-1!==o.extensions.indexOf(n))return o}return this._registeredPlugins[this._registeredPlugins.length-1]},t.RegisterPlugin=function(e){e.extensions=e.extensions.toLowerCase(),t._registeredPlugins.push(e)},t.ImportMesh=function(r,n,i,o,s,a,u){if(i.substr&&"/"===i.substr(0,1))return void e.Tools.Error("Wrong sceneFilename parameter");var c={};o._addPendingData(c);var l=function(l){o.database=h;var f=t._getPluginForFilename(i),d=function(e){var t=[],a=[],l=[];try{if(!f.importMesh(r,o,e,n,t,a,l))return u&&u(o,"Unable to import meshes from "+n+i),void o._removePendingData(c)}catch(h){return u&&u(o,"Unable to import meshes from "+n+i+" (Exception: "+h+")"),void o._removePendingData(c)}s&&(o.importedMeshesFiles.push(n+i),s(t,a,l),o._removePendingData(c))};return i.substr&&"data:"===i.substr(0,5)?void d(i.substr(5)):void e.Tools.LoadFile(n+i,function(e){d(e)},a,h)};if(o.getEngine().enableOfflineSupport)var h=new e.Database(n+i,l);else l(!0)},t.Load=function(r,n,i,o,s,a){t.Append(r,n,new e.Scene(i),o,s,a)},t.Append=function(r,n,i,o,s,a){if(n.substr&&"/"===n.substr(0,1))return void e.Tools.Error("Wrong sceneFilename parameter");var u,c=this._getPluginForFilename(n.name||n),l={};i._addPendingData(l),t.ShowLoadingScreen&&i.getEngine().displayLoadingUI();var h=function(e){return i.database=u,c.load(i,e,r)?(o&&o(i),i._removePendingData(l),void(t.ShowLoadingScreen&&i.executeWhenReady(function(){i.getEngine().hideLoadingUI()}))):(a&&a(i),i._removePendingData(l),void i.getEngine().hideLoadingUI())},f=function(t){e.Tools.LoadFile(r+n,h,s,u)};return n.substr&&"data:"===n.substr(0,5)?void h(n.substr(5)):void(-1===r.indexOf("file:")?i.getEngine().enableOfflineSupport?u=new e.Database(r+n,f):f(!0):e.Tools.ReadFile(n,h,s))},t._ForceFullSceneLoadingForIncremental=!1,t._ShowLoadingScreen=!0,t._registeredPlugins=new Array,t}();e.SceneLoader=t}(r||(r={}));var r;!function(e){var t;!function(t){var r=function(e,t){if(e.length===3*t){for(var r=[],n=0;n<e.length;n+=3){var i=n/3*4;r[i]=e[n],r[i+1]=e[n+1],r[i+2]=e[n+2],r[i+3]=1}return r}return e},n=function(t,r,n){var i=null;return!r.name&&!r.extensions||r.isRenderTarget||(i=new e.CubeTexture(t+r.name,n,r.extensions),
i.name=r.name,i.hasAlpha=r.hasAlpha,i.level=r.level,i.coordinatesMode=r.coordinatesMode),i},i=function(t,r,i){if(r.isCube)return n(t,r,i);if(!r.name&&!r.isRenderTarget)return null;var o;if(r.mirrorPlane?(o=new e.MirrorTexture(r.name,r.renderTargetSize,i),o._waitingRenderList=r.renderList,o.mirrorPlane=e.Plane.FromArray(r.mirrorPlane)):r.isRenderTarget?(o=new e.RenderTargetTexture(r.name,r.renderTargetSize,i),o._waitingRenderList=r.renderList):o=r.base64String?e.Texture.CreateFromBase64String(r.base64String,r.name,i):new e.Texture(t+r.name,i),o.name=r.name,o.hasAlpha=r.hasAlpha,o.getAlphaFromRGB=r.getAlphaFromRGB,o.level=r.level,o.coordinatesIndex=r.coordinatesIndex,o.coordinatesMode=r.coordinatesMode,o.uOffset=r.uOffset,o.vOffset=r.vOffset,o.uScale=r.uScale,o.vScale=r.vScale,o.uAng=r.uAng,o.vAng=r.vAng,o.wAng=r.wAng,o.wrapU=r.wrapU,o.wrapV=r.wrapV,r.animations)for(var s=0;s<r.animations.length;s++){var a=r.animations[s];o.animations.push(d(a))}return o},o=function(t,r){for(var n=new e.Skeleton(t.name,t.id,r),i=0;i<t.bones.length;i++){var o=t.bones[i],s=null;o.parentBoneIndex>-1&&(s=n.bones[o.parentBoneIndex]);var a=new e.Bone(o.name,n,s,e.Matrix.FromArray(o.matrix));o.animation&&a.animations.push(d(o.animation))}return n},s=function(t){var r=new e.FresnelParameters;return r.isEnabled=t.isEnabled,r.leftColor=e.Color3.FromArray(t.leftColor),r.rightColor=e.Color3.FromArray(t.rightColor),r.bias=t.bias,r.power=t.power||1,r},a=function(t,r,n){var o;return o=new e.StandardMaterial(t.name,r),o.ambientColor=e.Color3.FromArray(t.ambient),o.diffuseColor=e.Color3.FromArray(t.diffuse),o.specularColor=e.Color3.FromArray(t.specular),o.specularPower=t.specularPower,o.emissiveColor=e.Color3.FromArray(t.emissive),o.useReflectionFresnelFromSpecular=t.useReflectionFresnelFromSpecular,o.useEmissiveAsIllumination=t.useEmissiveAsIllumination,o.alpha=t.alpha,o.id=t.id,t.disableDepthWrite&&(o.disableDepthWrite=t.disableDepthWrite),e.Tags.AddTagsTo(o,t.tags),o.backFaceCulling=t.backFaceCulling,o.wireframe=t.wireframe,t.diffuseTexture&&(o.diffuseTexture=i(n,t.diffuseTexture,r)),t.diffuseFresnelParameters&&(o.diffuseFresnelParameters=s(t.diffuseFresnelParameters)),t.ambientTexture&&(o.ambientTexture=i(n,t.ambientTexture,r)),t.opacityTexture&&(o.opacityTexture=i(n,t.opacityTexture,r)),t.opacityFresnelParameters&&(o.opacityFresnelParameters=s(t.opacityFresnelParameters)),t.reflectionTexture&&(o.reflectionTexture=i(n,t.reflectionTexture,r)),t.reflectionFresnelParameters&&(o.reflectionFresnelParameters=s(t.reflectionFresnelParameters)),t.emissiveTexture&&(o.emissiveTexture=i(n,t.emissiveTexture,r)),t.emissiveFresnelParameters&&(o.emissiveFresnelParameters=s(t.emissiveFresnelParameters)),t.specularTexture&&(o.specularTexture=i(n,t.specularTexture,r)),t.bumpTexture&&(o.bumpTexture=i(n,t.bumpTexture,r)),t.checkReadyOnlyOnce&&(o.checkReadyOnlyOnce=t.checkReadyOnlyOnce),o},u=function(e,t,r,n){for(var i=0;i<t.materials.length;i++){var o=t.materials[i];if(o.id===e)return a(o,r,n)}return null},c=function(t,r){var n=new e.MultiMaterial(t.name,r);n.id=t.id,e.Tags.AddTagsTo(n,t.tags);for(var i=0;i<t.materials.length;i++){var o=t.materials[i];n.subMaterials.push(o?r.getMaterialByID(o):null)}return n},l=function(t,r,n){var i=r.getLastEntryByID(t.emitterId),o=new e.LensFlareSystem("lensFlareSystem#"+t.emitterId,i,r);o.borderLimit=t.borderLimit;for(var s=0;s<t.flares.length;s++){var a=t.flares[s];new e.LensFlare(a.size,a.position,e.Color3.FromArray(a.color),n+a.textureName,o)}return o},h=function(t,r,n){var i=r.getLastMeshByID(t.emitterId),o=new e.ParticleSystem("particles#"+i.name,t.capacity,r);return t.textureName&&(o.particleTexture=new e.Texture(n+t.textureName,r),o.particleTexture.name=t.textureName),o.minAngularSpeed=t.minAngularSpeed,o.maxAngularSpeed=t.maxAngularSpeed,o.minSize=t.minSize,o.maxSize=t.maxSize,o.minLifeTime=t.minLifeTime,o.maxLifeTime=t.maxLifeTime,o.emitter=i,o.emitRate=t.emitRate,o.minEmitBox=e.Vector3.FromArray(t.minEmitBox),o.maxEmitBox=e.Vector3.FromArray(t.maxEmitBox),o.gravity=e.Vector3.FromArray(t.gravity),o.direction1=e.Vector3.FromArray(t.direction1),o.direction2=e.Vector3.FromArray(t.direction2),o.color1=e.Color4.FromArray(t.color1),o.color2=e.Color4.FromArray(t.color2),o.colorDead=e.Color4.FromArray(t.colorDead),o.updateSpeed=t.updateSpeed,o.targetStopDuration=t.targetStopFrame,o.textureMask=e.Color4.FromArray(t.textureMask),o.blendMode=t.blendMode,o.start(),o},f=function(t,r){for(var n=r.getLightByID(t.lightId),i=new e.ShadowGenerator(t.mapSize,n),o=0;o<t.renderList.length;o++){var s=r.getMeshByID(t.renderList[o]);i.getShadowMap().renderList.push(s)}return t.usePoissonSampling?i.usePoissonSampling=!0:t.useVarianceShadowMap?i.useVarianceShadowMap=!0:t.useBlurVarianceShadowMap&&(i.useBlurVarianceShadowMap=!0,t.blurScale&&(i.blurScale=t.blurScale),t.blurBoxOffset&&(i.blurBoxOffset=t.blurBoxOffset)),void 0!==t.bias&&(i.bias=t.bias),i},d=function(t){for(var r=new e.Animation(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),n=t.dataType,i=[],o=0;o<t.keys.length;o++){var s,a=t.keys[o];switch(n){case e.Animation.ANIMATIONTYPE_FLOAT:s=a.values[0];break;case e.Animation.ANIMATIONTYPE_QUATERNION:s=e.Quaternion.FromArray(a.values);break;case e.Animation.ANIMATIONTYPE_MATRIX:s=e.Matrix.FromArray(a.values);break;case e.Animation.ANIMATIONTYPE_VECTOR3:default:s=e.Vector3.FromArray(a.values)}i.push({frame:a.frame,value:s})}return r.setKeys(i),r},p=function(t,r){var n;switch(t.type){case 0:n=new e.PointLight(t.name,e.Vector3.FromArray(t.position),r);break;case 1:n=new e.DirectionalLight(t.name,e.Vector3.FromArray(t.direction),r),n.position=e.Vector3.FromArray(t.position);break;case 2:n=new e.SpotLight(t.name,e.Vector3.FromArray(t.position),e.Vector3.FromArray(t.direction),t.angle,t.exponent,r);break;case 3:n=new e.HemisphericLight(t.name,e.Vector3.FromArray(t.direction),r),n.groundColor=e.Color3.FromArray(t.groundColor)}if(n.id=t.id,e.Tags.AddTagsTo(n,t.tags),void 0!==t.intensity&&(n.intensity=t.intensity),t.range&&(n.range=t.range),n.diffuse=e.Color3.FromArray(t.diffuse),n.specular=e.Color3.FromArray(t.specular),t.excludedMeshesIds&&(n._excludedMeshesIds=t.excludedMeshesIds),t.parentId&&(n._waitingParentId=t.parentId),t.includedOnlyMeshesIds&&(n._includedOnlyMeshesIds=t.includedOnlyMeshesIds),t.animations)for(var i=0;i<t.animations.length;i++){var o=t.animations[i];n.animations.push(d(o))}t.autoAnimate&&r.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,1)},m=function(t,r){var n,i=e.Vector3.FromArray(t.position),o=t.lockedTargetId?r.getLastMeshByID(t.lockedTargetId):null;if("AnaglyphArcRotateCamera"===t.type||"ArcRotateCamera"===t.type){var s=t.alpha,a=t.beta,u=t.radius;if("AnaglyphArcRotateCamera"===t.type){var c=t.interaxial_distance;n=new e.AnaglyphArcRotateCamera(t.name,s,a,u,o,c,r)}else n=new e.ArcRotateCamera(t.name,s,a,u,o,r)}else"AnaglyphFreeCamera"===t.type?(c=t.interaxial_distance,n=new e.AnaglyphFreeCamera(t.name,i,c,r)):"DeviceOrientationCamera"===t.type?n=new e.DeviceOrientationCamera(t.name,i,r):"FollowCamera"===t.type?(n=new e.FollowCamera(t.name,i,r),n.heightOffset=t.heightOffset,n.radius=t.radius,n.rotationOffset=t.rotationOffset,o&&(n.target=o)):n="GamepadCamera"===t.type?new e.GamepadCamera(t.name,i,r):"TouchCamera"===t.type?new e.TouchCamera(t.name,i,r):"VirtualJoysticksCamera"===t.type?new e.VirtualJoysticksCamera(t.name,i,r):"WebVRFreeCamera"===t.type?new e.WebVRFreeCamera(t.name,i,r):"VRDeviceOrientationFreeCamera"===t.type?new e.VRDeviceOrientationFreeCamera(t.name,i,r):new e.FreeCamera(t.name,i,r);if(t.cameraRigMode){var l=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};n.setCameraRigMode(t.cameraRigMode,l)}if(o&&n instanceof e.FreeCamera&&(n.lockedTarget=o),n.id=t.id,e.Tags.AddTagsTo(n,t.tags),t.parentId&&(n._waitingParentId=t.parentId),t.target?n.setTarget?n.setTarget(e.Vector3.FromArray(t.target)):n.target=e.Vector3.FromArray(t.target):n.rotation=e.Vector3.FromArray(t.rotation),n.fov=t.fov,n.minZ=t.minZ,n.maxZ=t.maxZ,n.speed=t.speed,n.inertia=t.inertia,n.checkCollisions=t.checkCollisions,n.applyGravity=t.applyGravity,t.ellipsoid&&(n.ellipsoid=e.Vector3.FromArray(t.ellipsoid)),t.animations)for(var h=0;h<t.animations.length;h++){var f=t.animations[h];n.animations.push(d(f))}return t.autoAnimate&&r.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,1),n.layerMask=t.layerMask&&!isNaN(t.layerMask)?Math.abs(parseInt(t.layerMask)):268435455,n},g=function(e,t){var r=e.id;return t.getGeometryByID(r)},v=function(t,r){if(g(t,r))return null;var n=new e.Geometry.Primitives.Box(t.id,r,t.size,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},_=function(t,r){if(g(t,r))return null;var n=new e.Geometry.Primitives.Sphere(t.id,r,t.segments,t.diameter,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},y=function(t,r){if(g(t,r))return null;var n=new e.Geometry.Primitives.Cylinder(t.id,r,t.height,t.diameterTop,t.diameterBottom,t.tessellation,t.subdivisions,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},x=function(t,r){if(g(t,r))return null;var n=new e.Geometry.Primitives.Torus(t.id,r,t.diameter,t.thickness,t.tessellation,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},b=function(t,r){if(g(t,r))return null;var n=new e.Geometry.Primitives.Ground(t.id,r,t.width,t.height,t.subdivisions,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},S=function(t,r){if(g(t,r))return null;var n=new e.Geometry.Primitives.Plane(t.id,r,t.size,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},E=function(t,r){if(g(t,r))return null;var n=new e.Geometry.Primitives.TorusKnot(t.id,r,t.radius,t.tube,t.radialSegments,t.tubularSegments,t.p,t.q,t.canBeRegenerated,null);return e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},M=function(t,r,n){if(g(t,r))return null;var i=new e.Geometry(t.id,r);return e.Tags.AddTagsTo(i,t.tags),t.delayLoadingFile?(i.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,i.delayLoadingFile=n+t.delayLoadingFile,i._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum),e.Vector3.FromArray(t.boundingBoxMaximum)),i._delayInfo=[],t.hasUVs&&i._delayInfo.push(e.VertexBuffer.UVKind),t.hasUVs2&&i._delayInfo.push(e.VertexBuffer.UV2Kind),t.hasUVs3&&i._delayInfo.push(e.VertexBuffer.UV3Kind),t.hasUVs4&&i._delayInfo.push(e.VertexBuffer.UV4Kind),t.hasUVs5&&i._delayInfo.push(e.VertexBuffer.UV5Kind),t.hasUVs6&&i._delayInfo.push(e.VertexBuffer.UV6Kind),t.hasColors&&i._delayInfo.push(e.VertexBuffer.ColorKind),t.hasMatricesIndices&&i._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&i._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),i._delayLoadingFunction=A):A(t,i),r.pushGeometry(i,!0),i},T=function(t,r,n){var i=new e.Mesh(t.name,r);if(i.id=t.id,e.Tags.AddTagsTo(i,t.tags),i.position=e.Vector3.FromArray(t.position),t.rotationQuaternion?i.rotationQuaternion=e.Quaternion.FromArray(t.rotationQuaternion):t.rotation&&(i.rotation=e.Vector3.FromArray(t.rotation)),i.scaling=e.Vector3.FromArray(t.scaling),t.localMatrix?i.setPivotMatrix(e.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&i.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),i.setEnabled(t.isEnabled),i.isVisible=t.isVisible,i.infiniteDistance=t.infiniteDistance,i.showBoundingBox=t.showBoundingBox,i.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.applyFog&&(i.applyFog=t.applyFog),void 0!==t.pickable&&(i.isPickable=t.pickable),void 0!==t.alphaIndex&&(i.alphaIndex=t.alphaIndex),i.receiveShadows=t.receiveShadows,i.billboardMode=t.billboardMode,void 0!==t.visibility&&(i.visibility=t.visibility),i.checkCollisions=t.checkCollisions,i._shouldGenerateFlatShading=t.useFlatShading,t.freezeWorldMatrix&&(i._waitingFreezeWorldMatrix=t.freezeWorldMatrix),t.parentId&&(i._waitingParentId=t.parentId),void 0!==t.actions&&(i._waitingActions=t.actions),i.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(i.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,i.delayLoadingFile=n+t.delayLoadingFile,i._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum),e.Vector3.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(i._binaryInfo=t._binaryInfo),i._delayInfo=[],t.hasUVs&&i._delayInfo.push(e.VertexBuffer.UVKind),t.hasUVs2&&i._delayInfo.push(e.VertexBuffer.UV2Kind),t.hasUVs3&&i._delayInfo.push(e.VertexBuffer.UV3Kind),t.hasUVs4&&i._delayInfo.push(e.VertexBuffer.UV4Kind),t.hasUVs5&&i._delayInfo.push(e.VertexBuffer.UV5Kind),t.hasUVs6&&i._delayInfo.push(e.VertexBuffer.UV6Kind),t.hasColors&&i._delayInfo.push(e.VertexBuffer.ColorKind),t.hasMatricesIndices&&i._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&i._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),i._delayLoadingFunction=D,e.SceneLoader.ForceFullSceneLoadingForIncremental&&i._checkDelayState()):D(t,i),t.materialId?i.setMaterialByID(t.materialId):i.material=null,t.skeletonId>-1&&(i.skeleton=r.getLastSkeletonByID(t.skeletonId)),t.physicsImpostor&&(r.isPhysicsEnabled()||r.enablePhysics(),i.setPhysicsState({impostor:t.physicsImpostor,mass:t.physicsMass,friction:t.physicsFriction,restitution:t.physicsRestitution})),t.animations)for(var o=0;o<t.animations.length;o++){var s=t.animations[o];i.animations.push(d(s))}if(t.autoAnimate&&r.beginAnimation(i,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,1),i.layerMask=t.layerMask&&!isNaN(t.layerMask)?Math.abs(parseInt(t.layerMask)):268435455,t.instances)for(var a=0;a<t.instances.length;a++){var u=t.instances[a],c=i.createInstance(u.name);if(e.Tags.AddTagsTo(c,u.tags),c.position=e.Vector3.FromArray(u.position),u.rotationQuaternion?c.rotationQuaternion=e.Quaternion.FromArray(u.rotationQuaternion):u.rotation&&(c.rotation=e.Vector3.FromArray(u.rotation)),c.scaling=e.Vector3.FromArray(u.scaling),c.checkCollisions=i.checkCollisions,t.animations)for(o=0;o<t.animations.length;o++)s=t.animations[o],c.animations.push(d(s))}return i},P=function(t,r,n){var i=new e.ActionManager(n);null===r?n.actionManager=i:r.actionManager=i;for(var o=function(t,r){var n=Object.create(e[t].prototype);return n.constructor.apply(n,r),n},s=function(t,r,n,i){if(null===i){var o=parseFloat(r);return"true"===r||"false"===r?"true"===r:isNaN(o)?r:o}for(var s=i.split("."),a=r.split(","),u=0;u<s.length;u++)n=n[s[u]];if("boolean"==typeof n)return"true"===a[0];if("string"==typeof n)return a[0];for(var c=new Array,u=0;u<a.length;u++)c.push(parseFloat(a[u]));return n instanceof e.Vector3?e.Vector3.FromArray(c):n instanceof e.Vector4?e.Vector4.FromArray(c):n instanceof e.Color3?e.Color3.FromArray(c):n instanceof e.Color4?e.Color4.FromArray(c):parseFloat(a[0])},a=function(t,r,u,c,l){if(void 0===l&&(l=null),!t.detached){var h=new Array,f=null,d=null,p=t.combine&&t.combine.length>0;if(h.push(2===t.type?i:r),p){for(var m=new Array,g=0;g<t.combine.length;g++)a(t.combine[g],e.ActionManager.NothingTrigger,u,c,m);h.push(m)}else for(var v=0;v<t.properties.length;v++){var _=t.properties[v].value,y=t.properties[v].name,x=t.properties[v].targetType;"target"===y?_=f=null!==x&&"SceneProperties"===x?n:n.getNodeByName(_):"parent"===y?_=n.getNodeByName(_):"sound"===y?_=n.getSoundByName(_):"propertyPath"!==y?_=2===t.type&&"operator"===y?e.ValueCondition[_]:s(y,_,f,"value"===y?d:null):d=_,h.push(_)}if(h.push(null===l?u:null),"InterpolateValueAction"===t.name){var b=h[h.length-2];h[h.length-1]=b,h[h.length-2]=u}var S=o(t.name,h);null===l?S instanceof e.Condition?(u=S,S=c):(u=null,c?c.then(S):i.registerAction(S)):l.push(S);for(var v=0;v<t.children.length;v++)a(t.children[v],r,u,S,null)}},u=0;u<t.children.length;u++){var c,l=t.children[u];if(l.properties.length>0){var h=l.properties[0].value,f=null===l.properties[0].targetType?h:n.getMeshByName(h);c={trigger:e.ActionManager[l.name],parameter:f}}else c=e.ActionManager[l.name];for(var d=0;d<l.children.length;d++)l.detached||a(l.children[d],c,null,null)}},C=function(t,r,n){var i=t.name,o=n+i,s={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate},a=new e.Sound(i,o,r,function(){r._removePendingData(a)},s);if(r._addPendingData(a),t.position){var u=e.Vector3.FromArray(t.position);a.setPosition(u)}if(t.isDirectional&&(a.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){var c=e.Vector3.FromArray(t.localDirectionToMesh);a.setLocalDirectionToMesh(c)}if(t.connectedMeshId){var l=r.getMeshByID(t.connectedMeshId);l&&a.attachToMesh(l)}},w=function(e,t,r){t=t instanceof Array?t:[t];for(var n in t)if(e.name===t[n])return r.push(e.id),!0;return e.parentId&&-1!==r.indexOf(e.parentId)?(r.push(e.id),!0):!1},A=function(t,n){var i=new e.VertexData,o=t.positions;o&&i.set(o,e.VertexBuffer.PositionKind);var s=t.normals;s&&i.set(s,e.VertexBuffer.NormalKind);var a=t.uvs;a&&i.set(a,e.VertexBuffer.UVKind);var u=t.uv2s;u&&i.set(u,e.VertexBuffer.UV2Kind);var c=t.uv3s;c&&i.set(c,e.VertexBuffer.UV3Kind);var l=t.uv4s;l&&i.set(l,e.VertexBuffer.UV4Kind);var h=t.uv5s;h&&i.set(h,e.VertexBuffer.UV5Kind);var f=t.uv6s;f&&i.set(f,e.VertexBuffer.UV6Kind);var d=t.colors;d&&i.set(r(d,o.length/3),e.VertexBuffer.ColorKind);var p=t.matricesIndices;p&&i.set(p,e.VertexBuffer.MatricesIndicesKind);var m=t.matricesWeights;m&&i.set(m,e.VertexBuffer.MatricesWeightsKind);var g=t.indices;g&&(i.indices=g),n.setAllVerticesData(i,t.updatable)},D=function(t,n){var i=n.getScene(),o=t.geometryId;if(o){var s=i.getGeometryByID(o);s&&s.applyToMesh(n)}else if(t instanceof ArrayBuffer){var a=n._binaryInfo;if(a.positionsAttrDesc&&a.positionsAttrDesc.count>0){var u=new Float32Array(t,a.positionsAttrDesc.offset,a.positionsAttrDesc.count);n.setVerticesData(e.VertexBuffer.PositionKind,u,!1)}if(a.normalsAttrDesc&&a.normalsAttrDesc.count>0){var c=new Float32Array(t,a.normalsAttrDesc.offset,a.normalsAttrDesc.count);n.setVerticesData(e.VertexBuffer.NormalKind,c,!1)}if(a.uvsAttrDesc&&a.uvsAttrDesc.count>0){var l=new Float32Array(t,a.uvsAttrDesc.offset,a.uvsAttrDesc.count);n.setVerticesData(e.VertexBuffer.UVKind,l,!1)}if(a.uvs2AttrDesc&&a.uvs2AttrDesc.count>0){var h=new Float32Array(t,a.uvs2AttrDesc.offset,a.uvs2AttrDesc.count);n.setVerticesData(e.VertexBuffer.UV2Kind,h,!1)}if(a.uvs3AttrDesc&&a.uvs3AttrDesc.count>0){var f=new Float32Array(t,a.uvs3AttrDesc.offset,a.uvs3AttrDesc.count);n.setVerticesData(e.VertexBuffer.UV3Kind,f,!1)}if(a.uvs4AttrDesc&&a.uvs4AttrDesc.count>0){var d=new Float32Array(t,a.uvs4AttrDesc.offset,a.uvs4AttrDesc.count);n.setVerticesData(e.VertexBuffer.UV4Kind,d,!1)}if(a.uvs5AttrDesc&&a.uvs5AttrDesc.count>0){var p=new Float32Array(t,a.uvs5AttrDesc.offset,a.uvs5AttrDesc.count);n.setVerticesData(e.VertexBuffer.UV5Kind,p,!1)}if(a.uvs6AttrDesc&&a.uvs6AttrDesc.count>0){var m=new Float32Array(t,a.uvs6AttrDesc.offset,a.uvs6AttrDesc.count);n.setVerticesData(e.VertexBuffer.UV6Kind,m,!1)}if(a.colorsAttrDesc&&a.colorsAttrDesc.count>0){var g=new Float32Array(t,a.colorsAttrDesc.offset,a.colorsAttrDesc.count);n.setVerticesData(e.VertexBuffer.ColorKind,g,!1,a.colorsAttrDesc.stride)}if(a.matricesIndicesAttrDesc&&a.matricesIndicesAttrDesc.count>0){var v=new Int32Array(t,a.matricesIndicesAttrDesc.offset,a.matricesIndicesAttrDesc.count);n.setVerticesData(e.VertexBuffer.MatricesIndicesKind,v,!1)}if(a.matricesWeightsAttrDesc&&a.matricesWeightsAttrDesc.count>0){var _=new Float32Array(t,a.matricesWeightsAttrDesc.offset,a.matricesWeightsAttrDesc.count);n.setVerticesData(e.VertexBuffer.MatricesWeightsKind,_,!1)}if(a.indicesAttrDesc&&a.indicesAttrDesc.count>0){var y=new Int32Array(t,a.indicesAttrDesc.offset,a.indicesAttrDesc.count);n.setIndices(y)}if(a.subMeshesAttrDesc&&a.subMeshesAttrDesc.count>0){var x=new Int32Array(t,a.subMeshesAttrDesc.offset,5*a.subMeshesAttrDesc.count);n.subMeshes=[];for(var b=0;b<a.subMeshesAttrDesc.count;b++){var S=x[5*b+0],E=x[5*b+1],M=x[5*b+2],T=x[5*b+3],P=x[5*b+4];new e.SubMesh(S,E,M,T,P,n)}}}else if(t.positions&&t.normals&&t.indices){if(n.setVerticesData(e.VertexBuffer.PositionKind,t.positions,!1),n.setVerticesData(e.VertexBuffer.NormalKind,t.normals,!1),t.uvs&&n.setVerticesData(e.VertexBuffer.UVKind,t.uvs,!1),t.uvs2&&n.setVerticesData(e.VertexBuffer.UV2Kind,t.uvs2,!1),t.uvs3&&n.setVerticesData(e.VertexBuffer.UV3Kind,t.uvs3,!1),t.uvs4&&n.setVerticesData(e.VertexBuffer.UV4Kind,t.uvs4,!1),t.uvs5&&n.setVerticesData(e.VertexBuffer.UV5Kind,t.uvs5,!1),t.uvs6&&n.setVerticesData(e.VertexBuffer.UV6Kind,t.uvs6,!1),t.colors&&n.setVerticesData(e.VertexBuffer.ColorKind,r(t.colors,t.positions.length/3),!1),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,n.setVerticesData(e.VertexBuffer.MatricesIndicesKind,t.matricesIndices,!1);else{for(var C=[],b=0;b<t.matricesIndices.length;b++){var w=t.matricesIndices[b];C.push(255&w),C.push((65280&w)>>8),C.push((16711680&w)>>16),C.push(w>>24)}n.setVerticesData(e.VertexBuffer.MatricesIndicesKind,C,!1)}t.matricesWeights&&n.setVerticesData(e.VertexBuffer.MatricesWeightsKind,t.matricesWeights,!1),n.setIndices(t.indices)}if(t.subMeshes){n.subMeshes=[];for(var A=0;A<t.subMeshes.length;A++){var D=t.subMeshes[A];new e.SubMesh(D.materialIndex,D.verticesStart,D.verticesCount,D.indexStart,D.indexCount,n)}}n._shouldGenerateFlatShading&&(n.convertToFlatShadedMesh(),delete n._shouldGenerateFlatShading),n.computeWorldMatrix(!0),i._selectionOctree&&i._selectionOctree.addMesh(n)};e.SceneLoader.RegisterPlugin({extensions:".babylon",importMesh:function(t,r,n,i,s,a,l){for(var f=JSON.parse(n),d=[],p=[],m=[],g=0;g<f.meshes.length;g++){var P=f.meshes[g];if(!t||w(P,t,m)){if(t instanceof Array&&delete t[t.indexOf(P.name)],P.geometryId&&f.geometries){var C=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(e){!C&&f.geometries[e]&&f.geometries[e]instanceof Array&&f.geometries[e].forEach(function(t){if(t.id==P.geometryId){switch(e){case"boxes":v(t,r);break;case"spheres":_(t,r);break;case"cylinders":y(t,r);break;case"toruses":x(t,r);break;case"grounds":b(t,r);break;case"planes":S(t,r);break;case"torusKnots":E(t,r);break;case"vertexData":M(t,r,i)}C=!0}})}),C||e.Tools.Warn("Geometry not found for mesh "+P.id)}if(P.materialId){var A=-1!==p.indexOf(P.materialId);if(!A&&f.multiMaterials)for(var D=0;D<f.multiMaterials.length;D++){var I=f.multiMaterials[D];if(I.id==P.materialId){for(var R=0;R<I.materials.length;R++){var O=I.materials[R];p.push(O),u(O,f,r,i)}p.push(I.id),c(I,r),A=!0;break}}A||(p.push(P.materialId),u(P.materialId,f,r,i)||e.Tools.Warn("Material not found for mesh "+P.id))}if(P.skeletonId>-1&&r.skeletons){var L=d.indexOf(P.skeletonId)>-1;if(!L)for(var F=0;F<f.skeletons.length;F++){var V=f.skeletons[F];V.id===P.skeletonId&&(l.push(o(V,r)),d.push(V.id))}}var k=T(P,r,i);s.push(k)}}for(g=0;g<r.meshes.length;g++){var B=r.meshes[g];B._waitingParentId&&(B.parent=r.getLastEntryByID(B._waitingParentId),B._waitingParentId=void 0)}for(g=0;g<r.meshes.length;g++){var B=r.meshes[g];B._waitingFreezeWorldMatrix&&(B.freezeWorldMatrix(),B._waitingFreezeWorldMatrix=void 0)}if(f.particleSystems)for(g=0;g<f.particleSystems.length;g++){var N=f.particleSystems[g];-1!==m.indexOf(N.emitterId)&&a.push(h(N,r,i))}return!0},load:function(t,r,n){var i=JSON.parse(r);t.useDelayedTextureLoading=i.useDelayedTextureLoading&&!e.SceneLoader.ForceFullSceneLoadingForIncremental,t.autoClear=i.autoClear,t.clearColor=e.Color3.FromArray(i.clearColor),t.ambientColor=e.Color3.FromArray(i.ambientColor),t.gravity=e.Vector3.FromArray(i.gravity),i.fogMode&&0!==i.fogMode&&(t.fogMode=i.fogMode,t.fogColor=e.Color3.FromArray(i.fogColor),t.fogStart=i.fogStart,t.fogEnd=i.fogEnd,t.fogDensity=i.fogDensity);for(var s=0;s<i.lights.length;s++){var u=i.lights[s];p(u,t)}if(i.materials)for(s=0;s<i.materials.length;s++){var d=i.materials[s];a(d,t,n)}if(i.multiMaterials)for(s=0;s<i.multiMaterials.length;s++){var g=i.multiMaterials[s];c(g,t)}if(i.skeletons)for(s=0;s<i.skeletons.length;s++){var w=i.skeletons[s];o(w,t)}var A=i.geometries;if(A){var D=A.boxes;if(D)for(s=0;s<D.length;s++){var I=D[s];v(I,t)}var R=A.spheres;if(R)for(s=0;s<R.length;s++){var O=R[s];_(O,t)}var L=A.cylinders;if(L)for(s=0;s<L.length;s++){var F=L[s];y(F,t)}var V=A.toruses;if(V)for(s=0;s<V.length;s++){var k=V[s];x(k,t)}var B=A.grounds;if(B)for(s=0;s<B.length;s++){var N=B[s];b(N,t)}var U=A.planes;if(U)for(s=0;s<U.length;s++){var z=U[s];S(z,t)}var W=A.torusKnots;if(W)for(s=0;s<W.length;s++){var j=W[s];E(j,t)}var G=A.vertexData;if(G)for(s=0;s<G.length;s++){var H=G[s];M(H,t,n)}}for(s=0;s<i.meshes.length;s++){var K=i.meshes[s];T(K,t,n)}for(s=0;s<i.cameras.length;s++){var X=i.cameras[s];m(X,t)}for(i.activeCameraID&&t.setActiveCameraByID(i.activeCameraID),s=0;s<t.cameras.length;s++){var Y=t.cameras[s];Y._waitingParentId&&(Y.parent=t.getLastEntryByID(Y._waitingParentId),Y._waitingParentId=void 0)}for(s=0;s<t.lights.length;s++){var q=t.lights[s];q._waitingParentId&&(q.parent=t.getLastEntryByID(q._waitingParentId),q._waitingParentId=void 0)}if(i.sounds)for(s=0;s<i.sounds.length;s++){var Z=i.sounds[s];e.Engine.audioEngine.canUseWebAudio?C(Z,t,n):new e.Sound(Z.name,null,t)}for(s=0;s<t.meshes.length;s++){var Q=t.meshes[s];Q._waitingParentId&&(Q.parent=t.getLastEntryByID(Q._waitingParentId),Q._waitingParentId=void 0),Q._waitingActions&&(P(Q._waitingActions,Q,t),Q._waitingActions=void 0)}for(s=0;s<t.meshes.length;s++){var J=t.meshes[s];J._waitingFreezeWorldMatrix&&(J.freezeWorldMatrix(),J._waitingFreezeWorldMatrix=void 0)}if(i.particleSystems)for(s=0;s<i.particleSystems.length;s++){var $=i.particleSystems[s];h($,t,n)}if(i.lensFlareSystems)for(s=0;s<i.lensFlareSystems.length;s++){var ee=i.lensFlareSystems[s];l(ee,t,n)}if(i.shadowGenerators)for(s=0;s<i.shadowGenerators.length;s++){var te=i.shadowGenerators[s];f(te,t)}return i.actions&&P(i.actions,null,t),!0}})}(t=e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(){function t(t,r,n,i,o,s,a){void 0===a&&(a=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.cellSize=i,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this._vertexDeclaration=[4,4,4,4],this._vertexStrideSize=64,this._capacity=n,this._spriteTexture=new e.Texture(r,o,!0,!1,a),this._spriteTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._epsilon=void 0===s?.01:s,this._scene=o,this._scene.spriteManagers.push(this),this._vertexBuffer=o.getEngine().createDynamicVertexBuffer(n*this._vertexStrideSize*4);for(var u=[],c=0,l=0;n>l;l++)u.push(c),u.push(c+1),u.push(c+2),u.push(c),u.push(c+2),u.push(c+3),c+=4;this._indexBuffer=o.getEngine().createIndexBuffer(u),this._vertices=new Float32Array(n*this._vertexStrideSize),this._effectBase=this._scene.getEngine().createEffect("sprites",["position","options","cellInfo","color"],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",["position","options","cellInfo","color"],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return t.prototype._appendSpriteVertex=function(e,t,r,n,i){var o=16*e;0===r?r=this._epsilon:1===r&&(r=1-this._epsilon),0===n?n=this._epsilon:1===n&&(n=1-this._epsilon),this._vertices[o]=t.position.x,this._vertices[o+1]=t.position.y,this._vertices[o+2]=t.position.z,this._vertices[o+3]=t.angle,this._vertices[o+4]=t.width,this._vertices[o+5]=t.height,this._vertices[o+6]=r,this._vertices[o+7]=n,this._vertices[o+8]=t.invertU?1:0,this._vertices[o+9]=t.invertV?1:0;var s=t.cellIndex/i>>0;this._vertices[o+10]=t.cellIndex-s*i,this._vertices[o+11]=s,this._vertices[o+12]=t.color.r,this._vertices[o+13]=t.color.g,this._vertices[o+14]=t.color.b,this._vertices[o+15]=t.color.a},t.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var t=this._scene.getEngine(),r=this._spriteTexture.getBaseSize(),n=t.getDeltaTime(),i=Math.min(this._capacity,this.sprites.length),o=r.width/this.cellSize,s=0,a=0;i>a;a++){var u=this.sprites[a];u&&(u._animate(n),this._appendSpriteVertex(s++,u,0,0,o),this._appendSpriteVertex(s++,u,1,0,o),this._appendSpriteVertex(s++,u,1,1,o),this._appendSpriteVertex(s++,u,0,1,o))}t.updateDynamicVertexBuffer(this._vertexBuffer,this._vertices);var c=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(c=this._effectFog),t.enableEffect(c);var l=this._scene.getViewMatrix();c.setTexture("diffuseSampler",this._spriteTexture),c.setMatrix("view",l),c.setMatrix("projection",this._scene.getProjectionMatrix()),c.setFloat2("textureInfos",this.cellSize/r.width,this.cellSize/r.height),this._scene.fogEnabled&&this._scene.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(c.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),c.setColor3("vFogColor",this._scene.fogColor)),t.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,c),t.setDepthFunctionToLessOrEqual(),c.setBool("alphaTest",!0),t.setColorWrite(!1),t.draw(!0,0,6*i),t.setColorWrite(!0),c.setBool("alphaTest",!1),t.setAlphaMode(e.Engine.ALPHA_COMBINE),t.draw(!0,0,6*i),t.setAlphaMode(e.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var e=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(e,1),this.onDispose&&this.onDispose()},t}();e.SpriteManager=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r){this.name=t,this.color=new e.Color4(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._frameCount=0,this._time=0,this._manager=r,this._manager.sprites.push(this),this.position=e.Vector3.Zero()}return Object.defineProperty(t.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!0,configurable:!0}),t.prototype.playAnimation=function(e,t,r,n){this._fromIndex=e,this._toIndex=t,this._loopAnimation=r,this._delay=n,this._animationStarted=!0,this._direction=t>e?1:-1,this.cellIndex=e,this._time=0},t.prototype.stopAnimation=function(){this._animationStarted=!1},t.prototype._animate=function(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex==this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this._animationStarted=!1,this.disposeWhenFinishedAnimating&&this.dispose()))))},t.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1)},t}();e.Sprite=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r,n,i,o){this.name=t,this._vertexDeclaration=[2],this._vertexStrideSize=8,this.texture=r?new e.Texture(r,n,!0):null,this.isBackground=void 0===i?!0:i,this.color=void 0===o?new e.Color4(1,1,1,1):o,this._scene=n,this._scene.layers.push(this);var s=[];s.push(1,1),s.push(-1,1),s.push(-1,-1),s.push(1,-1),this._vertexBuffer=n.getEngine().createVertexBuffer(s);var a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=n.getEngine().createIndexBuffer(a),this._effect=this._scene.getEngine().createEffect("layer",["position"],["textureMatrix","color"],["textureSampler"],"")}return t.prototype.render=function(){if(this._effect.isReady()&&this.texture&&this.texture.isReady()){
var t=this._scene.getEngine();t.enableEffect(this._effect),t.setState(!1),this._effect.setTexture("textureSampler",this.texture),this._effect.setMatrix("textureMatrix",this.texture.getTextureMatrix()),this._effect.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),t.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect),t.setAlphaMode(e.Engine.ALPHA_COMBINE),t.draw(!0,0,6),t.setAlphaMode(e.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null);var e=this._scene.layers.indexOf(this);this._scene.layers.splice(e,1),this.onDispose&&this.onDispose()},t}();e.Layer=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this.position=e.Vector3.Zero(),this.direction=e.Vector3.Zero(),this.color=new e.Color4(0,0,0,0),this.colorStep=new e.Color4(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.angle=0,this.angularSpeed=0}return t.prototype.copyTo=function(e){e.position.copyFrom(this.position),e.direction.copyFrom(this.direction),e.color.copyFrom(this.color),e.colorStep.copyFrom(this.colorStep),e.lifeTime=this.lifeTime,e.age=this.age,e.size=this.size,e.angle=this.angle,e.angularSpeed=this.angularSpeed},t}();e.Particle=t}(r||(r={}));var r;!function(e){var t=function(e,t){if(e===t)return e;var r=Math.random();return r*(t-e)+e},r=function(){function r(n,i,o,s){var a=this;this.name=n,this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.blendMode=r.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.gravity=e.Vector3.Zero(),this.direction1=new e.Vector3(0,1,0),this.direction2=new e.Vector3(0,1,0),this.minEmitBox=new e.Vector3(-.5,-.5,-.5),this.maxEmitBox=new e.Vector3(.5,.5,.5),this.color1=new e.Color4(1,1,1,1),this.color2=new e.Color4(1,1,1,1),this.colorDead=new e.Color4(0,0,0,1),this.textureMask=new e.Color4(1,1,1,1),this.particles=new Array,this._vertexDeclaration=[3,4,4],this._vertexStrideSize=44,this._stockParticles=new Array,this._newPartsExcess=0,this._scaledColorStep=new e.Color4(0,0,0,0),this._colorDiff=new e.Color4(0,0,0,0),this._scaledDirection=e.Vector3.Zero(),this._scaledGravity=e.Vector3.Zero(),this._currentRenderId=-1,this._started=!1,this._stopped=!1,this._actualFrame=0,this.id=n,this._capacity=i,this._scene=o,this._customEffect=s,o.particleSystems.push(this),this._vertexBuffer=o.getEngine().createDynamicVertexBuffer(i*this._vertexStrideSize*4);for(var u=[],c=0,l=0;i>l;l++)u.push(c),u.push(c+1),u.push(c+2),u.push(c),u.push(c+2),u.push(c+3),c+=4;this._indexBuffer=o.getEngine().createIndexBuffer(u),this._vertices=new Float32Array(i*this._vertexStrideSize),this.startDirectionFunction=function(r,n,i){var o=t(a.direction1.x,a.direction2.x),s=t(a.direction1.y,a.direction2.y),u=t(a.direction1.z,a.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(o*r,s*r,u*r,n,i)},this.startPositionFunction=function(r,n){var i=t(a.minEmitBox.x,a.maxEmitBox.x),o=t(a.minEmitBox.y,a.maxEmitBox.y),s=t(a.minEmitBox.z,a.maxEmitBox.z);e.Vector3.TransformCoordinatesFromFloatsToRef(i,o,s,r,n)},this.updateFunction=function(e){for(var t=0;t<e.length;t++){var r=e[t];r.age+=a._scaledUpdateSpeed,r.age>=r.lifeTime?(a.recycleParticle(r),t--):(r.colorStep.scaleToRef(a._scaledUpdateSpeed,a._scaledColorStep),r.color.addInPlace(a._scaledColorStep),r.color.a<0&&(r.color.a=0),r.angle+=r.angularSpeed*a._scaledUpdateSpeed,r.direction.scaleToRef(a._scaledUpdateSpeed,a._scaledDirection),r.position.addInPlace(a._scaledDirection),a.gravity.scaleToRef(a._scaledUpdateSpeed,a._scaledGravity),r.direction.addInPlace(a._scaledGravity))}}}return r.prototype.recycleParticle=function(e){var t=this.particles.pop();t!==e&&(t.copyTo(e),this._stockParticles.push(t))},r.prototype.getCapacity=function(){return this._capacity},r.prototype.isAlive=function(){return this._alive},r.prototype.isStarted=function(){return this._started},r.prototype.start=function(){this._started=!0,this._stopped=!1,this._actualFrame=0},r.prototype.stop=function(){this._stopped=!0},r.prototype._appendParticleVertex=function(e,t,r,n){var i=11*e;this._vertices[i]=t.position.x,this._vertices[i+1]=t.position.y,this._vertices[i+2]=t.position.z,this._vertices[i+3]=t.color.r,this._vertices[i+4]=t.color.g,this._vertices[i+5]=t.color.b,this._vertices[i+6]=t.color.a,this._vertices[i+7]=t.angle,this._vertices[i+8]=t.size,this._vertices[i+9]=r,this._vertices[i+10]=n},r.prototype._update=function(r){this._alive=this.particles.length>0,this.updateFunction(this.particles);var n;n=this.emitter.position?this.emitter.getWorldMatrix():e.Matrix.Translation(this.emitter.x,this.emitter.y,this.emitter.z);for(var i=0;r>i&&this.particles.length!==this._capacity;i++){if(0!==this._stockParticles.length){var o=this._stockParticles.pop();o.age=0}else o=new e.Particle;this.particles.push(o);var s=t(this.minEmitPower,this.maxEmitPower);this.startDirectionFunction(s,n,o.direction),o.lifeTime=t(this.minLifeTime,this.maxLifeTime),o.size=t(this.minSize,this.maxSize),o.angularSpeed=t(this.minAngularSpeed,this.maxAngularSpeed),this.startPositionFunction(n,o.position);var a=t(0,1);e.Color4.LerpToRef(this.color1,this.color2,a,o.color),this.colorDead.subtractToRef(o.color,this._colorDiff),this._colorDiff.scaleToRef(1/o.lifeTime,o.colorStep)}},r.prototype._getEffect=function(){if(this._customEffect)return this._customEffect;var e=[];this._scene.clipPlane&&e.push("#define CLIPPLANE");var t=e.join("\n");return this._cachedDefines!==t&&(this._cachedDefines=t,this._effect=this._scene.getEngine().createEffect("particles",["position","color","options"],["invView","view","projection","vClipPlane","textureMask"],["diffuseSampler"],t)),this._effect},r.prototype.animate=function(){if(this._started){var e=this._getEffect();if(this.emitter&&e.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId()){this._currentRenderId=this._scene.getRenderId(),this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio();var t;this.manualEmitCount>-1?(t=this.manualEmitCount,this.manualEmitCount=0):t=this.emitRate;var r=t*this._scaledUpdateSpeed>>0;this._newPartsExcess+=t*this._scaledUpdateSpeed-r,this._newPartsExcess>1&&(r+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?r=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(r),this._stopped&&(this._alive||(this._started=!1,this.disposeOnStop&&this._scene._toBeDisposed.push(this)));for(var n=0,i=0;i<this.particles.length;i++){var o=this.particles[i];this._appendParticleVertex(n++,o,0,0),this._appendParticleVertex(n++,o,1,0),this._appendParticleVertex(n++,o,1,1),this._appendParticleVertex(n++,o,0,1)}var s=this._scene.getEngine();s.updateDynamicVertexBuffer(this._vertexBuffer,this._vertices)}}},r.prototype.render=function(){var t=this._getEffect();if(!(this.emitter&&t.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this.particles.length))return 0;var n=this._scene.getEngine();n.enableEffect(t),n.setState(!1);var i=this._scene.getViewMatrix();if(t.setTexture("diffuseSampler",this.particleTexture),t.setMatrix("view",i),t.setMatrix("projection",this._scene.getProjectionMatrix()),t.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane){var o=this._scene.clipPlane,s=i.clone();s.invert(),t.setMatrix("invView",s),t.setFloat4("vClipPlane",o.normal.x,o.normal.y,o.normal.z,o.d)}return n.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,t),n.setAlphaMode(this.blendMode===r.BLENDMODE_ONEONE?e.Engine.ALPHA_ONEONE:e.Engine.ALPHA_COMBINE),this.forceDepthWrite&&n.setDepthWrite(!0),n.draw(!0,0,6*this.particles.length),n.setAlphaMode(e.Engine.ALPHA_DISABLE),this.particles.length},r.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);var e=this._scene.particleSystems.indexOf(this);this._scene.particleSystems.splice(e,1),this.onDispose&&this.onDispose()},r.prototype.clone=function(t,n){var i=new r(t,this._capacity,this._scene);return e.Tools.DeepCopy(this,i,["particles"],["_vertexDeclaration","_vertexStrideSize"]),void 0===n&&(n=this.emitter),i.emitter=n,this.particleTexture&&(i.particleTexture=new e.Texture(this.particleTexture.url,this._scene)),i.start(),i},r.BLENDMODE_ONEONE=0,r.BLENDMODE_STANDARD=1,r}();e.ParticleSystem=r}(r||(r={}));var r;!function(e){var t=function(){function t(e,r,n,i,o){this.name=e,this.targetProperty=r,this.framePerSecond=n,this.dataType=i,this.loopMode=o,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this.allowMatricesInterpolation=!1,this.targetPropertyPath=r.split("."),this.dataType=i,this.loopMode=void 0===o?t.ANIMATIONLOOPMODE_CYCLE:o}return t.CreateAndStartAnimation=function(r,n,i,o,s,a,u,c,l){var h=void 0;if(!isNaN(parseFloat(a))&&isFinite(a)?h=t.ANIMATIONTYPE_FLOAT:a instanceof e.Quaternion?h=t.ANIMATIONTYPE_QUATERNION:a instanceof e.Vector3?h=t.ANIMATIONTYPE_VECTOR3:a instanceof e.Vector2?h=t.ANIMATIONTYPE_VECTOR2:a instanceof e.Color3&&(h=t.ANIMATIONTYPE_COLOR3),void 0==h)return null;var f=new t(r,i,o,h,c),d=[];return d.push({frame:0,value:a}),d.push({frame:s,value:u}),f.setKeys(d),void 0!==l&&f.setEasingFunction(l),n.animations.push(f),n.getScene().beginAnimation(n,0,s,1===f.loopMode)},t.prototype.reset=function(){this._offsetsCache={},this._highLimitsCache={},this.currentFrame=0},t.prototype.isStopped=function(){return this._stopped},t.prototype.getKeys=function(){return this._keys},t.prototype.getEasingFunction=function(){return this._easingFunction},t.prototype.setEasingFunction=function(e){this._easingFunction=e},t.prototype.floatInterpolateFunction=function(e,t,r){return e+(t-e)*r},t.prototype.quaternionInterpolateFunction=function(t,r,n){return e.Quaternion.Slerp(t,r,n)},t.prototype.vector3InterpolateFunction=function(t,r,n){return e.Vector3.Lerp(t,r,n)},t.prototype.vector2InterpolateFunction=function(t,r,n){return e.Vector2.Lerp(t,r,n)},t.prototype.color3InterpolateFunction=function(t,r,n){return e.Color3.Lerp(t,r,n)},t.prototype.matrixInterpolateFunction=function(t,r,n){var i=new e.Vector3(0,0,0),o=new e.Quaternion,s=new e.Vector3(0,0,0);t.decompose(i,o,s);var a=new e.Vector3(0,0,0),u=new e.Quaternion,c=new e.Vector3(0,0,0);r.decompose(a,u,c);var l=this.vector3InterpolateFunction(i,a,n),h=this.quaternionInterpolateFunction(o,u,n),f=this.vector3InterpolateFunction(s,c,n),d=e.Matrix.Compose(l,h,f);return d},t.prototype.clone=function(){var e=new t(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);return e.setKeys(this._keys),e},t.prototype.setKeys=function(e){this._keys=e.slice(0),this._offsetsCache={},this._highLimitsCache={}},t.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},t.prototype._interpolate=function(e,r,n,i,o){if(n===t.ANIMATIONLOOPMODE_CONSTANT&&r>0)return o.clone?o.clone():o;this.currentFrame=e;var s=Math.max(0,Math.min(this._keys.length-1,Math.floor(this._keys.length*(e-this._keys[0].frame)/(this._keys[this._keys.length-1].frame-this._keys[0].frame))-1));if(this._keys[s].frame>=e)for(;s-1>=0&&this._keys[s].frame>=e;)s--;for(var a=s;a<this._keys.length;a++)if(this._keys[a+1].frame>=e){var u=this._getKeyValue(this._keys[a].value),c=this._getKeyValue(this._keys[a+1].value),l=(e-this._keys[a].frame)/(this._keys[a+1].frame-this._keys[a].frame);switch(null!=this._easingFunction&&(l=this._easingFunction.ease(l)),this.dataType){case t.ANIMATIONTYPE_FLOAT:switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.floatInterpolateFunction(u,c,l);case t.ANIMATIONLOOPMODE_RELATIVE:return i*r+this.floatInterpolateFunction(u,c,l)}break;case t.ANIMATIONTYPE_QUATERNION:var h=null;switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:h=this.quaternionInterpolateFunction(u,c,l);break;case t.ANIMATIONLOOPMODE_RELATIVE:h=this.quaternionInterpolateFunction(u,c,l).add(i.scale(r))}return h;case t.ANIMATIONTYPE_VECTOR3:switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.vector3InterpolateFunction(u,c,l);case t.ANIMATIONLOOPMODE_RELATIVE:return this.vector3InterpolateFunction(u,c,l).add(i.scale(r))}case t.ANIMATIONTYPE_VECTOR2:switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.vector2InterpolateFunction(u,c,l);case t.ANIMATIONLOOPMODE_RELATIVE:return this.vector2InterpolateFunction(u,c,l).add(i.scale(r))}case t.ANIMATIONTYPE_COLOR3:switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(u,c,l);case t.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(u,c,l).add(i.scale(r))}case t.ANIMATIONTYPE_MATRIX:switch(n){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:if(this.allowMatricesInterpolation)return this.matrixInterpolateFunction(u,c,l);case t.ANIMATIONLOOPMODE_RELATIVE:return u}}break}return this._getKeyValue(this._keys[this._keys.length-1].value)},t.prototype.animate=function(r,n,i,o,s){if(!this.targetPropertyPath||this.targetPropertyPath.length<1)return this._stopped=!0,!1;var a=!0;if(0!==this._keys[0].frame){var u={frame:0,value:this._keys[0].value};this._keys.splice(0,0,u)}(n<this._keys[0].frame||n>this._keys[this._keys.length-1].frame)&&(n=this._keys[0].frame),(i<this._keys[0].frame||i>this._keys[this._keys.length-1].frame)&&(i=this._keys[this._keys.length-1].frame);var c,l=i-n,h=r*this.framePerSecond*s/1e3,f=0;if(h>l&&!o)a=!1,f=this._getKeyValue(this._keys[this._keys.length-1].value);else if(this.loopMode!==t.ANIMATIONLOOPMODE_CYCLE){var d=i.toString()+n.toString();if(!this._offsetsCache[d]){var p=this._interpolate(n,0,t.ANIMATIONLOOPMODE_CYCLE),m=this._interpolate(i,0,t.ANIMATIONLOOPMODE_CYCLE);switch(this.dataType){case t.ANIMATIONTYPE_FLOAT:this._offsetsCache[d]=m-p;break;case t.ANIMATIONTYPE_QUATERNION:this._offsetsCache[d]=m.subtract(p);break;case t.ANIMATIONTYPE_VECTOR3:this._offsetsCache[d]=m.subtract(p);case t.ANIMATIONTYPE_VECTOR2:this._offsetsCache[d]=m.subtract(p);case t.ANIMATIONTYPE_COLOR3:this._offsetsCache[d]=m.subtract(p)}this._highLimitsCache[d]=m}f=this._highLimitsCache[d],c=this._offsetsCache[d]}if(void 0===c)switch(this.dataType){case t.ANIMATIONTYPE_FLOAT:c=0;break;case t.ANIMATIONTYPE_QUATERNION:c=new e.Quaternion(0,0,0,0);break;case t.ANIMATIONTYPE_VECTOR3:c=e.Vector3.Zero();break;case t.ANIMATIONTYPE_VECTOR2:c=e.Vector2.Zero();break;case t.ANIMATIONTYPE_COLOR3:c=e.Color3.Black()}var g=h/l>>0,v=a?n+h%l:i,_=this._interpolate(v,g,this.loopMode,c,f);if(this.targetPropertyPath.length>1){for(var y=this._target[this.targetPropertyPath[0]],x=1;x<this.targetPropertyPath.length-1;x++)y=y[this.targetPropertyPath[x]];y[this.targetPropertyPath[this.targetPropertyPath.length-1]]=_}else this._target[this.targetPropertyPath[0]]=_;return this._target.markAsDirty&&this._target.markAsDirty(this.targetProperty),a||(this._stopped=!0),a},Object.defineProperty(t,"ANIMATIONTYPE_FLOAT",{get:function(){return t._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_VECTOR3",{get:function(){return t._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_VECTOR2",{get:function(){return t._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_QUATERNION",{get:function(){return t._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_MATRIX",{get:function(){return t._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONTYPE_COLOR3",{get:function(){return t._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return t._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return t._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return t._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),t._ANIMATIONTYPE_FLOAT=0,t._ANIMATIONTYPE_VECTOR3=1,t._ANIMATIONTYPE_QUATERNION=2,t._ANIMATIONTYPE_MATRIX=3,t._ANIMATIONTYPE_COLOR3=4,t._ANIMATIONTYPE_VECTOR2=5,t._ANIMATIONLOOPMODE_RELATIVE=0,t._ANIMATIONLOOPMODE_CYCLE=1,t._ANIMATIONLOOPMODE_CONSTANT=2,t}();e.Animation=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,r,n,i,o,s,a){void 0===r&&(r=0),void 0===n&&(n=100),void 0===i&&(i=!1),void 0===o&&(o=1),this.target=t,this.fromFrame=r,this.toFrame=n,this.loopAnimation=i,this.speedRatio=o,this.onAnimationEnd=s,this._animations=new Array,this._paused=!1,this.animationStarted=!1,a&&this.appendAnimations(t,a),this._scene=e,e._activeAnimatables.push(this)}return e.prototype.appendAnimations=function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n._target=e,this._animations.push(n)}},e.prototype.getAnimationByTargetProperty=function(e){for(var t=this._animations,r=0;r<t.length;r++)if(t[r].targetProperty===e)return t[r];return null},e.prototype.reset=function(){for(var e=this._animations,t=0;t<e.length;t++)e[t].reset();this._localDelayOffset=null,this._pausedDelay=null},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype.stop=function(){var e=this._scene._activeAnimatables.indexOf(this);e>-1&&this._scene._activeAnimatables.splice(e,1),this.onAnimationEnd&&this.onAnimationEnd()},e.prototype._animate=function(e){if(this._paused)return this._pausedDelay||(this._pausedDelay=e),!0;this._localDelayOffset?this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null):this._localDelayOffset=e;for(var t=!1,r=this._animations,n=0;n<r.length;n++){var i=r[n],o=i.animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this.speedRatio);t=t||o}return t||(n=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(n,1)),!t&&this.onAnimationEnd&&this.onAnimationEnd(),t},e}();e.Animatable=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this._easingMode=e.EASINGMODE_EASEIN}return Object.defineProperty(e,"EASINGMODE_EASEIN",{get:function(){return e._EASINGMODE_EASEIN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEOUT",{get:function(){return e._EASINGMODE_EASEOUT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEINOUT",{get:function(){return e._EASINGMODE_EASEINOUT},enumerable:!0,configurable:!0}),e.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(e){throw new Error("You must implement this method")},e.prototype.ease=function(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)},e._EASINGMODE_EASEIN=0,e._EASINGMODE_EASEOUT=1,e._EASINGMODE_EASEINOUT=2,e}();e.EasingFunction=t;var r=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t}(t);e.CircleEase=r;var i=function(e){function t(t){void 0===t&&(t=1),e.call(this),this.amplitude=t}return n(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)},t}(t);e.BackEase=i;var o=function(e){function t(t,r){void 0===t&&(t=3),void 0===r&&(r=2),e.call(this),this.bounces=t,this.bounciness=r}return n(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.bounces),r=this.bounciness;1>=r&&(r=1.001);var n=Math.pow(r,t),i=1-r,o=(1-n)/i+.5*n,s=e*o,a=Math.log(-s*(1-r)+1)/Math.log(r),u=Math.floor(a),c=u+1,l=(1-Math.pow(r,u))/(i*o),h=(1-Math.pow(r,c))/(i*o),f=.5*(l+h),d=e-f,p=f-l;return-Math.pow(1/r,t-u)/(p*p)*(d-p)*(d+p)},t}(t);e.BounceEase=o;var s=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.easeInCore=function(e){return e*e*e},t}(t);e.CubicEase=s;var a=function(e){function t(t,r){void 0===t&&(t=3),void 0===r&&(r=3),e.call(this),this.oscillations=t,this.springiness=r}return n(t,e),t.prototype.easeInCore=function(e){var t,r=Math.max(0,this.oscillations),n=Math.max(0,this.springiness);return t=0==n?e:(Math.exp(n*e)-1)/(Math.exp(n)-1),t*Math.sin((6.283185307179586*r+1.5707963267948966)*e)},t}(t);e.ElasticEase=a;var u=function(e){function t(t){void 0===t&&(t=2),e.call(this),this.exponent=t}return n(t,e),t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}(t);e.ExponentialEase=u;var c=function(e){function t(t){void 0===t&&(t=2),e.call(this),this.power=t}return n(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.power);return Math.pow(e,t)},t}(t);e.PowerEase=c;var l=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.easeInCore=function(e){return e*e},t}(t);e.QuadraticEase=l;var h=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.easeInCore=function(e){return e*e*e*e},t}(t);e.QuarticEase=h;var f=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.easeInCore=function(e){return e*e*e*e*e},t}(t);e.QuinticEase=f;var d=function(e){function t(){e.apply(this,arguments)}return n(t,e),t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t}(t);e.SineEase=d;var p=function(t){function r(e,r,n,i){void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=1),t.call(this),this.x1=e,this.y1=r,this.x2=n,this.y2=i}return n(r,t),r.prototype.easeInCore=function(t){return e.BezierCurve.interpolate(t,this.x1,this.y1,this.x2,this.y2)},r}(t);e.BezierCurveEase=p}(r||(r={}));var r;!function(e){var t=function(){function t(t,r,n){void 0===n&&(n=2),this.maxDepth=n,this.dynamicContent=new Array,this._maxBlockCapacity=r||64,this._selectionContent=new e.SmartArray(1024),this._creationFunc=t}return t.prototype.update=function(e,r,n){t._CreateBlocks(e,r,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},t.prototype.addMesh=function(e){for(var t=0;t<this.blocks.length;t++){var r=this.blocks[t];r.addEntry(e)}},t.prototype.select=function(e,t){this._selectionContent.reset();for(var r=0;r<this.blocks.length;r++){var n=this.blocks[r];n.select(e,this._selectionContent,t)}return t?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersects=function(e,t,r){this._selectionContent.reset();for(var n=0;n<this.blocks.length;n++){var i=this.blocks[n];i.intersects(e,t,this._selectionContent,r)}return r?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersectsRay=function(e){this._selectionContent.reset();for(var t=0;t<this.blocks.length;t++){var r=this.blocks[t];r.intersectsRay(e,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t._CreateBlocks=function(t,r,n,i,o,s,a,u){a.blocks=new Array;for(var c=new e.Vector3((r.x-t.x)/2,(r.y-t.y)/2,(r.z-t.z)/2),l=0;2>l;l++)for(var h=0;2>h;h++)for(var f=0;2>f;f++){var d=t.add(c.multiplyByFloats(l,h,f)),p=t.add(c.multiplyByFloats(l+1,h+1,f+1)),m=new e.OctreeBlock(d,p,i,o+1,s,u);m.addEntries(n),a.blocks.push(m)}},t.CreationFuncForMeshes=function(e,t){!e.isBlocked&&e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},t.CreationFuncForSubMeshes=function(e,t){e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},t}();e.Octree=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,r,n,i,o){this.entries=new Array,this._boundingVectors=new Array,this._capacity=r,this._depth=n,this._maxDepth=i,this._creationFunc=o,this._minPoint=e,this._maxPoint=t,this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors[2].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[3].y=t.y,this._boundingVectors.push(e.clone()),this._boundingVectors[4].z=t.z,this._boundingVectors.push(t.clone()),this._boundingVectors[5].z=e.z,this._boundingVectors.push(t.clone()),this._boundingVectors[6].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[7].y=e.y}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(e){if(this.blocks)for(var t=0;t<this.blocks.length;t++){var r=this.blocks[t];r.addEntry(e)}else this._creationFunc(e,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},t.prototype.addEntries=function(e){for(var t=0;t<e.length;t++){var r=e[t];this.addEntry(r)}},t.prototype.select=function(t,r,n){if(e.BoundingBox.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var i=0;i<this.blocks.length;i++){var o=this.blocks[i];o.select(t,r,n)}return}n?r.concat(this.entries):r.concatWithNoDuplicate(this.entries)}},t.prototype.intersects=function(t,r,n,i){if(e.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,t,r)){if(this.blocks){for(var o=0;o<this.blocks.length;o++){var s=this.blocks[o];s.intersects(t,r,n,i)}return}i?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}},t.prototype.intersectsRay=function(e,t){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var r=0;r<this.blocks.length;r++){var n=this.blocks[r];n.intersectsRay(e,t)}return}t.concatWithNoDuplicate(this.entries)}},t.prototype.createInnerBlocks=function(){e.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},t}();e.OctreeBlock=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o){t.call(this,r,n.getScene()),this.name=r,this.children=new Array,this.animations=new Array,this._worldTransform=new e.Matrix,this._absoluteTransform=new e.Matrix,this._invertedAbsoluteTransform=new e.Matrix,this._skeleton=n,this._matrix=o,this._baseMatrix=o,n.bones.push(this),i?(this._parent=i,i.children.push(this)):this._parent=null,this._updateDifferenceMatrix()}return n(r,t),r.prototype.getParent=function(){return this._parent},r.prototype.getLocalMatrix=function(){return this._matrix},r.prototype.getBaseMatrix=function(){return this._baseMatrix},r.prototype.getWorldMatrix=function(){return this._worldTransform},r.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},r.prototype.getAbsoluteMatrix=function(){for(var e=this._matrix.clone(),t=this._parent;t;)e=e.multiply(t.getLocalMatrix()),t=t.getParent();return e},r.prototype.updateMatrix=function(e){this._matrix=e,this._skeleton._markAsDirty(),this._updateDifferenceMatrix()},r.prototype._updateDifferenceMatrix=function(){this._parent?this._matrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(this._matrix),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(var e=0;e<this.children.length;e++)this.children[e]._updateDifferenceMatrix()},r.prototype.markAsDirty=function(){this._currentRenderId++,this._skeleton._markAsDirty()},r}(e.Node);e.Bone=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r,n){this.name=t,this.id=r,this.bones=new Array,this._isDirty=!0,this._identity=e.Matrix.Identity(),this.bones=[],this._scene=n,n.skeletons.push(this),this.prepare(),this._isDirty=!0}return t.prototype.getTransformMatrices=function(){return this._transformMatrices},t.prototype.getScene=function(){return this._scene},t.prototype._markAsDirty=function(){this._isDirty=!0},t.prototype.prepare=function(){if(this._isDirty){this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)));for(var e=0;e<this.bones.length;e++){var t=this.bones[e],r=t.getParent();r?t.getLocalMatrix().multiplyToRef(r.getWorldMatrix(),t.getWorldMatrix()):t.getWorldMatrix().copyFrom(t.getLocalMatrix()),t.getInvertedAbsoluteTransform().multiplyToArray(t.getWorldMatrix(),this._transformMatrices,16*e)}this._identity.copyToArray(this._transformMatrices,16*this.bones.length),this._isDirty=!1,this._scene._activeBones+=this.bones.length}},t.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables},t.prototype.clone=function(r,n){for(var i=new t(r,n||r,this._scene),o=0;o<this.bones.length;o++){var s=this.bones[o],a=null;if(s.getParent()){var u=this.bones.indexOf(s.getParent());a=i.bones[u]}var c=new e.Bone(s.name,i,a,s.getBaseMatrix());e.Tools.DeepCopy(s.animations,c.animations)}return i},t}();e.Skeleton=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r,n,i,o,s,a,u,c,l,h){void 0===a&&(a=e.Texture.NEAREST_SAMPLINGMODE),void 0===h&&(h=e.Engine.TEXTURETYPE_UNSIGNED_INT),this.name=t,this.width=-1,this.height=-1,this._reusable=!1,this._textures=new e.SmartArray(2),this._currentRenderTextureInd=0,null!=s?(this._camera=s,this._scene=s.getScene(),s.attachPostProcess(this),this._engine=this._scene.getEngine()):this._engine=u,this._renderRatio=o,this.renderTargetSamplingMode=a?a:e.Texture.NEAREST_SAMPLINGMODE,this._reusable=c||!1,this._textureType=h,i=i||[],i.push("textureSampler"),this._effect=this._engine.createEffect({vertex:"postprocess",fragment:r},["position"],n||[],i,void 0!==l?l:"")}return t.prototype.isReusable=function(){return this._reusable},t.prototype.activate=function(t,r){t=t||this._camera;var n=t.getScene(),i=t.getEngine().getCaps().maxTextureSize,o=(r?r._width:this._engine.getRenderingCanvas().width)*this._renderRatio|0,s=(r?r._height:this._engine.getRenderingCanvas().height)*this._renderRatio|0;if(o=this._renderRatio.width||e.Tools.GetExponantOfTwo(o,i),s=this._renderRatio.height||e.Tools.GetExponantOfTwo(s,i),this.width!==o||this.height!==s){if(this._textures.length>0){for(var a=0;a<this._textures.length;a++)this._engine._releaseTexture(this._textures.data[a]);this._textures.reset()}this.width=o,this.height=s,this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:t._postProcesses.indexOf(this)===t._postProcessesTakenIndices[0],samplingMode:this.renderTargetSamplingMode,type:this._textureType})),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:t._postProcesses.indexOf(this)===t._postProcessesTakenIndices[0],samplingMode:this.renderTargetSamplingMode,
type:this._textureType})),this.onSizeChanged&&this.onSizeChanged()}this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd]),this.onActivate&&this.onActivate(t),this.clearColor?this._engine.clear(this.clearColor,!0,!0):this._engine.clear(n.clearColor,n.autoClear||n.forceWireframe,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},t.prototype.apply=function(){return this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setAlphaMode(e.Engine.ALPHA_DISABLE),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._effect._bindTexture("textureSampler",this._textures.data[this._currentRenderTextureInd]),this.onApply&&this.onApply(this._effect),this._effect):null},t.prototype.dispose=function(e){if(e=e||this._camera,this._textures.length>0){for(var t=0;t<this._textures.length;t++)this._engine._releaseTexture(this._textures.data[t]);this._textures.reset()}if(e){e.detachPostProcess(this);var r=e._postProcesses.indexOf(this);r===e._postProcessesTakenIndices[0]&&e._postProcessesTakenIndices.length>0&&(this._camera._postProcesses[e._postProcessesTakenIndices[0]].width=-1)}},t}();e.PostProcess=t}(r||(r={}));var r;!function(e){var t=function(){function e(e){this._vertexDeclaration=[2],this._vertexStrideSize=8,this._scene=e}return e.prototype._prepareBuffers=function(){if(!this._vertexBuffer){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffer=this._scene.getEngine().createVertexBuffer(e);var t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(t)}},e.prototype._prepareFrame=function(e){var t=this._scene.activeCamera._postProcesses,r=this._scene.activeCamera._postProcessesTakenIndices;return 0!==r.length&&this._scene.postProcessesEnabled?(t[this._scene.activeCamera._postProcessesTakenIndices[0]].activate(this._scene.activeCamera,e),!0):!1},e.prototype.directRender=function(e,t){for(var r=this._scene.getEngine(),n=0;n<e.length;n++){n<e.length-1?e[n+1].activate(this._scene.activeCamera,t):t?r.bindFramebuffer(t):r.restoreDefaultFramebuffer();var i=e[n],o=i.apply();o&&(i.onBeforeRender&&i.onBeforeRender(o),this._prepareBuffers(),r.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,o),r.draw(!0,0,6),i.onAfterRender&&i.onAfterRender(o))}r.setDepthBuffer(!0),r.setDepthWrite(!0)},e.prototype._finalizeFrame=function(e,t,r){r=r||this._scene.activeCamera._postProcesses;var n=this._scene.activeCamera._postProcessesTakenIndices;if(0!==n.length&&this._scene.postProcessesEnabled){for(var i=this._scene.getEngine(),o=0;o<n.length&&(o<n.length-1?r[n[o+1]].activate(this._scene.activeCamera):t?i.bindFramebuffer(t):i.restoreDefaultFramebuffer(),!e);o++){var s=r[n[o]],a=s.apply();a&&(s.onBeforeRender&&s.onBeforeRender(a),this._prepareBuffers(),i.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,a),i.draw(!0,0,6),s.onAfterRender&&s.onAfterRender(a))}i.setDepthBuffer(!0),i.setDepthWrite(!0)}},e.prototype.dispose=function(){this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},e}();e.PostProcessManager=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r,n,i,o,s){e.call(this,t,"pass",null,null,r,n,i,o,s)}return n(t,e),t}(e.PostProcess);e.PassPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s,a,u,c){var l=this;void 0===a&&(a=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,r,"blur",["screenSize","direction","blurWidth"],null,o,s,a,u,c),this.direction=n,this.blurWidth=i,this.onApply=function(e){e.setFloat2("screenSize",l.width,l.height),e.setVector2("direction",l.direction),e.setFloat("blurWidth",l.blurWidth)}}return n(r,t),r}(e.PostProcess);e.BlurPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s,a,u,c,l,h){var f=this;t.call(this,r,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],a,u,c,l,h),this.color=i,this.depth=o,this.colorLevel=s,this.onActivate=function(t){f._refRexture=f._refRexture||new e.Texture(n,t.getScene())},this.onApply=function(e){e.setColor3("baseColor",f.color),e.setFloat("depth",f.depth),e.setFloat("colorLevel",f.colorLevel),e.setTexture("refractionSampler",f._refRexture)}}return n(r,t),r.prototype.dispose=function(e){this._refRexture&&this._refRexture.dispose(),t.prototype.dispose.call(this,e)},r}(e.PostProcess);e.RefractionPostProcess=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r,n,i,o,s){e.call(this,t,"blackAndWhite",null,null,r,n,i,o,s)}return n(t,e),t}(e.PostProcess);e.BlackAndWhitePostProcess=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r,n,i,o,s,a){var u=this;e.call(this,t,"convolution",["kernel","screenSize"],null,n,i,o,s,a),this.kernel=r,this.onApply=function(e){e.setFloat2("screenSize",u.width,u.height),e.setArray("kernel",u.kernel)}}return n(t,e),t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],t}(e.PostProcess);e.ConvolutionPostProcess=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r,n,i,o,s,a){var u=this;e.call(this,t,"filter",["kernelMatrix"],null,n,i,o,s,a),this.kernelMatrix=r,this.onApply=function(e){e.setMatrix("kernelMatrix",u.kernelMatrix)}}return n(t,e),t}(e.PostProcess);e.FilterPostProcess=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r,n,i,o,s){var a=this;e.call(this,t,"fxaa",["texelSize"],null,r,n,i,o,s),this.onSizeChanged=function(){a.texelWidth=1/a.width,a.texelHeight=1/a.height},this.onApply=function(e){e.setFloat2("texelSize",a.texelWidth,a.texelHeight)}}return n(t,e),t}(e.PostProcess);e.FxaaPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s){var a=this;t.call(this,r,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n,s,n.getScene().getEngine(),!1,o?"#define IS_STEREOSCOPIC_HORIZ 1":void 0),this._stepSize=new e.Vector2(1/this.width,1/this.height),this.onSizeChanged=function(){a._stepSize=new e.Vector2(1/a.width,1/a.height)},this.onApply=function(e){e.setTextureFromPostProcess("camASampler",i),e.setFloat2("stepSize",a._stepSize.x,a._stepSize.y)}}return n(r,t),r}(e.PostProcess);e.StereoscopicInterlacePostProcess=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r,n,i,o){this.size=t,this.position=r,this.dispose=function(){this.texture&&this.texture.dispose();var e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)},this.color=n||new e.Color3(1,1,1),this.texture=i?new e.Texture(i,o.getScene(),!0):null,this._system=o,o.lensFlares.push(this)}return t}();e.LensFlare=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,r){this.name=e,this.lensFlares=new Array,this.borderLimit=300,this.layerMask=268435455,this._vertexDeclaration=[2],this._vertexStrideSize=8,this._isEnabled=!0,this._scene=r,this._emitter=t,r.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return e.material&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&r.activeCamera.layerMask)};var n=[];n.push(1,1),n.push(-1,1),n.push(-1,-1),n.push(1,-1),this._vertexBuffer=r.getEngine().createVertexBuffer(n);var i=[];i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),this._indexBuffer=r.getEngine().createIndexBuffer(i),this._effect=this._scene.getEngine().createEffect("lensFlare",["position"],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEmitter=function(){return this._emitter},t.prototype.setEmitter=function(e){this._emitter=e},t.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},t.prototype.computeEffectivePosition=function(t){var r=this.getEmitterPosition();return r=e.Vector3.Project(r,e.Matrix.Identity(),this._scene.getTransformMatrix(),t),this._positionX=r.x,this._positionY=r.y,r=e.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),r.z>0&&this._positionX>t.x&&this._positionX<t.x+t.width&&this._positionY>t.y&&this._positionY<t.y+t.height?!0:!1},t.prototype._isVisible=function(){if(!this._isEnabled)return!1;var t=this.getEmitterPosition(),r=t.subtract(this._scene.activeCamera.position),n=r.length();r.normalize();var i=new e.Ray(this._scene.activeCamera.position,r),o=this._scene.pickWithRay(i,this.meshesSelectionPredicate,!0);return!o.hit||o.distance>n},t.prototype.render=function(){if(!this._effect.isReady())return!1;var t=this._scene.getEngine(),r=this._scene.activeCamera.viewport,n=r.toGlobal(t);if(!this.computeEffectivePosition(n))return!1;if(!this._isVisible())return!1;var i,o;i=this._positionX<this.borderLimit+n.x?this.borderLimit+n.x-this._positionX:this._positionX>n.x+n.width-this.borderLimit?this._positionX-n.x-n.width+this.borderLimit:0,o=this._positionY<this.borderLimit+n.y?this.borderLimit+n.y-this._positionY:this._positionY>n.y+n.height-this.borderLimit?this._positionY-n.y-n.height+this.borderLimit:0;var s=i>o?i:o;s>this.borderLimit&&(s=this.borderLimit);var a=1-s/this.borderLimit;if(0>a)return!1;a>1&&(a=1);var u=n.x+n.width/2,c=n.y+n.height/2,l=u-this._positionX,h=c-this._positionY;t.enableEffect(this._effect),t.setState(!1),t.setDepthBuffer(!1),t.setAlphaMode(e.Engine.ALPHA_ONEONE),t.bindBuffers(this._vertexBuffer,this._indexBuffer,this._vertexDeclaration,this._vertexStrideSize,this._effect);for(var f=0;f<this.lensFlares.length;f++){var d=this.lensFlares[f],p=u-l*d.position,m=c-h*d.position,g=d.size,v=d.size*t.getAspectRatio(this._scene.activeCamera),_=2*(p/n.width)-1,y=1-2*(m/n.height),x=e.Matrix.FromValues(g/2,0,0,0,0,v/2,0,0,0,0,1,0,_,y,0,1);this._effect.setMatrix("viewportMatrix",x),this._effect.setTexture("textureSampler",d.texture),this._effect.setFloat4("color",d.color.r*a,d.color.g*a,d.color.b*a,1),t.draw(!0,0,6)}return t.setDepthBuffer(!0),t.setAlphaMode(e.Engine.ALPHA_DISABLE),!0},t.prototype.dispose=function(){for(this._vertexBuffer&&(this._scene.getEngine()._releaseBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var e=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(e,1)},t}();e.LensFlareSystem=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._registeredMeshes=[],this._physicsMaterials=[],this.updateBodyPosition=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var r=this._registeredMeshes[t];if(r.mesh===e||r.mesh===e.parent){var n=r.body,i=e.getBoundingInfo().boundingBox.center;return n.position.set(i.x,i.z,i.y),n.quaternion.x=e.rotationQuaternion.x,n.quaternion.z=e.rotationQuaternion.y,n.quaternion.y=e.rotationQuaternion.z,void(n.quaternion.w=-e.rotationQuaternion.w)}}}}return t.prototype.initialize=function(e){void 0===e&&(e=10),this._world=new CANNON.World,this._world.broadphase=new CANNON.NaiveBroadphase,this._world.solver.iterations=e},t.prototype._checkWithEpsilon=function(t){return t<e.PhysicsEngine.Epsilon?e.PhysicsEngine.Epsilon:t},t.prototype.runOneStep=function(t){this._world.step(t);for(var r=0;r<this._registeredMeshes.length;r++){var n=this._registeredMeshes[r];if(!n.isChild){var i=n.body.position.x,o=n.body.position.y,s=n.body.position.z,a=n.delta;a?(n.mesh.position.x=i+a.x,n.mesh.position.y=s+a.y,n.mesh.position.z=o+a.z):(n.mesh.position.x=i,n.mesh.position.y=s,n.mesh.position.z=o),n.mesh.rotationQuaternion||(n.mesh.rotationQuaternion=new e.Quaternion(0,0,0,1)),n.mesh.rotationQuaternion.x=n.body.quaternion.x,n.mesh.rotationQuaternion.y=n.body.quaternion.z,n.mesh.rotationQuaternion.z=n.body.quaternion.y,n.mesh.rotationQuaternion.w=-n.body.quaternion.w}}},t.prototype.setGravity=function(e){this._world.gravity.set(e.x,e.z,e.y)},t.prototype.registerMesh=function(t,r,n){switch(this.unregisterMesh(t),t.computeWorldMatrix(!0),r){case e.PhysicsEngine.SphereImpostor:var i=t.getBoundingInfo().boundingBox,o=i.maximumWorld.x-i.minimumWorld.x,s=i.maximumWorld.y-i.minimumWorld.y,a=i.maximumWorld.z-i.minimumWorld.z;return this._createSphere(Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(s),this._checkWithEpsilon(a))/2,t,n);case e.PhysicsEngine.BoxImpostor:i=t.getBoundingInfo().boundingBox;var u=i.minimumWorld,c=i.maximumWorld,l=c.subtract(u).scale(.5);return this._createBox(this._checkWithEpsilon(l.x),this._checkWithEpsilon(l.y),this._checkWithEpsilon(l.z),t,n);case e.PhysicsEngine.PlaneImpostor:return this._createPlane(t,n);case e.PhysicsEngine.MeshImpostor:var h=t.getVerticesData(e.VertexBuffer.PositionKind),f=t.getIndices();return this._createConvexPolyhedron(h,f,t,n)}return null},t.prototype._createSphere=function(e,t,r){var n=new CANNON.Sphere(e);return r?this._createRigidBodyFromShape(n,t,r.mass,r.friction,r.restitution):n},t.prototype._createBox=function(e,t,r,n,i){var o=new CANNON.Box(new CANNON.Vec3(e,r,t));return i?this._createRigidBodyFromShape(o,n,i.mass,i.friction,i.restitution):o},t.prototype._createPlane=function(e,t){var r=new CANNON.Plane;return t?this._createRigidBodyFromShape(r,e,t.mass,t.friction,t.restitution):r},t.prototype._createConvexPolyhedron=function(t,r,n,i){var o=[],s=[];n.computeWorldMatrix(!0);for(var a=0;a<t.length;a+=3){var u=e.Vector3.Zero();e.Vector3.TransformNormalFromFloatsToRef(t[a],t[a+1],t[a+2],n.getWorldMatrix(),u),o.push(new CANNON.Vec3(u.x,u.z,u.y))}for(var c=0;c<r.length;c+=3)s.push([r[c],r[c+2],r[c+1]]);var l=new CANNON.ConvexPolyhedron(o,s);return i?this._createRigidBodyFromShape(l,n,i.mass,i.friction,i.restitution):l},t.prototype._addMaterial=function(e,t){var r,n;for(r=0;r<this._physicsMaterials.length;r++)if(n=this._physicsMaterials[r],n.friction===e&&n.restitution===t)return n;var i=new CANNON.Material;for(i.friction=e,i.restitution=t,this._physicsMaterials.push(i),r=0;r<this._physicsMaterials.length;r++){n=this._physicsMaterials[r];var o=new CANNON.ContactMaterial(n,i,n.friction*i.friction,n.restitution*i.restitution);o.contactEquationStiffness=1e10,o.contactEquationRegularizationTime=10,this._world.addContactMaterial(o)}return i},t.prototype._createRigidBodyFromShape=function(t,r,n,i,o){var s=null;r.rotationQuaternion&&(s=r.rotationQuaternion.clone(),r.rotationQuaternion=new e.Quaternion(0,0,0,1));var a=r.getBoundingInfo().boundingBox,u=r.position.subtract(a.center),c=this._addMaterial(i,o),l=new CANNON.RigidBody(n,t,c);return s&&(l.quaternion.x=s.x,l.quaternion.z=s.y,l.quaternion.y=s.z,l.quaternion.w=-s.w),l.position.set(a.center.x,a.center.z,a.center.y),this._world.add(l),this._registeredMeshes.push({mesh:r,body:l,material:c,delta:u}),l},t.prototype.registerMeshesAsCompound=function(e,t){for(var r=new CANNON.Compound,n=0;n<e.length;n++){var i=e[n].mesh,o=this.registerMesh(i,e[n].impostor);0==n?r.addChild(o,new CANNON.Vec3(0,0,0)):r.addChild(o,new CANNON.Vec3(i.position.x,i.position.z,i.position.y))}var s=e[0].mesh,a=this._createRigidBodyFromShape(r,s,t.mass,t.friction,t.restitution);return a.parts=e,a},t.prototype._unbindBody=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var r=this._registeredMeshes[t];r.body===e&&(r.body=null,r.delta=0)}},t.prototype.unregisterMesh=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var r=this._registeredMeshes[t];if(r.mesh===e)return r.body&&(this._world.remove(r.body),this._unbindBody(r.body)),void this._registeredMeshes.splice(t,1)}},t.prototype.applyImpulse=function(e,t,r){for(var n=new CANNON.Vec3(r.x,r.z,r.y),i=new CANNON.Vec3(t.x,t.z,t.y),o=0;o<this._registeredMeshes.length;o++){var s=this._registeredMeshes[o];if(s.mesh===e)return void s.body.applyImpulse(i,n)}},t.prototype.createLink=function(e,t,r,n){for(var i=null,o=null,s=0;s<this._registeredMeshes.length;s++){var a=this._registeredMeshes[s];a.mesh===e?i=a.body:a.mesh===t&&(o=a.body)}if(!i||!o)return!1;var u=new CANNON.PointToPointConstraint(i,new CANNON.Vec3(r.x,r.z,r.y),o,new CANNON.Vec3(n.x,n.z,n.y));return this._world.addConstraint(u),!0},t.prototype.dispose=function(){for(;this._registeredMeshes.length;)this.unregisterMesh(this._registeredMeshes[0].mesh)},t.prototype.isSupported=function(){return void 0!==window.CANNON},t}();e.CannonJSPlugin=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._registeredMeshes=[],this.updateBodyPosition=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var r=this._registeredMeshes[t];if(r.mesh===e||r.mesh===e.parent){var n=r.body.body;e.computeWorldMatrix(!0);var i=e.getBoundingInfo().boundingBox.center;return n.setPosition(new OIMO.Vec3(i.x,i.y,i.z)),n.setRotation(new OIMO.Vec3(e.rotation.x,e.rotation.y,e.rotation.z)),void(n.sleeping=!1)}if(r.mesh.parent===e){e.computeWorldMatrix(!0),r.mesh.computeWorldMatrix(!0);var o=r.mesh.getAbsolutePosition(),s=e.rotation;return n=r.body.body,n.setPosition(new OIMO.Vec3(o.x,o.y,o.z)),n.setRotation(new OIMO.Vec3(s.x,s.y,s.z)),void(n.sleeping=!1)}}}}return t.prototype._checkWithEpsilon=function(t){return t<e.PhysicsEngine.Epsilon?e.PhysicsEngine.Epsilon:t},t.prototype.initialize=function(e){this._world=new OIMO.World,this._world.clear()},t.prototype.setGravity=function(e){this._world.gravity=e},t.prototype.registerMesh=function(t,r,n){var i=null;this.unregisterMesh(t),t.computeWorldMatrix(!0);var o=null;t.rotationQuaternion&&(o=t.rotationQuaternion.clone(),t.rotationQuaternion=new e.Quaternion(0,0,0,1),t.computeWorldMatrix(!0));var s=t.getBoundingInfo().boundingBox,a=t.position.subtract(s.center);if(o){var u=new e.Matrix;o.toRotationMatrix(u),a=e.Vector3.TransformCoordinates(a,u)}switch(r){case e.PhysicsEngine.SphereImpostor:var c=s.maximumWorld.x-s.minimumWorld.x,l=s.maximumWorld.y-s.minimumWorld.y,h=s.maximumWorld.z-s.minimumWorld.z,f=Math.max(this._checkWithEpsilon(c),this._checkWithEpsilon(l),this._checkWithEpsilon(h))/2;i=new OIMO.Body({type:"sphere",size:[f],pos:[s.center.x,s.center.y,s.center.z],rot:[t.rotation.x/OIMO.TO_RAD,t.rotation.y/OIMO.TO_RAD,t.rotation.z/OIMO.TO_RAD],move:0!=n.mass,config:[n.mass,n.friction,n.restitution],world:this._world});break;case e.PhysicsEngine.PlaneImpostor:case e.PhysicsEngine.CylinderImpostor:case e.PhysicsEngine.BoxImpostor:var d=s.minimumWorld,p=s.maximumWorld,m=p.subtract(d),g=this._checkWithEpsilon(m.x),v=this._checkWithEpsilon(m.y),_=this._checkWithEpsilon(m.z);i=new OIMO.Body({type:"box",size:[g,v,_],pos:[s.center.x,s.center.y,s.center.z],rot:[t.rotation.x/OIMO.TO_RAD,t.rotation.y/OIMO.TO_RAD,t.rotation.z/OIMO.TO_RAD],move:0!=n.mass,config:[n.mass,n.friction,n.restitution],world:this._world})}return o&&(i.body.orientation=new OIMO.Quat(o.w,o.x,o.y,o.z),i.body.syncShapes()),this._registeredMeshes.push({mesh:t,body:i,delta:a}),i},t.prototype.registerMeshesAsCompound=function(e,t){for(var r=[],n=[],i=[],o=[],s=e[0].mesh,a=0;a<e.length;a++){var u=e[a],c=this._createBodyAsCompound(u,t,s);r.push(c.type),n.push.apply(n,c.size),i.push.apply(i,c.pos),o.push.apply(o,c.rot)}var l=new OIMO.Body({type:r,size:n,pos:i,rot:o,move:0!=t.mass,config:[t.mass,t.friction,t.restitution],world:this._world});return this._registeredMeshes.push({mesh:s,body:l}),l},t.prototype._createBodyAsCompound=function(t,r,n){var i=null,o=t.mesh;switch(o.computeWorldMatrix(),t.impostor){case e.PhysicsEngine.SphereImpostor:var s=o.getBoundingInfo().boundingBox,a=s.maximumWorld.x-s.minimumWorld.x,u=s.maximumWorld.y-s.minimumWorld.y,c=s.maximumWorld.z-s.minimumWorld.z,l=Math.max(this._checkWithEpsilon(a),this._checkWithEpsilon(u),this._checkWithEpsilon(c))/2;i={type:"sphere",size:[l,-1,-1],pos:[o.position.x,o.position.y,o.position.z],rot:[o.rotation.x/OIMO.TO_RAD,o.rotation.y/OIMO.TO_RAD,o.rotation.z/OIMO.TO_RAD]};break;case e.PhysicsEngine.PlaneImpostor:case e.PhysicsEngine.BoxImpostor:s=o.getBoundingInfo().boundingBox;var h=s.minimumWorld,f=s.maximumWorld,d=f.subtract(h),p=this._checkWithEpsilon(d.x),m=this._checkWithEpsilon(d.y),g=this._checkWithEpsilon(d.z),v=o.position;i={type:"box",size:[p,m,g],pos:[v.x,v.y,v.z],rot:[o.rotation.x/OIMO.TO_RAD,o.rotation.y/OIMO.TO_RAD,o.rotation.z/OIMO.TO_RAD]}}return i},t.prototype.unregisterMesh=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var r=this._registeredMeshes[t];if(r.mesh===e||r.mesh===e.parent)return r.body&&(this._world.removeRigidBody(r.body.body),this._unbindBody(r.body)),void this._registeredMeshes.splice(t,1)}},t.prototype._unbindBody=function(e){for(var t=0;t<this._registeredMeshes.length;t++){var r=this._registeredMeshes[t];r.body===e&&(r.body=null)}},t.prototype.applyImpulse=function(e,t,r){for(var n=0;n<this._registeredMeshes.length;n++){var i=this._registeredMeshes[n];if(i.mesh===e||i.mesh===e.parent){var o=i.body.body.massInfo.mass;return void i.body.body.applyImpulse(r.scale(OIMO.INV_SCALE),t.scale(OIMO.INV_SCALE*o))}}},t.prototype.createLink=function(e,t,r,n,i){for(var o=null,s=null,a=0;a<this._registeredMeshes.length;a++){var u=this._registeredMeshes[a];u.mesh===e?o=u.body.body:u.mesh===t&&(s=u.body.body)}return o&&s?(i||(i={}),new OIMO.Link({type:i.type,body1:o,body2:s,min:i.min,max:i.max,axe1:i.axe1,axe2:i.axe2,pos1:[r.x,r.y,r.z],pos2:[n.x,n.y,n.z],collision:i.collision,spring:i.spring,world:this._world}),!0):!1},t.prototype.dispose=function(){for(this._world.clear();this._registeredMeshes.length;)this.unregisterMesh(this._registeredMeshes[0].mesh)},t.prototype.isSupported=function(){return void 0!==OIMO},t.prototype._getLastShape=function(e){for(var t=e.shapes;t.next;)t=t.next;return t},t.prototype.runOneStep=function(t){this._world.step();for(var r,n=this._registeredMeshes.length;n--;){var i=this._registeredMeshes[n].body.body,o=this._registeredMeshes[n].mesh,s=this._registeredMeshes[n].delta;if(!i.sleeping)if(i.shapes.next){var a=this._getLastShape(i);o.position.x=a.position.x*OIMO.WORLD_SCALE,o.position.y=a.position.y*OIMO.WORLD_SCALE,o.position.z=a.position.z*OIMO.WORLD_SCALE;var u=e.Matrix.FromArray(i.getMatrix());o.rotationQuaternion||(o.rotationQuaternion=new e.Quaternion(0,0,0,1)),o.rotationQuaternion.fromRotationMatrix(u),o.computeWorldMatrix()}else{r=i.getMatrix(),u=e.Matrix.FromArray(r);var c=u.m[12],l=u.m[13],h=u.m[14];s?(o.position.x=c+s.x,o.position.y=l+s.y,o.position.z=h+s.z):(o.position.x=c,o.position.y=l,o.position.z=h),o.rotationQuaternion||(o.rotationQuaternion=new e.Quaternion(0,0,0,1)),e.Quaternion.FromRotationMatrixToRef(u,o.rotationQuaternion),o.computeWorldMatrix()}}},t}();e.OimoJSPlugin=t}(r||(r={}));var r;!function(e){var t=function(){function t(t){this._currentPlugin=t||new e.OimoJSPlugin}return t.prototype._initialize=function(e){this._currentPlugin.initialize(),this._setGravity(e)},t.prototype._runOneStep=function(e){e>.1?e=.1:0>=e&&(e=1/60),this._currentPlugin.runOneStep(e)},t.prototype._setGravity=function(t){this.gravity=t||new e.Vector3(0,-9.807,0),this._currentPlugin.setGravity(this.gravity)},t.prototype._registerMesh=function(e,t,r){return this._currentPlugin.registerMesh(e,t,r)},t.prototype._registerMeshesAsCompound=function(e,t){return this._currentPlugin.registerMeshesAsCompound(e,t)},t.prototype._unregisterMesh=function(e){this._currentPlugin.unregisterMesh(e)},t.prototype._applyImpulse=function(e,t,r){this._currentPlugin.applyImpulse(e,t,r)},t.prototype._createLink=function(e,t,r,n,i){return this._currentPlugin.createLink(e,t,r,n,i)},t.prototype._updateBodyPosition=function(e){this._currentPlugin.updateBodyPosition(e)},t.prototype.dispose=function(){this._currentPlugin.dispose()},t.prototype.isSupported=function(){return this._currentPlugin.isSupported()},t.NoImpostor=0,t.SphereImpostor=1,t.BoxImpostor=2,t.PlaneImpostor=3,t.MeshImpostor=4,t.CapsuleImpostor=5,t.ConeImpostor=6,t.CylinderImpostor=7,t.ConvexHullImpostor=8,t.Epsilon=.001,t}();e.PhysicsEngine=t}(r||(r={}));var r;!function(e){var t,r=function(t){var r={};if(r.name=t.name,r.id=t.id,r.tags=e.Tags.GetTags(t),t instanceof e.PointLight)r.type=0,r.position=t.position.asArray();else if(t instanceof e.DirectionalLight){r.type=1;var n=t;r.position=n.position.asArray(),r.direction=n.direction.asArray()}else if(t instanceof e.SpotLight){r.type=2;var i=t;r.position=i.position.asArray(),r.direction=i.position.asArray(),r.angle=i.angle,r.exponent=i.exponent}else if(t instanceof e.HemisphericLight){r.type=3;var o=t;r.direction=o.direction.asArray(),r.groundColor=o.groundColor.asArray()}return t.intensity&&(r.intensity=t.intensity),r.range=t.range,r.diffuse=t.diffuse.asArray(),r.specular=t.specular.asArray(),r},n=function(e){var t={};return t.isEnabled=e.isEnabled,t.leftColor=e.leftColor,t.rightColor=e.rightColor,t.bias=e.bias,t.power=e.power,t},i=function(e,r){if(e.animations){r.animations=[];for(var n=0;n<e.animations.length;n++){var i=e.animations[n];r.animations.push(t(i))}}},o=function(t){var r={};if(r.name=t.name,r.tags=e.Tags.GetTags(t),r.id=t.id,r.position=t.position.asArray(),t.parent&&(r.parentId=t.parent.id),r.fov=t.fov,r.minZ=t.minZ,r.maxZ=t.maxZ,r.inertia=t.inertia,t instanceof e.FreeCamera?r.type="FreeCamera":t instanceof e.ArcRotateCamera?r.type="ArcRotateCamera":t instanceof e.AnaglyphArcRotateCamera?r.type="AnaglyphArcRotateCamera":t instanceof e.GamepadCamera?r.type="GamepadCamera":t instanceof e.AnaglyphFreeCamera?r.type="AnaglyphFreeCamera":t instanceof e.DeviceOrientationCamera?r.type="DeviceOrientationCamera":t instanceof e.FollowCamera?r.type="FollowCamera":t instanceof e.TouchCamera?r.type="TouchCamera":t instanceof e.VirtualJoysticksCamera?r.type="VirtualJoysticksCamera":t instanceof e.WebVRFreeCamera?r.type="WebVRFreeCamera":t instanceof e.VRDeviceOrientationFreeCamera&&(r.type="VRDeviceOrientationFreeCamera"),t instanceof e.ArcRotateCamera||t instanceof e.AnaglyphArcRotateCamera){var n=t;r.alpha=n.alpha,r.beta=n.beta,r.radius=n.radius,n.target&&n.target.id&&(r.lockedTargetId=n.target.id)}else if(t instanceof e.FollowCamera){var o=t;r.radius=o.radius,r.heightOffset=o.heightOffset,r.rotationOffset=o.rotationOffset}else(t instanceof e.AnaglyphFreeCamera||t instanceof e.AnaglyphArcRotateCamera)&&void 0!==t._interaxialDistance&&(r.interaxial_distance=e.Tools.ToDegrees(t._interaxialDistance));return void 0!==t.speed&&(r.speed=t.speed),t.target&&t.target instanceof e.Vector3&&(r.target=t.target.asArray()),t.rotation&&t.rotation instanceof e.Vector3&&(r.rotation=t.rotation.asArray()),t.lockedTarget&&t.lockedTarget.id&&(r.lockedTargetId=t.lockedTarget.id),r.checkCollisions=t.checkCollisions||!1,r.applyGravity=t.applyGravity||!1,t.ellipsoid&&(r.ellipsoid=t.ellipsoid.asArray()),i(t,r),r.layerMask=t.layerMask,r};t=function(t){var r={};r.name=t.name,r.property=t.targetProperty,r.framePerSecond=t.framePerSecond,r.dataType=t.dataType,r.loopBehavior=t.loopMode;var n=t.dataType;r.keys=[];for(var i=t.getKeys(),o=0;o<i.length;o++){var s=i[o],a={};switch(a.frame=s.frame,n){case e.Animation.ANIMATIONTYPE_FLOAT:a.values=[s.value];break;case e.Animation.ANIMATIONTYPE_QUATERNION:case e.Animation.ANIMATIONTYPE_MATRIX:case e.Animation.ANIMATIONTYPE_VECTOR3:a.values=s.value.asArray()}r.keys.push(a)}return r};var s,a=function(t){var r={};r.name=t.name,r.id=t.id,r.tags=e.Tags.GetTags(t),r.materials=[];for(var n=0;n<t.subMaterials.length;n++){var i=t.subMaterials[n];r.materials.push(i?i.id:null)}return r},u=function(t){var r={};return r.name=t.name,r.ambient=t.ambientColor.asArray(),r.diffuse=t.diffuseColor.asArray(),r.specular=t.specularColor.asArray(),r.specularPower=t.specularPower,r.emissive=t.emissiveColor.asArray(),r.useReflectionFresnelFromSpecular=r.useReflectionFresnelFromSpecular,r.useEmissiveAsIllumination=r.useEmissiveAsIllumination,r.alpha=t.alpha,r.id=t.id,r.tags=e.Tags.GetTags(t),r.backFaceCulling=t.backFaceCulling,t.diffuseTexture&&(r.diffuseTexture=s(t.diffuseTexture)),t.diffuseFresnelParameters&&(r.diffuseFresnelParameters=n(t.diffuseFresnelParameters)),t.ambientTexture&&(r.ambientTexture=s(t.ambientTexture)),t.opacityTexture&&(r.opacityTexture=s(t.opacityTexture)),t.opacityFresnelParameters&&(r.opacityFresnelParameters=n(t.opacityFresnelParameters)),t.reflectionTexture&&(r.reflectionTexture=s(t.reflectionTexture)),t.reflectionFresnelParameters&&(r.reflectionFresnelParameters=n(t.reflectionFresnelParameters)),t.emissiveTexture&&(r.emissiveTexture=s(t.emissiveTexture)),t.emissiveFresnelParameters&&(r.emissiveFresnelParameters=n(t.emissiveFresnelParameters)),t.specularTexture&&(r.specularTexture=s(t.specularTexture)),t.bumpTexture&&(r.bumpTexture=s(t.bumpTexture)),r};s=function(t){var r={};if(!t.name)return null;if(t instanceof e.CubeTexture)return r.name=t.name,r.hasAlpha=t.hasAlpha,r.isCube=!0,r.level=t.level,r.coordinatesMode=t.coordinatesMode,r;var n;if(t instanceof e.MirrorTexture){var o=t;for(r.renderTargetSize=o.getRenderSize(),r.renderList=[],n=0;n<o.renderList.length;n++)r.renderList.push(o.renderList[n].id);r.mirrorPlane=o.mirrorPlane.asArray()}else if(t instanceof e.RenderTargetTexture){var s=t;for(r.renderTargetSize=s.getRenderSize(),r.renderList=[],n=0;n<s.renderList.length;n++)r.renderList.push(s.renderList[n].id)}var a=t;return r.name=t.name,r.hasAlpha=t.hasAlpha,r.level=t.level,r.coordinatesIndex=t.coordinatesIndex,r.coordinatesMode=t.coordinatesMode,r.uOffset=a.uOffset,r.vOffset=a.vOffset,r.uScale=a.uScale,r.vScale=a.vScale,r.uAng=a.uAng,r.vAng=a.vAng,r.wAng=a.wAng,r.wrapU=t.wrapU,r.wrapV=t.wrapV,i(t,r),r};var c,l,h,f,d,p,m,g,v=function(e){var r={};r.name=e.name,r.id=e.id,r.bones=[];for(var n=0;n<e.bones.length;n++){var i=e.bones[n],o={parentBoneIndex:i.getParent()?e.bones.indexOf(i.getParent()):-1,name:i.name,matrix:i.getLocalMatrix().toArray()};r.bones.push(o),i.animations&&i.animations.length>0&&(o.animation=t(i.animations[0]))}return r},_=function(e){var t={};return t.emitterId=e.emitter.id,t.capacity=e.getCapacity(),e.particleTexture&&(t.textureName=e.particleTexture.name),t.minAngularSpeed=e.minAngularSpeed,t.maxAngularSpeed=e.maxAngularSpeed,t.minSize=e.minSize,t.maxSize=e.maxSize,t.minLifeTime=e.minLifeTime,t.maxLifeTime=e.maxLifeTime,t.emitRate=e.emitRate,t.minEmitBox=e.minEmitBox.asArray(),t.maxEmitBox=e.maxEmitBox.asArray(),t.gravity=e.gravity.asArray(),t.direction1=e.direction1.asArray(),t.direction2=e.direction2.asArray(),t.color1=e.color1.asArray(),t.color2=e.color2.asArray(),t.colorDead=e.colorDead.asArray(),t.updateSpeed=e.updateSpeed,t.targetStopDuration=e.targetStopDuration,t.textureMask=e.textureMask.asArray(),t.blendMode=e.blendMode,t},y=function(t){var r={};r.emitterId=t.getEmitter().id,r.borderLimit=t.borderLimit,r.flares=[];for(var n=0;n<t.lensFlares.length;n++){var i=t.lensFlares[n];r.flares.push({size:i.size,position:i.position,color:i.color.asArray(),textureName:e.Tools.GetFilename(i.texture.name)})}return r},x=function(e){var t={},r=e.getShadowGenerator();t.lightId=e.id,t.mapSize=r.getShadowMap().getRenderSize(),t.useVarianceShadowMap=r.useVarianceShadowMap,t.usePoissonSampling=r.usePoissonSampling,t.renderList=[];for(var n=0;n<r.getShadowMap().renderList.length;n++){var i=r.getShadowMap().renderList[n];t.renderList.push(i.id)}return t},b=[],S=function(t,r){if(!b[t.id]){if(t instanceof e.Geometry.Primitives.Box)r.boxes.push(g(t));else if(t instanceof e.Geometry.Primitives.Sphere)r.spheres.push(m(t));else if(t instanceof e.Geometry.Primitives.Cylinder)r.cylinders.push(p(t));else if(t instanceof e.Geometry.Primitives.Torus)r.toruses.push(d(t));else if(t instanceof e.Geometry.Primitives.Ground)r.grounds.push(f(t));else if(t instanceof e.Geometry.Primitives.Plane)r.planes.push(h(t));else if(t instanceof e.Geometry.Primitives.TorusKnot)r.torusKnots.push(l(t));else{if(t instanceof e.Geometry.Primitives._Primitive)throw new Error("Unknown primitive type");
r.vertexData.push(c(t))}b[t.id]=!0}},E=function(t){var r={};return r.id=t.id,e.Tags.HasTags(t)&&(r.tags=e.Tags.GetTags(t)),r};c=function(t){var r=E(t);return t.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(r.positions=t.getVerticesData(e.VertexBuffer.PositionKind)),t.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(r.normals=t.getVerticesData(e.VertexBuffer.NormalKind)),t.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(r.uvs=t.getVerticesData(e.VertexBuffer.UVKind)),t.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(r.uvs2=t.getVerticesData(e.VertexBuffer.UV2Kind)),t.isVerticesDataPresent(e.VertexBuffer.UV3Kind)&&(r.uvs3=t.getVerticesData(e.VertexBuffer.UV3Kind)),t.isVerticesDataPresent(e.VertexBuffer.UV4Kind)&&(r.uvs4=t.getVerticesData(e.VertexBuffer.UV4Kind)),t.isVerticesDataPresent(e.VertexBuffer.UV5Kind)&&(r.uvs5=t.getVerticesData(e.VertexBuffer.UV5Kind)),t.isVerticesDataPresent(e.VertexBuffer.UV6Kind)&&(r.uvs6=t.getVerticesData(e.VertexBuffer.UV6Kind)),t.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(r.colors=t.getVerticesData(e.VertexBuffer.ColorKind)),t.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(r.matricesIndices=t.getVerticesData(e.VertexBuffer.MatricesIndicesKind),r.matricesIndices._isExpanded=!0),t.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(r.matricesWeights=t.getVerticesData(e.VertexBuffer.MatricesWeightsKind)),r.indices=t.getIndices(),r};var M=function(e){var t=E(e);return t.canBeRegenerated=e.canBeRegenerated(),t};g=function(e){var t=M(e);return t.size=e.size,t},m=function(e){var t=M(e);return t.segments=e.segments,t.diameter=e.diameter,t},p=function(e){var t=M(e);return t.height=e.height,t.diameterTop=e.diameterTop,t.diameterBottom=e.diameterBottom,t.tessellation=e.tessellation,t},d=function(e){var t=M(e);return t.diameter=e.diameter,t.thickness=e.thickness,t.tessellation=e.tessellation,t},f=function(e){var t=M(e);return t.width=e.width,t.height=e.height,t.subdivisions=e.subdivisions,t},h=function(e){var t=M(e);return t.size=e.size,t},l=function(e){var t=M(e);return t.radius=e.radius,t.tube=e.tube,t.radialSegments=e.radialSegments,t.tubularSegments=e.tubularSegments,t.p=e.p,t.q=e.q,t};var T=function(t,r){var n={};n.name=t.name,n.id=t.id,e.Tags.HasTags(t)&&(n.tags=e.Tags.GetTags(t)),n.position=t.position.asArray(),t.rotationQuaternion?n.rotationQuaternion=t.rotationQuaternion.asArray():t.rotation&&(n.rotation=t.rotation.asArray()),n.scaling=t.scaling.asArray(),n.localMatrix=t.getPivotMatrix().asArray(),n.isEnabled=t.isEnabled(),n.isVisible=t.isVisible,n.infiniteDistance=t.infiniteDistance,n.pickable=t.isPickable,n.receiveShadows=t.receiveShadows,n.billboardMode=t.billboardMode,n.visibility=t.visibility,n.checkCollisions=t.checkCollisions,t.parent&&(n.parentId=t.parent.id);var o=t._geometry;if(o){var s=o.id;n.geometryId=s,t.getScene().getGeometryByID(s)||S(o,r.geometries),n.subMeshes=[];for(var a=0;a<t.subMeshes.length;a++){var u=t.subMeshes[a];n.subMeshes.push({materialIndex:u.materialIndex,verticesStart:u.verticesStart,verticesCount:u.verticesCount,indexStart:u.indexStart,indexCount:u.indexCount})}}if(t.material?n.materialId=t.material.id:t.material=null,t.skeleton&&(n.skeletonId=t.skeleton.id),t.getPhysicsImpostor()!==e.PhysicsEngine.NoImpostor)switch(n.physicsMass=t.getPhysicsMass(),n.physicsFriction=t.getPhysicsFriction(),n.physicsRestitution=t.getPhysicsRestitution(),t.getPhysicsImpostor()){case e.PhysicsEngine.BoxImpostor:n.physicsImpostor=1;break;case e.PhysicsEngine.SphereImpostor:n.physicsImpostor=2}n.instances=[];for(var c=0;c<t.instances.length;c++){var l=t.instances[c],h={name:l.name,position:l.position,rotation:l.rotation,rotationQuaternion:l.rotationQuaternion,scaling:l.scaling};n.instances.push(h),i(l,h)}return i(t,n),n.layerMask=t.layerMask,n},P=function(t,r){if(t.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||t.delayLoadState===e.Engine.DELAYLOADSTATE_NONE){t.material&&(t.material instanceof e.StandardMaterial?(r.materials=r.materials||[],r.materials.some(function(e){return e.id===t.material.id})||r.materials.push(u(t.material))):t.material instanceof e.MultiMaterial&&(r.multiMaterials=r.multiMaterials||[],r.multiMaterials.some(function(e){return e.id===t.material.id})||r.multiMaterials.push(a(t.material))));var n=t._geometry;n&&(r.geometries||(r.geometries={},r.geometries.boxes=[],r.geometries.spheres=[],r.geometries.cylinders=[],r.geometries.toruses=[],r.geometries.grounds=[],r.geometries.planes=[],r.geometries.torusKnots=[],r.geometries.vertexData=[]),S(n,r.geometries)),t.skeleton&&(r.skeletons=r.skeletons||[],r.skeletons.push(v(t.skeleton))),r.meshes=r.meshes||[],r.meshes.push(T(t,r))}},C=function(){function t(){}return t.Serialize=function(t){var n={};n.useDelayedTextureLoading=t.useDelayedTextureLoading,n.autoClear=t.autoClear,n.clearColor=t.clearColor.asArray(),n.ambientColor=t.ambientColor.asArray(),n.gravity=t.gravity.asArray(),t.fogMode&&0!==t.fogMode&&(n.fogMode=t.fogMode,n.fogColor=t.fogColor.asArray(),n.fogStart=t.fogStart,n.fogEnd=t.fogEnd,n.fogDensity=t.fogDensity),n.lights=[];var i,s;for(i=0;i<t.lights.length;i++)s=t.lights[i],n.lights.push(r(s));for(n.cameras=[],i=0;i<t.cameras.length;i++){var c=t.cameras[i];n.cameras.push(o(c))}t.activeCamera&&(n.activeCameraID=t.activeCamera.id),n.materials=[],n.multiMaterials=[];var l;for(i=0;i<t.materials.length;i++)l=t.materials[i],n.materials.push(u(l));for(n.multiMaterials=[],i=0;i<t.multiMaterials.length;i++){var h=t.multiMaterials[i];n.multiMaterials.push(a(h))}for(i=0;i<t.materials.length;i++)l=t.materials[i],l instanceof e.StandardMaterial?n.materials.push(u(l)):l instanceof e.MultiMaterial&&n.multiMaterials.push(a(l));for(n.skeletons=[],i=0;i<t.skeletons.length;i++)n.skeletons.push(v(t.skeletons[i]));n.geometries={},n.geometries.boxes=[],n.geometries.spheres=[],n.geometries.cylinders=[],n.geometries.toruses=[],n.geometries.grounds=[],n.geometries.planes=[],n.geometries.torusKnots=[],n.geometries.vertexData=[],b=[];var f=t.getGeometries();for(i=0;i<f.length;i++){var d=f[i];d.isReady()&&S(d,n.geometries)}for(n.meshes=[],i=0;i<t.meshes.length;i++){var p=t.meshes[i];if(p instanceof e.Mesh){var m=p;(m.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||m.delayLoadState===e.Engine.DELAYLOADSTATE_NONE)&&n.meshes.push(T(m,n))}}for(n.particleSystems=[],i=0;i<t.particleSystems.length;i++)n.particleSystems.push(_(t.particleSystems[i]));for(n.lensFlareSystems=[],i=0;i<t.lensFlareSystems.length;i++)n.lensFlareSystems.push(y(t.lensFlareSystems[i]));for(n.shadowGenerators=[],i=0;i<t.lights.length;i++)s=t.lights[i],s.getShadowGenerator()&&n.shadowGenerators.push(x(s));return n},t.SerializeMesh=function(t,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1);var i={};if(t=t instanceof Array?t:[t],r||n)for(var o=0;o<t.length;++o)n&&t[o].getDescendants().forEach(function(r){r instanceof e.Mesh&&t.indexOf(r)<0&&t.push(r)}),r&&t[o].parent&&t.indexOf(t[o].parent)<0&&t.push(t[o].parent);return t.forEach(function(e){P(e,i)}),i},t}();e.SceneSerializer=C}(r||(r={}));var r;!function(e){var t=0,r=function(){function t(e,t,r){this.pos=e,this.normal=t,this.uv=r}return t.prototype.clone=function(){return new t(this.pos.clone(),this.normal.clone(),this.uv.clone())},t.prototype.flip=function(){this.normal=this.normal.scale(-1)},t.prototype.interpolate=function(r,n){return new t(e.Vector3.Lerp(this.pos,r.pos,n),e.Vector3.Lerp(this.normal,r.normal,n),e.Vector2.Lerp(this.uv,r.uv,n))},t}(),n=function(){function t(e,t){this.normal=e,this.w=t}return t.FromPoints=function(r,n,i){var o=i.subtract(r),s=n.subtract(r);if(0===o.lengthSquared()||0===s.lengthSquared())return null;var a=e.Vector3.Normalize(e.Vector3.Cross(o,s));return new t(a,e.Vector3.Dot(a,r))},t.prototype.clone=function(){return new t(this.normal.clone(),this.w)},t.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},t.prototype.splitPolygon=function(r,n,o,s,a){for(var u=0,c=1,l=2,h=3,f=0,d=[],p=0;p<r.vertices.length;p++){var m=e.Vector3.Dot(this.normal,r.vertices[p].pos)-this.w,g=m<-t.EPSILON?l:m>t.EPSILON?c:u;f|=g,d.push(g)}switch(f){case u:(e.Vector3.Dot(this.normal,r.plane.normal)>0?n:o).push(r);break;case c:s.push(r);break;case l:a.push(r);break;case h:var v=[],_=[];for(p=0;p<r.vertices.length;p++){var y=(p+1)%r.vertices.length,x=d[p],b=d[y],S=r.vertices[p],E=r.vertices[y];if(x!=l&&v.push(S),x!=c&&_.push(x!=l?S.clone():S),(x|b)==h){m=(this.w-e.Vector3.Dot(this.normal,S.pos))/e.Vector3.Dot(this.normal,E.pos.subtract(S.pos));var M=S.interpolate(E,m);v.push(M),_.push(M.clone())}}if(v.length>=3){var T=new i(v,r.shared);T.plane&&s.push(T)}_.length>=3&&(T=new i(_,r.shared),T.plane&&a.push(T))}},t.EPSILON=1e-5,t}(),i=function(){function e(e,t){this.vertices=e,this.shared=t,this.plane=n.FromPoints(e[0].pos,e[1].pos,e[2].pos)}return e.prototype.clone=function(){var t=this.vertices.map(function(e){return e.clone()});return new e(t,this.shared)},e.prototype.flip=function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()},e}(),o=function(){function e(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}return e.prototype.clone=function(){var t=new e;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},e.prototype.invert=function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},e.prototype.clipPolygons=function(e){if(!this.plane)return e.slice();for(var t=[],r=[],n=0;n<e.length;n++)this.plane.splitPolygon(e[n],t,r,t,r);return this.front&&(t=this.front.clipPolygons(t)),r=this.back?this.back.clipPolygons(r):[],t.concat(r)},e.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var r=[],n=[],i=0;i<t.length;i++)this.plane.splitPolygon(t[i],this.polygons,this.polygons,r,n);r.length&&(this.front||(this.front=new e),this.front.build(r)),n.length&&(this.back||(this.back=new e),this.back.build(n))}},e}(),s=function(){function n(){this.polygons=new Array}return n.FromMesh=function(o){var s,a,u,c,l,h,f,d,p,m,g,v=new Array;if(!(o instanceof e.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";o.computeWorldMatrix(!0),f=o.getWorldMatrix(),d=o.position.clone(),p=o.rotation.clone(),o.rotationQuaternion&&(m=o.rotationQuaternion.clone()),g=o.scaling.clone();for(var _=o.getIndices(),y=o.getVerticesData(e.VertexBuffer.PositionKind),x=o.getVerticesData(e.VertexBuffer.NormalKind),b=o.getVerticesData(e.VertexBuffer.UVKind),S=o.subMeshes,E=0,M=S.length;M>E;E++)for(var T=S[E].indexStart,P=S[E].indexCount+S[E].indexStart;P>T;T+=3){h=[];for(var C=0;3>C;C++){var w=new e.Vector3(x[3*_[T+C]],x[3*_[T+C]+1],x[3*_[T+C]+2]);u=new e.Vector2(b[2*_[T+C]],b[2*_[T+C]+1]);var A=new e.Vector3(y[3*_[T+C]],y[3*_[T+C]+1],y[3*_[T+C]+2]);c=e.Vector3.TransformCoordinates(A,f),a=e.Vector3.TransformNormal(w,f),s=new r(c,a,u),h.push(s)}l=new i(h,{subMeshId:E,meshId:t,materialIndex:S[E].materialIndex}),l.plane&&v.push(l)}var D=n.FromPolygons(v);return D.matrix=f,D.position=d,D.rotation=p,D.scaling=g,D.rotationQuaternion=m,t++,D},n.FromPolygons=function(e){var t=new n;return t.polygons=e,t},n.prototype.clone=function(){var e=new n;return e.polygons=this.polygons.map(function(e){return e.clone()}),e.copyTransformAttributes(this),e},n.prototype.toPolygons=function(){return this.polygons},n.prototype.union=function(e){var t=new o(this.clone().polygons),r=new o(e.clone().polygons);return t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),n.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},n.prototype.unionInPlace=function(e){var t=new o(this.polygons),r=new o(e.polygons);t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),this.polygons=t.allPolygons()},n.prototype.subtract=function(e){var t=new o(this.clone().polygons),r=new o(e.clone().polygons);return t.invert(),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t.invert(),n.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},n.prototype.subtractInPlace=function(e){var t=new o(this.polygons),r=new o(e.polygons);t.invert(),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t.invert(),this.polygons=t.allPolygons()},n.prototype.intersect=function(e){var t=new o(this.clone().polygons),r=new o(e.clone().polygons);return t.invert(),r.clipTo(t),r.invert(),t.clipTo(r),r.clipTo(t),t.build(r.allPolygons()),t.invert(),n.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},n.prototype.intersectInPlace=function(e){var t=new o(this.polygons),r=new o(e.polygons);t.invert(),r.clipTo(t),r.invert(),t.clipTo(r),r.clipTo(t),t.build(r.allPolygons()),t.invert(),this.polygons=t.allPolygons()},n.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},n.prototype.inverseInPlace=function(){this.polygons.map(function(e){e.flip()})},n.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this},n.prototype.buildMeshGeometry=function(t,r,n){var i=this.matrix.clone();i.invert();var o,s,a,u=new e.Mesh(t,r),c=[],l=[],h=[],f=[],d=e.Vector3.Zero(),p=e.Vector3.Zero(),m=e.Vector2.Zero(),g=this.polygons,v=[0,0,0],_={},y=0,x={};n&&g.sort(function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId});for(var b=0,S=g.length;S>b;b++){o=g[b],x[o.shared.meshId]||(x[o.shared.meshId]={}),x[o.shared.meshId][o.shared.subMeshId]||(x[o.shared.meshId][o.shared.subMeshId]={indexStart:+(1/0),indexEnd:-(1/0),materialIndex:o.shared.materialIndex}),a=x[o.shared.meshId][o.shared.subMeshId];for(var E=2,M=o.vertices.length;M>E;E++){v[0]=0,v[1]=E-1,v[2]=E;for(var T=0;3>T;T++){d.copyFrom(o.vertices[v[T]].pos),p.copyFrom(o.vertices[v[T]].normal),m.copyFrom(o.vertices[v[T]].uv);var P=e.Vector3.TransformCoordinates(d,i),C=e.Vector3.TransformNormal(p,i);s=_[P.x+","+P.y+","+P.z],("undefined"==typeof s||h[3*s]!==C.x||h[3*s+1]!==C.y||h[3*s+2]!==C.z||f[2*s]!==m.x||f[2*s+1]!==m.y)&&(c.push(P.x,P.y,P.z),f.push(m.x,m.y),h.push(p.x,p.y,p.z),s=_[P.x+","+P.y+","+P.z]=c.length/3-1),l.push(s),a.indexStart=Math.min(y,a.indexStart),a.indexEnd=Math.max(y,a.indexEnd),y++}}}if(u.setVerticesData(e.VertexBuffer.PositionKind,c),u.setVerticesData(e.VertexBuffer.NormalKind,h),u.setVerticesData(e.VertexBuffer.UVKind,f),u.setIndices(l),n){var w,A=0;u.subMeshes.length=0;for(var D in x){w=-1;for(var I in x[D])a=x[D][I],e.SubMesh.CreateFromIndices(a.materialIndex+A,a.indexStart,a.indexEnd-a.indexStart+1,u),w=Math.max(a.materialIndex,w);A+=++w}}return u},n.prototype.toMesh=function(e,t,r,n){var i=this.buildMeshGeometry(e,r,n);return i.material=t,i.position.copyFrom(this.position),i.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(i.rotationQuaternion=this.rotationQuaternion.clone()),i.scaling.copyFrom(this.scaling),i.computeWorldMatrix(!0),i},n}();e.CSG=s}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o){var s=this;t.call(this,r,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,o.postProcessScaleFactor,n,e.Texture.BILINEAR_SAMPLINGMODE,null,null),this._isRightEye=i,this._distortionFactors=o.distortionK,this._postProcessScaleFactor=o.postProcessScaleFactor,this._lensCenterOffset=o.lensCenterOffset,this.onSizeChanged=function(){s.aspectRatio=.5*s.width/s.height,s._scaleIn=new e.Vector2(2,2/s.aspectRatio),s._scaleFactor=new e.Vector2(.5*(1/s._postProcessScaleFactor),.5*(1/s._postProcessScaleFactor)*s.aspectRatio),s._lensCenter=new e.Vector2(s._isRightEye?.5-.5*s._lensCenterOffset:.5+.5*s._lensCenterOffset,.5)},this.onApply=function(e){e.setFloat2("LensCenter",s._lensCenter.x,s._lensCenter.y),e.setFloat2("Scale",s._scaleFactor.x,s._scaleFactor.y),e.setFloat2("ScaleIn",s._scaleIn.x,s._scaleIn.y),e.setFloat4("HmdWarpParam",s._distortionFactors[0],s._distortionFactors[1],s._distortionFactors[2],s._distortionFactors[3])}}return n(r,t),r}(e.PostProcess);e.VRDistortionCorrectionPostProcess=t}(r||(r={}));var r;!function(e){!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(e.JoystickAxis||(e.JoystickAxis={}));var t=e.JoystickAxis,r=function(){function r(n){var i=this;this._leftJoystick=n?!0:!1,this._joystickIndex=r._globalJoystickIndex,r._globalJoystickIndex++,this._axisTargetedByLeftAndRight=t.X,this._axisTargetedByUpAndDown=t.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new e.SmartCollection,this.deltaPosition=e.Vector3.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._rotationSpeed=25,this._inverseRotationSpeed=1/(this._rotationSpeed/1e3),this._rotateOnAxisRelativeToMesh=!1,this._onResize=function(e){r.vjCanvasWidth=window.innerWidth,r.vjCanvasHeight=window.innerHeight,r.vjCanvas.width=r.vjCanvasWidth,r.vjCanvas.height=r.vjCanvasHeight,r.halfWidth=r.vjCanvasWidth/2,r.halfHeight=r.vjCanvasHeight/2},r.vjCanvas||(window.addEventListener("resize",this._onResize,!1),r.vjCanvas=document.createElement("canvas"),r.vjCanvasWidth=window.innerWidth,r.vjCanvasHeight=window.innerHeight,r.vjCanvas.width=window.innerWidth,r.vjCanvas.height=window.innerHeight,r.vjCanvas.style.width="100%",r.vjCanvas.style.height="100%",r.vjCanvas.style.position="absolute",r.vjCanvas.style.backgroundColor="transparent",r.vjCanvas.style.top="0px",r.vjCanvas.style.left="0px",r.vjCanvas.style.zIndex="5",r.vjCanvas.style.msTouchAction="none",r.vjCanvasContext=r.vjCanvas.getContext("2d"),r.vjCanvasContext.strokeStyle="#ffffff",r.vjCanvasContext.lineWidth=2,document.body.appendChild(r.vjCanvas)),r.halfWidth=r.vjCanvas.width/2,r.halfHeight=r.vjCanvas.height/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new e.Vector2(0,0),this._joystickPreviousPointerPos=new e.Vector2(0,0),this._joystickPointerStartPos=new e.Vector2(0,0),this._deltaJoystickVector=new e.Vector2(0,0),this._onPointerDownHandlerRef=function(e){i._onPointerDown(e)},this._onPointerMoveHandlerRef=function(e){i._onPointerMove(e)},this._onPointerOutHandlerRef=function(e){i._onPointerUp(e)},this._onPointerUpHandlerRef=function(e){i._onPointerUp(e)},r.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),r.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),r.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),r.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),r.vjCanvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),requestAnimationFrame(function(){i._drawVirtualJoystick()})}return r.prototype.setJoystickSensibility=function(e){this._joystickSensibility=e,this._inversedSensibility=1/(this._joystickSensibility/1e3)},r.prototype._onPointerDown=function(e){var t;e.preventDefault(),t=this._leftJoystick===!0?e.clientX<r.halfWidth:e.clientX>r.halfWidth,t&&this._joystickPointerID<0?(this._joystickPointerID=e.pointerId,this._joystickPointerStartPos.x=e.clientX,this._joystickPointerStartPos.y=e.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(e.pointerId.toString(),e)):r._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(e.pointerId.toString(),{x:e.clientX,y:e.clientY,prevX:e.clientX,prevY:e.clientY}))},r.prototype._onPointerMove=function(e){if(this._joystickPointerID==e.pointerId){this._joystickPointerPos.x=e.clientX,this._joystickPointerPos.y=e.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var r=this.reverseLeftRight?-1:1,n=r*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,n));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,n));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,n))}var i=this.reverseUpDown?1:-1,o=i*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,o));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,o));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,o))}}else this._touches.item(e.pointerId.toString())&&(this._touches.item(e.pointerId.toString()).x=e.clientX,this._touches.item(e.pointerId.toString()).y=e.clientY)},r.prototype._onPointerUp=function(e){if(this._joystickPointerID==e.pointerId)r.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-63,this._joystickPointerStartPos.y-63,126,126),r.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-41,this._joystickPreviousPointerPos.y-41,82,82),this._joystickPointerID=-1,this.pressed=!1;else{var t=this._touches.item(e.pointerId.toString());t&&r.vjCanvasContext.clearRect(t.prevX-43,t.prevY-43,86,86)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(e.pointerId.toString())},r.prototype.setJoystickColor=function(e){this._joystickColor=e},r.prototype.setActionOnTouch=function(e){this._action=e},r.prototype.setAxisForLeftRight=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByLeftAndRight=e;break;default:this._axisTargetedByLeftAndRight=t.X}},r.prototype.setAxisForUpDown=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByUpAndDown=e;break;default:this._axisTargetedByUpAndDown=t.Y}},r.prototype._clearCanvas=function(){this._leftJoystick?r.vjCanvasContext.clearRect(0,0,r.vjCanvasWidth/2,r.vjCanvasHeight):r.vjCanvasContext.clearRect(r.vjCanvasWidth/2,0,r.vjCanvasWidth,r.vjCanvasHeight)},r.prototype._drawVirtualJoystick=function(){var e=this;this.pressed&&this._touches.forEach(function(t){t.pointerId===e._joystickPointerID?(r.vjCanvasContext.clearRect(e._joystickPointerStartPos.x-63,e._joystickPointerStartPos.y-63,126,126),r.vjCanvasContext.clearRect(e._joystickPreviousPointerPos.x-41,e._joystickPreviousPointerPos.y-41,82,82),r.vjCanvasContext.beginPath(),r.vjCanvasContext.lineWidth=6,r.vjCanvasContext.strokeStyle=e._joystickColor,r.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,40,0,2*Math.PI,!0),r.vjCanvasContext.stroke(),r.vjCanvasContext.closePath(),r.vjCanvasContext.beginPath(),r.vjCanvasContext.strokeStyle=e._joystickColor,r.vjCanvasContext.lineWidth=2,r.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,60,0,2*Math.PI,!0),r.vjCanvasContext.stroke(),r.vjCanvasContext.closePath(),r.vjCanvasContext.beginPath(),r.vjCanvasContext.strokeStyle=e._joystickColor,r.vjCanvasContext.arc(e._joystickPointerPos.x,e._joystickPointerPos.y,40,0,2*Math.PI,!0),r.vjCanvasContext.stroke(),r.vjCanvasContext.closePath(),e._joystickPreviousPointerPos=e._joystickPointerPos.clone()):(r.vjCanvasContext.clearRect(t.prevX-43,t.prevY-43,86,86),r.vjCanvasContext.beginPath(),r.vjCanvasContext.fillStyle="white",r.vjCanvasContext.beginPath(),r.vjCanvasContext.strokeStyle="red",r.vjCanvasContext.lineWidth=6,r.vjCanvasContext.arc(t.x,t.y,40,0,2*Math.PI,!0),r.vjCanvasContext.stroke(),r.vjCanvasContext.closePath(),t.prevX=t.x,t.prevY=t.y)}),requestAnimationFrame(function(){e._drawVirtualJoystick()})},r.prototype.releaseCanvas=function(){r.vjCanvas&&(r.vjCanvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),r.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),r.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),r.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(r.vjCanvas),r.vjCanvas=null)},r._globalJoystickIndex=0,r}();e.VirtualJoystick=r}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i){t.call(this,r,n,i),this._leftjoystick=new e.VirtualJoystick(!0),this._leftjoystick.setAxisForUpDown(e.JoystickAxis.Z),this._leftjoystick.setAxisForLeftRight(e.JoystickAxis.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new e.VirtualJoystick(!1),this._rightjoystick.setAxisForUpDown(e.JoystickAxis.X),this._rightjoystick.setAxisForLeftRight(e.JoystickAxis.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")}return n(r,t),r.prototype.getLeftJoystick=function(){return this._leftjoystick},r.prototype.getRightJoystick=function(){return this._rightjoystick},r.prototype._checkInputs=function(){var r=50*this._computeLocalCameraSpeed(),n=e.Matrix.RotationYawPitchRoll(this.rotation.y,this.rotation.x,0),i=e.Vector3.TransformCoordinates(new e.Vector3(this._leftjoystick.deltaPosition.x*r,this._leftjoystick.deltaPosition.y*r,this._leftjoystick.deltaPosition.z*r),n);this.cameraDirection=this.cameraDirection.add(i),this.cameraRotation=this.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9)),t.prototype._checkInputs.call(this)},r.prototype.dispose=function(){this._leftjoystick.releaseCanvas(),t.prototype.dispose.call(this)},r}(e.FreeCamera);e.VirtualJoysticksCamera=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o){t.call(this,r,n),this._textures=new Array,this._floats=new Array,this._floatsArrays={},this._colors3=new Array,this._colors4=new Array,this._vectors2=new Array,this._vectors3=new Array,this._vectors4=new Array,this._matrices=new Array,this._matrices3x3=new Array,this._matrices2x2=new Array,this._cachedWorldViewMatrix=new e.Matrix,this._shaderPath=i,o.needAlphaBlending=o.needAlphaBlending||!1,o.needAlphaTesting=o.needAlphaTesting||!1,o.attributes=o.attributes||["position","normal","uv"],o.uniforms=o.uniforms||["worldViewProjection"],o.samplers=o.samplers||[],o.defines=o.defines||[],this._options=o}return n(r,t),r.prototype.needAlphaBlending=function(){return this._options.needAlphaBlending},r.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},r.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},r.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},r.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},r.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},r.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},r.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},r.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},r.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},r.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},r.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},r.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},r.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},r.prototype.isReady=function(t,r){var n=this.getScene(),i=n.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===n.getRenderId())return!0;var o=[],s=new e.EffectFallbacks;r&&o.push("#define INSTANCES");for(var a=0;a<this._options.defines.length;a++)o.push(this._options.defines[a]);t&&t.useBones&&t.computeBonesUsingShaders&&(o.push("#define BONES"),o.push("#define BonesPerMesh "+(t.skeleton.bones.length+1)),o.push("#define BONES4"),s.addFallback(0,"BONES4")),i.getAlphaTesting()&&o.push("#define ALPHATEST");var u=this._effect,c=o.join("\n");return this._effect=i.createEffect(this._shaderPath,this._options.attributes,this._options.uniforms,this._options.samplers,c,s,this.onCompiled,this.onError),this._effect.isReady()?(u!==this._effect&&n.resetCachedMaterial(),this._renderId=n.getRenderId(),!0):!1},r.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",e.multiply(t.getTransformMatrix()))},r.prototype.bind=function(e,r){if(this.bindOnlyWorldMatrix(e),this.getScene().getCachedMaterial()!==this){-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),r&&r.useBones&&r.computeBonesUsingShaders&&this._effect.setMatrices("mBones",r.skeleton.getTransformMatrices());for(var n in this._textures)this._effect.setTexture(n,this._textures[n]);for(n in this._floats)this._effect.setFloat(n,this._floats[n]);for(n in this._floatsArrays)this._effect.setArray(n,this._floatsArrays[n]);for(n in this._colors3)this._effect.setColor3(n,this._colors3[n]);for(n in this._colors4){var i=this._colors4[n];this._effect.setFloat4(n,i.r,i.g,i.b,i.a)}for(n in this._vectors2)this._effect.setVector2(n,this._vectors2[n]);for(n in this._vectors3)this._effect.setVector3(n,this._vectors3[n]);for(n in this._vectors4)this._effect.setVector4(n,this._vectors4[n]);for(n in this._matrices)this._effect.setMatrix(n,this._matrices[n]);for(n in this._matrices3x3)this._effect.setMatrix3x3(n,this._matrices3x3[n]);for(n in this._matrices2x2)this._effect.setMatrix2x2(n,this._matrices2x2[n])}t.prototype.bind.call(this,e,r)},r.prototype.clone=function(e){var t=new r(e,this.getScene(),this._shaderPath,this._options);return t},r.prototype.dispose=function(e){for(var r in this._textures)this._textures[r].dispose();this._textures=[],t.prototype.dispose.call(this,e)},r}(e.Material);e.ShaderMaterial=t}(r||(r={}));var r;!function(e){var t=function(){function t(){}return t.prototype.set=function(t,r){switch(r){case e.VertexBuffer.PositionKind:this.positions=t;break;case e.VertexBuffer.NormalKind:this.normals=t;break;case e.VertexBuffer.UVKind:this.uvs=t;break;case e.VertexBuffer.UV2Kind:this.uvs2=t;break;case e.VertexBuffer.UV3Kind:this.uvs3=t;break;case e.VertexBuffer.UV4Kind:this.uvs4=t;break;case e.VertexBuffer.UV5Kind:this.uvs5=t;break;case e.VertexBuffer.UV6Kind:this.uvs6=t;break;case e.VertexBuffer.ColorKind:this.colors=t;break;case e.VertexBuffer.MatricesIndicesKind:this.matricesIndices=t;break;case e.VertexBuffer.MatricesWeightsKind:this.matricesWeights=t}},t.prototype.applyToMesh=function(e,t){this._applyTo(e,t)},t.prototype.applyToGeometry=function(e,t){this._applyTo(e,t)},t.prototype.updateMesh=function(e,t,r){this._update(e)},t.prototype.updateGeometry=function(e,t,r){this._update(e)},t.prototype._applyTo=function(t,r){this.positions&&t.setVerticesData(e.VertexBuffer.PositionKind,this.positions,r),this.normals&&t.setVerticesData(e.VertexBuffer.NormalKind,this.normals,r),
this.uvs&&t.setVerticesData(e.VertexBuffer.UVKind,this.uvs,r),this.uvs2&&t.setVerticesData(e.VertexBuffer.UV2Kind,this.uvs2,r),this.uvs3&&t.setVerticesData(e.VertexBuffer.UV3Kind,this.uvs3,r),this.uvs4&&t.setVerticesData(e.VertexBuffer.UV4Kind,this.uvs4,r),this.uvs5&&t.setVerticesData(e.VertexBuffer.UV5Kind,this.uvs5,r),this.uvs6&&t.setVerticesData(e.VertexBuffer.UV6Kind,this.uvs6,r),this.colors&&t.setVerticesData(e.VertexBuffer.ColorKind,this.colors,r),this.matricesIndices&&t.setVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,r),this.matricesWeights&&t.setVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,r),this.indices&&t.setIndices(this.indices)},t.prototype._update=function(t,r,n){this.positions&&t.updateVerticesData(e.VertexBuffer.PositionKind,this.positions,r,n),this.normals&&t.updateVerticesData(e.VertexBuffer.NormalKind,this.normals,r,n),this.uvs&&t.updateVerticesData(e.VertexBuffer.UVKind,this.uvs,r,n),this.uvs2&&t.updateVerticesData(e.VertexBuffer.UV2Kind,this.uvs2,r,n),this.uvs3&&t.updateVerticesData(e.VertexBuffer.UV3Kind,this.uvs3,r,n),this.uvs4&&t.updateVerticesData(e.VertexBuffer.UV4Kind,this.uvs4,r,n),this.uvs5&&t.updateVerticesData(e.VertexBuffer.UV5Kind,this.uvs5,r,n),this.uvs6&&t.updateVerticesData(e.VertexBuffer.UV6Kind,this.uvs6,r,n),this.colors&&t.updateVerticesData(e.VertexBuffer.ColorKind,this.colors,r,n),this.matricesIndices&&t.updateVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,r,n),this.matricesWeights&&t.updateVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,r,n),this.indices&&t.setIndices(this.indices)},t.prototype.transform=function(t){var r,n=e.Vector3.Zero();if(this.positions){var i=e.Vector3.Zero();for(r=0;r<this.positions.length;r+=3)e.Vector3.FromArrayToRef(this.positions,r,i),e.Vector3.TransformCoordinatesToRef(i,t,n),this.positions[r]=n.x,this.positions[r+1]=n.y,this.positions[r+2]=n.z}if(this.normals){var o=e.Vector3.Zero();for(r=0;r<this.normals.length;r+=3)e.Vector3.FromArrayToRef(this.normals,r,o),e.Vector3.TransformNormalToRef(o,t,n),this.normals[r]=n.x,this.normals[r+1]=n.y,this.normals[r+2]=n.z}},t.prototype.merge=function(e){var t;if(e.indices){this.indices||(this.indices=[]);var r=this.positions?this.positions.length/3:0;for(t=0;t<e.indices.length;t++)this.indices.push(e.indices[t]+r)}if(e.positions)for(this.positions||(this.positions=[]),t=0;t<e.positions.length;t++)this.positions.push(e.positions[t]);if(e.normals)for(this.normals||(this.normals=[]),t=0;t<e.normals.length;t++)this.normals.push(e.normals[t]);if(e.uvs)for(this.uvs||(this.uvs=[]),t=0;t<e.uvs.length;t++)this.uvs.push(e.uvs[t]);if(e.uvs2)for(this.uvs2||(this.uvs2=[]),t=0;t<e.uvs2.length;t++)this.uvs2.push(e.uvs2[t]);if(e.uvs3)for(this.uvs3||(this.uvs3=[]),t=0;t<e.uvs3.length;t++)this.uvs3.push(e.uvs3[t]);if(e.uvs4)for(this.uvs4||(this.uvs4=[]),t=0;t<e.uvs4.length;t++)this.uvs4.push(e.uvs4[t]);if(e.uvs5)for(this.uvs5||(this.uvs5=[]),t=0;t<e.uvs5.length;t++)this.uvs5.push(e.uvs5[t]);if(e.uvs6)for(this.uvs6||(this.uvs6=[]),t=0;t<e.uvs6.length;t++)this.uvs6.push(e.uvs6[t]);if(e.matricesIndices)for(this.matricesIndices||(this.matricesIndices=[]),t=0;t<e.matricesIndices.length;t++)this.matricesIndices.push(e.matricesIndices[t]);if(e.matricesWeights)for(this.matricesWeights||(this.matricesWeights=[]),t=0;t<e.matricesWeights.length;t++)this.matricesWeights.push(e.matricesWeights[t]);if(e.colors)for(this.colors||(this.colors=[]),t=0;t<e.colors.length;t++)this.colors.push(e.colors[t])},t.ExtractFromMesh=function(e,r){return t._ExtractFrom(e,r)},t.ExtractFromGeometry=function(e,r){return t._ExtractFrom(e,r)},t._ExtractFrom=function(r,n){var i=new t;return r.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(i.positions=r.getVerticesData(e.VertexBuffer.PositionKind,n)),r.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(i.normals=r.getVerticesData(e.VertexBuffer.NormalKind,n)),r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(i.uvs=r.getVerticesData(e.VertexBuffer.UVKind,n)),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(i.uvs2=r.getVerticesData(e.VertexBuffer.UV2Kind,n)),r.isVerticesDataPresent(e.VertexBuffer.UV3Kind)&&(i.uvs3=r.getVerticesData(e.VertexBuffer.UV3Kind,n)),r.isVerticesDataPresent(e.VertexBuffer.UV4Kind)&&(i.uvs4=r.getVerticesData(e.VertexBuffer.UV4Kind,n)),r.isVerticesDataPresent(e.VertexBuffer.UV5Kind)&&(i.uvs5=r.getVerticesData(e.VertexBuffer.UV5Kind,n)),r.isVerticesDataPresent(e.VertexBuffer.UV6Kind)&&(i.uvs6=r.getVerticesData(e.VertexBuffer.UV6Kind,n)),r.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(i.colors=r.getVerticesData(e.VertexBuffer.ColorKind,n)),r.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(i.matricesIndices=r.getVerticesData(e.VertexBuffer.MatricesIndicesKind,n)),r.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(i.matricesWeights=r.getVerticesData(e.VertexBuffer.MatricesWeightsKind,n)),i.indices=r.getIndices(n),i},t.CreateRibbon=function(r,n,i,o,s){void 0===s&&(s=e.Mesh.DEFAULTSIDE),n=n||!1,i=i||!1;var a=Math.floor(r[0].length/2);o=o||a,o=o>a?a:Math.floor(o);var u,c,l,h,f=[],d=[],p=[],m=[],g=[],v=[],_=[],y=[],x=[],b=[];if(r.length<2){var S=[],E=[];for(l=0;l<r[0].length-o;l++)S.push(r[0][l]),E.push(r[0][l+o]);r=[S,E]}var M,T,P=0,C=i?1:0;u=r[0].length;var w,A;for(c=0;c<r.length;c++){for(_[c]=0,g[c]=[0],M=r[c],T=M.length,u=T>u?u:T,h=0;T>h;)f.push(M[h].x,M[h].y,M[h].z),h>0&&(w=M[h].subtract(M[h-1]).length(),A=w+_[c],g[c].push(A),_[c]=A),h++;i&&(h--,f.push(M[0].x,M[0].y,M[0].z),w=M[h].subtract(M[0]).length(),A=w+_[c],g[c].push(A),_[c]=A),x[c]=T+C,b[c]=P,P+=T+C}var D,I,R,O;for(l=0;u+C>l;l++){for(y[l]=0,v[l]=[0],c=0;c<r.length-1;c++)D=r[c],I=r[c+1],l===u?(R=D[0],O=I[0]):(R=D[l],O=I[l]),w=O.subtract(R).length(),A=w+y[l],v[l].push(A),y[l]=A;n&&(D=r[c],I=r[0],w=I[l].subtract(D[l]).length(),A=w+y[l],y[l]=A)}var L,F;for(c=0;c<r.length;c++)for(l=0;u+C>l;l++)L=g[c][l]/_[c],F=v[l][c]/y[l],m.push(L,F);c=0;for(var V=0,k=x[c]-1,B=x[c+1]-1,N=B>k?k:B,U=b[1]-b[0],z=n?x.length:x.length-1;N>=V&&z>c;)d.push(V,V+U,V+1),d.push(V+U+1,V+1,V+U),V+=1,V===N&&(c++,c===x.length-1?(U=b[0]-b[c],k=x[c]-1,B=x[0]-1):(U=b[c+1]-b[c],k=x[c]-1,B=x[c+1]-1),V=b[c],N=B>k?k+V:B+V);if(t.ComputeNormals(f,d,p),i){var W=0,j=0;for(c=0;c<r.length;c++)W=3*b[c],j=c+1<r.length?3*(b[c+1]-1):p.length-3,p[W]=.5*(p[W]+p[j]),p[W+1]=.5*(p[W+1]+p[j+1]),p[W+2]=.5*(p[W+2]+p[j+2]),p[j]=p[W],p[j+1]=p[W+1],p[j+2]=p[W+2]}t._ComputeSides(s,f,d,p,m);var G=new t;return G.indices=d,G.positions=f,G.normals=p,G.uvs=m,i&&(G._idx=b),G},t.CreateBox=function(r,n){void 0===n&&(n=e.Mesh.DEFAULTSIDE);var i,o=[new e.Vector3(0,0,1),new e.Vector3(0,0,-1),new e.Vector3(1,0,0),new e.Vector3(-1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,-1,0)],s=[],a=[],u=[],c=[],l=1,h=1,f=1,d=r.faceUV||new Array(6),p=[];r.faceColors&&(i=r.faceColors),void 0!==r.width?(l=r.width||1,h=r.height||1,f=r.depth||1):(l=r||1,h=r||1,f=r||1),n=n||r.sideOrientation||e.Mesh.DEFAULTSIDE;for(var m=0;6>m;m++)void 0===d[m]&&(d[m]=new e.Vector4(0,0,1,1)),i&&void 0===i[m]&&(i[m]=new e.Color4(1,1,1,1));for(var g=new e.Vector3(l/2,h/2,f/2),v=0;v<o.length;v++){var _=o[v],y=new e.Vector3(_.y,_.z,_.x),x=e.Vector3.Cross(_,y),b=a.length/3;s.push(b),s.push(b+1),s.push(b+2),s.push(b),s.push(b+2),s.push(b+3);var S=_.subtract(y).subtract(x).multiply(g);a.push(S.x,S.y,S.z),u.push(_.x,_.y,_.z),c.push(d[v].z,d[v].w),i&&p.push(i[v].r,i[v].g,i[v].b,i[v].a),S=_.subtract(y).add(x).multiply(g),a.push(S.x,S.y,S.z),u.push(_.x,_.y,_.z),c.push(d[v].x,d[v].w),i&&p.push(i[v].r,i[v].g,i[v].b,i[v].a),S=_.add(y).add(x).multiply(g),a.push(S.x,S.y,S.z),u.push(_.x,_.y,_.z),c.push(d[v].x,d[v].y),i&&p.push(i[v].r,i[v].g,i[v].b,i[v].a),S=_.add(y).subtract(x).multiply(g),a.push(S.x,S.y,S.z),u.push(_.x,_.y,_.z),c.push(d[v].z,d[v].y),i&&p.push(i[v].r,i[v].g,i[v].b,i[v].a)}t._ComputeSides(n,a,s,u,c);var E=new t;if(E.indices=s,E.positions=a,E.normals=u,E.uvs=c,i){var M=n===e.Mesh.DOUBLESIDE?p.concat(p):p;E.colors=M}return E},t.CreateSphere=function(r,n,i){void 0===i&&(i=e.Mesh.DEFAULTSIDE);var o,s,a,u;r.segments?(o=r.segments||32,s=r.diameterX||1,a=r.diameterY||1,u=r.diameterZ||1):(o=r||32,s=n||1,a=s,u=s),i=i||r.sideOrientation||e.Mesh.DEFAULTSIDE;for(var c=new e.Vector3(s/2,a/2,u/2),l=2+o,h=2*l,f=[],d=[],p=[],m=[],g=0;l>=g;g++){for(var v=g/l,_=v*Math.PI,y=0;h>=y;y++){var x=y/h,b=x*Math.PI*2,S=e.Matrix.RotationZ(-_),E=e.Matrix.RotationY(b),M=e.Vector3.TransformCoordinates(e.Vector3.Up(),S),T=e.Vector3.TransformCoordinates(M,E),P=T.multiply(c),C=e.Vector3.Normalize(P);d.push(P.x,P.y,P.z),p.push(C.x,C.y,C.z),m.push(v,x)}if(g>0)for(var w=d.length/3,A=w-2*(h+1);w>A+h+2;A++)f.push(A),f.push(A+1),f.push(A+h+1),f.push(A+h+1),f.push(A+1),f.push(A+h+2)}t._ComputeSides(i,d,f,p,m);var D=new t;return D.indices=f,D.positions=d,D.normals=p,D.uvs=m,D},t.CreateCylinder=function(r,n,i,o,s,a){void 0===s&&(s=1),void 0===a&&(a=e.Mesh.DEFAULTSIDE);var u,c,l,h,f,d=[],p=[],m=[],g=[],v=2*Math.PI/o,_=(i-n)/2/r,y=e.Vector3.Zero(),x=e.Vector3.Zero();for(h=0;s>=h;h++)for(c=h/s,l=(c*(n-i)+i)/2,f=0;o>=f;f++)u=f*v,y.x=Math.cos(-u)*l,y.y=-r/2+c*r,y.z=Math.sin(-u)*l,0===n&&h===s?(x.x=m[m.length-3*(o+1)],x.y=m[m.length-3*(o+1)+1],x.z=m[m.length-3*(o+1)+2]):(x.x=y.x,x.z=y.z,x.y=Math.sqrt(x.x*x.x+x.z*x.z)*_,x.normalize()),p.push(y.x,y.y,y.z),m.push(x.x,x.y,x.z),g.push(f/o,1-c);for(h=0;s>h;h++)for(f=0;o>f;f++){var b=h*(o+1)+f,S=(h+1)*(o+1)+f,E=h*(o+1)+(f+1),M=(h+1)*(o+1)+(f+1);d.push(b,S,E),d.push(M,E,S)}var T=function(t){var s=t?n/2:i/2;if(0!==s){var a,u,c,l=p.length/3,h=new e.Vector3(0,t?r/2:-r/2,0),f=new e.Vector2(.5,.5);for(c=0;o>c;c++){a=2*Math.PI*c/o,u=new e.Vector3(Math.cos(-a),0,Math.sin(-a));var v=u.scale(s).add(h),_=new e.Vector2(u.x*f.x+.5,u.z*f.y+.5);p.push(v.x,v.y,v.z),m.push(0,t?1:-1,0),g.push(_.x,_.y)}for(c=0;o-2>c;c++)t?(d.push(l),d.push(l+(c+2)%o),d.push(l+(c+1)%o)):(d.push(l),d.push(l+(c+1)%o),d.push(l+(c+2)%o))}};T(!0),T(!1),t._ComputeSides(a,p,d,m,g);var P=new t;return P.indices=d,P.positions=p,P.normals=m,P.uvs=g,P},t.CreateTorus=function(r,n,i,o){void 0===o&&(o=e.Mesh.DEFAULTSIDE);var s=[],a=[],u=[],c=[];r=r||1,n=n||.5,i=i||16;for(var l=i+1,h=0;i>=h;h++)for(var f=h/i,d=h*Math.PI*2/i-Math.PI/2,p=e.Matrix.Translation(r/2,0,0).multiply(e.Matrix.RotationY(d)),m=0;i>=m;m++){var g=1-m/i,v=m*Math.PI*2/i+Math.PI,_=Math.cos(v),y=Math.sin(v),x=new e.Vector3(_,y,0),b=x.scale(n/2),S=new e.Vector2(f,g);b=e.Vector3.TransformCoordinates(b,p),x=e.Vector3.TransformNormal(x,p),a.push(b.x,b.y,b.z),u.push(x.x,x.y,x.z),c.push(S.x,S.y);var E=(h+1)%l,M=(m+1)%l;s.push(h*l+m),s.push(h*l+M),s.push(E*l+m),s.push(h*l+M),s.push(E*l+M),s.push(E*l+m)}t._ComputeSides(o,a,s,u,c);var T=new t;return T.indices=s,T.positions=a,T.normals=u,T.uvs=c,T},t.CreateLines=function(e){for(var r=[],n=[],i=0;i<e.length;i++)n.push(e[i].x,e[i].y,e[i].z),i>0&&(r.push(i-1),r.push(i));var o=new t;return o.indices=r,o.positions=n,o},t.CreateDashedLines=function(r,n,i,o){n=n||3,i=i||1,o=o||200;var s=new Array,a=new Array,u=e.Vector3.Zero(),c=0,l=0,h=0,f=0,d=0,p=0,m=0;for(m=0;m<r.length-1;m++)r[m+1].subtractToRef(r[m],u),c+=u.length();for(h=c/o,f=n*h/(n+i),m=0;m<r.length-1;m++){r[m+1].subtractToRef(r[m],u),l=Math.floor(u.length()/h),u.normalize();for(var g=0;l>g;g++)d=h*g,s.push(r[m].x+d*u.x,r[m].y+d*u.y,r[m].z+d*u.z),s.push(r[m].x+(d+f)*u.x,r[m].y+(d+f)*u.y,r[m].z+(d+f)*u.z),a.push(p,p+1),p+=2}var v=new t;return v.positions=s,v.indices=a,v},t.CreateGround=function(r,n,i){var o,s,a,u=[],c=[],l=[],h=[];for(r.width?(a=r.width||1,n=r.height||1,i=r.subdivisions||1):(a=r||1,n=n||1,i=i||1),o=0;i>=o;o++)for(s=0;i>=s;s++){var f=new e.Vector3(s*a/i-a/2,0,(i-o)*n/i-n/2),d=new e.Vector3(0,1,0);c.push(f.x,f.y,f.z),l.push(d.x,d.y,d.z),h.push(s/i,1-o/i)}for(o=0;i>o;o++)for(s=0;i>s;s++)u.push(s+1+(o+1)*(i+1)),u.push(s+1+o*(i+1)),u.push(s+o*(i+1)),u.push(s+(o+1)*(i+1)),u.push(s+1+(o+1)*(i+1)),u.push(s+o*(i+1));var p=new t;return p.indices=u,p.positions=c,p.normals=l,p.uvs=h,p},t.CreateTiledGround=function(r,n,i,o,s,a){function u(t,r,n,i){var o=p.length/3,s=a.w+1;for(c=0;c<a.h;c++)for(l=0;l<a.w;l++){var u=[o+l+c*s,o+(l+1)+c*s,o+(l+1)+(c+1)*s,o+l+(c+1)*s];d.push(u[1]),d.push(u[2]),d.push(u[3]),d.push(u[0]),d.push(u[1]),d.push(u[3])}var h=e.Vector3.Zero(),f=new e.Vector3(0,1,0);for(c=0;c<=a.h;c++)for(h.z=c*(i-r)/a.h+r,l=0;l<=a.w;l++)h.x=l*(n-t)/a.w+t,h.y=0,p.push(h.x,h.y,h.z),m.push(f.x,f.y,f.z),g.push(l/a.w,c/a.h)}void 0===s&&(s={w:1,h:1}),void 0===a&&(a={w:1,h:1});var c,l,h,f,d=[],p=[],m=[],g=[];s.h=s.w<1?1:s.h,s.w=s.w<1?1:s.w,a.w=a.w<1?1:a.w,a.h=a.h<1?1:a.h;var v={w:(i-r)/s.w,h:(o-n)/s.h};for(h=0;h<s.h;h++)for(f=0;f<s.w;f++)u(r+f*v.w,n+h*v.h,r+(f+1)*v.w,n+(h+1)*v.h);var _=new t;return _.indices=d,_.positions=p,_.normals=m,_.uvs=g,_},t.CreateGroundFromHeightMap=function(r,n,i,o,s,a,u,c){var l,h,f=[],d=[],p=[],m=[];for(l=0;i>=l;l++)for(h=0;i>=h;h++){var g=new e.Vector3(h*r/i-r/2,0,(i-l)*n/i-n/2),v=(g.x+r/2)/r*(u-1)|0,_=(1-(g.z+n/2)/n)*(c-1)|0,y=4*(v+_*u),x=a[y]/255,b=a[y+1]/255,S=a[y+2]/255,E=.3*x+.59*b+.11*S;g.y=o+(s-o)*E,d.push(g.x,g.y,g.z),p.push(0,0,0),m.push(h/i,1-l/i)}for(l=0;i>l;l++)for(h=0;i>h;h++)f.push(h+1+(l+1)*(i+1)),f.push(h+1+l*(i+1)),f.push(h+l*(i+1)),f.push(h+(l+1)*(i+1)),f.push(h+1+(l+1)*(i+1)),f.push(h+l*(i+1));t.ComputeNormals(d,f,p);var M=new t;return M.indices=f,M.positions=d,M.normals=p,M.uvs=m,M},t.CreatePlane=function(r,n){void 0===n&&(n=e.Mesh.DEFAULTSIDE);var i,o,s=[],a=[],u=[],c=[];r.width?(i=r.width||1,o=r.height||1,n=r.sideOrientation||e.Mesh.DEFAULTSIDE):(i=r||1,o=r||1);var l=i/2,h=o/2;a.push(-l,-h,0),u.push(0,0,-1),c.push(0,0),a.push(l,-h,0),u.push(0,0,-1),c.push(1,0),a.push(l,h,0),u.push(0,0,-1),c.push(1,1),a.push(-l,h,0),u.push(0,0,-1),c.push(0,1),s.push(0),s.push(1),s.push(2),s.push(0),s.push(2),s.push(3),t._ComputeSides(n,a,s,u,c);var f=new t;return f.indices=s,f.positions=a,f.normals=u,f.uvs=c,f},t.CreateDisc=function(r,n,i){void 0===i&&(i=e.Mesh.DEFAULTSIDE);var o=[],s=[],a=[],u=[];o.push(0,0,0),u.push(.5,.5);for(var c=2*Math.PI/n,l=0;l<2*Math.PI;l+=c){var h=Math.cos(l),f=Math.sin(l),d=(h+1)/2,p=(1-f)/2;o.push(r*h,r*f,0),u.push(d,p)}o.push(o[3],o[4],o[5]),u.push(u[2],u[3]);for(var m=o.length/3,g=1;m-1>g;g++)s.push(g+1,0,g);t.ComputeNormals(o,s,a),t._ComputeSides(i,o,s,a,u);var v=new t;return v.indices=s,v.positions=o,v.normals=a,v.uvs=u,v},t.CreateTorusKnot=function(r,n,i,o,s,a,u){void 0===u&&(u=e.Mesh.DEFAULTSIDE);var c=[],l=[],h=[],f=[];r=r||2,n=n||.5,i=i||32,o=o||32,s=s||2,a=a||3;var d,p,m=function(t){var n=Math.cos(t),i=Math.sin(t),o=a/s*t,u=Math.cos(o),c=r*(2+u)*.5*n,l=r*(2+u)*i*.5,h=r*Math.sin(o)*.5;return new e.Vector3(c,l,h)};for(d=0;i>=d;d++){var g=d%i,v=g/i*2*s*Math.PI,_=m(v),y=m(v+.01),x=y.subtract(_),b=y.add(_),S=e.Vector3.Cross(x,b);for(b=e.Vector3.Cross(S,x),S.normalize(),b.normalize(),p=0;o>p;p++){var E=p%o,M=E/o*2*Math.PI,T=-n*Math.cos(M),P=n*Math.sin(M);l.push(_.x+T*b.x+P*S.x),l.push(_.y+T*b.y+P*S.y),l.push(_.z+T*b.z+P*S.z),f.push(d/i),f.push(p/o)}}for(d=0;i>d;d++)for(p=0;o>p;p++){var C=(p+1)%o,w=d*o+p,A=(d+1)*o+p,D=(d+1)*o+C,I=d*o+C;c.push(I),c.push(A),c.push(w),c.push(I),c.push(D),c.push(A)}t.ComputeNormals(l,c,h),t._ComputeSides(u,l,c,h,f);var R=new t;return R.indices=c,R.positions=l,R.normals=h,R.uvs=f,R},t.ComputeNormals=function(t,r,n){var i=0,o=e.Vector3.Zero(),s=e.Vector3.Zero(),a=e.Vector3.Zero(),u=e.Vector3.Zero();for(i=0;i<t.length;i++)n[i]=0;var c=r.length/3;for(i=0;c>i;i++){var l=r[3*i],h=r[3*i+1],f=r[3*i+2];o.x=t[3*l]-t[3*h],o.y=t[3*l+1]-t[3*h+1],o.z=t[3*l+2]-t[3*h+2],s.x=t[3*f]-t[3*h],s.y=t[3*f+1]-t[3*h+1],s.z=t[3*f+2]-t[3*h+2],e.Vector3.CrossToRef(o,s,a),a.normalize(),n[3*l]+=a.x,n[3*l+1]+=a.y,n[3*l+2]+=a.z,n[3*h]+=a.x,n[3*h+1]+=a.y,n[3*h+2]+=a.z,n[3*f]+=a.x,n[3*f+1]+=a.y,n[3*f+2]+=a.z}for(i=0;i<n.length/3;i++)e.Vector3.FromFloatsToRef(n[3*i],n[3*i+1],n[3*i+2],u),u.normalize(),n[3*i]=u.x,n[3*i+1]=u.y,n[3*i+2]=u.z},t._ComputeSides=function(t,r,n,i,o){var s,a,u=n.length,c=i.length;switch(t=t||e.Mesh.DEFAULTSIDE){case e.Mesh.FRONTSIDE:break;case e.Mesh.BACKSIDE:var l;for(s=0;u>s;s+=3)l=n[s],n[s]=n[s+2],n[s+2]=l;for(a=0;c>a;a++)i[a]=-i[a];break;case e.Mesh.DOUBLESIDE:for(var h=r.length,f=h/3,d=0;h>d;d++)r[h+d]=r[d];for(s=0;u>s;s+=3)n[s+u]=n[s+2]+f,n[s+1+u]=n[s+1]+f,n[s+2+u]=n[s]+f;for(a=0;c>a;a++)i[c+a]=-i[a];for(var p=o.length,m=0;p>m;m++)o[m+p]=o[m]}},t}();e.VertexData=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r,n,i,o,s){e.call(this,t,"anaglyph",null,["leftSampler"],r,n,i,o,s)}return n(t,e),t}(e.PostProcess);e.AnaglyphPostProcess=t}(r||(r={}));var r;!function(e){var t=function(){function t(){}return t.EnableFor=function(e){e._tags=e._tags||{},e.hasTags=function(){return t.HasTags(e)},e.addTags=function(r){return t.AddTagsTo(e,r)},e.removeTags=function(r){return t.RemoveTagsFrom(e,r)},e.matchesTagsQuery=function(r){return t.MatchesQuery(e,r)}},t.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},t.HasTags=function(t){return t._tags?!e.Tools.IsEmpty(t._tags):!1},t.GetTags=function(e){return e._tags?e._tags:null},t.AddTagsTo=function(e,r){if(r){var n=r.split(" ");for(var i in n)t._AddTagTo(e,n[i])}},t._AddTagTo=function(e,r){r=r.trim(),""!==r&&"true"!==r&&"false"!==r&&(r.match(/[\s]/)||r.match(/^([!]|([|]|[&]){2})/)||(t.EnableFor(e),e._tags[r]=!0))},t.RemoveTagsFrom=function(e,r){if(t.HasTags(e)){var n=r.split(" ");for(var i in n)t._RemoveTagFrom(e,n[i])}},t._RemoveTagFrom=function(e,t){delete e._tags[t]},t.MatchesQuery=function(r,n){return void 0===n?!0:""===n?t.HasTags(r):e.Internals.AndOrNotEvaluator.Eval(n,function(e){return t.HasTags(r)&&r._tags[e]})},t}();e.Tags=t}(r||(r={}));var r;!function(e){var t;!function(e){var t=function(){function e(){}return e.Eval=function(t,r){return t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,r)}):e._HandleParenthesisContent(t,r),"true"===t?!0:"false"===t?!1:e.Eval(t,r)},e._HandleParenthesisContent=function(t,r){r=r||function(e){return"true"===e?!0:!1};var n,i=t.split("||");for(var o in i){var s=e._SimplifyNegation(i[o].trim()),a=s.split("&&");if(a.length>1)for(var u=0;u<a.length;++u){var c=e._SimplifyNegation(a[u].trim());if(n="true"!==c&&"false"!==c?"!"===c[0]?!r(c.substring(1)):r(c):"true"===c?!0:!1,!n){s="false";break}}if(n||"true"===s){n=!0;break}n="true"!==s&&"false"!==s?"!"===s[0]?!r(s.substring(1)):r(s):"true"===s?!0:!1}return n?"true":"false"},e._SimplifyNegation=function(e){return e=e.replace(/^[\s!]+/,function(e){return e=e.replace(/[\s]/g,function(){return""}),e.length%2?"!":""}),e=e.trim(),"!true"===e?e="false":"!false"===e&&(e="true"),e},e}();e.AndOrNotEvaluator=t}(t=e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(){function t(t,r,n,i,o,s){this._enabled=!0,this._refCount=0,this._name=r,this._renderTexture=new e.RenderTargetTexture(r,n,t),this.setRenderList(i),this._renderTexture.onBeforeRender=o,this._renderTexture.onAfterRender=s,this._scene=t,this._renderList=i}return t.prototype._incRefCount=function(){return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},t.prototype._decRefCount=function(){return this._refCount--,this._refCount<=0&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount},t.prototype._update=function(){this.setRenderList(this._renderList)},t.prototype.setRenderList=function(e){this._renderTexture.renderList=e},t.prototype.getRenderTexture=function(){return this._renderTexture},t}();e.PostProcessRenderPass=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,r,n){this._engine=e,this._name=t,this._singleInstance=n||!0,this._getPostProcess=r,this._cameras=[],this._indicesForCamera=[],this._postProcesses={},this._renderPasses={},this._renderEffectAsPasses={}}return t.prototype._update=function(){for(var e in this._renderPasses)this._renderPasses[e]._update()},t.prototype.addPass=function(e){this._renderPasses[e._name]=e,this._linkParameters()},t.prototype.removePass=function(e){delete this._renderPasses[e._name],this._linkParameters()},t.prototype.addRenderEffectAsPass=function(e){this._renderEffectAsPasses[e._name]=e,this._linkParameters()},t.prototype.getPass=function(e){for(var t in this._renderPasses)if(t===e)return this._renderPasses[e]},t.prototype.emptyPasses=function(){this._renderPasses={},this._linkParameters()},t.prototype._attachCameras=function(t){for(var r,n=e.Tools.MakeArray(t||this._cameras),i=0;i<n.length;i++){var o=n[i],s=o.name;r=this._singleInstance?0:s,this._postProcesses[r]=this._postProcesses[r]||this._getPostProcess();var a=o.attachPostProcess(this._postProcesses[r]);this._indicesForCamera[s]||(this._indicesForCamera[s]=[]),this._indicesForCamera[s].push(a),-1===this._cameras.indexOf(o)&&(this._cameras[s]=o);for(var u in this._renderPasses)this._renderPasses[u]._incRefCount()}this._linkParameters()},t.prototype._detachCameras=function(t){for(var r=e.Tools.MakeArray(t||this._cameras),n=0;n<r.length;n++){var i=r[n],o=i.name;i.detachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o]);var s=this._cameras.indexOf(o);this._indicesForCamera.splice(s,1),this._cameras.splice(s,1);for(var a in this._renderPasses)this._renderPasses[a]._decRefCount()}},t.prototype._enable=function(t){for(var r=e.Tools.MakeArray(t||this._cameras),n=0;n<r.length;n++){for(var i=r[n],o=i.name,s=0;s<this._indicesForCamera[o].length;s++)void 0===i._postProcesses[this._indicesForCamera[o][s]]&&t[n].attachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o][s]);for(var a in this._renderPasses)this._renderPasses[a]._incRefCount()}},t.prototype._disable=function(t){for(var r=e.Tools.MakeArray(t||this._cameras),n=0;n<r.length;n++){var i=r[n],o=i.Name;i.detachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o]);for(var s in this._renderPasses)this._renderPasses[s]._decRefCount()}},t.prototype.getPostProcess=function(e){return this._singleInstance?this._postProcesses[0]:this._postProcesses[e.name]},t.prototype._linkParameters=function(){var e=this;for(var t in this._postProcesses)this.applyParameters&&this.applyParameters(this._postProcesses[t]),this._postProcesses[t].onBeforeRender=function(t){e._linkTextures(t)}},t.prototype._linkTextures=function(e){for(var t in this._renderPasses)e.setTexture(t,this._renderPasses[t].getRenderTexture());for(var r in this._renderEffectAsPasses)e.setTextureFromPostProcess(r+"Sampler",this._renderEffectAsPasses[r].getPostProcess())},t}();e.PostProcessRenderEffect=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t){this._engine=e,this._name=t,this._renderEffects={},this._renderEffectsForIsolatedPass={},this._cameras=[]}return t.prototype.addEffect=function(e){this._renderEffects[e._name]=e},t.prototype._enableEffect=function(t,r){var n=this._renderEffects[t];n&&n._enable(e.Tools.MakeArray(r||this._cameras))},t.prototype._disableEffect=function(t,r){var n=this._renderEffects[t];n&&n._disable(e.Tools.MakeArray(r||this._cameras))},t.prototype._attachCameras=function(t,r){for(var n=e.Tools.MakeArray(t||this._cameras),i=[],o=0;o<n.length;o++){var s=n[o],a=s.name;-1===this._cameras.indexOf(s)?this._cameras[a]=s:r&&i.push(o)}for(var o=0;o<i.length;o++)t.splice(i[o],1);for(var u in this._renderEffects)this._renderEffects[u]._attachCameras(n)},t.prototype._detachCameras=function(t){var r=e.Tools.MakeArray(t||this._cameras);for(var n in this._renderEffects)this._renderEffects[n]._detachCameras(r);for(var i=0;i<r.length;i++)this._cameras.splice(this._cameras.indexOf(r[i]),1)},t.prototype._enableDisplayOnlyPass=function(r,n){var i=this,o=e.Tools.MakeArray(n||this._cameras),s=null;for(var a in this._renderEffects)if(s=this._renderEffects[a].getPass(r),null!=s)break;if(null!==s){for(var a in this._renderEffects)this._renderEffects[a]._disable(o);s._name=t.PASS_SAMPLER_NAME;for(var u=0;u<o.length;u++){var c=o[u],l=c.name;this._renderEffectsForIsolatedPass[l]=this._renderEffectsForIsolatedPass[l]||new e.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,function(){return new e.DisplayPassPostProcess(t.PASS_EFFECT_NAME,1,null,null,i._engine,!0)}),this._renderEffectsForIsolatedPass[l].emptyPasses(),this._renderEffectsForIsolatedPass[l].addPass(s),this._renderEffectsForIsolatedPass[l]._attachCameras(c)}}},t.prototype._disableDisplayOnlyPass=function(r){for(var n=this,i=e.Tools.MakeArray(r||this._cameras),o=0;o<i.length;o++){var s=i[o],a=s.name;this._renderEffectsForIsolatedPass[a]=this._renderEffectsForIsolatedPass[a]||new e.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,function(){return new e.DisplayPassPostProcess(t.PASS_EFFECT_NAME,1,null,null,n._engine,!0)}),this._renderEffectsForIsolatedPass[a]._disable(s)}for(var u in this._renderEffects)this._renderEffects[u]._enable(i)},t.prototype._update=function(){for(var e in this._renderEffects)this._renderEffects[e]._update();for(var t=0;t<this._cameras.length;t++){var r=this._cameras[t].name;this._renderEffectsForIsolatedPass[r]&&this._renderEffectsForIsolatedPass[r]._update()}},t.PASS_EFFECT_NAME="passEffect",t.PASS_SAMPLER_NAME="passSampler",t}();e.PostProcessRenderPipeline=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this._renderPipelines={}}return e.prototype.addPipeline=function(e){this._renderPipelines[e._name]=e},e.prototype.attachCamerasToRenderPipeline=function(e,t,r){var n=this._renderPipelines[e];n&&n._attachCameras(t,r)},e.prototype.detachCamerasFromRenderPipeline=function(e,t){var r=this._renderPipelines[e];r&&r._detachCameras(t)},e.prototype.enableEffectInPipeline=function(e,t,r){var n=this._renderPipelines[e];n&&n._enableEffect(t,r)},e.prototype.disableEffectInPipeline=function(e,t,r){var n=this._renderPipelines[e];n&&n._disableEffect(t,r)},e.prototype.enableDisplayOnlyPassInPipeline=function(e,t,r){var n=this._renderPipelines[e];n&&n._enableDisplayOnlyPass(t,r)},e.prototype.disableDisplayOnlyPassInPipeline=function(e,t){var r=this._renderPipelines[e];r&&r._disableDisplayOnlyPass(t)},e.prototype.update=function(){for(var e in this._renderPipelines)this._renderPipelines[e]._update()},e}();e.PostProcessRenderPipelineManager=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r,n,i,o,s){e.call(this,t,"displayPass",["passSampler"],["passSampler"],r,n,i,o,s)}return n(t,e),t}(e.PostProcess);e.DisplayPassPostProcess=t}(r||(r={}));var r;!function(e){var t=function(){function t(t){this.frontColor=new e.Color3(1,1,1),this.backColor=new e.Color3(.1,.1,.1),this.showBackLines=!0,this.renderList=new e.SmartArray(32),this._scene=t}return t.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new e.ShaderMaterial("colorShader",this._scene,"color",{attributes:["position"],uniforms:["worldViewProjection","color"]});var t=this._scene.getEngine(),r=e.VertexData.CreateBox(1);this._vb=new e.VertexBuffer(t,r.positions,e.VertexBuffer.PositionKind,!1),this._ib=t.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])}},t.prototype.reset=function(){this.renderList.reset()},t.prototype.render=function(){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var t=this._scene.getEngine();t.setDepthWrite(!1),this._colorShader._preBind();for(var r=0;r<this.renderList.length;r++){var n=this.renderList.data[r],i=n.minimum,o=n.maximum,s=o.subtract(i),a=i.add(s.scale(.5)),u=e.Matrix.Scaling(s.x,s.y,s.z).multiply(e.Matrix.Translation(a.x,a.y,a.z)).multiply(n.getWorldMatrix());t.bindBuffers(this._vb.getBuffer(),this._ib,[3],12,this._colorShader.getEffect()),this.showBackLines&&(t.setDepthFunctionToGreaterOrEqual(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(u),t.draw(!1,0,24)),t.setDepthFunctionToLess(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(u),t.draw(!1,0,24)}this._colorShader.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0)}},t.prototype.dispose=function(){this._colorShader&&(this._colorShader.dispose(),this._vb.dispose(),this._scene.getEngine()._releaseBuffer(this._ib))},t}();e.BoundingBoxRenderer=t}(r||(r={}));var r;!function(e){var t=function(){function e(e){this._actionManager=e}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e}();e.Condition=t;var r=function(e){function t(r,n,i,o,s){void 0===s&&(s=t.IsEqual),e.call(this,r),this.propertyPath=i,this.value=o,this.operator=s,this._target=this._getEffectiveTarget(n,this.propertyPath),this._property=this._getProperty(this.propertyPath)}return n(t,e),Object.defineProperty(t,"IsEqual",{get:function(){return t._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsDifferent",{get:function(){return t._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsGreater",{get:function(){return t._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsLesser",{get:function(){return t._IsLesser},enumerable:!0,configurable:!0}),t.prototype.isValid=function(){switch(this.operator){case t.IsGreater:return this._target[this._property]>this.value;case t.IsLesser:return this._target[this._property]<this.value;case t.IsEqual:case t.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._target[this._property]):this.value===this._target[this._property],this.operator===t.IsEqual?e:!e}return!1},t._IsEqual=0,t._IsDifferent=1,t._IsGreater=2,t._IsLesser=3,t}(t);e.ValueCondition=r;var i=function(e){function t(t,r){e.call(this,t),this.predicate=r}return n(t,e),t.prototype.isValid=function(){return this.predicate()},t}(t);e.PredicateCondition=i;var o=function(e){function t(t,r,n){e.call(this,t),this.value=n,this._target=r}return n(t,e),t.prototype.isValid=function(){return this._target.state===this.value},t}(t);e.StateCondition=o}(r||(r={}));var r;!function(e){var t=function(){function e(e,t){this.triggerOptions=e,e.parameter?(this.trigger=e.trigger,this._triggerParameter=e.parameter):this.trigger=e,this._nextActiveAction=this,this._condition=t}return e.prototype._prepare=function(){},e.prototype.getTriggerParameter=function(){return this._triggerParameter},e.prototype._executeCurrent=function(e){if(this._nextActiveAction._condition){var t=this._nextActiveAction._condition,r=this._actionManager.getScene().getRenderId();if(t._evaluationId===r){if(!t._currentResult)return}else{if(t._evaluationId=r,!t.isValid())return void(t._currentResult=!1);t._currentResult=!0}}this._nextActiveAction.execute(e),this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},e.prototype.execute=function(e){},e.prototype.then=function(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e}();e.Action=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,r,n,i,o){this.source=e,this.pointerX=t,this.pointerY=r,this.meshUnderPointer=n,this.sourceEvent=i,this.additionalData=o}return e.CreateNew=function(t,r,n){var i=t.getScene();return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer,r,n)},e.CreateNewFromScene=function(t,r){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,r)},e}();e.ActionEvent=t;var r=function(){function t(e){this.actions=new Array,this._scene=e,e._actionManagers.push(this)}return Object.defineProperty(t,"NothingTrigger",{get:function(){return t._NothingTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickTrigger",{get:function(){return t._OnPickTrigger},enumerable:!0,configurable:!0
}),Object.defineProperty(t,"OnLeftPickTrigger",{get:function(){return t._OnLeftPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnRightPickTrigger",{get:function(){return t._OnRightPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnCenterPickTrigger",{get:function(){return t._OnCenterPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOverTrigger",{get:function(){return t._OnPointerOverTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOutTrigger",{get:function(){return t._OnPointerOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnEveryFrameTrigger",{get:function(){return t._OnEveryFrameTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionEnterTrigger",{get:function(){return t._OnIntersectionEnterTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionExitTrigger",{get:function(){return t._OnIntersectionExitTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyDownTrigger",{get:function(){return t._OnKeyDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyUpTrigger",{get:function(){return t._OnKeyUpTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickUpTrigger",{get:function(){return t._OnPickUpTrigger},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var e=this._scene._actionManagers.indexOf(this);e>-1&&this._scene._actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var t=0;t<this.actions.length;t++){var r=this.actions[t];if(e.indexOf(r.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTrigger=function(e){for(var t=0;t<this.actions.length;t++){var r=this.actions[t];if(r.trigger===e)return!0}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var r=this.actions[e];if(r.trigger>=t._OnPickTrigger&&r.trigger<=t._OnPointerOutTrigger)return!0;if(r.trigger==t._OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var r=this.actions[e];if(r.trigger>=t._OnPickTrigger&&r.trigger<=t._OnCenterPickTrigger)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.registerAction=function(r){return r.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(e.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(r),r._actionManager=this,r._prepare(),r)},t.prototype.processTrigger=function(e,r){for(var n=0;n<this.actions.length;n++){var i=this.actions[n];if(i.trigger===e){if(e===t.OnKeyUpTrigger||e===t.OnKeyDownTrigger){var o=i.getTriggerParameter();if(o){var s=r.sourceEvent.charCode?r.sourceEvent.charCode:r.sourceEvent.keyCode,a=String.fromCharCode(s).toLowerCase();if(a!==o.toLowerCase())continue}}i._executeCurrent(r)}}},t.prototype._getEffectiveTarget=function(e,t){for(var r=t.split("."),n=0;n<r.length-1;n++)e=e[r[n]];return e},t.prototype._getProperty=function(e){var t=e.split(".");return t[t.length-1]},t._NothingTrigger=0,t._OnPickTrigger=1,t._OnLeftPickTrigger=2,t._OnRightPickTrigger=3,t._OnCenterPickTrigger=4,t._OnPointerOverTrigger=5,t._OnPointerOutTrigger=6,t._OnEveryFrameTrigger=7,t._OnIntersectionEnterTrigger=8,t._OnIntersectionExitTrigger=9,t._OnKeyDownTrigger=10,t._OnKeyUpTrigger=11,t._OnPickUpTrigger=12,t}();e.ActionManager=r}(r||(r={}));var r;!function(e){var t=function(t){function r(e,r,n,i,o,s,a){void 0===o&&(o=1e3),t.call(this,e,s),this.propertyPath=n,this.value=i,this.duration=o,this.stopOtherAnimations=a,this._target=r}return n(r,t),r.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},r.prototype.execute=function(){var t,r=this._actionManager.getScene(),n=[{frame:0,value:this._target[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)t=e.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");t=e.Animation.ANIMATIONTYPE_QUATERNION}var i=new e.Animation("InterpolateValueAction",this._property,100*(1e3/this.duration),t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);i.setKeys(n),this.stopOtherAnimations&&r.stopAnimation(this._target),r.beginDirectAnimation(this._target,[i],0,100)},r}(e.Action);e.InterpolateValueAction=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r,n,i){e.call(this,t,i),this.propertyPath=n,this._target=r}return n(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=!this._target[this._property]},t}(e.Action);e.SwitchBooleanAction=t;var r=function(e){function t(t,r,n,i){e.call(this,t,i),this.value=n,this._target=r}return n(t,e),t.prototype.execute=function(){this._target.state=this.value},t}(e.Action);e.SetStateAction=r;var i=function(e){function t(t,r,n,i,o){e.call(this,t,o),this.propertyPath=n,this.value=i,this._target=r}return n(t,e),t.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._target[this._property]=this.value},t}(e.Action);e.SetValueAction=i;var o=function(t){function r(e,r,n,i,o){t.call(this,e,o),this.propertyPath=n,this.value=i,this._target=r}return n(r,t),r.prototype._prepare=function(){this._target=this._getEffectiveTarget(this._target,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._target[this._property]&&e.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},r.prototype.execute=function(){this._target[this._property]+=this.value},r}(e.Action);e.IncrementValueAction=o;var s=function(e){function t(t,r,n,i,o,s){e.call(this,t,s),this.from=n,this.to=i,this.loop=o,this._target=r}return n(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.beginAnimation(this._target,this.from,this.to,this.loop)},t}(e.Action);e.PlayAnimationAction=s;var a=function(e){function t(t,r,n){e.call(this,t,n),this._target=r}return n(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){var e=this._actionManager.getScene();e.stopAnimation(this._target)},t}(e.Action);e.StopAnimationAction=a;var u=function(t){function r(r,n){void 0===r&&(r=e.ActionManager.NothingTrigger),t.call(this,r,n)}return n(r,t),r.prototype.execute=function(){},r}(e.Action);e.DoNothingAction=u;var c=function(e){function t(t,r,n){e.call(this,t,n),this.children=r}return n(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t}(e.Action);e.CombineAction=c;var l=function(e){function t(t,r,n){e.call(this,t,n),this.func=r}return n(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=l;var h=function(t){function r(e,r,n,i){t.call(this,e,i),this._target=r,this._parent=n}return n(r,t),r.prototype._prepare=function(){},r.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},r}(e.Action);e.SetParentAction=h;var f=function(e){function t(t,r,n){e.call(this,t,n),this._sound=r}return n(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t}(e.Action);e.PlaySoundAction=f;var d=function(e){function t(t,r,n){e.call(this,t,n),this._sound=r}return n(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t}(e.Action);e.StopSoundAction=d}(r||(r={}));var r;!function(e){var t=function(){function t(t,r,n,i,o){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._indices=[],this._isDisposed=!1,this.id=t,this._engine=r.getEngine(),this._meshes=[],this._scene=r,n?this.setAllVerticesData(n,i):(this._totalVertices=0,this._indices=[]),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0))}return t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,r,n,i){if(this._vertexBuffers=this._vertexBuffers||{},this._vertexBuffers[t]&&this._vertexBuffers[t].dispose(),this._vertexBuffers[t]=new e.VertexBuffer(this._engine,r,t,n,0===this._meshes.length,i),t===e.VertexBuffer.PositionKind){i=this._vertexBuffers[t].getStrideSize(),this._totalVertices=r.length/i;for(var o=e.Tools.ExtractMinAndMax(r,0,this._totalVertices),s=this._meshes,a=s.length,u=0;a>u;u++){var c=s[u];c._resetPointsArrayCache(),c._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum),c._createGlobalSubMesh(),c.computeWorldMatrix(!0)}}this.notifyUpdate(t)},t.prototype.updateVerticesDataDirectly=function(e,t,r){var n=this.getVertexBuffer(e);n&&(n.updateDirectly(t,r),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,r,n){var i=this.getVertexBuffer(t);if(i){if(i.update(r),t===e.VertexBuffer.PositionKind){var o,s=i.getStrideSize();this._totalVertices=r.length/s,n&&(o=e.Tools.ExtractMinAndMax(r,0,this._totalVertices));for(var a=this._meshes,u=a.length,c=0;u>c;c++){var l=a[c];if(l._resetPointsArrayCache(),n){l._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum);for(var h=0;h<l.subMeshes.length;h++){var f=l.subMeshes[h];f.refreshBoundingInfo()}}}}this.notifyUpdate(t)}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e,t){var r=this.getVertexBuffer(e);if(!r)return null;var n=r.getData();if(t&&1!==this._meshes.length){for(var i=n.length,o=[],s=0;i>s;s++)o.push(n[s]);return o}return n},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:this._delayInfo?-1!==this._delayInfo.indexOf(e):!1},t.prototype.getVerticesDataKinds=function(){var e=[];if(!this._vertexBuffers&&this._delayInfo)for(var t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},t.prototype.setIndices=function(e,t){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),void 0!==t&&(this._totalVertices=t);for(var r=this._meshes,n=r.length,i=0;n>i;i++)r[i]._createGlobalSubMesh();this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e){if(!this.isReady())return null;var t=this._indices;if(e&&1!==this._meshes.length){for(var r=t.length,n=[],i=0;r>i;i++)n.push(t[i]);return n}return t},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(e,t){var r=this._meshes,n=r.indexOf(e);if(-1!==n){for(var i in this._vertexBuffers)this._vertexBuffers[i].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),r.splice(n,1),e._geometry=null,0===r.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var r=this._meshes;e._geometry=this,this._scene.pushGeometry(this),r.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype._applyToMesh=function(t){var r=this._meshes.length;for(var n in this._vertexBuffers)if(1===r&&this._vertexBuffers[n].create(),this._vertexBuffers[n]._buffer.references=r,n===e.VertexBuffer.PositionKind){t._resetPointsArrayCache();var i=e.Tools.ExtractMinAndMax(this._vertexBuffers[n].getData(),0,this._totalVertices);t._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum),t._createGlobalSubMesh(),t._updateBoundingInfo()}1===r&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=r)},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e)},t.prototype.load=function(t,r){var n=this;if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(r&&r());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(i){n._delayLoadingFunction(JSON.parse(i),n),n.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,n._delayInfo=[],t._removePendingData(n);for(var o=n._meshes,s=o.length,a=0;s>a;a++)n._applyToMesh(o[a]);r&&r()},function(){},t.database)}},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype.dispose=function(){var t,r=this._meshes,n=r.length;for(t=0;n>t;t++)this.releaseForMesh(r[t]);this._meshes=[];for(var i in this._vertexBuffers)this._vertexBuffers[i].dispose();this._vertexBuffers=[],this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(r){var n=new e.VertexData;n.indices=[];for(var i=this.getIndices(),o=0;o<i.length;o++)n.indices.push(i[o]);var s=!1,a=!1;for(var u in this._vertexBuffers)n.set(this.getVerticesData(u).slice(0),u),a||(s=this.getVertexBuffer(u).isUpdatable(),a=!s);var c=new t(r,this._scene,n,s,null);c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction;for(u in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(u);var l=e.Tools.ExtractMinAndMax(this.getVerticesData(e.VertexBuffer.PositionKind),0,this.getTotalVertices());return c._boundingInfo=new e.BoundingInfo(l.minimum,l.maximum),c},t.ExtractFromMesh=function(e,t){var r=e._geometry;return r?r.copy(t):null},t.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,r="x"===e?t:3&t|8;return r.toString(16)})},t}();e.Geometry=t;var t;!function(t){var r;!function(r){var i=function(e){function t(t,r,n,i,o){this._beingRegenerated=!0,this._canBeRegenerated=i,e.call(this,t,r,n,!1,o),this._beingRegenerated=!1}return n(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,r){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,r,n){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,r,!1)},t.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},t.prototype.copy=function(e){throw new Error("Must be overriden in sub-classes.")},t}(t);r._Primitive=i;var o=function(t){function r(r,n,i,o,s,a,u,c,l){void 0===l&&(l=e.Mesh.DEFAULTSIDE),this.pathArray=i,this.closeArray=o,this.closePath=s,this.offset=a,this.side=l,t.call(this,r,n,this._regenerateVertexData(),u,c)}return n(r,t),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon(this.pathArray,this.closeArray,this.closePath,this.offset,this.side)},r.prototype.copy=function(e){return new r(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},r}(i);r.Ribbon=o;var s=function(t){function r(r,n,i,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=i,this.side=a,t.call(this,r,n,this._regenerateVertexData(),o,s)}return n(r,t),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox(this.size,this.side)},r.prototype.copy=function(e){return new r(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},r}(i);r.Box=s;var a=function(t){function r(r,n,i,o,s,a,u){void 0===u&&(u=e.Mesh.DEFAULTSIDE),this.segments=i,this.diameter=o,this.side=u,t.call(this,r,n,this._regenerateVertexData(),s,a)}return n(r,t),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere(this.segments,this.diameter,this.side)},r.prototype.copy=function(e){return new r(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},r}(i);r.Sphere=a;var u=function(t){function r(r,n,i,o,s,a,u,c,l,h){void 0===u&&(u=1),void 0===h&&(h=e.Mesh.DEFAULTSIDE),this.height=i,this.diameterTop=o,this.diameterBottom=s,this.tessellation=a,this.subdivisions=u,this.side=h,t.call(this,r,n,this._regenerateVertexData(),c,l)}return n(r,t),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder(this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.side)},r.prototype.copy=function(e){return new r(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},r}(i);r.Cylinder=u;var c=function(t){function r(r,n,i,o,s,a,u,c){void 0===c&&(c=e.Mesh.DEFAULTSIDE),this.diameter=i,this.thickness=o,this.tessellation=s,this.side=c,t.call(this,r,n,this._regenerateVertexData(),a,u)}return n(r,t),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus(this.diameter,this.thickness,this.tessellation,this.side)},r.prototype.copy=function(e){return new r(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},r}(i);r.Torus=c;var l=function(t){function r(e,r,n,i,o,s,a){this.width=n,this.height=i,this.subdivisions=o,t.call(this,e,r,this._regenerateVertexData(),s,a)}return n(r,t),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround(this.width,this.height,this.subdivisions)},r.prototype.copy=function(e){return new r(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},r}(i);r.Ground=l;var h=function(t){function r(e,r,n,i,o,s,a,u,c,l){this.xmin=n,this.zmin=i,this.xmax=o,this.zmax=s,this.subdivisions=a,this.precision=u,t.call(this,e,r,this._regenerateVertexData(),c,l)}return n(r,t),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround(this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision)},r.prototype.copy=function(e){return new r(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},r}(i);r.TiledGround=h;var f=function(t){function r(r,n,i,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),this.size=i,this.side=a,t.call(this,r,n,this._regenerateVertexData(),o,s)}return n(r,t),r.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane(this.size,this.side)},r.prototype.copy=function(e){return new r(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},r}(i);r.Plane=f;var d=function(t){function r(r,n,i,o,s,a,u,c,l,h,f){void 0===f&&(f=e.Mesh.DEFAULTSIDE),this.radius=i,this.tube=o,this.radialSegments=s,this.tubularSegments=a,this.p=u,this.q=c,this.side=f,t.call(this,r,n,this._regenerateVertexData(),l,h)}return n(r,t),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot(this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.side)},r.prototype.copy=function(e){return new r(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},r}(i);r.TorusKnot=d}(r=t.Primitives||(t.Primitives={}))}(t=e.Geometry||(e.Geometry={}))}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n){t.call(this,r,n),this.generateOctree=!1,this._worldInverse=new e.Matrix}return n(r,t),Object.defineProperty(r.prototype,"subdivisions",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),r.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisions=e,this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(t)},r.prototype.getHeightAtCoordinates=function(t,r){var n=new e.Ray(new e.Vector3(t,this.getBoundingInfo().boundingBox.maximumWorld.y+1,r),new e.Vector3(0,-1,0));this.getWorldMatrix().invertToRef(this._worldInverse),n=e.Ray.Transform(n,this._worldInverse);var i=this.intersects(n);return i.hit?i.pickedPoint.y:0},r}(e.Mesh);e.GroundMesh=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s){void 0===i&&(i=null),t.call(this,r,n,i,o,s),this.color=new e.Color3(1,1,1),this.alpha=1,this._colorShader=new e.ShaderMaterial("colorShader",n,"color",{attributes:["position"],uniforms:["worldViewProjection","color"],needAlphaBlending:!0})}return n(r,t),Object.defineProperty(r.prototype,"material",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPickable",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),r.prototype._bind=function(t,r,n){var i=this.getScene().getEngine(),o=this._geometry.getIndexBuffer();i.bindBuffers(this._geometry.getVertexBuffer(e.VertexBuffer.PositionKind).getBuffer(),o,[3],12,this._colorShader.getEffect()),this._colorShader.setColor4("color",this.color.toColor4(this.alpha))},r.prototype._draw=function(e,t,r){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var n=this.getScene().getEngine();n.draw(!1,e.indexStart,e.indexCount)}},r.prototype.intersects=function(e,t){return null},r.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},r.prototype.clone=function(e,t,n){return new r(e,this.getScene(),t,this,n)},r}(e.Mesh);e.LinesMesh=t}(r||(r={}));var r;!function(e){var t=function(){function t(e){this._scene=e}return t.prototype.render=function(t,r,n){var i=this;void 0===n&&(n=!1);var o=this._scene,s=this._scene.getEngine(),a=null!==s.getCaps().instancedArrays&&null!==r.visibleInstances[t._id]&&void 0!==r.visibleInstances[t._id];if(this.isReady(t,a)){var u=t.getRenderingMesh(),c=t.getMaterial();if(s.enableEffect(this._effect),this._effect.setFloat("offset",n?0:u.outlineWidth),this._effect.setColor4("color",n?u.overlayColor:u.outlineColor,n?u.overlayAlpha:1),this._effect.setMatrix("viewProjection",o.getTransformMatrix()),u.useBones&&u.computeBonesUsingShaders&&this._effect.setMatrices("mBones",u.skeleton.getTransformMatrices()),u._bind(t,this._effect,e.Material.TriangleFillMode),c&&c.needAlphaTesting()){var l=c.getAlphaTestTexture();this._effect.setTexture("diffuseSampler",l),this._effect.setMatrix("diffuseMatrix",l.getTextureMatrix())}u._processRendering(t,this._effect,e.Material.TriangleFillMode,r,a,function(e,t){i._effect.setMatrix("world",t)})}},t.prototype.isReady=function(t,r){var n=[],i=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(i.push(e.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(i.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),o.useBones&&o.computeBonesUsingShaders&&(i.push(e.VertexBuffer.MatricesIndicesKind),i.push(e.VertexBuffer.MatricesWeightsKind),n.push("#define BONES"),n.push("#define BonesPerMesh "+(o.skeleton.bones.length+1))),r&&(n.push("#define INSTANCES"),i.push("world0"),i.push("world1"),i.push("world2"),i.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("outline",i,["world","mBones","viewProjection","diffuseMatrix","offset","color"],["diffuseSampler"],a)),this._effect.isReady()},t}();e.OutlineRenderer=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,r,n){this.name=e,this.meshesNames=t,this.rootUrl=r,this.sceneFilename=n,this.isCompleted=!1}return t.prototype.run=function(t,r,n){var i=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(e,t,n){i.loadedMeshes=e,i.loadedParticleSystems=t,i.loadedSkeletons=n,i.isCompleted=!0,i.onSuccess&&i.onSuccess(i),r()},null,function(){i.onError&&i.onError(i),n()})},t}();e.MeshAssetTask=t;var r=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,r,n){var i=this;e.Tools.LoadFile(this.url,function(e){i.text=e,i.isCompleted=!0,i.onSuccess&&i.onSuccess(i),r()},null,t.database,!1,function(){i.onError&&i.onError(i),n()})},t}();e.TextFileAssetTask=r;var n=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,r,n){var i=this;e.Tools.LoadFile(this.url,function(e){i.data=e,i.isCompleted=!0,i.onSuccess&&i.onSuccess(i),r()},null,t.database,!0,function(){i.onError&&i.onError(i),n()})},t}();e.BinaryFileAssetTask=n;var i=function(){function e(e,t){this.name=e,this.url=t,this.isCompleted=!1}return e.prototype.run=function(e,t,r){var n=this,i=new Image;i.onload=function(){n.image=i,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),t()},i.onerror=function(){n.onError&&n.onError(n),r()},i.src=this.url},e}();e.ImageAssetTask=i;var o=function(){function t(t,r,n,i,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.url=r,this.noMipmap=n,this.invertY=i,this.samplingMode=o,this.isCompleted=!1}return t.prototype.run=function(t,r,n){var i=this,o=function(){i.isCompleted=!0,i.onSuccess&&i.onSuccess(i),r()};this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,o,n)},t}();e.TextureAssetTask=o;var s=function(){function s(e){this._tasks=new Array,this._waitingTasksCount=0,this.useDefaultLoadingScreen=!0,this._scene=e}return s.prototype.addMeshTask=function(e,r,n,i){var o=new t(e,r,n,i);return this._tasks.push(o),o},s.prototype.addTextFileTask=function(e,t){var n=new r(e,t);return this._tasks.push(n),n},s.prototype.addBinaryFileTask=function(e,t){var r=new n(e,t);return this._tasks.push(r),r},s.prototype.addImageTask=function(e,t){var r=new i(e,t);return this._tasks.push(r),r},s.prototype.addTextureTask=function(t,r,n,i,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var a=new o(t,r,n,i,s);return this._tasks.push(a),a},s.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--,0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},s.prototype._runTask=function(e){var t=this;e.run(this._scene,function(){t.onTaskSuccess&&t.onTaskSuccess(e),t._decreaseWaitingTasksCount()},function(){t.onTaskError&&t.onTaskError(e),t._decreaseWaitingTasksCount()})},s.prototype.reset=function(){return this._tasks=new Array,this},s.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];this._runTask(t)}return this},s}();e.AssetsManager=s}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o){void 0===o&&(o=!0),t.call(this,r,n,i),this._alpha=0,this._beta=0,this._gamma=0;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return n(r,t),r.prototype._onOrientationEvent=function(e){this._alpha=0|+e.alpha,this._beta=0|+e.beta,this._gamma=0|+e.gamma,this._gamma=this._gamma<0?90+this._gamma:270-this._gamma,this.rotation.x=this._gamma/180*Math.PI,this.rotation.y=-this._alpha/180*Math.PI,this.rotation.z=this._beta/180*Math.PI},r.prototype.attachControl=function(e,r){t.prototype.attachControl.call(this,e,r),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},r.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},r}(e.FreeCamera);e.VRDeviceOrientationFreeCamera=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o){void 0===o&&(o=!0),t.call(this,r,n,i),this._hmdDevice=null,this._sensorDevice=null,this._cacheState=null,this._cacheQuaternion=new e.Quaternion,this._cacheRotation=e.Vector3.Zero(),this._vrEnabled=!1;var s=e.VRCameraMetrics.GetDefault();s.compensateDistorsion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._getWebVRDevices=this._getWebVRDevices.bind(this)}return n(r,t),r.prototype._getWebVRDevices=function(e){var t=e.length,r=0;for(this._sensorDevice=null,this._hmdDevice=null;t>r&&null===this._hmdDevice;)e[r]instanceof HMDVRDevice&&(this._hmdDevice=e[r]),r++;for(r=0;t>r&&null===this._sensorDevice;)e[r]instanceof PositionSensorVRDevice&&(!this._hmdDevice||e[r].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=e[r]),r++;this._vrEnabled=this._sensorDevice&&this._hmdDevice?!0:!1},r.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this._cacheQuaternion.copyFromFloats(this._cacheState.orientation.x,this._cacheState.orientation.y,this._cacheState.orientation.z,this._cacheState.orientation.w),this._cacheQuaternion.toEulerAnglesToRef(this._cacheRotation),this.rotation.x=-this._cacheRotation.z,this.rotation.y=-this._cacheRotation.y,this.rotation.z=this._cacheRotation.x),t.prototype._checkInputs.call(this)},r.prototype.attachControl=function(e,r){t.prototype.attachControl.call(this,e,r),navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},r.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),this._vrEnabled=!1},r}(e.FreeCamera);e.WebVRFreeCamera=t}(r||(r={}));var r;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e,this.apply=function(e){return!0}}return e}();e.SceneOptimization=t;var r=function(e){function t(t,r){var n=this;void 0===t&&(t=0),void 0===r&&(r=1024),e.call(this,t),this.priority=t,this.maximumSize=r,this.apply=function(e){for(var t=!0,r=0;r<e.textures.length;r++){var i=e.textures[r];if(i.canRescale){var o=i.getSize(),s=Math.max(o.width,o.height);s>n.maximumSize&&(i.scale(.5),t=!1)}}return t}}return n(t,e),t}(t);e.TextureOptimization=r;var i=function(e){function t(t,r){var n=this;void 0===t&&(t=0),void 0===r&&(r=2),e.call(this,t),this.priority=t,this.maximumScale=r,this._currentScale=1,this.apply=function(e){return n._currentScale++,e.getEngine().setHardwareScalingLevel(n._currentScale),n._currentScale>=n.maximumScale}}return n(t,e),t}(t);e.HardwareScalingOptimization=i;var o=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.shadowsEnabled=!1,!0}}return n(t,e),t}(t);e.ShadowsOptimization=o;var s=function(e){function t(){e.apply(this,arguments),
this.apply=function(e){return e.postProcessesEnabled=!1,!0}}return n(t,e),t}(t);e.PostProcessesOptimization=s;var a=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.lensFlaresEnabled=!1,!0}}return n(t,e),t}(t);e.LensFlaresOptimization=a;var u=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.particlesEnabled=!1,!0}}return n(t,e),t}(t);e.ParticlesOptimization=u;var c=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.renderTargetsEnabled=!1,!0}}return n(t,e),t}(t);e.RenderTargetsOptimization=c;var l=function(t){function r(){var n=this;t.apply(this,arguments),this._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var r=t;return r.isVisible&&r.isEnabled()?r.instances.length>0?!1:r.skeleton||r.hasLODLevels?!1:!0:!1},this.apply=function(t,i){for(var o=t.meshes.slice(0),s=o.length,a=0;s>a;a++){var u=new Array,c=o[a];if(n._canBeMerged(c)){u.push(c);for(var l=a+1;s>l;l++){var h=o[l];n._canBeMerged(h)&&h.material===c.material&&h.checkCollisions===c.checkCollisions&&(u.push(h),s--,o.splice(l,1),l--)}u.length<2||e.Mesh.MergeMeshes(u)}}return void 0!=i?i&&t.createOrUpdateSelectionOctree():r.UpdateSelectionTree&&t.createOrUpdateSelectionOctree(),!0}}return n(r,t),Object.defineProperty(r,"UpdateSelectionTree",{get:function(){return r._UpdateSelectionTree},set:function(e){r._UpdateSelectionTree=e},enumerable:!0,configurable:!0}),r._UpdateSelectionTree=!1,r}(t);e.MergeMeshesOptimization=l;var h=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.LowDegradationAllowed=function(t){var n=new e(t),i=0;return n.optimizations.push(new l(i)),n.optimizations.push(new o(i)),n.optimizations.push(new a(i)),i++,n.optimizations.push(new s(i)),n.optimizations.push(new u(i)),i++,n.optimizations.push(new r(i,1024)),n},e.ModerateDegradationAllowed=function(t){var n=new e(t),h=0;return n.optimizations.push(new l(h)),n.optimizations.push(new o(h)),n.optimizations.push(new a(h)),h++,n.optimizations.push(new s(h)),n.optimizations.push(new u(h)),h++,n.optimizations.push(new r(h,512)),h++,n.optimizations.push(new c(h)),h++,n.optimizations.push(new i(h,2)),n},e.HighDegradationAllowed=function(t){var n=new e(t),h=0;return n.optimizations.push(new l(h)),n.optimizations.push(new o(h)),n.optimizations.push(new a(h)),h++,n.optimizations.push(new s(h)),n.optimizations.push(new u(h)),h++,n.optimizations.push(new r(h,256)),h++,n.optimizations.push(new c(h)),h++,n.optimizations.push(new i(h,4)),n},e}();e.SceneOptimizerOptions=h;var f=function(){function e(){}return e._CheckCurrentState=function(t,r,n,i,o){if(t.getEngine().getFps()>=r.targetFrameRate)return void(i&&i());for(var s=!0,a=!0,u=0;u<r.optimizations.length;u++){var c=r.optimizations[u];c.priority===n&&(a=!1,s=s&&c.apply(t))}return a?void(o&&o()):(s&&n++,void t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,r,n,i,o)},r.trackerDuration)}))},e.OptimizeAsync=function(t,r,n,i){r||(r=h.ModerateDegradationAllowed()),t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,r,0,n,i)},r.trackerDuration)})},e}();e.SceneOptimizer=f}(r||(r={}));var r;!function(e){var t;!function(e){var t=function(){function e(e,t){this.distance=e,this.mesh=t}return e}();e.MeshLODLevel=t}(t=e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(){function t(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,("undefined"!=typeof window.AudioContext||"undefined"!=typeof window.webkitAudioContext)&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0)}return Object.defineProperty(t.prototype,"audioContext",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(t){this.canUseWebAudio=!1,e.Tools.Error("Web Audio: "+t.message)}},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r,n,i,o){var s=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this._panningModel="equalpower",this._playbackRate=1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isLoaded=!1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this.name=t,this._scene=n,this._readyToPlayCallback=i,this._customAttenuationFunction=function(e,t,r,n,i){return r>t?e*(1-t/r):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this.spatialSound=o.spatialSound||!1,this.maxDistance=o.maxDistance||100,this.useCustomAttenuation=o.useCustomAttenuation||!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||"linear",this._playbackRate=o.playbackRate||1),e.Engine.audioEngine.canUseWebAudio?(this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),r&&("string"==typeof r?e.Tools.LoadFile(r,function(e){s._soundLoaded(e)},null,null,!0):r instanceof ArrayBuffer?this._soundLoaded(r):e.Tools.Error("Parameter must be a URL to the sound or an ArrayBuffer of the sound."))):(this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error("Web Audio is not supported by your browser."),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback()},1e3))}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype._soundLoaded=function(t){var r=this;this._isLoaded=!0,e.Engine.audioEngine.audioContext.decodeAudioData(t,function(e){r._audioBuffer=e,r._isReadyToPlay=!0,r.autoplay&&r.play(),r._readyToPlayCallback&&r._readyToPlayCallback()},function(){e.Tools.Error("Error while decoding audio data for: "+r.name)})},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(t),this._isOutputConnected=!0)},t.prototype.setDirectionalCone=function(t,r,n){return t>r?void e.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=r,this._coneOuterGain=n,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){var t=this._connectedMesh.getWorldMatrix(),r=e.Vector3.TransformNormal(this._localDirection,t);r.normalize(),this._soundPanner.setOrientation(r.x,r.y,r.z)},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t){var r=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{var n=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._startTime=n,this._soundSource.onended=function(){r._onended()},this._soundSource.start(this._startTime,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0),this.isPlaying=!0,this.isPaused=!1}catch(i){e.Tools.Error("Error while trying to play audio: "+this.name+", "+i.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},t.prototype.stop=function(t){if(this.isPlaying){var r=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(r),this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime,this.isPaused=!0)},t.prototype.setVolume=function(t,r){e.Engine.audioEngine.canUseWebAudio&&(r?(this._soundGain.gain.linearRampToValueAtTime(this._volume,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,r)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._soundSource.playbackRate.value=this._playbackRate)},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){this.setPosition(t.getBoundingInfo().boundingSphere.centerWorld),e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},t}();e.Sound=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r){this.id=-1,this._isMainTrack=!1,this._scene=t,this._audioEngine=e.Engine.audioEngine,this.soundCollection=new Array,this._audioEngine.canUseWebAudio&&(this._outputAudioNode=this._audioEngine.audioContext.createGain(),this._outputAudioNode.connect(this._audioEngine.masterGain),r&&(r.volume&&(this._outputAudioNode.gain.value=r.volume),r.mainTrack&&(this._isMainTrack=r.mainTrack))),this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype.dispose=function(){if(this._audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){e.Engine.audioEngine.canUseWebAudio&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(e){this._audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,this._audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,this._audioEngine.masterGain))},t}();e.SoundTrack=t}(r||(r={}));var r;!function(e){var t=function(){function t(t){var r=this;this._transformationMatrix=e.Matrix.Identity(),this._enabled=!1,this._labelsEnabled=!1,this._displayStatistics=!0,this._displayTree=!1,this._displayLogs=!1,this._identityMatrix=e.Matrix.Identity(),this.axisRatio=.02,this.accentColor="orange",this._scene=t,this._syncPositions=function(){var e=r._scene.getEngine(),t=e.getRenderingCanvasClientRect();r._showUI&&(r._statsDiv.style.left=t.width-410+"px",r._statsDiv.style.top=t.height-290+"px",r._statsDiv.style.width="400px",r._statsDiv.style.height="auto",r._statsSubsetDiv.style.maxHeight="240px",r._optionsDiv.style.left="0px",r._optionsDiv.style.top="10px",r._optionsDiv.style.width="200px",r._optionsDiv.style.height="auto",r._optionsSubsetDiv.style.maxHeight=t.height-225+"px",r._logDiv.style.left="0px",r._logDiv.style.top=t.height-170+"px",r._logDiv.style.width="600px",r._logDiv.style.height="160px",r._treeDiv.style.left=t.width-310+"px",r._treeDiv.style.top="10px",r._treeDiv.style.width="300px",r._treeDiv.style.height="auto",r._treeSubsetDiv.style.maxHeight=t.height-340+"px"),r._globalDiv.style.left=t.left+"px",r._globalDiv.style.top=t.top+"px",r._drawingCanvas.style.left="0px",r._drawingCanvas.style.top="0px",r._drawingCanvas.style.width=e.getRenderWidth()+"px",r._drawingCanvas.style.height=e.getRenderHeight()+"px";var n=window.devicePixelRatio||1,i=r._drawingContext,o=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1;r._ratio=n/o,r._drawingCanvas.width=e.getRenderWidth()*r._ratio,r._drawingCanvas.height=e.getRenderHeight()*r._ratio},this._onCanvasClick=function(e){r._clickPosition={x:e.clientX*r._ratio,y:e.clientY*r._ratio}},this._syncUI=function(){r._showUI&&(r._displayStatistics?(r._displayStats(),r._statsDiv.style.display=""):r._statsDiv.style.display="none",r._logDiv.style.display=r._displayLogs?"":"none",r._displayTree?(r._treeDiv.style.display="",r._needToRefreshMeshesTree&&(r._needToRefreshMeshesTree=!1,r._refreshMeshesTreeContent())):r._treeDiv.style.display="none")},this._syncData=function(){if(r._labelsEnabled||!r._showUI){r._camera.getViewMatrix().multiplyToRef(r._camera.getProjectionMatrix(),r._transformationMatrix),r._drawingContext.clearRect(0,0,r._drawingCanvas.width,r._drawingCanvas.height);for(var t=r._scene.getEngine(),n=r._camera.viewport,i=n.toGlobal(t),o=r._camera.getActiveMeshes(),s=0;s<o.length;s++){var a=o.data[s],u=a.getBoundingInfo().boundingSphere.center,c=e.Vector3.Project(u,a.getWorldMatrix(),r._transformationMatrix,i);(a.renderOverlay||r.shouldDisplayAxis&&r.shouldDisplayAxis(a))&&r._renderAxis(c,a,i),(!r.shouldDisplayLabel||r.shouldDisplayLabel(a))&&r._renderLabel(a.name,c,12,function(){a.renderOverlay=!a.renderOverlay},function(){return a.renderOverlay?"red":"black"})}var l=r._scene.cameras;for(s=0;s<l.length;s++){var h=l[s];h!==r._camera&&(c=e.Vector3.Project(e.Vector3.Zero(),h.getWorldMatrix(),r._transformationMatrix,i),(!r.shouldDisplayLabel||r.shouldDisplayLabel(h))&&r._renderLabel(h.name,c,12,function(){r._camera.detachControl(t.getRenderingCanvas()),r._camera=h,r._camera.attachControl(t.getRenderingCanvas())},function(){return"purple"}))}var f=r._scene.lights;for(s=0;s<f.length;s++){var d=f[s];d.position&&(c=e.Vector3.Project(d.getAbsolutePosition(),r._identityMatrix,r._transformationMatrix,i),(!r.shouldDisplayLabel||r.shouldDisplayLabel(d))&&r._renderLabel(d.name,c,-20,function(){d.setEnabled(!d.isEnabled())},function(){return d.isEnabled()?"orange":"gray"}))}}r._clickPosition=void 0}}return t.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var e=this._scene.meshes.slice(0,this._scene.meshes.length);e.sort(function(e,t){return e.name===t.name?0:e.name>t.name?1:-1});for(var t=0;t<e.length;t++){var r=e[t];r.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,r.name,r.getTotalVertices()+" verts",r.isVisible,function(e,t){t.isVisible=e.checked},r)}},t.prototype._renderSingleAxis=function(e,t,r,n,i){this._drawingContext.beginPath(),this._drawingContext.moveTo(e.x,e.y),this._drawingContext.lineTo(t.x,t.y),this._drawingContext.strokeStyle=i,this._drawingContext.lineWidth=4,this._drawingContext.stroke(),this._drawingContext.font="normal 14px Segoe UI",this._drawingContext.fillStyle=i,this._drawingContext.fillText(n,r.x,r.y)},t.prototype._renderAxis=function(t,r,n){var i=r.getBoundingInfo().boundingSphere.center,o=r.getWorldMatrix(),s=e.Vector3.UnprojectFromTransform(t.add(new e.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),n.width,n.height,o,this._transformationMatrix),a=s.subtract(i).length(),u=e.Vector3.Project(i.add(new e.Vector3(a,0,0)),o,this._transformationMatrix,n),c=e.Vector3.Project(i.add(new e.Vector3(1.5*a,0,0)),o,this._transformationMatrix,n);this._renderSingleAxis(t,u,c,"x","#FF0000");var l=e.Vector3.Project(i.add(new e.Vector3(0,a,0)),o,this._transformationMatrix,n),h=e.Vector3.Project(i.add(new e.Vector3(0,1.5*a,0)),o,this._transformationMatrix,n);this._renderSingleAxis(t,l,h,"y","#00FF00");var f=e.Vector3.Project(i.add(new e.Vector3(0,0,a)),o,this._transformationMatrix,n),d=e.Vector3.Project(i.add(new e.Vector3(0,0,1.5*a)),o,this._transformationMatrix,n);this._renderSingleAxis(t,f,d,"z","#0000FF")},t.prototype._renderLabel=function(e,t,r,n,i){if(t.z>0&&t.z<1){this._drawingContext.font="normal 12px Segoe UI";var o=this._drawingContext.measureText(e),s=t.x-o.width/2,a=t.y,u=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(u.left*this._ratio+s-5,u.top*this._ratio+a-r-12,o.width+10,17)&&n(),this._drawingContext.beginPath(),this._drawingContext.rect(s-5,a-r-12,o.width+10,17),this._drawingContext.fillStyle=i(),this._drawingContext.globalAlpha=.5,this._drawingContext.fill(),this._drawingContext.globalAlpha=1,this._drawingContext.strokeStyle="#FFFFFF",this._drawingContext.lineWidth=1,this._drawingContext.stroke(),this._drawingContext.fillStyle="#FFFFFF",this._drawingContext.fillText(e,s,a-r),this._drawingContext.beginPath(),this._drawingContext.arc(t.x,a,5,0,2*Math.PI,!1),this._drawingContext.fill()}},t.prototype._isClickInsideRect=function(e,t,r,n){return this._clickPosition?this._clickPosition.x<e||this._clickPosition.x>e+r?!1:this._clickPosition.y<t||this._clickPosition.y>t+n?!1:!0:!1},t.prototype.isVisible=function(){return this._enabled},t.prototype.hide=function(){if(this._enabled){this._enabled=!1;var t=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData),this._scene.unregisterAfterRender(this._syncUI),document.body.removeChild(this._globalDiv),window.removeEventListener("resize",this._syncPositions),this._scene.forceShowBoundingBoxes=!1,this._scene.forceWireframe=!1,e.StandardMaterial.DiffuseTextureEnabled=!0,e.StandardMaterial.AmbientTextureEnabled=!0,e.StandardMaterial.SpecularTextureEnabled=!0,e.StandardMaterial.EmissiveTextureEnabled=!0,e.StandardMaterial.BumpTextureEnabled=!0,e.StandardMaterial.OpacityTextureEnabled=!0,e.StandardMaterial.ReflectionTextureEnabled=!0,this._scene.shadowsEnabled=!0,this._scene.particlesEnabled=!0,this._scene.postProcessesEnabled=!0,this._scene.collisionsEnabled=!0,this._scene.lightsEnabled=!0,this._scene.texturesEnabled=!0,this._scene.lensFlaresEnabled=!0,this._scene.proceduralTexturesEnabled=!0,this._scene.renderTargetsEnabled=!0,t.getRenderingCanvas().removeEventListener("click",this._onCanvasClick)}},t.prototype.show=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=null),!this._enabled){this._enabled=!0,this._camera=t?t:this._scene.activeCamera,this._showUI=e;var r=this._scene.getEngine();this._globalDiv=document.createElement("div"),document.body.appendChild(this._globalDiv),this._generateDOMelements(),window.addEventListener("resize",this._syncPositions),r.getRenderingCanvas().addEventListener("click",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)}},t.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var e=0;e<this._scene.meshes.length;e++){var t=this._scene.meshes[e];t.renderOverlay=!1}},t.prototype._generateheader=function(e,t){var r=document.createElement("div");r.innerHTML=t+"&nbsp;",r.style.textAlign="right",r.style.width="100%",r.style.color="white",r.style.backgroundColor="Black",r.style.padding="5px 5px 4px 0px",r.style.marginLeft="-5px",r.style.fontWeight="bold",e.appendChild(r)},t.prototype._generateTexBox=function(e,t,r){var n=document.createElement("label");n.innerHTML=t,n.style.color=r,e.appendChild(n),e.appendChild(document.createElement("br"))},t.prototype._generateAdvancedCheckBox=function(e,t,r,n,i,o){void 0===o&&(o=null);var s=document.createElement("label"),a=document.createElement("input");a.type="checkbox",a.checked=n,a.addEventListener("change",function(e){i(e.target,o)}),s.appendChild(a);var u=document.createElement("span"),c=document.createElement("span"),l=document.createElement("span");l.style.cssFloat="right",c.innerHTML=t,l.innerHTML=r,l.style.fontSize="12px",l.style.maxWidth="200px",u.appendChild(c),u.appendChild(l),s.appendChild(u),e.appendChild(s),e.appendChild(document.createElement("br"))},t.prototype._generateCheckBox=function(e,t,r,n,i){void 0===i&&(i=null);var o=document.createElement("label"),s=document.createElement("input");s.type="checkbox",s.checked=r,s.addEventListener("change",function(e){n(e.target,i)}),o.appendChild(s),o.appendChild(document.createTextNode(t)),e.appendChild(o),e.appendChild(document.createElement("br"))},t.prototype._generateButton=function(e,t,r,n){void 0===n&&(n=null);var i=document.createElement("button");i.innerHTML=t,i.style.height="24px",i.style.color="#444444",i.style.border="1px solid white",i.className="debugLayerButton",i.addEventListener("click",function(e){r(e.target,n)}),e.appendChild(i),e.appendChild(document.createElement("br"))},t.prototype._generateRadio=function(e,t,r,n,i,o){void 0===o&&(o=null);var s=document.createElement("label"),a=document.createElement("input");a.type="radio",a.name=r,a.checked=n,a.addEventListener("change",function(e){i(e.target,o)}),s.appendChild(a),s.appendChild(document.createTextNode(t)),e.appendChild(s),e.appendChild(document.createElement("br"))},t.prototype._generateDOMelements=function(){var t=this;if(this._globalDiv.id="DebugLayer",this._globalDiv.style.position="absolute",this._globalDiv.style.fontFamily="Segoe UI, Arial",this._globalDiv.style.fontSize="14px",this._globalDiv.style.color="white",this._drawingCanvas=document.createElement("canvas"),this._drawingCanvas.id="DebugLayerDrawingCanvas",this._drawingCanvas.style.position="absolute",this._drawingCanvas.style.pointerEvents="none",this._drawingContext=this._drawingCanvas.getContext("2d"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI){var r="rgba(128, 128, 128, 0.4)",n="rgb(180, 180, 180) solid 1px";this._statsDiv=document.createElement("div"),this._statsDiv.id="DebugLayerStats",this._statsDiv.style.border=n,this._statsDiv.style.position="absolute",this._statsDiv.style.background=r,this._statsDiv.style.padding="0px 0px 0px 5px",this._generateheader(this._statsDiv,"STATISTICS"),this._statsSubsetDiv=document.createElement("div"),this._statsSubsetDiv.style.paddingTop="5px",this._statsSubsetDiv.style.paddingBottom="5px",this._statsSubsetDiv.style.overflowY="auto",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement("div"),this._treeDiv.id="DebugLayerTree",this._treeDiv.style.border=n,this._treeDiv.style.position="absolute",this._treeDiv.style.background=r,this._treeDiv.style.padding="0px 0px 0px 5px",this._treeDiv.style.display="none",this._generateheader(this._treeDiv,"MESHES TREE"),this._treeSubsetDiv=document.createElement("div"),this._treeSubsetDiv.style.paddingTop="5px",this._treeSubsetDiv.style.paddingRight="5px",this._treeSubsetDiv.style.overflowY="auto",this._treeSubsetDiv.style.maxHeight="300px",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement("div"),this._logDiv.style.border=n,this._logDiv.id="DebugLayerLogs",this._logDiv.style.position="absolute",this._logDiv.style.background=r,this._logDiv.style.padding="0px 0px 0px 5px",this._logDiv.style.display="none",this._generateheader(this._logDiv,"LOGS"),this._logSubsetDiv=document.createElement("div"),this._logSubsetDiv.style.height="127px",this._logSubsetDiv.style.paddingTop="5px",this._logSubsetDiv.style.overflowY="auto",this._logSubsetDiv.style.fontSize="12px",this._logSubsetDiv.style.fontFamily="consolas",this._logSubsetDiv.innerHTML=e.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),e.Tools.OnNewCacheEntry=function(e){t._logSubsetDiv.innerHTML=e+t._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement("div"),this._optionsDiv.id="DebugLayerOptions",this._optionsDiv.style.border=n,this._optionsDiv.style.position="absolute",this._optionsDiv.style.background=r,this._optionsDiv.style.padding="0px 0px 0px 5px",this._optionsDiv.style.overflowY="auto",this._generateheader(this._optionsDiv,"OPTIONS"),this._optionsSubsetDiv=document.createElement("div"),this._optionsSubsetDiv.style.paddingTop="5px",this._optionsSubsetDiv.style.paddingBottom="5px",this._optionsSubsetDiv.style.overflowY="auto",this._optionsSubsetDiv.style.maxHeight="200px",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,"<b>Windows:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Statistics",this._displayStatistics,function(e){t._displayStatistics=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Logs",this._displayLogs,function(e){t._displayLogs=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Meshes tree",this._displayTree,function(e){t._displayTree=e.checked,t._needToRefreshMeshesTree=!0}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>General:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Bounding boxes",this._scene.forceShowBoundingBoxes,function(e){t._scene.forceShowBoundingBoxes=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Clickable labels",this._labelsEnabled,function(e){t._labelsEnabled=e.checked,t._labelsEnabled||t._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,"Generate user marks (F12)",e.Tools.PerformanceLogLevel===e.Tools.PerformanceUserMarkLogLevel,function(t){e.Tools.PerformanceLogLevel=t.checked?e.Tools.PerformanceUserMarkLogLevel:e.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Rendering mode:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Solid","renderMode",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Wireframe","renderMode",this._scene.forceWireframe,function(e){e.checked&&(t._scene.forceWireframe=!0,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Point","renderMode",this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Texture channels:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Diffuse",e.StandardMaterial.DiffuseTextureEnabled,function(t){
e.StandardMaterial.DiffuseTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Ambient",e.StandardMaterial.AmbientTextureEnabled,function(t){e.StandardMaterial.AmbientTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Specular",e.StandardMaterial.SpecularTextureEnabled,function(t){e.StandardMaterial.SpecularTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Emissive",e.StandardMaterial.EmissiveTextureEnabled,function(t){e.StandardMaterial.EmissiveTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Bump",e.StandardMaterial.BumpTextureEnabled,function(t){e.StandardMaterial.BumpTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Opacity",e.StandardMaterial.OpacityTextureEnabled,function(t){e.StandardMaterial.OpacityTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Reflection",e.StandardMaterial.ReflectionTextureEnabled,function(t){e.StandardMaterial.ReflectionTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fresnel",e.StandardMaterial.FresnelEnabled,function(t){e.StandardMaterial.FresnelEnabled=t.checked}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Options:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Animations",this._scene.animationsEnabled,function(e){t._scene.animationsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Collisions",this._scene.collisionsEnabled,function(e){t._scene.collisionsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fog",this._scene.fogEnabled,function(e){t._scene.fogEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lens flares",this._scene.lensFlaresEnabled,function(e){t._scene.lensFlaresEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lights",this._scene.lightsEnabled,function(e){t._scene.lightsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Particles",this._scene.particlesEnabled,function(e){t._scene.particlesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Post-processes",this._scene.postProcessesEnabled,function(e){t._scene.postProcessesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Procedural textures",this._scene.proceduralTexturesEnabled,function(e){t._scene.proceduralTexturesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Render targets",this._scene.renderTargetsEnabled,function(e){t._scene.renderTargetsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Shadows",this._scene.shadowsEnabled,function(e){t._scene.shadowsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",this._scene.skeletonsEnabled,function(e){t._scene.skeletonsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Sprites",this._scene.spritesEnabled,function(e){t._scene.spritesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Textures",this._scene.texturesEnabled,function(e){t._scene.texturesEnabled=e.checked}),e.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Audio:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Headphones","panningModel",this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!0)}),this._generateRadio(this._optionsSubsetDiv,"Normal Speakers","panningModel",!this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,"Disable audio",!this._scene.audioEnabled,function(e){t._scene.audioEnabled=!e.checked})),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Tools:</b>",this.accentColor),this._generateButton(this._optionsSubsetDiv,"Dump rendertargets",function(e){t._scene.dumpNextRenderTargets=!0}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv)}},t.prototype._displayStats=function(){var t=this._scene,r=t.getEngine(),n=r.getGlInfo();this._statsSubsetDiv.innerHTML="Babylon.js v"+e.Engine.Version+" - <b>"+e.Tools.Format(r.getFps(),0)+" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: "+t.meshes.length+"<br>Total vertices: "+t.getTotalVertices()+"<br>Total materials: "+t.materials.length+"<br>Total textures: "+t.textures.length+"<br>Active meshes: "+t.getActiveMeshes().length+"<br>Active indices: "+t.getActiveIndices()+"<br>Active bones: "+t.getActiveBones()+"<br>Active particles: "+t.getActiveParticles()+"<br><b>Draw calls: "+r.drawCalls+"</b><br><br><b>Duration</b><br>Meshes selection:</i> "+e.Tools.Format(t.getEvaluateActiveMeshesDuration())+" ms<br>Render Targets: "+e.Tools.Format(t.getRenderTargetsDuration())+" ms<br>Particles: "+e.Tools.Format(t.getParticlesDuration())+" ms<br>Sprites: "+e.Tools.Format(t.getSpritesDuration())+" ms<br><br>Render: <b>"+e.Tools.Format(t.getRenderDuration())+" ms</b><br>Frame: "+e.Tools.Format(t.getLastFrameDuration())+" ms<br>Potential FPS: "+e.Tools.Format(1e3/t.getLastFrameDuration(),0)+"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: "+(r.getCaps().standardDerivatives?"Yes":"No")+"<br>Compressed textures: "+(r.getCaps().s3tc?"Yes":"No")+"<br>Hardware instances: "+(r.getCaps().instancedArrays?"Yes":"No")+"<br>Texture float: "+(r.getCaps().textureFloat?"Yes":"No")+"<br>32bits indices: "+(r.getCaps().uintIndices?"Yes":"No")+"<br><b>Caps.</b><br>Max textures units: "+r.getCaps().maxTexturesImageUnits+"<br>Max textures size: "+r.getCaps().maxTextureSize+"<br>Max anisotropy: "+r.getCaps().maxAnisotropy+"<br><br><br></div><br><b>Info</b><br>"+n.version+"<br>"+n.renderer+"<br>",this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this._statsSubsetDiv.innerHTML)},t}();e.DebugLayer=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s,a,u,c){void 0===a&&(a=!0),void 0===u&&(u=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,s,!a,u),this.format=o,this._texture=s.getEngine().createRawTexture(r,n,i,o,a,u,c),this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE}return n(r,t),r.prototype.update=function(e){this.getScene().getEngine().updateRawTexture(this._texture,e,this.format,this._invertY)},r.CreateLuminanceTexture=function(t,n,i,o,s,a,u){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE),new r(t,n,i,e.Engine.TEXTUREFORMAT_LUMINANCE,o,s,a,u)},r.CreateLuminanceAlphaTexture=function(t,n,i,o,s,a,u){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE),new r(t,n,i,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,s,a,u)},r.CreateAlphaTexture=function(t,n,i,o,s,a,u){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE),new r(t,n,i,e.Engine.TEXTUREFORMAT_ALPHA,o,s,a,u)},r.CreateRGBTexture=function(t,n,i,o,s,a,u){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE),new r(t,n,i,e.Engine.TEXTUREFORMAT_RGB,o,s,a,u)},r.CreateRGBATexture=function(t,n,i,o,s,a,u){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE),new r(t,n,i,e.Engine.TEXTUREFORMAT_RGBA,o,s,a,u)},r}(e.Texture);e.RawTexture=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,r){e.call(this,t.x,t.y),this.index=r}return n(t,e),t}(e.Vector2),r=function(){function r(){this.elements=new Array}return r.prototype.add=function(e){var r=this,n=new Array;return e.forEach(function(e){if(0===n.length||!e.equalsWithEpsilon(n[0])){var i=new t(e,r.elements.length);n.push(i),r.elements.push(i)}}),n},r.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[0].x,this.elements[0].y),r=new e.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>r.x&&(r.x=e.x),e.y<t.y?t.y=e.y:e.y>r.y&&(r.y=e.y)}),{min:t,max:r,width:r.x-t.x,height:r.y-t.y}},r}(),i=function(){function t(){}return t.Rectangle=function(t,r,n,i){return[new e.Vector2(t,r),new e.Vector2(n,r),new e.Vector2(n,i),new e.Vector2(t,i)]},t.Circle=function(t,r,n,i){void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=32);for(var o=new Array,s=0,a=2*Math.PI/i,u=0;i>u;u++)o.push(new e.Vector2(r+Math.cos(s)*t,n+Math.sin(s)*t)),s-=a;return o},t.Parse=function(t){var r,n=t.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),i=[];for(r=0;r<(2147483646&n.length);r+=2)i.push(new e.Vector2(n[r],n[r+1]));return i},t.StartingAt=function(t,r){return e.Path2.StartingAt(t,r)},t}();e.Polygon=i;var o=function(){function t(t,n,i){if(this._points=new r,this._outlinepoints=new r,this._holes=[],!("poly2tri"in window))throw"PolygonMeshBuilder cannot be used because poly2tri is not referenced";this._name=t,this._scene=i;var o;o=n instanceof e.Path2?n.getPoints():n,this._swctx=new poly2tri.SweepContext(this._points.add(o)),this._outlinepoints.add(o)}return t.prototype.addHole=function(e){this._swctx.addHole(this._points.add(e));var t=new r;return t.add(e),this._holes.push(t),this},t.prototype.build=function(t,r){var n=this;void 0===t&&(t=!1);var i=new e.Mesh(this._name,this._scene),o=[],s=[],a=[],u=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),s.push(e.x,0,e.y),a.push((e.x-u.min.x)/u.width,(e.y-u.min.y)/u.height)});var c=[];if(this._swctx.triangulate(),this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){c.push(e.index)})}),r>0){var l=s.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),s.push(e.x,-r,e.y),a.push(1-(e.x-u.min.x)/u.width,1-(e.y-u.min.y)/u.height)});var h,f,d=0;this._swctx.getTriangles().forEach(function(e){e.getPoints().forEach(function(e){switch(d){case 0:h=e;break;case 1:f=e;break;case 2:c.push(e.index+l),c.push(f.index+l),c.push(h.index+l),d=-1}d++})}),this.addSide(s,o,a,c,u,this._outlinepoints,r,!1),this._holes.forEach(function(e){n.addSide(s,o,a,c,u,e,r,!0)})}return i.setVerticesData(e.VertexBuffer.PositionKind,s,t),i.setVerticesData(e.VertexBuffer.NormalKind,o,t),i.setVerticesData(e.VertexBuffer.UVKind,a,t),i.setIndices(c),i},t.prototype.addSide=function(t,r,n,i,o,s,a,u){for(var c=t.length/3,l=0,h=0;h<s.elements.length;h++){var f,d=s.elements[h];f=h+1>s.elements.length-1?s.elements[0]:s.elements[h+1],t.push(d.x,0,d.y),t.push(d.x,-a,d.y),t.push(f.x,0,f.y),t.push(f.x,-a,f.y);var p=new e.Vector3(d.x,0,d.y),m=new e.Vector3(f.x,0,f.y),g=m.subtract(p),v=new e.Vector3(0,1,0),_=e.Vector3.Cross(g,v);_=_.normalize(),n.push(l/o.width,0),n.push(l/o.width,1),l+=g.length(),n.push(l/o.width,0),n.push(l/o.width,1),u?(r.push(_.x,_.y,_.z),r.push(_.x,_.y,_.z),r.push(_.x,_.y,_.z),r.push(_.x,_.y,_.z),i.push(c),i.push(c+2),i.push(c+1),i.push(c+1),i.push(c+2),i.push(c+3)):(r.push(-_.x,-_.y,-_.z),r.push(-_.x,-_.y,-_.z),r.push(-_.x,-_.y,-_.z),r.push(-_.x,-_.y,-_.z),i.push(c),i.push(c+1),i.push(c+2),i.push(c+1),i.push(c+3),i.push(c+2)),c+=4}},t}();e.PolygonMeshBuilder=o}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,r){this.quality=e,this.distance=t,this.optimizeMesh=r}return e}();e.SimplificationSettings=t;var r=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var r=this;if(t.parallelProcessing)t.settings.forEach(function(e){var n=r.getSimplifier(t);n.simplify(e,function(n){t.mesh.addLODLevel(e.distance,n),n.isVisible=!0,e.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),r.executeNext()})});else{var n=this.getSimplifier(t),i=function(e,r){n.simplify(e,function(n){t.mesh.addLODLevel(e.distance,n),n.isVisible=!0,r()})};e.AsyncLoop.Run(t.settings.length,function(e){i(t.settings[e.index],function(){e.executeNext()})},function(){t.successCallback&&t.successCallback(),r.executeNext()})}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case n.QUADRATIC:default:return new u(e.mesh)}},t}();e.SimplificationQueue=r,function(e){e[e.QUADRATIC=0]="QUADRATIC"}(e.SimplificationType||(e.SimplificationType={}));var n=e.SimplificationType,i=function(){function e(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return e}();e.DecimationTriangle=i;var o=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new s,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}();e.DecimationVertex=o;var s=function(){function e(e){this.data=new Array(10);for(var t=0;10>t;++t)this.data[t]=e&&e[t]?e[t]:0}return e.prototype.det=function(e,t,r,n,i,o,s,a,u){var c=this.data[e]*this.data[i]*this.data[u]+this.data[r]*this.data[n]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[r]*this.data[i]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[n]*this.data[u];return c},e.prototype.addInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var r=new e,n=0;10>n;++n)r.data[n]=this.data[n]+t.data[n];return r},e.FromData=function(t,r,n,i){return new e(e.DataFromNumbers(t,r,n,i))},e.DataFromNumbers=function(e,t,r,n){return[e*e,e*t,e*r,e*n,t*t,t*r,t*n,r*r,r*n,n*n]},e}();e.QuadraticMatrix=s;var a=function(){function e(e,t){this.vertexId=e,this.triangleId=t}return e}();e.Reference=a;var u=function(){function t(t){this._mesh=t,this.initialized=!1,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Engine.Epsilon}return t.prototype.simplify=function(t,r){var n=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,function(e){n.initWithMesh(e.index,function(){n.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){r(n._reconstructedMesh)},0)})},t.prototype.isTriangleOnBoundingBox=function(e){var t=this,r=0;return e.vertices.forEach(function(e){var n=0,i=e.position,o=t._mesh.getBoundingInfo().boundingBox;(o.maximum.x-i.x<t.boundingBoxEpsilon||i.x-o.minimum.x>t.boundingBoxEpsilon)&&++n,(o.maximum.y==i.y||i.y==o.minimum.y)&&++n,(o.maximum.z==i.z||i.z==o.minimum.z)&&++n,n>1&&++r}),r>1&&console.log(e,r),r>1},t.prototype.runDecimation=function(t,r,n){var i=this,o=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length,u=function(t,r){setTimeout(function(){t%5===0&&i.updateMesh(0===t);for(var n=0;n<i.triangles.length;++n)i.triangles[n].isDirty=!1;var u=1e-9*Math.pow(t+3,i.aggressiveness),c=function(t){var r=~~((i.triangles.length/2+t)%i.triangles.length),n=i.triangles[r];if(n&&!(n.error[3]>u||n.deleted||n.isDirty))for(var o=0;3>o;++o)if(n.error[o]<u){var a=[],c=[],l=n.vertices[o],h=n.vertices[(o+1)%3];if(l.isBorder!==h.isBorder)continue;var f=e.Vector3.Zero(),d=e.Vector3.Zero(),p=e.Vector2.Zero(),m=new e.Color4(0,0,0,1);i.calculateError(l,h,f,d,p,m);var g=[];if(i.isFlipped(l,h,f,a,n.borderFactor,g))continue;if(i.isFlipped(h,l,f,c,n.borderFactor,g))continue;if(a.indexOf(!0)<0||c.indexOf(!0)<0)continue;var v=[];if(g.forEach(function(e){-1===v.indexOf(e)&&(e.deletePending=!0,v.push(e))}),v.length%2!=0)continue;l.q=h.q.add(l.q),l.updatePosition(f);var _=i.references.length;s=i.updateTriangles(l,l,a,s),s=i.updateTriangles(l,h,c,s);var y=i.references.length-_;if(y<=l.triangleCount){if(y)for(var x=0;y>x;x++)i.references[l.triangleStart+x]=i.references[_+x]}else l.triangleStart=_;l.triangleCount=y;break}};e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,c,r,function(){return o>=a-s})},0)};e.AsyncLoop.Run(this.decimationIterations,function(e){o>=a-s?e.breakLoop():u(e.index,function(){e.executeNext()})},function(){setTimeout(function(){i.reconstructMesh(r),n()},0)})},t.prototype.initWithMesh=function(t,r,n){var s=this;this.vertices=[],this.triangles=[];var a=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),u=this._mesh.getIndices(),c=this._mesh.subMeshes[t],l=function(e){if(n)for(var t=0;t<s.vertices.length;++t)if(s.vertices[t].position.equals(e))return s.vertices[t];return null},h=[],f=function(t){var r=t+c.verticesStart,n=e.Vector3.FromArray(a,3*r),i=l(n)||new o(n,s.vertices.length);i.originalOffsets.push(r),i.id==s.vertices.length&&s.vertices.push(i),h.push(i.id)},d=c.verticesCount;e.AsyncLoop.SyncAsyncForLoop(d,this.syncIterations/4>>0,f,function(){var t=function(e){var t=c.indexStart/3+e,r=3*t,n=u[r+0],o=u[r+1],a=u[r+2],l=s.vertices[h[n-c.verticesStart]],f=s.vertices[h[o-c.verticesStart]],d=s.vertices[h[a-c.verticesStart]],p=new i([l,f,d]);p.originalOffset=r,s.triangles.push(p)};e.AsyncLoop.SyncAsyncForLoop(c.indexCount/3,s.syncIterations,t,function(){s.init(r)})})},t.prototype.init=function(t){var r=this,n=function(t){var n=r.triangles[t];n.normal=e.Vector3.Cross(n.vertices[1].position.subtract(n.vertices[0].position),n.vertices[2].position.subtract(n.vertices[0].position)).normalize();for(var i=0;3>i;i++)n.vertices[i].q.addArrayInPlace(s.DataFromNumbers(n.normal.x,n.normal.y,n.normal.z,-e.Vector3.Dot(n.normal,n.vertices[0].position)))};e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,n,function(){var n=function(e){for(var t=r.triangles[e],n=0;3>n;++n)t.error[n]=r.calculateError(t.vertices[n],t.vertices[(n+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])};e.AsyncLoop.SyncAsyncForLoop(r.triangles.length,r.syncIterations,n,function(){r.initialized=!0,t()})})},t.prototype.reconstructMesh=function(t){var r,n=[];for(r=0;r<this.vertices.length;++r)this.vertices[r].triangleCount=0;var i,o;for(r=0;r<this.triangles.length;++r)if(!this.triangles[r].deleted){for(i=this.triangles[r],o=0;3>o;++o)i.vertices[o].triangleCount=1;n.push(i)}var s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],u=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],c=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],l=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),h=this._mesh.getVerticesData(e.VertexBuffer.UVKind),f=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),d=0;for(r=0;r<this.vertices.length;++r){var p=this.vertices[r];p.id=d,p.triangleCount&&p.originalOffsets.forEach(function(e){s.push(p.position.x),s.push(p.position.y),s.push(p.position.z),a.push(l[3*e]),a.push(l[3*e+1]),a.push(l[3*e+2]),h&&h.length?(u.push(h[2*e]),u.push(h[2*e+1])):f&&f.length&&(c.push(f[4*e]),c.push(f[4*e+1]),c.push(f[4*e+2]),c.push(f[4*e+3])),++d})}var m=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),v=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var _=this._reconstructedMesh.getIndices(),y=this._mesh.getIndices();for(r=0;r<n.length;++r){var i=n[r];[0,1,2].forEach(function(e){var t=y[i.originalOffset+e],r=i.vertices[e].originalOffsets.indexOf(t);0>r&&(r=0),_.push(i.vertices[e].id+r+g)})}this._reconstructedMesh.setIndices(_),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,s),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,a),u.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,u),c.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,c);var x=this._mesh.subMeshes[t];t>0&&(this._reconstructedMesh.subMeshes=[],v.forEach(function(t){new e.SubMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())}),new e.SubMesh(x.materialIndex,g,d,m,3*n.length,this._reconstructedMesh))},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1},t.prototype.isFlipped=function(t,r,n,i,o,s){for(var a=0;a<t.triangleCount;++a){var u=this.triangles[this.references[t.triangleStart+a].triangleId];if(!u.deleted){var c=this.references[t.triangleStart+a].vertexId,l=u.vertices[(c+1)%3],h=u.vertices[(c+2)%3];if(l!==r&&h!==r){var f=l.position.subtract(n);f=f.normalize();var d=h.position.subtract(n);if(d=d.normalize(),Math.abs(e.Vector3.Dot(f,d))>.999)return!0;var p=e.Vector3.Cross(f,d).normalize();if(i[a]=!1,e.Vector3.Dot(p,u.normal)<.2)return!0}else i[a]=!0,s.push(u)}}return!1},t.prototype.updateTriangles=function(e,t,r,n){for(var i=n,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(r[o]&&a.deletePending?(a.deleted=!0,i++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return i},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,r=[],n=[],i=this.vertices[e];for(t=0;t<i.triangleCount;++t)for(var o=this.triangles[this.references[i.triangleStart+t].triangleId],s=0;3>s;s++){for(var a=0,u=o.vertices[s];a<r.length&&n[a]!==u.id;)++a;a===r.length?(r.push(1),n.push(u.id)):r[a]++}for(t=0;t<r.length;++t)this.vertices[n[t]].isBorder=1===r[t]?!0:!1}},t.prototype.updateMesh=function(e){void 0===e&&(e=!1);var t;if(!e){var r=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||r.push(this.triangles[t]);this.triangles=r}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;var n,i,o;for(t=0;t<this.triangles.length;++t)for(n=this.triangles[t],i=0;3>i;++i)o=n.vertices[i],o.triangleCount++;var s=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=s,s+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var u=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(n=this.triangles[t],i=0;3>i;++i)o=n.vertices[i],u[o.triangleStart+o.triangleCount]=new a(i,t),o.triangleCount++;this.references=u,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var r=t.x,n=t.y,i=t.z;return e.data[0]*r*r+2*e.data[1]*r*n+2*e.data[2]*r*i+2*e.data[3]*r+e.data[4]*n*n+2*e.data[5]*n*i+2*e.data[6]*n+e.data[7]*i*i+2*e.data[8]*i+e.data[9]},t.prototype.calculateError=function(t,r,n,i,o,s){var a=t.q.add(r.q),u=t.isBorder&&r.isBorder,c=0,l=a.det(0,1,2,1,4,5,2,5,7);if(0===l||u){var h=t.position.add(r.position).divide(new e.Vector3(2,2,2)),f=this.vertexError(a,t.position),d=this.vertexError(a,r.position),p=this.vertexError(a,h);c=Math.min(f,d,p),c===f?n&&n.copyFrom(t.position):c===d?n&&n.copyFrom(r.position):n&&n.copyFrom(h)}else n||(n=e.Vector3.Zero()),n.x=-1/l*a.det(1,2,3,4,5,6,5,7,8),n.y=1/l*a.det(0,2,3,1,5,6,2,7,8),n.z=-1/l*a.det(0,1,3,1,4,6,2,5,8),c=this.vertexError(a,n);return c},t}();e.QuadraticErrorSimplification=u}(r||(r={}));var r;!function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var r=0;r<this.getFrequencyBinCount();r++){var n=t[r],i=n/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*i,s=this.DEBUGCANVASSIZE.height-o-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),u=r/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+u+", 100%, 50%)",this._debugCanvasContext.fillRect(r*a,s,a,o)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,r){var n=this;void 0===r&&(r=e.Engine.TEXTURETYPE_FLOAT),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._scene=t;var i=t.getEngine();this._depthMap=new e.RenderTargetTexture("depthMap",{width:i.getRenderWidth(),height:i.getRenderHeight()},this._scene,!1,!0,r),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClear=function(t){t.clear(new e.Color4(1,1,1,1),!0,!0)};var o=function(t){var r=t.getRenderingMesh(),i=n._scene,o=i.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=r._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(n.isReady(t,a)){o.enableEffect(n._effect),r._bind(t,n._effect,e.Material.TriangleFillMode);var u=t.getMaterial();if(n._effect.setMatrix("viewProjection",i.getTransformMatrix()),n._effect.setFloat("far",i.activeCamera.maxZ),u&&u.needAlphaTesting()){var c=u.getAlphaTestTexture();n._effect.setTexture("diffuseSampler",c),n._effect.setMatrix("diffuseMatrix",c.getTextureMatrix())}r.useBones&&r.computeBonesUsingShaders&&n._effect.setMatrices("mBones",r.skeleton.getTransformMatrices()),r._processRendering(t,n._effect,e.Material.TriangleFillMode,s,a,function(e,t){return n._effect.setMatrix("world",t)})}}};this._depthMap.customRenderFunction=function(e,t){var r;for(r=0;r<e.length;r++)o(e.data[r]);for(r=0;r<t.length;r++)o(t.data[r])}}return t.prototype.isReady=function(t,r){var n=[],i=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=(o.getScene(),t.getMaterial());s&&s.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(i.push(e.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(i.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),o.useBones&&o.computeBonesUsingShaders&&(i.push(e.VertexBuffer.MatricesIndicesKind),i.push(e.VertexBuffer.MatricesWeightsKind),n.push("#define BONES"),n.push("#define BonesPerMesh "+(o.skeleton.bones.length+1))),r&&(n.push("#define INSTANCES"),i.push("world0"),i.push("world1"),i.push("world2"),i.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("depth",i,["world","mBones","viewProjection","diffuseMatrix","far"],["diffuseSampler"],a)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o){var s=this;t.call(this,n.getEngine(),r),this.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",this.SSAORenderEffect="SSAORenderEffect",this.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",this.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",this.SSAOCombineRenderEffect="SSAOCombineRenderEffect",this.totalStrength=1,this.radius=2e-4,this.area=.0075,this.fallOff=2e-4,this._firstUpdate=!0,this._scene=n,this._createRandomTexture(),this._depthTexture=n.enableDepthRenderer().getDepthMap();var a=i.ssaoRatio||i,u=i.combineRatio||i;this._originalColorPostProcess=new e.PassPostProcess("SSAOOriginalSceneColor",u,null,e.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),this._createSSAOPostProcess(a),this._blurHPostProcess=new e.BlurPostProcess("SSAOBlurH",new e.Vector2(2,0),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),this._blurVPostProcess=new e.BlurPostProcess("SSAOBlurV",new e.Vector2(0,2),2,a,null,e.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),this._createSSAOCombinePostProcess(u),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(this),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(r,o)}return n(r,t),r.prototype.getBlurHPostProcess=function(){return this._blurHPostProcess},r.prototype.getBlurVPostProcess=function(){return this._blurVPostProcess},r.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._originalColorPostProcess=void 0,this._ssaoPostProcess=void 0,this._blurHPostProcess=void 0,this._blurVPostProcess=void 0,this._ssaoCombinePostProcess=void 0,this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer();
},r.prototype._createSSAOPostProcess=function(t){var r=this,n=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],i=1/16;this._ssaoPostProcess=new e.PostProcess("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff"],["randomSampler"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoPostProcess.onApply=function(e){r._firstUpdate&&(e.setArray3("sampleSphere",n),e.setFloat("samplesFactor",i),e.setFloat("randTextureTiles",4/t),r._firstUpdate=!1),e.setFloat("totalStrength",r.totalStrength),e.setFloat("radius",r.radius),e.setFloat("area",r.area),e.setFloat("fallOff",r.fallOff),e.setTexture("textureSampler",r._depthTexture),e.setTexture("randomSampler",r._randomTexture)}},r.prototype._createSSAOCombinePostProcess=function(t){var r=this;this._ssaoCombinePostProcess=new e.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess("originalColor",r._originalColorPostProcess)}},r.prototype._createRandomTexture=function(){var t=512;this._randomTexture=new e.DynamicTexture("SSAORandomTexture",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var r=this._randomTexture.getContext(),n=function(e,t){return Math.random()*(t-e)+e},i=0;t>i;i++)for(var o=0;t>o;o++){var s=e.Vector3.Zero();s.x=Math.floor(255*n(0,1)),s.y=Math.floor(255*n(0,1)),s.z=Math.floor(255*n(0,1)),r.fillStyle="rgb("+s.x+", "+s.y+", "+s.z+")",r.fillRect(i,o,1,1)}this._randomTexture.update(!1)},r}(e.PostProcessRenderPipeline);e.SSAORenderingPipeline=t}(r||(r={}));var r;!function(e){var t=function(t){function r(n,i,o,s,a,u,c,l,h){var f=this;void 0===a&&(a=100),void 0===u&&(u=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,n,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],i.postProcessRatio||i,o,u,c,l,"#define NUM_SAMPLES "+a),this._screenCoordinates=e.Vector2.Zero(),this.useCustomMeshPosition=!1,this.invert=!0,this.useDiffuseColor=!1,this.excludedMeshes=new Array,this.exposure=.3,this.decay=.96815,this.weight=.58767,this.density=.926,h=null===o?h:o.getScene(),this._viewPort=new e.Viewport(0,0,1,1).toGlobal(h.getEngine()),this.mesh=null!==s?s:r.CreateDefaultMesh("VolumetricLightScatteringMesh",h),this._createPass(h,i.passRatio||i),this.onApply=function(e){f._updateMeshScreenCoordinates(h),e.setTexture("lightScatteringSampler",f._volumetricLightScatteringRTT),e.setFloat("exposure",f.exposure),e.setFloat("decay",f.decay),e.setFloat("weight",f.weight),e.setFloat("density",f.density),e.setVector2("meshPositionOnScreen",f._screenCoordinates)}}return n(r,t),r.prototype.isReady=function(t,r){var n=t.getMesh(),i=[],o=[e.VertexBuffer.PositionKind],s=t.getMaterial(),a=!1;n===this.mesh&&(this.useDiffuseColor?i.push("#define DIFFUSE_COLOR_RENDER"):s&&i.push(void 0!==s.diffuseTexture?"#define BASIC_RENDER":"#define DIFFUSE_COLOR_RENDER"),i.push("#define NEED_UV"),a=!0),s&&(s.needAlphaTesting()&&i.push("#define ALPHATEST"),void 0!==s.opacityTexture&&(i.push("#define OPACITY"),s.opacityTexture.getAlphaFromRGB&&i.push("#define OPACITYRGB"),a||i.push("#define NEED_UV")),n.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),i.push("#define UV1")),n.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),i.push("#define UV2"))),n.useBones&&n.computeBonesUsingShaders&&(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),i.push("#define BONES"),i.push("#define BonesPerMesh "+(n.skeleton.bones.length+1))),r&&(i.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"));var u=i.join("\n");return this._cachedDefines!==u&&(this._cachedDefines=u,this._volumetricLightScatteringPass=n.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},o,["world","mBones","viewProjection","diffuseMatrix","opacityLevel","color"],["diffuseSampler","opacitySampler"],u)),this._volumetricLightScatteringPass.isReady()},r.prototype.setCustomMeshPosition=function(e){this._customMeshPosition=e},r.prototype.getCustomMeshPosition=function(){return this._customMeshPosition},r.prototype.dispose=function(e){var r=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==r&&e.getScene().customRenderTargets.splice(r,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},r.prototype.getPass=function(){return this._volumetricLightScatteringRTT},r.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)?!0:!1},r.prototype._createPass=function(t,r){var n=this,i=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture("volumetricLightScatteringMap",{width:i.getRenderWidth()*r,height:i.getRenderHeight()*r},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,t.customRenderTargets.push(this._volumetricLightScatteringRTT);var o,s=function(t){var r=t.getRenderingMesh();if(!n._meshExcluded(r)){var i=r.getScene(),o=i.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=r._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(n.isReady(t,a)){o.enableEffect(n._volumetricLightScatteringPass),r._bind(t,n._volumetricLightScatteringPass,e.Material.TriangleFillMode);var u=t.getMaterial();if(n._volumetricLightScatteringPass.setMatrix("viewProjection",i.getTransformMatrix()),u&&(r===n.mesh||u.needAlphaTesting()||void 0!==u.opacityTexture)){var c=u.getAlphaTestTexture();!n.useDiffuseColor&&void 0!==c||r!==n.mesh||n._volumetricLightScatteringPass.setColor3("color",u.diffuseColor),(u.needAlphaTesting()||r===n.mesh&&c&&!n.useDiffuseColor)&&(n._volumetricLightScatteringPass.setTexture("diffuseSampler",c),c&&n._volumetricLightScatteringPass.setMatrix("diffuseMatrix",c.getTextureMatrix())),void 0!==u.opacityTexture&&(n._volumetricLightScatteringPass.setTexture("opacitySampler",u.opacityTexture),n._volumetricLightScatteringPass.setFloat("opacityLevel",u.opacityTexture.level))}r.useBones&&r.computeBonesUsingShaders&&n._volumetricLightScatteringPass.setMatrices("mBones",r.skeleton.getTransformMatrices()),r._processRendering(t,n._volumetricLightScatteringPass,e.Material.TriangleFillMode,s,a,function(e,t){return n._volumetricLightScatteringPass.setMatrix("world",t)})}}}},a=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRender=function(){o=t.clearColor,t.clearColor=a},this._volumetricLightScatteringRTT.onAfterRender=function(){t.clearColor=o},this._volumetricLightScatteringRTT.customRenderFunction=function(r,n,i){var o,a=t.getEngine();for(o=0;o<r.length;o++)s(r.data[o]);for(a.setAlphaTesting(!0),o=0;o<n.length;o++)s(n.data[o]);if(a.setAlphaTesting(!1),i.length){for(o=0;o<i.length;o++){var u=i.data[o];u._alphaIndex=u.getMesh().alphaIndex,u._distanceToCamera=u.getBoundingInfo().boundingSphere.centerWorld.subtract(t.activeCamera.position).length()}var c=i.data.slice(0,i.length);for(c.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(e.Engine.ALPHA_COMBINE),o=0;o<c.length;o++)s(c[o]);a.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},r.prototype._updateMeshScreenCoordinates=function(t){var r=t.getTransformMatrix(),n=e.Vector3.Project(this.useCustomMeshPosition?this._customMeshPosition:this.mesh.position,e.Matrix.Identity(),r,this._viewPort);this._screenCoordinates.x=n.x/this._viewPort.width,this._screenCoordinates.y=n.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},r.CreateDefaultMesh=function(t,r){var n=e.Mesh.CreatePlane(t,1,r);return n.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL,n.material=new e.StandardMaterial(t+"Material",r),n},r}(e.PostProcess);e.VolumetricLightScatteringPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s){var a=this;void 0===o&&(o=1),t.call(this,i.getEngine(),r),this.LensChromaticAberrationEffect="LensChromaticAberrationEffect",this.HighlightsEnhancingEffect="HighlightsEnhancingEffect",this.LensDepthOfFieldEffect="LensDepthOfFieldEffect",this._scene=i,this._depthTexture=i.enableDepthRenderer().getDepthMap(),n.grain_texture?this._grainTexture=n.grain_texture:this._createGrainTexture(),this._edgeBlur=n.edge_blur?n.edge_blur:0,this._grainAmount=n.grain_amount?n.grain_amount:0,this._chromaticAberration=n.chromatic_aberration?n.chromatic_aberration:0,this._distortion=n.distortion?n.distortion:0,this._highlightsGain=void 0!==n.dof_gain?n.dof_gain:-1,this._highlightsThreshold=n.dof_threshold?n.dof_threshold:1,this._dofDistance=void 0!==n.dof_focus_distance?n.dof_focus_distance:-1,this._dofAperture=n.dof_aperture?n.dof_aperture:1,this._dofDarken=n.dof_darken?n.dof_darken:0,this._dofPentagon=void 0!==n.dof_pentagon?n.dof_pentagon:!0,this._blurNoise=void 0!==n.blur_noise?n.blur_noise:!0,this._createChromaticAberrationPostProcess(o),this._createHighlightsPostProcess(o),this._createDepthOfFieldPostProcess(o/4),this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),this.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),this.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),this.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1==this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null),i.postProcessRenderPipelineManager.addPipeline(this),s&&i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(r,s)}return n(r,t),r.prototype.setEdgeBlur=function(e){this._edgeBlur=e},r.prototype.disableEdgeBlur=function(){this._edgeBlur=0},r.prototype.setGrainAmount=function(e){this._grainAmount=e},r.prototype.disableGrain=function(){this._grainAmount=0},r.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},r.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},r.prototype.setEdgeDistortion=function(e){this._distortion=e},r.prototype.disableEdgeDistortion=function(){this._distortion=0},r.prototype.setFocusDistance=function(e){this._dofDistance=e},r.prototype.disableDepthOfField=function(){this._dofDistance=-1},r.prototype.setAperture=function(e){this._dofAperture=e},r.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},r.prototype.enablePentagonBokeh=function(){this._dofPentagon=!0},r.prototype.disablePentagonBokeh=function(){this._dofPentagon=!1},r.prototype.enableNoiseBlur=function(){this._blurNoise=!0},r.prototype.disableNoiseBlur=function(){this._blurNoise=!1},r.prototype.setHighlightsGain=function(e){this._highlightsGain=e},r.prototype.setHighlightsThreshold=function(e){-1==this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},r.prototype.disableHighlights=function(){this._highlightsGain=-1},r.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=void 0,this._highlightsPostProcess=void 0,this._depthOfFieldPostProcess=void 0,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},r.prototype._createChromaticAberrationPostProcess=function(t){var r=this;this._chromaticAberrationPostProcess=new e.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat("chromatic_aberration",r._chromaticAberration),e.setFloat("screen_width",r._scene.getEngine().getRenderingCanvas().width),e.setFloat("screen_height",r._scene.getEngine().getRenderingCanvas().height)}},r.prototype._createHighlightsPostProcess=function(t){var r=this;this._highlightsPostProcess=new e.PostProcess("LensHighlights","lensHighlights",["pentagon","gain","threshold","screen_width","screen_height"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._highlightsPostProcess.onApply=function(e){e.setFloat("gain",r._highlightsGain),e.setFloat("threshold",r._highlightsThreshold),e.setBool("pentagon",r._dofPentagon),e.setTextureFromPostProcess("textureSampler",r._chromaticAberrationPostProcess),e.setFloat("screen_width",r._scene.getEngine().getRenderingCanvas().width),e.setFloat("screen_height",r._scene.getEngine().getRenderingCanvas().height)}},r.prototype._createDepthOfFieldPostProcess=function(t){var r=this;this._depthOfFieldPostProcess=new e.PostProcess("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture("depthSampler",r._depthTexture),e.setTexture("grainSampler",r._grainTexture),e.setTextureFromPostProcess("textureSampler",r._highlightsPostProcess),e.setTextureFromPostProcess("highlightsSampler",r._depthOfFieldPostProcess),e.setFloat("grain_amount",r._grainAmount),e.setBool("blur_noise",r._blurNoise),e.setFloat("screen_width",r._scene.getEngine().getRenderingCanvas().width),e.setFloat("screen_height",r._scene.getEngine().getRenderingCanvas().height),e.setFloat("distortion",r._distortion),e.setBool("dof_enabled",-1!=r._dofDistance),e.setFloat("screen_distance",1/(.1-1/r._dofDistance)),e.setFloat("aperture",r._dofAperture),e.setFloat("darken",r._dofDarken),e.setFloat("edge_blur",r._edgeBlur),e.setBool("highlights",-1!=r._highlightsGain),e.setFloat("near",r._scene.activeCamera.minZ),e.setFloat("far",r._scene.activeCamera.maxZ)}},r.prototype._createGrainTexture=function(){var t=512;this._grainTexture=new e.DynamicTexture("LensNoiseTexture",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var r,n=this._grainTexture.getContext(),i=function(e,t){return Math.random()*(t-e)+e},o=0;t>o;o++)for(var s=0;t>s;s++)r=Math.floor(255*i(.42,.58)),n.fillStyle="rgb("+r+", "+r+", "+r+")",n.fillRect(o,s,1,1);this._grainTexture.update(!1)},r}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o,s,a,u){var c=this;t.call(this,r,"colorCorrection",null,["colorTable"],i,o,s,a,u),this._colorTableTexture=new e.Texture(n,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._colorTableTexture.anisotropicFilteringLevel=1,this._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.onApply=function(e){e.setTexture("colorTable",c._colorTableTexture)}}return n(r,t),r}(e.PostProcess);e.ColorCorrectionPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function r(r,n,i,o){t.call(this,r,n,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:i})}return n(r,t),r}(e.FreeCamera);e.AnaglyphFreeCamera=t;var r=function(t){function r(r,n,i,o,s,a,u){t.call(this,r,n,i,o,s,u),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a})}return n(r,t),r}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=r;var i=function(t){function r(r,n,i,o){t.call(this,r,n,o),this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:i})}return n(r,t),r}(e.GamepadCamera);e.AnaglyphGamepadCamera=i;var o=function(t){function r(r,n,i,o,s){t.call(this,r,n,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:i})}return n(r,t),r}(e.FreeCamera);e.StereoscopicFreeCamera=o;var s=function(t){function r(r,n,i,o,s,a,u,c){t.call(this,r,n,i,o,s,c),this.setCameraRigMode(u?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a})}return n(r,t),r}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=s;var a=function(t){function r(r,n,i,o,s){t.call(this,r,n,s),this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:i})}return n(r,t),r}(e.GamepadCamera);e.StereoscopicGamepadCamera=a}(r||(r={}));var r;!function(e){var t=function(t){function r(n,i,o,s,a){var u=this;void 0===s&&(s=null),t.call(this,i.getEngine(),n),this.gaussCoeff=.3,this.gaussMean=1,this.gaussStandDev=.8,this.exposure=1,this.minimumLuminance=1,this.maximumLuminance=1e20,this.luminanceIncreaserate=.5,this.luminanceDecreaseRate=.5,this.brightThreshold=.8,this._needUpdate=!0,this._scene=i,this._createBrightPassPostProcess(i,o),this._createDownSampleX4PostProcess(i,o),this._createGaussianBlurPostProcess(i,o),this._createTextureAdderPostProcess(i,o),this._createLuminanceGeneratorPostProcess(i),this._createHDRPostProcess(i,o),this._originalPostProcess=null===s?new e.PassPostProcess("hdr",o,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1):s,this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRPassPostProcess",function(){return u._originalPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRBrightPass",function(){return u._brightPassPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRDownSampleX4",function(){return u._downSampleX4PostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRGaussianBlurH",function(){return u._guassianBlurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRGaussianBlurV",function(){return u._guassianBlurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRTextureAdder",function(){return u._textureAdderPostProcess},!0));for(var c=function(t){u.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDRDownSampler"+t,function(){return u._downSamplePostProcesses[t]},!0))},l=r.LUM_STEPS-1;l>=0;l--)c(l);this.addEffect(new e.PostProcessRenderEffect(i.getEngine(),"HDR",function(){return u._hdrPostProcess},!0)),i.postProcessRenderPipelineManager.addPipeline(this),null!==a&&i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(n,a),this.update()}return n(r,t),r.prototype.update=function(){this._needUpdate=!0},r.prototype.getCurrentLuminance=function(){return this._hdrCurrentLuminance},r.prototype.getOutputLuminance=function(){return this._hdrOutputLuminance},r.prototype.dispose=function(){this._originalPostProcess=void 0,this._brightPassPostProcess=void 0,this._downSampleX4PostProcess=void 0,this._guassianBlurHPostProcess=void 0,this._guassianBlurVPostProcess=void 0,this._textureAdderPostProcess=void 0;for(var e=r.LUM_STEPS-1;e>=0;e--)this._downSamplePostProcesses[e]=void 0;this._hdrPostProcess=void 0,this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras)},r.prototype._createHDRPostProcess=function(t,r){var n=this,i=0;this._hdrOutputLuminance=-1,this._hdrCurrentLuminance=1,this._hdrPostProcess=new e.PostProcess("hdr","hdr",["exposure","avgLuminance"],["otherSampler"],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define HDR"),this._hdrPostProcess.onApply=function(r){if(n._hdrOutputLuminance<0)n._hdrOutputLuminance=n._hdrCurrentLuminance;else{var o=(i-(i+t.getEngine().getDeltaTime()))/1e3;n._hdrCurrentLuminance<n._hdrOutputLuminance+n.luminanceDecreaseRate*o?n._hdrOutputLuminance+=n.luminanceDecreaseRate*o:n._hdrCurrentLuminance>n._hdrOutputLuminance-n.luminanceIncreaserate*o?n._hdrOutputLuminance-=n.luminanceIncreaserate*o:n._hdrOutputLuminance=n._hdrCurrentLuminance}n._hdrOutputLuminance=e.Tools.Clamp(n._hdrOutputLuminance,n.minimumLuminance,n.maximumLuminance),i+=t.getEngine().getDeltaTime(),r.setTextureFromPostProcess("textureSampler",n._textureAdderPostProcess),r.setTextureFromPostProcess("otherSampler",n._originalPostProcess),r.setFloat("exposure",n.exposure),r.setFloat("avgLuminance",n._hdrOutputLuminance),n._needUpdate=!1}},r.prototype._createTextureAdderPostProcess=function(t,r){var n=this;this._textureAdderPostProcess=new e.PostProcess("hdr","hdr",[],["otherSampler"],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define TEXTURE_ADDER"),this._textureAdderPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",n._originalPostProcess)}},r.prototype._createDownSampleX4PostProcess=function(t,r){var n=this,i=new Array(32);this._downSampleX4PostProcess=new e.PostProcess("hdr","hdr",["dsOffsets"],[],r/4,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define DOWN_SAMPLE_X4"),this._downSampleX4PostProcess.onApply=function(e){if(n._needUpdate)for(var t=0,r=-2;2>r;r++)for(var o=-2;2>o;o++)i[t]=(r+.5)*(1/n._downSampleX4PostProcess.width),i[t+1]=(o+.5)*(1/n._downSampleX4PostProcess.height),t+=2;e.setArray2("dsOffsets",i)}},r.prototype._createBrightPassPostProcess=function(t,r){var n=this,i=new Array(8),o=function(e){if(n._needUpdate){var t=1/n._brightPassPostProcess.width,r=1/n._brightPassPostProcess.height;i[0]=-.5*t,i[1]=.5*r,i[2]=.5*t,i[3]=.5*r,i[4]=-.5*t,i[5]=-.5*r,i[6]=.5*t,i[7]=-.5*r}e.setArray2("dsOffsets",i),e.setFloat("brightThreshold",n.brightThreshold)};this._brightPassPostProcess=new e.PostProcess("hdr","hdr",["dsOffsets","brightThreshold"],[],r,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define BRIGHT_PASS"),this._brightPassPostProcess.onApply=o},r.prototype._createLuminanceGeneratorPostProcess=function(t){var n,i=this,o=r.LUM_STEPS,s=new Array(8),a=new Array(18);this._downSamplePostProcesses=new Array(o);var u=function(e,t){var r=1/e,n=1/t;s[0]=-.5*r,s[1]=.5*n,s[2]=.5*r,s[3]=.5*n,s[4]=-.5*r,s[5]=-.5*n,s[6]=.5*r,s[7]=-.5*n},c=function(e,t){for(var r=0,n=-1;2>n;n++)for(var i=-1;2>i;i++)a[r]=n/e,a[r+1]=i/t,r+=2},l=function(e){i._needUpdate&&u(i._textureAdderPostProcess.width,i._textureAdderPostProcess.height),e.setTextureFromPostProcess("textureSampler",i._textureAdderPostProcess),e.setArray2("lumOffsets",s)},h=function(e){var t=e;return function(e){u(i._downSamplePostProcesses[t].width,i._downSamplePostProcesses[t].height),c(i._downSamplePostProcesses[t].width,i._downSamplePostProcesses[t].height),n=.5/i._downSamplePostProcesses[t].width,e.setTextureFromPostProcess("textureSampler",i._downSamplePostProcesses[t+1]),e.setFloat("halfDestPixelSize",n),e.setArray2("dsOffsets",a)}},f=function(r){var n=t.getEngine().readPixels(0,0,1,1),o=new e.Vector4(1/16581375,1/65025,1/255,1);i._hdrCurrentLuminance=(n[0]*o.x+n[1]*o.y+n[2]*o.z+n[3]*o.w)/100},d={width:Math.pow(3,o-1),height:Math.pow(3,o-1)};this._downSamplePostProcesses[o-1]=new e.PostProcess("hdr","hdr",["lumOffsets"],[],d,null,e.Texture.NEAREST_SAMPLINGMODE,t.getEngine(),!1,"#define LUMINANCE_GENERATOR",e.Engine.TEXTURETYPE_FLOAT),this._downSamplePostProcesses[o-1].onApply=l;for(var p=o-2;p>=0;p--){var m=Math.pow(3,p);d={width:m,height:m};var g="#define DOWN_SAMPLE\n";0===p&&(g+="#define FINAL_DOWN_SAMPLE\n"),this._downSamplePostProcesses[p]=new e.PostProcess("hdr","hdr",["dsOffsets","halfDestPixelSize"],[],d,null,e.Texture.NEAREST_SAMPLINGMODE,t.getEngine(),!1,g,e.Engine.TEXTURETYPE_FLOAT),this._downSamplePostProcesses[p].onApply=h(p),0===p&&(this._downSamplePostProcesses[p].onAfterRender=f)}},r.prototype._createGaussianBlurPostProcess=function(t,r){var n=this,i=new Array(9),o=new Array(9),s=new Array(9),a=["blurOffsets","blurWeights"],u=function(e){for(var n={width:t.getEngine().getRenderWidth()*(r/4),height:t.getEngine().getRenderHeight()*(r/4)},s=0;9>s;s++){var a=(s-4)*(1/(e===!0?n.height:n.width));e?o[s]=a:i[s]=a}},c=function(){for(var e=0,t=0;9>t;t++)e=(t-4)/4,s[t]=n.gaussCoeff*(1/Math.sqrt(2*Math.PI*n.gaussStandDev))*Math.exp(-((e-n.gaussMean)*(e-n.gaussMean))/(2*n.gaussStandDev*n.gaussStandDev))},l=function(e){return function(t){n._needUpdate&&(c(),u(e)),t.setArray("blurOffsets",e?o:i),t.setArray("blurWeights",s)}};this._guassianBlurHPostProcess=new e.PostProcess("hdr","hdr",a,[],r/4,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define GAUSSIAN_BLUR_H"),this._guassianBlurHPostProcess.onApply=l(!1),this._guassianBlurVPostProcess=new e.PostProcess("hdr","hdr",a,[],r/4,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define GAUSSIAN_BLUR_V"),this._guassianBlurVPostProcess.onApply=l(!0)},r.LUM_STEPS=6,r}(e.PostProcessRenderPipeline);e.HDRRenderingPipeline=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this.edges=new Array,this.edgesConnectedCount=0}return e}(),r=function(){function r(e,t,r){void 0===t&&(t=.95),void 0===r&&(r=!1),this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers=new Array,this._checkVerticesInsteadOfIndices=!1,this._source=e,this._checkVerticesInsteadOfIndices=r,this._epsilon=t,this._prepareRessources(),this._generateEdgesLines()}return r.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new e.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},r.prototype.dispose=function(){this._vb0.dispose(),this._vb1.dispose(),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},r.prototype._processEdgeForAdjacencies=function(e,t,r,n,i){return e===r&&t===n||e===n&&t===r?0:e===n&&t===i||e===i&&t===n?1:e===i&&t===r||e===r&&t===i?2:-1},r.prototype._processEdgeForAdjacenciesWithVertices=function(e,t,r,n,i){return e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(n)||e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(r)?0:e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(i)||e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(n)?1:e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(r)||e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(i)?2:-1},r.prototype._checkEdge=function(t,r,n,i,o){var s;if(void 0===r)s=!0;else{var a=e.Vector3.Dot(n[t],n[r]);s=a<this._epsilon}if(s){var u=this._linesPositions.length/3,c=i.subtract(o);c.normalize(),this._linesPositions.push(i.x),this._linesPositions.push(i.y),this._linesPositions.push(i.z),this._linesPositions.push(i.x),this._linesPositions.push(i.y),this._linesPositions.push(i.z),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(-1),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(1),this._linesNormals.push(i.x),this._linesNormals.push(i.y),this._linesNormals.push(i.z),this._linesNormals.push(-1),this._linesNormals.push(i.x),this._linesNormals.push(i.y),this._linesNormals.push(i.z),this._linesNormals.push(1),this._linesIndices.push(u),this._linesIndices.push(u+1),this._linesIndices.push(u+2),this._linesIndices.push(u),this._linesIndices.push(u+2),this._linesIndices.push(u+3)}},r.prototype._generateEdgesLines=function(){var r,n,i=this._source.getVerticesData(e.VertexBuffer.PositionKind),o=this._source.getIndices(),s=new Array,a=new Array;for(r=0;r<o.length;r+=3){n=new t;var u=o[r],c=o[r+1],l=o[r+2];n.p0=new e.Vector3(i[3*u],i[3*u+1],i[3*u+2]),n.p1=new e.Vector3(i[3*c],i[3*c+1],i[3*c+2]),n.p2=new e.Vector3(i[3*l],i[3*l+1],i[3*l+2]);var h=e.Vector3.Cross(n.p1.subtract(n.p0),n.p2.subtract(n.p1));h.normalize(),a.push(h),s.push(n)}for(r=0;r<s.length;r++){n=s[r];for(var f=r+1;f<s.length;f++){var d=s[f];if(3===n.edgesConnectedCount)break;if(3!==d.edgesConnectedCount)for(var p=o[3*f],m=o[3*f+1],g=o[3*f+2],v=0;3>v;v++){var _;if(void 0===n.edges[v]){switch(v){case 0:_=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(n.p0,n.p1,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(o[3*r],o[3*r+1],p,m,g);break;case 1:_=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(n.p1,n.p2,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(o[3*r+1],o[3*r+2],p,m,g);break;case 2:_=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(n.p2,n.p0,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(o[3*r+2],o[3*r],p,m,g)}if(-1!==_&&(n.edges[v]=f,d.edges[_]=r,n.edgesConnectedCount++,d.edgesConnectedCount++,3===n.edgesConnectedCount))break}}}}for(r=0;r<s.length;r++){var y=s[r];this._checkEdge(r,y.edges[0],a,y.p0,y.p1),this._checkEdge(r,y.edges[1],a,y.p1,y.p2),this._checkEdge(r,y.edges[2],a,y.p2,y.p0)}var x=this._source.getScene().getEngine();this._vb0=new e.VertexBuffer(x,this._linesPositions,e.VertexBuffer.PositionKind,!1),this._vb1=new e.VertexBuffer(x,this._linesNormals,e.VertexBuffer.NormalKind,!1,!1,4),this._buffers[e.VertexBuffer.PositionKind]=this._vb0,this._buffers[e.VertexBuffer.NormalKind]=this._vb1,this._ib=x.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length},r.prototype.render=function(){if(this._lineShader.isReady()){var e=this._source.getScene(),t=e.getEngine();this._lineShader._preBind(),t.bindMultiBuffers(this._buffers,this._ib,this._lineShader.getEffect()),e.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),this._lineShader.setFloat("width",this._source.edgesWidth/50),this._lineShader.setFloat("aspectRatio",t.getAspectRatio(e.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),t.draw(!0,0,this._indicesCount),this._lineShader.unbind(),t.setDepthWrite(!0)}},r}();e.EdgesRenderer=r}(r||(r={}));var r;!function(e){!function(e){e[e.Hable=0]="Hable",e[e.Reinhard=1]="Reinhard",e[e.HejiDawson=2]="HejiDawson",e[e.Photographic=3]="Photographic"}(e.TonemappingOperator||(e.TonemappingOperator={}));var t=e.TonemappingOperator,r=function(r){function i(n,i,o,s,a,u,c){var l=this;void 0===a&&(a=e.Texture.BILINEAR_SAMPLINGMODE),void 0===c&&(c=e.Engine.TEXTURETYPE_UNSIGNED_INT),this._operator=i,this._exposureAdjustment=o;var h=["_ExposureAdjustment"],f="#define ";i===t.Hable?f+="HABLE_TONEMAPPING":i===t.Reinhard?f+="REINHARD_TONEMAPPING":i===t.HejiDawson?f+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":i===t.Photographic&&(f+="PHOTOGRAPHIC_TONEMAPPING"),r.call(this,n,"tonemap",h,null,1,s,a,u,!0,f,c),this.onApply=function(e){e.setFloat("_ExposureAdjustment",l._exposureAdjustment)}}return n(i,r),i}(e.PostProcess);e.TonemapPostProcess=r}(r||(r={})),r.Effect.ShadersStore={anaglyphPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D leftSampler;\r\n\r\nvoid main(void)\r\n{\r\n    vec4 leftFrag = texture2D(leftSampler, vUV);\r\n    leftFrag = vec4(1.0, leftFrag.g, leftFrag.b, 1.0);\r\n\r\n	vec4 rightFrag = texture2D(textureSampler, vUV);\r\n    rightFrag = vec4(rightFrag.r, 1.0, 1.0, 1.0);\r\n\r\n    gl_FragColor = vec4(rightFrag.rgb * leftFrag.rgb, 1.0);\r\n}",blackAndWhitePixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nvoid main(void) \r\n{\r\n	float luminance = dot(texture2D(textureSampler, vUV).rgb, vec3(0.3, 0.59, 0.11));\r\n	gl_FragColor = vec4(luminance, luminance, luminance, 1.0);\r\n}",
blurPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Parameters\r\nuniform vec2 screenSize;\r\nuniform vec2 direction;\r\nuniform float blurWidth;\r\n\r\nvoid main(void)\r\n{\r\n	float weights[7];\r\n	weights[0] = 0.05;\r\n	weights[1] = 0.1;\r\n	weights[2] = 0.2;\r\n	weights[3] = 0.3;\r\n	weights[4] = 0.2;\r\n	weights[5] = 0.1;\r\n	weights[6] = 0.05;\r\n\r\n	vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y);\r\n	vec2 texelStep = texelSize * direction * blurWidth;\r\n	vec2 start = vUV - 3.0 * texelStep;\r\n\r\n	vec4 baseColor = vec4(0., 0., 0., 0.);\r\n	vec2 texelOffset = vec2(0., 0.);\r\n\r\n	for (int i = 0; i < 7; i++)\r\n	{\r\n		baseColor += texture2D(textureSampler, start + texelOffset) * weights[i];\r\n		texelOffset += texelStep;\r\n	}\r\n\r\n	gl_FragColor = baseColor;\r\n}",brickPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform float numberOfBricksHeight;\r\nuniform float numberOfBricksWidth;\r\nuniform vec3 brickColor;\r\nuniform vec3 jointColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nfloat round(float number){\r\n	return sign(number)*floor(abs(number) + 0.5);\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	float brickW = 1.0 / numberOfBricksWidth;\r\n	float brickH = 1.0 / numberOfBricksHeight;\r\n	float jointWPercentage = 0.01;\r\n	float jointHPercentage = 0.05;\r\n	vec3 color = brickColor;\r\n	float yi = vUV.y / brickH;\r\n	float nyi = round(yi);\r\n	float xi = vUV.x / brickW;\r\n\r\n	if (mod(floor(yi), 2.0) == 0.0){\r\n		xi = xi - 0.5;\r\n	}\r\n\r\n	float nxi = round(xi);\r\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) /  brickW);\r\n\r\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\r\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\r\n	}\r\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\r\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\r\n	}\r\n	else {\r\n		float brickColorSwitch = mod(floor(yi) + floor(xi), 3.0);\r\n\r\n		if (brickColorSwitch == 0.0)\r\n			color = mix(color, vec3(0.33, 0.33, 0.33), 0.3);\r\n		else if (brickColorSwitch == 2.0)\r\n			color = mix(color, vec3(0.11, 0.11, 0.11), 0.3);\r\n	}\r\n\r\n	gl_FragColor = vec4(color, 1.0);\r\n}",chromaticAberrationPixelShader:"// BABYLON.JS Chromatic Aberration GLSL Shader\r\n// Author: Olivier Guyot\r\n// Separates very slightly R, G and B colors on the edges of the screen\r\n// Inspired by Francois Tarlier & Martins Upitis\r\n\r\n#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;	// original color\r\n\r\n// uniforms\r\nuniform float chromatic_aberration;\r\nuniform float screen_width;\r\nuniform float screen_height;\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\nvoid main(void)\r\n{\r\n	vec2 centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\r\n	float radius2 = centered_screen_pos.x*centered_screen_pos.x\r\n		+ centered_screen_pos.y*centered_screen_pos.y;\r\n	float radius = sqrt(radius2);\r\n\r\n	vec4 original = texture2D(textureSampler, vUV);\r\n\r\n	if (chromatic_aberration > 0.0) {\r\n		//index of refraction of each color channel, causing chromatic dispersion\r\n		vec3 ref_indices = vec3(-0.3, 0.0, 0.3);\r\n		float ref_shiftX = chromatic_aberration * radius * 17.0 / screen_width;\r\n		float ref_shiftY = chromatic_aberration * radius * 17.0 / screen_height;\r\n\r\n		// shifts for red, green & blue\r\n		vec2 ref_coords_r = vec2(vUV.x + ref_indices.r*ref_shiftX, vUV.y + ref_indices.r*ref_shiftY*0.5);\r\n		vec2 ref_coords_g = vec2(vUV.x + ref_indices.g*ref_shiftX, vUV.y + ref_indices.g*ref_shiftY*0.5);\r\n		vec2 ref_coords_b = vec2(vUV.x + ref_indices.b*ref_shiftX, vUV.y + ref_indices.b*ref_shiftY*0.5);\r\n\r\n		original.r = texture2D(textureSampler, ref_coords_r).r;\r\n		original.g = texture2D(textureSampler, ref_coords_g).g;\r\n		original.b = texture2D(textureSampler, ref_coords_b).b;\r\n	}\r\n\r\n	gl_FragColor = original;\r\n}",cloudPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vUV;\r\n\r\nuniform vec4 skyColor;\r\nuniform vec4 cloudColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main() {\r\n\r\n	vec2 p = vUV * 12.0;\r\n	vec4 c = mix(skyColor, cloudColor, fbm(p));\r\n	gl_FragColor = c;\r\n\r\n}\r\n\r\n",colorPixelShader:"precision highp float;\r\n\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	gl_FragColor = color;\r\n}",colorVertexShader:"precision highp float;\r\n\r\n// Attributes\r\nattribute vec3 position;\r\n\r\n// Uniforms\r\nuniform mat4 worldViewProjection;\r\n\r\nvoid main(void) {\r\n	gl_Position = worldViewProjection * vec4(position, 1.0);\r\n}",colorCorrectionPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;	// screen render\r\nuniform sampler2D colorTable;		// color table with modified colors\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\n// constants\r\nconst float SLICE_COUNT = 16.0;		// how many slices in the color cube; 1 slice = 1 pixel\r\n// it means the image is 256x16 pixels\r\n\r\nvec4 sampleAs3DTexture(sampler2D texture, vec3 uv, float width) {\r\n	float sliceSize = 1.0 / width;              // space of 1 slice\r\n	float slicePixelSize = sliceSize / width;           // space of 1 pixel\r\n	float sliceInnerSize = slicePixelSize * (width - 1.0);  // space of width pixels\r\n	float zSlice0 = min(floor(uv.z * width), width - 1.0);\r\n	float zSlice1 = min(zSlice0 + 1.0, width - 1.0);\r\n	float xOffset = slicePixelSize * 0.5 + uv.x * sliceInnerSize;\r\n	float s0 = xOffset + (zSlice0 * sliceSize);\r\n	float s1 = xOffset + (zSlice1 * sliceSize);\r\n	vec4 slice0Color = texture2D(texture, vec2(s0, uv.y));\r\n	vec4 slice1Color = texture2D(texture, vec2(s1, uv.y));\r\n	float zOffset = mod(uv.z * width, 1.0);\r\n	vec4 result = mix(slice0Color, slice1Color, zOffset);\r\n	return result;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	vec4 screen_color = texture2D(textureSampler, vUV);\r\n	gl_FragColor = sampleAs3DTexture(colorTable, screen_color.rgb, SLICE_COUNT);\r\n\r\n}",convolutionPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nuniform vec2 screenSize;\r\nuniform float kernel[9];\r\n\r\nvoid main(void)\r\n{\r\n	vec2 onePixel = vec2(1.0, 1.0) / screenSize;\r\n	vec4 colorSum =\r\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, -1)) * kernel[0] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(0, -1)) * kernel[1] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(1, -1)) * kernel[2] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 0)) * kernel[3] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 0)) * kernel[4] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 0)) * kernel[5] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(-1, 1)) * kernel[6] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(0, 1)) * kernel[7] +\r\n		texture2D(textureSampler, vUV + onePixel * vec2(1, 1)) * kernel[8];\r\n\r\n	float kernelWeight =\r\n		kernel[0] +\r\n		kernel[1] +\r\n		kernel[2] +\r\n		kernel[3] +\r\n		kernel[4] +\r\n		kernel[5] +\r\n		kernel[6] +\r\n		kernel[7] +\r\n		kernel[8];\r\n\r\n	if (kernelWeight <= 0.0) {\r\n		kernelWeight = 1.0;\r\n	}\r\n\r\n	gl_FragColor = vec4((colorSum / kernelWeight).rgb, 1);\r\n}",defaultPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define MAP_EXPLICIT	0.\r\n#define MAP_SPHERICAL	1.\r\n#define MAP_PLANAR		2.\r\n#define MAP_CUBIC		3.\r\n#define MAP_PROJECTION	4.\r\n#define MAP_SKYBOX		5.\r\n\r\n// Constants\r\nuniform vec3 vEyePosition;\r\nuniform vec3 vAmbientColor;\r\nuniform vec4 vDiffuseColor;\r\n#ifdef SPECULARTERM\r\nuniform vec4 vSpecularColor;\r\n#endif\r\nuniform vec3 vEmissiveColor;\r\n\r\n// Input\r\nvarying vec3 vPositionW;\r\n\r\n#ifdef NORMAL\r\nvarying vec3 vNormalW;\r\n#endif\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n// Lights\r\n#ifdef LIGHT0\r\nuniform vec4 vLightData0;\r\nuniform vec4 vLightDiffuse0;\r\n#ifdef SPECULARTERM\r\nuniform vec3 vLightSpecular0;\r\n#endif\r\n#ifdef SHADOW0\r\nvarying vec4 vPositionFromLight0;\r\nuniform sampler2D shadowSampler0;\r\nuniform vec3 shadowsInfo0;\r\n#endif\r\n#ifdef SPOTLIGHT0\r\nuniform vec4 vLightDirection0;\r\n#endif\r\n#ifdef HEMILIGHT0\r\nuniform vec3 vLightGround0;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT1\r\nuniform vec4 vLightData1;\r\nuniform vec4 vLightDiffuse1;\r\n#ifdef SPECULARTERM\r\nuniform vec3 vLightSpecular1;\r\n#endif\r\n#ifdef SHADOW1\r\nvarying vec4 vPositionFromLight1;\r\nuniform sampler2D shadowSampler1;\r\nuniform vec3 shadowsInfo1;\r\n#endif\r\n#ifdef SPOTLIGHT1\r\nuniform vec4 vLightDirection1;\r\n#endif\r\n#ifdef HEMILIGHT1\r\nuniform vec3 vLightGround1;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT2\r\nuniform vec4 vLightData2;\r\nuniform vec4 vLightDiffuse2;\r\n#ifdef SPECULARTERM\r\nuniform vec3 vLightSpecular2;\r\n#endif\r\n#ifdef SHADOW2\r\nvarying vec4 vPositionFromLight2;\r\nuniform sampler2D shadowSampler2;\r\nuniform vec3 shadowsInfo2;\r\n#endif\r\n#ifdef SPOTLIGHT2\r\nuniform vec4 vLightDirection2;\r\n#endif\r\n#ifdef HEMILIGHT2\r\nuniform vec3 vLightGround2;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT3\r\nuniform vec4 vLightData3;\r\nuniform vec4 vLightDiffuse3;\r\n#ifdef SPECULARTERM\r\nuniform vec3 vLightSpecular3;\r\n#endif\r\n#ifdef SHADOW3\r\nvarying vec4 vPositionFromLight3;\r\nuniform sampler2D shadowSampler3;\r\nuniform vec3 shadowsInfo3;\r\n#endif\r\n#ifdef SPOTLIGHT3\r\nuniform vec4 vLightDirection3;\r\n#endif\r\n#ifdef HEMILIGHT3\r\nuniform vec3 vLightGround3;\r\n#endif\r\n#endif\r\n\r\n// Samplers\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform sampler2D diffuseSampler;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform sampler2D ambientSampler;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY	\r\nvarying vec2 vOpacityUV;\r\nuniform sampler2D opacitySampler;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform sampler2D emissiveSampler;\r\n#endif\r\n\r\n#if defined(SPECULAR) && defined(SPECULARTERM)\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform sampler2D specularSampler;\r\n#endif\r\n\r\n// Fresnel\r\n#ifdef FRESNEL\r\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\r\n{\r\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\r\n	return clamp(fresnelTerm, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifdef DIFFUSEFRESNEL\r\nuniform vec4 diffuseLeftColor;\r\nuniform vec4 diffuseRightColor;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\nuniform vec4 opacityParts;\r\n#endif\r\n\r\n#ifdef REFLECTIONFRESNEL\r\nuniform vec4 reflectionLeftColor;\r\nuniform vec4 reflectionRightColor;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\nuniform vec4 emissiveLeftColor;\r\nuniform vec4 emissiveRightColor;\r\n#endif\r\n\r\n// Reflection\r\n#ifdef REFLECTION\r\nvarying vec3 vPositionUVW;\r\nuniform samplerCube reflectionCubeSampler;\r\nuniform sampler2D reflection2DSampler;\r\nuniform vec3 vReflectionInfos;\r\nuniform mat4 reflectionMatrix;\r\nuniform mat4 view;\r\n\r\n#ifdef ROUGHNESS\r\nuniform float roughness;\r\n#endif\r\n\r\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\r\n{\r\n	if (mode == MAP_SPHERICAL)\r\n	{\r\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\r\n	}\r\n	else if (mode == MAP_PLANAR)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1));\r\n	}\r\n	else if (mode == MAP_CUBIC)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = reflect(viewDir, worldNormal);\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 0));\r\n	}\r\n	else if (mode == MAP_PROJECTION)\r\n	{\r\n		return vec3(reflectionMatrix * (view * worldPos));\r\n	}\r\n	else if (mode == MAP_SKYBOX)\r\n	{\r\n		return vPositionUVW;\r\n	}\r\n\r\n	return vec3(0, 0, 0);\r\n}\r\n#endif\r\n\r\n// Shadows\r\n#ifdef SHADOWS\r\n\r\nfloat unpack(vec4 color)\r\n{\r\n	const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\r\n	return dot(color, bit_shift);\r\n}\r\n\r\nfloat unpackHalf(vec2 color)\r\n{\r\n	return color.x + (color.y / 255.0);\r\n}\r\n\r\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness, float bias)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	depth = 0.5 * depth + vec3(0.5);\r\n	vec2 uv = depth.xy;\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float shadow = unpack(texture2D(shadowSampler, uv)) + bias;\r\n\r\n	if (depth.z > shadow)\r\n	{\r\n		return darkness;\r\n	}\r\n	return 1.;\r\n}\r\n\r\nfloat computeShadowWithPCF(vec4 vPositionFromLight, sampler2D shadowSampler, float mapSize, float bias, float darkness)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	depth = 0.5 * depth + vec3(0.5);\r\n	vec2 uv = depth.xy;\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float visibility = 1.;\r\n\r\n	vec2 poissonDisk[4];\r\n	poissonDisk[0] = vec2(-0.94201624, -0.39906216);\r\n	poissonDisk[1] = vec2(0.94558609, -0.76890725);\r\n	poissonDisk[2] = vec2(-0.094184101, -0.92938870);\r\n	poissonDisk[3] = vec2(0.34495938, 0.29387760);\r\n\r\n	// Poisson Sampling\r\n	float biasedDepth = depth.z - bias;\r\n\r\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[0] / mapSize)) < biasedDepth) visibility -= 0.25;\r\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[1] / mapSize)) < biasedDepth) visibility -= 0.25;\r\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[2] / mapSize)) < biasedDepth) visibility -= 0.25;\r\n	if (unpack(texture2D(shadowSampler, uv + poissonDisk[3] / mapSize)) < biasedDepth) visibility -= 0.25;\r\n\r\n	return  min(1.0, visibility + darkness);\r\n}\r\n\r\n// Thanks to http://devmaster.net/\r\nfloat linstep(float low, float high, float v) {\r\n	return clamp((v - low) / (high - low), 0.0, 1.0);\r\n}\r\n\r\nfloat ChebychevInequality(vec2 moments, float compare, float bias)\r\n{\r\n	float p = smoothstep(compare - bias, compare, moments.x);\r\n	float variance = max(moments.y - moments.x * moments.x, 0.02);\r\n	float d = compare - moments.x;\r\n	float p_max = linstep(0.2, 1.0, variance / (variance + d * d));\r\n\r\n	return clamp(max(p, p_max), 0.0, 1.0);\r\n}\r\n\r\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler, float bias, float darkness)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	depth = 0.5 * depth + vec3(0.5);\r\n	vec2 uv = depth.xy;\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0 || depth.z >= 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	vec4 texel = texture2D(shadowSampler, uv);\r\n\r\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\r\n	return min(1.0, 1.0 - ChebychevInequality(moments, depth.z, bias) + darkness);\r\n}\r\n#endif\r\n\r\n// Bump\r\n#ifdef BUMP\r\n#extension GL_OES_standard_derivatives : enable\r\nvarying vec2 vBumpUV;\r\nuniform vec2 vBumpInfos;\r\nuniform sampler2D bumpSampler;\r\n\r\n// Thanks to http://www.thetenthplanet.de/archives/1180\r\nmat3 cotangent_frame(vec3 normal, vec3 p, vec2 uv)\r\n{\r\n	// get edge vectors of the pixel triangle\r\n	vec3 dp1 = dFdx(p);\r\n	vec3 dp2 = dFdy(p);\r\n	vec2 duv1 = dFdx(uv);\r\n	vec2 duv2 = dFdy(uv);\r\n\r\n	// solve the linear system\r\n	vec3 dp2perp = cross(dp2, normal);\r\n	vec3 dp1perp = cross(normal, dp1);\r\n	vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\r\n	vec3 binormal = dp2perp * duv1.y + dp1perp * duv2.y;\r\n\r\n	// construct a scale-invariant frame \r\n	float invmax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\r\n	return mat3(tangent * invmax, binormal * invmax, normal);\r\n}\r\n\r\nvec3 perturbNormal(vec3 viewDir)\r\n{\r\n	vec3 map = texture2D(bumpSampler, vBumpUV).xyz;\r\n	map = map * 255. / 127. - 128. / 127.;\r\n	mat3 TBN = cotangent_frame(vNormalW * vBumpInfos.y, -viewDir, vBumpUV);\r\n	return normalize(TBN * map);\r\n}\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n// Fog\r\n#ifdef FOG\r\n\r\n#define FOGMODE_NONE    0.\r\n#define FOGMODE_EXP     1.\r\n#define FOGMODE_EXP2    2.\r\n#define FOGMODE_LINEAR  3.\r\n#define E 2.71828\r\n\r\nuniform vec4 vFogInfos;\r\nuniform vec3 vFogColor;\r\nvarying float fFogDistance;\r\n\r\nfloat CalcFogFactor()\r\n{\r\n	float fogCoeff = 1.0;\r\n	float fogStart = vFogInfos.y;\r\n	float fogEnd = vFogInfos.z;\r\n	float fogDensity = vFogInfos.w;\r\n\r\n	if (FOGMODE_LINEAR == vFogInfos.x)\r\n	{\r\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\r\n	}\r\n	else if (FOGMODE_EXP == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\r\n	}\r\n	else if (FOGMODE_EXP2 == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\r\n	}\r\n\r\n	return clamp(fogCoeff, 0.0, 1.0);\r\n}\r\n#endif\r\n\r\n// Light Computing\r\nstruct lightingInfo\r\n{\r\n	vec3 diffuse;\r\n#ifdef SPECULARTERM\r\n	vec3 specular;\r\n#endif\r\n};\r\n\r\nlightingInfo computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, float range, float glossiness) {\r\n	lightingInfo result;\r\n\r\n	vec3 lightVectorW;\r\n	float attenuation = 1.0;\r\n	if (lightData.w == 0.)\r\n	{\r\n		vec3 direction = lightData.xyz - vPositionW;\r\n\r\n		attenuation = max(0., 1.0 - length(direction) / range);\r\n		lightVectorW = normalize(direction);\r\n	}\r\n	else\r\n	{\r\n		lightVectorW = normalize(-lightData.xyz);\r\n	}\r\n\r\n	// diffuse\r\n	float ndl = max(0., dot(vNormal, lightVectorW));\r\n	result.diffuse = ndl * diffuseColor * attenuation;\r\n\r\n#ifdef SPECULARTERM\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = pow(specComp, max(1., glossiness));\r\n\r\n	result.specular = specComp * specularColor * attenuation;\r\n#endif\r\n	return result;\r\n}\r\n\r\nlightingInfo computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec3 diffuseColor, vec3 specularColor, float range, float glossiness) {\r\n	lightingInfo result;\r\n\r\n	vec3 direction = lightData.xyz - vPositionW;\r\n	vec3 lightVectorW = normalize(direction);\r\n	float attenuation = max(0., 1.0 - length(direction) / range);\r\n\r\n	// diffuse\r\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\r\n	float spotAtten = 0.0;\r\n\r\n	if (cosAngle >= lightDirection.w)\r\n	{\r\n		cosAngle = max(0., pow(cosAngle, lightData.w));\r\n		spotAtten = clamp((cosAngle - lightDirection.w) / (1. - cosAngle), 0.0, 1.0);\r\n\r\n		// Diffuse\r\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\r\n		result.diffuse = ndl * spotAtten * diffuseColor * attenuation;\r\n\r\n#ifdef SPECULARTERM\r\n		// Specular\r\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\r\n		float specComp = max(0., dot(vNormal, angleW));\r\n		specComp = pow(specComp, max(1., glossiness));\r\n\r\n		result.specular = specComp * specularColor * spotAtten * attenuation;\r\n#endif\r\n\r\n		return result;\r\n	}\r\n\r\n	result.diffuse = vec3(0.);\r\n#ifdef SPECULARTERM\r\n	result.specular = vec3(0.);\r\n#endif\r\n\r\n	return result;\r\n}\r\n\r\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor, float glossiness) {\r\n	lightingInfo result;\r\n\r\n	// Diffuse\r\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\r\n	result.diffuse = mix(groundColor, diffuseColor, ndl);\r\n\r\n#ifdef SPECULARTERM\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = pow(specComp, max(1., glossiness));\r\n\r\n	result.specular = specComp * specularColor;\r\n#endif\r\n\r\n	return result;\r\n}\r\n\r\nvoid main(void) {\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	if (fClipDistance > 0.0)\r\n		discard;\r\n#endif\r\n\r\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\r\n\r\n	// Base color\r\n	vec4 baseColor = vec4(1., 1., 1., 1.);\r\n	vec3 diffuseColor = vDiffuseColor.rgb;\r\n\r\n	// Alpha\r\n	float alpha = vDiffuseColor.a;\r\n\r\n#ifdef DIFFUSE\r\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\r\n\r\n#ifdef ALPHATEST\r\n	if (baseColor.a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n#ifdef ALPHAFROMDIFFUSE\r\n	alpha *= baseColor.a;\r\n#endif\r\n\r\n	baseColor.rgb *= vDiffuseInfos.y;\r\n#endif\r\n\r\n#ifdef VERTEXCOLOR\r\n	baseColor.rgb *= vColor.rgb;\r\n#endif\r\n\r\n	// Bump\r\n#ifdef NORMAL\r\n	vec3 normalW = normalize(vNormalW);\r\n#else\r\n	vec3 normalW = vec3(1.0, 1.0, 1.0);\r\n#endif\r\n\r\n\r\n#ifdef BUMP\r\n	normalW = perturbNormal(viewDirectionW);\r\n#endif\r\n\r\n	// Ambient color\r\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\r\n\r\n#ifdef AMBIENT\r\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\r\n#endif\r\n\r\n\r\n	// Specular map\r\n#ifdef SPECULARTERM\r\n	float glossiness = vSpecularColor.a;\r\n	vec3 specularColor = vSpecularColor.rgb;\r\n\r\n	#ifdef SPECULAR\r\n		vec4 specularMapColor = texture2D(specularSampler, vSpecularUV);\r\n		specularColor = specularMapColor.rgb;\r\n		#ifdef GLOSSINESS\r\n			glossiness = glossiness * specularMapColor.a;\r\n		#endif\r\n	#endif\r\n#else\r\n	float glossiness = 0.;\r\n#endif\r\n\r\n	// Lighting\r\n	vec3 diffuseBase = vec3(0., 0., 0.);\r\n#ifdef SPECULARTERM\r\n	vec3 specularBase = vec3(0., 0., 0.);\r\n#endif\r\n	float shadow = 1.;\r\n\r\n#ifdef LIGHT0\r\n#ifndef SPECULARTERM\r\n	vec3 vLightSpecular0 = vec3(0.0);\r\n#endif\r\n#ifdef SPOTLIGHT0\r\n	lightingInfo info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a, glossiness);\r\n#endif\r\n#ifdef HEMILIGHT0\r\n	lightingInfo info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightGround0, glossiness);\r\n#endif\r\n#ifdef POINTDIRLIGHT0\r\n	lightingInfo info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0.rgb, vLightSpecular0, vLightDiffuse0.a, glossiness);\r\n#endif\r\n#ifdef SHADOW0\r\n#ifdef SHADOWVSM0\r\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0, shadowsInfo0.z, shadowsInfo0.x);\r\n#else\r\n	#ifdef SHADOWPCF0\r\n		shadow = computeShadowWithPCF(vPositionFromLight0, shadowSampler0, shadowsInfo0.y, shadowsInfo0.z, shadowsInfo0.x);\r\n	#else\r\n		shadow = computeShadow(vPositionFromLight0, shadowSampler0, shadowsInfo0.x, shadowsInfo0.z);\r\n	#endif\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info.diffuse * shadow;\r\n#ifdef SPECULARTERM\r\n	specularBase += info.specular * shadow;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT1\r\n#ifndef SPECULARTERM\r\n	vec3 vLightSpecular1 = vec3(0.0);\r\n#endif\r\n#ifdef SPOTLIGHT1\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a, glossiness);\r\n#endif\r\n#ifdef HEMILIGHT1\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightGround1, glossiness);\r\n#endif\r\n#ifdef POINTDIRLIGHT1\r\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1.rgb, vLightSpecular1, vLightDiffuse1.a, glossiness);\r\n#endif\r\n#ifdef SHADOW1\r\n#ifdef SHADOWVSM1\r\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1, shadowsInfo1.z, shadowsInfo1.x);\r\n#else\r\n	#ifdef SHADOWPCF1\r\n		shadow = computeShadowWithPCF(vPositionFromLight1, shadowSampler1, shadowsInfo1.y, shadowsInfo1.z, shadowsInfo1.x);\r\n	#else\r\n		shadow = computeShadow(vPositionFromLight1, shadowSampler1, shadowsInfo1.x, shadowsInfo1.z);\r\n	#endif\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info.diffuse * shadow;\r\n#ifdef SPECULARTERM\r\n	specularBase += info.specular * shadow;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT2\r\n#ifndef SPECULARTERM\r\n	vec3 vLightSpecular2 = vec3(0.0);\r\n#endif\r\n#ifdef SPOTLIGHT2\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a, glossiness);\r\n#endif\r\n#ifdef HEMILIGHT2\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightGround2, glossiness);\r\n#endif\r\n#ifdef POINTDIRLIGHT2\r\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2.rgb, vLightSpecular2, vLightDiffuse2.a, glossiness);\r\n#endif\r\n#ifdef SHADOW2\r\n#ifdef SHADOWVSM2\r\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2, shadowsInfo2.z, shadowsInfo2.x);\r\n#else\r\n	#ifdef SHADOWPCF2\r\n		shadow = computeShadowWithPCF(vPositionFromLight2, shadowSampler2, shadowsInfo2.y, shadowsInfo2.z, shadowsInfo2.x);\r\n	#else\r\n		shadow = computeShadow(vPositionFromLight2, shadowSampler2, shadowsInfo2.x, shadowsInfo2.z);\r\n	#endif	\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info.diffuse * shadow;\r\n#ifdef SPECULARTERM\r\n	specularBase += info.specular * shadow;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT3\r\n#ifndef SPECULARTERM\r\n	vec3 vLightSpecular3 = vec3(0.0);\r\n#endif\r\n#ifdef SPOTLIGHT3\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a, glossiness);\r\n#endif\r\n#ifdef HEMILIGHT3\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightGround3, glossiness);\r\n#endif\r\n#ifdef POINTDIRLIGHT3\r\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3.rgb, vLightSpecular3, vLightDiffuse3.a, glossiness);\r\n#endif\r\n#ifdef SHADOW3\r\n#ifdef SHADOWVSM3\r\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3, shadowsInfo3.z, shadowsInfo3.x);\r\n#else\r\n	#ifdef SHADOWPCF3\r\n		shadow = computeShadowWithPCF(vPositionFromLight3, shadowSampler3, shadowsInfo3.y, shadowsInfo3.z, shadowsInfo3.x);\r\n	#else\r\n		shadow = computeShadow(vPositionFromLight3, shadowSampler3, shadowsInfo3.x, shadowsInfo3.z);\r\n	#endif	\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info.diffuse * shadow;\r\n#ifdef SPECULARTERM\r\n	specularBase += info.specular * shadow;\r\n#endif\r\n#endif\r\n\r\n	// Reflection\r\n	vec3 reflectionColor = vec3(0., 0., 0.);\r\n\r\n#ifdef REFLECTION\r\n	vec3 vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), normalW);\r\n\r\n	if (vReflectionInfos.z != 0.0)\r\n	{\r\n		float bias = 0.;\r\n\r\n#ifdef ROUGHNESS\r\n		bias = roughness;\r\n#endif\r\n\r\n#ifdef SPECULARTERM\r\n#ifdef SPECULAR\r\n#ifdef GLOSSINESS\r\n		bias *= (1.0 - specularMapColor.a);\r\n#endif\r\n#endif\r\n#endif\r\n\r\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW, bias).rgb * vReflectionInfos.y * shadow;\r\n	}\r\n	else\r\n	{\r\n		vec2 coords = vReflectionUVW.xy;\r\n\r\n		if (vReflectionInfos.x == MAP_PROJECTION)\r\n		{\r\n			coords /= vReflectionUVW.z;\r\n		}\r\n\r\n		coords.y = 1.0 - coords.y;\r\n\r\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y * shadow;\r\n	}\r\n\r\n#ifdef REFLECTIONFRESNEL\r\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\r\n\r\n#ifdef REFLECTIONFRESNELFROMSPECULAR\r\n#ifdef SPECULARTERM\r\n	reflectionColor *= specularColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\r\n#else\r\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\r\n#endif\r\n#else\r\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\r\n#endif\r\n#endif\r\n#endif\r\n\r\n\r\n#ifdef OPACITY\r\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\r\n\r\n#ifdef OPACITYRGB\r\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\r\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\r\n#else\r\n	alpha *= opacityMap.a * vOpacityInfos.y;\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTEXALPHA\r\n	alpha *= vColor.a;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\r\n\r\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\r\n#endif\r\n\r\n	// Emissive\r\n	vec3 emissiveColor = vEmissiveColor;\r\n#ifdef EMISSIVE\r\n    emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\r\n\r\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\r\n#endif\r\n\r\n	// Fresnel\r\n#ifdef DIFFUSEFRESNEL\r\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\r\n\r\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\r\n#endif\r\n\r\n	// Composition\r\n#ifdef EMISSIVEASILLUMINATION\r\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\r\n#else\r\n    vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\r\n#endif\r\n\r\n#ifdef SPECULARTERM\r\n	vec3 finalSpecular = specularBase * specularColor;\r\n#else\r\n	vec3 finalSpecular = vec3(0.0);\r\n#endif\r\n\r\n#ifdef SPECULAROVERALPHA\r\n	alpha = clamp(alpha + dot(finalSpecular, vec3(0.3, 0.59, 0.11)), 0., 1.);\r\n#endif\r\n\r\n// Composition\r\n#ifdef EMISSIVEASILLUMINATION\r\n    vec4 color = vec4(clamp(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor + emissiveColor, 0.0, 1.0), alpha);\r\n#else\r\n    vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\r\n#endif\r\n\r\n#ifdef FOG\r\n	float fog = CalcFogFactor();\r\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\r\n#endif\r\n\r\n	gl_FragColor = color;\r\n}",defaultVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec3 position;\r\n#ifdef NORMAL\r\nattribute vec3 normal;\r\n#endif\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#ifdef VERTEXCOLOR\r\nattribute vec4 color;\r\n#endif\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniforms\r\n\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 view;\r\nuniform mat4 viewProjection;\r\n\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform mat4 diffuseMatrix;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform mat4 ambientMatrix;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY\r\nvarying vec2 vOpacityUV;\r\nuniform mat4 opacityMatrix;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform mat4 emissiveMatrix;\r\n#endif\r\n\r\n#if defined(SPECULAR) && defined(SPECULARTERM)\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform mat4 specularMatrix;\r\n#endif\r\n\r\n#ifdef BUMP\r\nvarying vec2 vBumpUV;\r\nuniform vec2 vBumpInfos;\r\nuniform mat4 bumpMatrix;\r\n#endif\r\n\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n#ifdef POINTSIZE\r\nuniform float pointSize;\r\n#endif\r\n\r\n// Output\r\nvarying vec3 vPositionW;\r\n#ifdef NORMAL\r\nvarying vec3 vNormalW;\r\n#endif\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nuniform vec4 vClipPlane;\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n#ifdef FOG\r\nvarying float fFogDistance;\r\n#endif\r\n\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\nuniform mat4 lightMatrix0;\r\nvarying vec4 vPositionFromLight0;\r\n#endif\r\n#ifdef LIGHT1\r\nuniform mat4 lightMatrix1;\r\nvarying vec4 vPositionFromLight1;\r\n#endif\r\n#ifdef LIGHT2\r\nuniform mat4 lightMatrix2;\r\nvarying vec4 vPositionFromLight2;\r\n#endif\r\n#ifdef LIGHT3\r\nuniform mat4 lightMatrix3;\r\nvarying vec4 vPositionFromLight3;\r\n#endif\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nvarying vec3 vPositionUVW;\r\n#endif\r\n\r\nvoid main(void) {\r\n	mat4 finalWorld;\r\n\r\n#ifdef REFLECTION\r\n	vPositionUVW = position;\r\n#endif \r\n\r\n#ifdef INSTANCES\r\n	finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	finalWorld = world;\r\n#endif\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n\r\n#ifdef BONES4\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n#else\r\n	finalWorld = finalWorld * (m0 + m1 + m2);\r\n#endif \r\n\r\n#endif\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n\r\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\r\n	vPositionW = vec3(worldPos);\r\n\r\n#ifdef NORMAL\r\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\r\n#endif\r\n\r\n	// Texture coordinates\r\n#ifndef UV1\r\n	vec2 uv = vec2(0., 0.);\r\n#endif\r\n#ifndef UV2\r\n	vec2 uv2 = vec2(0., 0.);\r\n#endif\r\n\r\n#ifdef DIFFUSE\r\n	if (vDiffuseInfos.x == 0.)\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef AMBIENT\r\n	if (vAmbientInfos.x == 0.)\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	if (vOpacityInfos.x == 0.)\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\n	if (vEmissiveInfos.x == 0.)\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#if defined(SPECULAR) && defined(SPECULARTERM)\r\n	if (vSpecularInfos.x == 0.)\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef BUMP\r\n	if (vBumpInfos.x == 0.)\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	fClipDistance = dot(worldPos, vClipPlane);\r\n#endif\r\n\r\n	// Fog\r\n#ifdef FOG\r\n	fFogDistance = (view * worldPos).z;\r\n#endif\r\n\r\n	// Shadows\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\n	vPositionFromLight0 = lightMatrix0 * worldPos;\r\n#endif\r\n#ifdef LIGHT1\r\n	vPositionFromLight1 = lightMatrix1 * worldPos;\r\n#endif\r\n#ifdef LIGHT2\r\n	vPositionFromLight2 = lightMatrix2 * worldPos;\r\n#endif\r\n#ifdef LIGHT3\r\n	vPositionFromLight3 = lightMatrix3 * worldPos;\r\n#endif\r\n#endif\r\n\r\n	// Vertex color\r\n#ifdef VERTEXCOLOR\r\n	vColor = color;\r\n#endif\r\n\r\n	// Point size\r\n#ifdef POINTSIZE\r\n	gl_PointSize = pointSize;\r\n#endif\r\n}",
depthPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\nuniform float far;\r\n\r\nvoid main(void)\r\n{\r\n#ifdef ALPHATEST\r\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n	float depth = (gl_FragCoord.z / gl_FragCoord.w) / far;\r\n	gl_FragColor = vec4(depth, depth * depth, 0.0, 1.0);\r\n}",depthVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attribute\r\nattribute vec3 position;\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniform\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 viewProjection;\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(NEED_UV)\r\nvarying vec2 vUV;\r\nuniform mat4 diffuseMatrix;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef INSTANCES\r\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	mat4 finalWorld = world;\r\n#endif\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n#else\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\r\n#ifdef UV1\r\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n#endif\r\n#ifdef UV2\r\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n#endif\r\n#endif\r\n}",depthBoxBlurPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Parameters\r\nuniform vec2 screenSize;\r\n\r\nvoid main(void)\r\n{\r\n	vec4 colorDepth = vec4(0.0);\r\n\r\n	for (int x = -OFFSET; x <= OFFSET; x++)\r\n		for (int y = -OFFSET; y <= OFFSET; y++)\r\n			colorDepth += texture2D(textureSampler, vUV + vec2(x, y) / screenSize);\r\n\r\n	gl_FragColor = (colorDepth / float((OFFSET * 2 + 1) * (OFFSET * 2 + 1)));\r\n}",depthOfFieldPixelShader:'// BABYLON.JS Depth-of-field GLSL Shader\r\n// Author: Olivier Guyot\r\n// Does depth-of-field blur, edge blur\r\n// Inspired by Francois Tarlier & Martins Upitis\r\n\r\n#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D highlightsSampler;\r\nuniform sampler2D depthSampler;\r\nuniform sampler2D grainSampler;\r\n\r\n// uniforms\r\nuniform float grain_amount;\r\nuniform bool blur_noise;\r\nuniform float screen_width;\r\nuniform float screen_height;\r\nuniform float distortion;\r\nuniform bool dof_enabled;\r\n//uniform float focus_distance;		// not needed; already used to compute screen distance\r\nuniform float screen_distance;		// precomputed screen distance from lens center; based on focal length & desired focus distance\r\nuniform float aperture;\r\nuniform float darken;\r\nuniform float edge_blur;\r\nuniform bool highlights;\r\n\r\n// preconputed uniforms (not effect parameters)\r\nuniform float near;\r\nuniform float far;\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\n// constants\r\n#define PI 		3.14159265\r\n#define TWOPI 	6.28318530\r\n#define inverse_focal_length 0.1	// a property of the lens used\r\n\r\n// common calculations\r\nvec2 centered_screen_pos;\r\nvec2 distorted_coords;\r\nfloat radius2;\r\nfloat radius;\r\n\r\n\r\n// on-the-fly constant noise\r\nvec2 rand(vec2 co)\r\n{\r\n	float noise1 = (fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453));\r\n	float noise2 = (fract(sin(dot(co, vec2(12.9898, 78.233)*2.0)) * 43758.5453));\r\n	return clamp(vec2(noise1, noise2), 0.0, 1.0);\r\n}\r\n\r\n// applies edge distortion on texture coords\r\nvec2 getDistortedCoords(vec2 coords) {\r\n\r\n	if (distortion == 0.0) { return coords; }\r\n\r\n	vec2 direction = 1.0 * normalize(centered_screen_pos);\r\n	vec2 dist_coords = vec2(0.5, 0.5);\r\n	dist_coords.x = 0.5 + direction.x * radius2 * 1.0;\r\n	dist_coords.y = 0.5 + direction.y * radius2 * 1.0;\r\n	float dist_amount = clamp(distortion*0.23, 0.0, 1.0);\r\n\r\n	dist_coords = mix(coords, dist_coords, dist_amount);\r\n\r\n	return dist_coords;\r\n}\r\n\r\n// sample screen with an offset (randomize offset angle for better smothness), returns partial sample weight\r\nfloat sampleScreen(inout vec4 color, const in vec2 offset, const in float weight) {\r\n\r\n	// compute coords with offset (a random angle is added)\r\n	vec2 coords = distorted_coords;\r\n	float angle = rand(coords * 100.0).x * TWOPI;\r\n	coords += vec2(offset.x * cos(angle) - offset.y * sin(angle), offset.x * sin(angle) + offset.y * cos(angle));\r\n\r\n	color += texture2D(textureSampler, coords)*weight;\r\n\r\n	return weight;\r\n}\r\n\r\n// returns blur level according to blur size required\r\nfloat getBlurLevel(float size) {\r\n	return min(3.0, ceil(size / 1.0));\r\n}\r\n\r\n// returns original screen color after blur\r\nvec4 getBlurColor(float size) {\r\n\r\n	vec4 col = texture2D(textureSampler, distorted_coords);\r\n	if (size == 0.0) { return col; }\r\n\r\n	// there are max. 30 samples; the number of samples chosen is dependant on the blur size\r\n	// there can be 10, 20 or 30 samples chosen; levels of blur are then 1, 2 or 3\r\n	float blur_level = getBlurLevel(size);\r\n\r\n	float w = (size / screen_width);\r\n	float h = (size / screen_height);\r\n	float total_weight = 1.0;\r\n	vec2 sample_coords;\r\n\r\n	total_weight += sampleScreen(col, vec2(-0.50*w, 0.24*h), 0.93);\r\n	total_weight += sampleScreen(col, vec2(0.30*w, -0.75*h), 0.90);\r\n	total_weight += sampleScreen(col, vec2(0.36*w, 0.96*h), 0.87);\r\n	total_weight += sampleScreen(col, vec2(-1.08*w, -0.55*h), 0.85);\r\n	total_weight += sampleScreen(col, vec2(1.33*w, -0.37*h), 0.83);\r\n	total_weight += sampleScreen(col, vec2(-0.82*w, 1.31*h), 0.80);\r\n	total_weight += sampleScreen(col, vec2(-0.31*w, -1.67*h), 0.78);\r\n	total_weight += sampleScreen(col, vec2(1.47*w, 1.11*h), 0.76);\r\n	total_weight += sampleScreen(col, vec2(-1.97*w, 0.19*h), 0.74);\r\n	total_weight += sampleScreen(col, vec2(1.42*w, -1.57*h), 0.72);\r\n\r\n	if (blur_level > 1.0) {\r\n		total_weight += sampleScreen(col, vec2(0.01*w, 2.25*h), 0.70);\r\n		total_weight += sampleScreen(col, vec2(-1.62*w, -1.74*h), 0.67);\r\n		total_weight += sampleScreen(col, vec2(2.49*w, 0.20*h), 0.65);\r\n		total_weight += sampleScreen(col, vec2(-2.07*w, 1.61*h), 0.63);\r\n		total_weight += sampleScreen(col, vec2(0.46*w, -2.70*h), 0.61);\r\n		total_weight += sampleScreen(col, vec2(1.55*w, 2.40*h), 0.59);\r\n		total_weight += sampleScreen(col, vec2(-2.88*w, -0.75*h), 0.56);\r\n		total_weight += sampleScreen(col, vec2(2.73*w, -1.44*h), 0.54);\r\n		total_weight += sampleScreen(col, vec2(-1.08*w, 3.02*h), 0.52);\r\n		total_weight += sampleScreen(col, vec2(-1.28*w, -3.05*h), 0.49);\r\n	}\r\n\r\n	if (blur_level > 2.0) {\r\n		total_weight += sampleScreen(col, vec2(3.11*w, 1.43*h), 0.46);\r\n		total_weight += sampleScreen(col, vec2(-3.36*w, 1.08*h), 0.44);\r\n		total_weight += sampleScreen(col, vec2(1.80*w, -3.16*h), 0.41);\r\n		total_weight += sampleScreen(col, vec2(0.83*w, 3.65*h), 0.38);\r\n		total_weight += sampleScreen(col, vec2(-3.16*w, -2.19*h), 0.34);\r\n		total_weight += sampleScreen(col, vec2(3.92*w, -0.53*h), 0.31);\r\n		total_weight += sampleScreen(col, vec2(-2.59*w, 3.12*h), 0.26);\r\n		total_weight += sampleScreen(col, vec2(-0.20*w, -4.15*h), 0.22);\r\n		total_weight += sampleScreen(col, vec2(3.02*w, 3.00*h), 0.15);\r\n	}\r\n\r\n	col /= total_weight;		// scales color according to weights\r\n\r\n								// darken if out of focus\r\n	if (darken > 0.0) {\r\n		col.rgb *= clamp(0.3, 1.0, 1.05 - size*0.5*darken);\r\n	}\r\n\r\n	// blur levels debug\r\n	// if(blur_level == 1.0) { col.b *= 0.5; }\r\n	// if(blur_level == 2.0) { col.r *= 0.5; }\r\n	// if(blur_level == 3.0) { col.g *= 0.5; }\r\n\r\n	return col;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n\r\n	// Common calc: position relative to screen center, screen radius, distorted coords, position in texel space\r\n	centered_screen_pos = vec2(vUV.x - 0.5, vUV.y - 0.5);\r\n	radius2 = centered_screen_pos.x*centered_screen_pos.x + centered_screen_pos.y*centered_screen_pos.y;\r\n	radius = sqrt(radius2);\r\n	distorted_coords = getDistortedCoords(vUV);		// we distort the screen coordinates (lens "magnifying" effect)\r\n	vec2 texels_coords = vec2(vUV.x * screen_width, vUV.y * screen_height);	// varies from 0 to SCREEN_WIDTH or _HEIGHT\r\n\r\n	float depth = texture2D(depthSampler, distorted_coords).r;	// depth value from DepthRenderer: 0 to 1\r\n	float distance = near + (far - near)*depth;		// actual distance from the lens\r\n	vec4 color = texture2D(textureSampler, vUV);	// original raster\r\n\r\n\r\n													// compute the circle of confusion size (CoC), i.e. blur radius depending on depth\r\n													// screen_distance is precomputed in code\r\n	float coc = abs(aperture * (screen_distance * (inverse_focal_length - 1.0 / distance) - 1.0));\r\n\r\n	// disable blur\r\n	if (dof_enabled == false || coc < 0.07) { coc = 0.0; }\r\n\r\n	// blur from edge blur effect\r\n	float edge_blur_amount = 0.0;\r\n	if (edge_blur > 0.0) {\r\n		edge_blur_amount = clamp((radius*2.0 - 1.0 + 0.15*edge_blur) * 1.5, 0.0, 1.0) * 1.3;\r\n	}\r\n\r\n	// total blur amount\r\n	float blur_amount = max(edge_blur_amount, coc);\r\n\r\n	// apply blur if necessary\r\n	if (blur_amount == 0.0) {\r\n		gl_FragColor = texture2D(textureSampler, distorted_coords);\r\n	}\r\n	else {\r\n\r\n		// add blurred color\r\n		gl_FragColor = getBlurColor(blur_amount * 1.7);\r\n\r\n		// if we have computed highlights: enhance highlights\r\n		if (highlights) {\r\n			gl_FragColor.rgb += clamp(coc, 0.0, 1.0)*texture2D(highlightsSampler, distorted_coords).rgb;\r\n		}\r\n\r\n		if (blur_noise) {\r\n			// we put a slight amount of noise in the blurred color\r\n			vec2 noise = rand(distorted_coords) * 0.01 * blur_amount;\r\n			vec2 blurred_coord = vec2(distorted_coords.x + noise.x, distorted_coords.y + noise.y);\r\n			gl_FragColor = 0.04 * texture2D(textureSampler, blurred_coord) + 0.96 * gl_FragColor;\r\n		}\r\n	}\r\n\r\n\r\n	// apply grain\r\n	if (grain_amount > 0.0) {\r\n		vec4 grain_color = texture2D(grainSampler, texels_coords*0.003);\r\n		gl_FragColor.rgb += (-0.5 + grain_color.rgb) * 0.30 * grain_amount;\r\n	}\r\n\r\n}\r\n',displayPassPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D passSampler;\r\n\r\nvoid main(void)\r\n{\r\n    gl_FragColor = texture2D(passSampler, vUV);\r\n}",filterPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nuniform mat4 kernelMatrix;\r\n\r\nvoid main(void)\r\n{\r\n	vec3 baseColor = texture2D(textureSampler, vUV).rgb;\r\n	vec3 updatedColor = (kernelMatrix * vec4(baseColor, 1.0)).rgb;\r\n\r\n	gl_FragColor = vec4(updatedColor, 1.0);\r\n}",firePixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform float time;\r\nuniform vec3 c1;\r\nuniform vec3 c2;\r\nuniform vec3 c3;\r\nuniform vec3 c4;\r\nuniform vec3 c5;\r\nuniform vec3 c6;\r\nuniform vec2 speed;\r\nuniform float shift;\r\nuniform float alphaThreshold;\r\n\r\nvarying vec2 vUV;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main() {\r\n	vec2 p = vUV * 8.0;\r\n	float q = fbm(p - time * 0.1);\r\n	vec2 r = vec2(fbm(p + q + time * speed.x - p.x - p.y), fbm(p + q - time * speed.y));\r\n	vec3 c = mix(c1, c2, fbm(p + r)) + mix(c3, c4, r.x) - mix(c5, c6, r.y);\r\n	vec3 color = c * cos(shift * vUV.y);\r\n	float luminance = dot(color.rgb, vec3(0.3, 0.59, 0.11));\r\n\r\n	gl_FragColor = vec4(color, luminance * alphaThreshold + (1.0 - alphaThreshold));\r\n}",fxaaPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define FXAA_REDUCE_MIN   (1.0/128.0)\r\n#define FXAA_REDUCE_MUL   (1.0/8.0)\r\n#define FXAA_SPAN_MAX     8.0\r\n\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 texelSize;\r\n\r\nvoid main(){\r\n	vec2 localTexelSize = texelSize;\r\n	vec4 rgbNW = texture2D(textureSampler, (vUV + vec2(-1.0, -1.0) * localTexelSize));\r\n	vec4 rgbNE = texture2D(textureSampler, (vUV + vec2(1.0, -1.0) * localTexelSize));\r\n	vec4 rgbSW = texture2D(textureSampler, (vUV + vec2(-1.0, 1.0) * localTexelSize));\r\n	vec4 rgbSE = texture2D(textureSampler, (vUV + vec2(1.0, 1.0) * localTexelSize));\r\n	vec4 rgbM = texture2D(textureSampler, vUV);\r\n	vec4 luma = vec4(0.299, 0.587, 0.114, 1.0);\r\n	float lumaNW = dot(rgbNW, luma);\r\n	float lumaNE = dot(rgbNE, luma);\r\n	float lumaSW = dot(rgbSW, luma);\r\n	float lumaSE = dot(rgbSE, luma);\r\n	float lumaM = dot(rgbM, luma);\r\n	float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\r\n	float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\r\n\r\n	vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\r\n\r\n	float dirReduce = max(\r\n		(lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL),\r\n		FXAA_REDUCE_MIN);\r\n\r\n	float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\r\n	dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\r\n		max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\r\n		dir * rcpDirMin)) * localTexelSize;\r\n\r\n	vec4 rgbA = 0.5 * (\r\n		texture2D(textureSampler, vUV + dir * (1.0 / 3.0 - 0.5)) +\r\n		texture2D(textureSampler, vUV + dir * (2.0 / 3.0 - 0.5)));\r\n\r\n	vec4 rgbB = rgbA * 0.5 + 0.25 * (\r\n		texture2D(textureSampler, vUV + dir *  -0.5) +\r\n		texture2D(textureSampler, vUV + dir * 0.5));\r\n	float lumaB = dot(rgbB, luma);\r\n	if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\r\n		gl_FragColor = rgbA;\r\n	}\r\n	else {\r\n		gl_FragColor = rgbB;\r\n	}\r\n}",grassPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform vec3 herb1Color;\r\nuniform vec3 herb2Color;\r\nuniform vec3 herb3Color;\r\nuniform vec3 groundColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main(void) {\r\n	vec3 color = mix(groundColor, herb1Color, rand(gl_FragCoord.xy * 4.0));\r\n	color = mix(color, herb2Color, rand(gl_FragCoord.xy * 8.0));\r\n	color = mix(color, herb3Color, rand(gl_FragCoord.xy));\r\n	color = mix(color, herb1Color, fbm(gl_FragCoord.xy * 16.0));\r\n	gl_FragColor = vec4(color, 1.0);\r\n}",hdrPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D textureSampler;\r\nvarying vec2 vUV;\r\n\r\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\r\nuniform float blurOffsets[9];\r\nuniform float blurWeights[9];\r\n\r\nvoid main(void) {\r\n	vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n	for (int i = 0; i < 9; i++) {\r\n		#ifdef GAUSSIAN_BLUR_H\r\n		color += (texture2D(textureSampler, vUV + vec2(blurOffsets[i], 0.0)) * blurWeights[i]);\r\n		#else\r\n		color += (texture2D(textureSampler, vUV + vec2(0.0, blurOffsets[i])) * blurWeights[i]);\r\n		#endif\r\n	}\r\n\r\n	color.a = 1.0;\r\n	gl_FragColor = color;\r\n}\r\n#endif\r\n\r\n#if defined(TEXTURE_ADDER)\r\nuniform sampler2D otherSampler;\r\n\r\nvoid main() {\r\n	vec4 sum = texture2D(textureSampler, vUV) + texture2D(otherSampler, vUV);\r\n	sum.a = clamp(sum.a, 0.0, 1.0);\r\n\r\n	gl_FragColor = sum;\r\n}\r\n#endif\r\n\r\n#if defined(LUMINANCE_GENERATOR)\r\nuniform vec2 lumOffsets[4];\r\n\r\nvoid main() {\r\n	float average = 0.0;\r\n	vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\r\n	float maximum = -1e20;\r\n\r\n	for (int i = 0; i < 4; i++) {\r\n		color = texture2D(textureSampler, vUV + lumOffsets[i]);\r\n\r\n		float GreyValue = length(color.rgb);\r\n\r\n		maximum = max(maximum, GreyValue);\r\n		average += (0.25 * log(1e-5 + GreyValue));\r\n	}\r\n\r\n	average = exp(average);\r\n\r\n	gl_FragColor = vec4(average, maximum, 0.0, 1.0);\r\n\r\n}\r\n#endif\r\n\r\n#if defined(DOWN_SAMPLE)\r\nuniform vec2 dsOffsets[9];\r\nuniform float halfDestPixelSize;\r\n\r\n#ifdef FINAL_DOWN_SAMPLE\r\nvec4 pack(float value) {\r\n	const vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\r\n	const vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\r\n\r\n	vec4 res = fract(value * bit_shift);\r\n	res -= res.xxyz * bit_mask;\r\n\r\n	return res;\r\n}\r\n#endif\r\n\r\nvoid main() {\r\n	vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\r\n	float average = 0.0;\r\n\r\n	for (int i = 0; i < 9; i++) {\r\n		color = texture2D(textureSampler, vUV + vec2(halfDestPixelSize, halfDestPixelSize) + dsOffsets[i]);\r\n		average += color.r;\r\n	}\r\n\r\n	average /= 9.0;\r\n\r\n	#ifndef FINAL_DOWN_SAMPLE\r\n	gl_FragColor = vec4(average, average, 0.0, 1.0);\r\n	#else\r\n	gl_FragColor = pack(average);\r\n	#endif\r\n}\r\n#endif\r\n\r\n#if defined(BRIGHT_PASS)\r\nuniform vec2 dsOffsets[4];\r\nuniform float brightThreshold;\r\n\r\nvoid main() {\r\n	vec4 average = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n	average = texture2D(textureSampler, vUV + vec2(dsOffsets[0].x, dsOffsets[0].y));\r\n	average += texture2D(textureSampler, vUV + vec2(dsOffsets[1].x, dsOffsets[1].y));\r\n	average += texture2D(textureSampler, vUV + vec2(dsOffsets[2].x, dsOffsets[2].y));\r\n	average += texture2D(textureSampler, vUV + vec2(dsOffsets[3].x, dsOffsets[3].y));\r\n\r\n	average *= 0.25;\r\n\r\n	float luminance = length(average.rgb);\r\n\r\n	if (luminance < brightThreshold) {\r\n		average = vec4(0.0, 0.0, 0.0, 1.0);\r\n	}\r\n\r\n	gl_FragColor = average;\r\n}\r\n#endif\r\n\r\n#if defined(DOWN_SAMPLE_X4)\r\nuniform vec2 dsOffsets[16];\r\n\r\nvoid main() {\r\n	vec4 average = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n	average = texture2D(textureSampler, vUV + dsOffsets[0]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[1]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[2]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[3]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[4]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[5]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[6]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[7]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[8]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[9]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[10]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[11]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[12]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[13]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[14]);\r\n	average += texture2D(textureSampler, vUV + dsOffsets[15]);\r\n\r\n	average /= 16.0;\r\n\r\n	gl_FragColor = average;\r\n}\r\n#endif\r\n\r\n#if defined(HDR)\r\nuniform sampler2D otherSampler;\r\n\r\nuniform float exposure;\r\nuniform float avgLuminance;\r\n\r\nvoid main() {\r\n	vec4 color = texture2D(textureSampler, vUV) + texture2D(otherSampler, vUV);\r\n	vec4 adjustedColor = color / avgLuminance * exposure;\r\n\r\n	color = adjustedColor;\r\n	color.a = 1.0;\r\n\r\n	gl_FragColor = color;\r\n}\r\n#endif\r\n",layerPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Color\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	vec4 baseColor = texture2D(textureSampler, vUV);\r\n\r\n	gl_FragColor = baseColor * color;\r\n}",layerVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Uniforms\r\nuniform mat4 textureMatrix;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n\r\n	vUV = vec2(textureMatrix * vec4(position * madd + madd, 1.0, 0.0));\r\n	gl_Position = vec4(position, 0.0, 1.0);\r\n}",legacydefaultPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define MAP_PROJECTION	4.\r\n\r\n// Constants\r\nuniform vec3 vEyePosition;\r\nuniform vec3 vAmbientColor;\r\nuniform vec4 vDiffuseColor;\r\n#ifdef SPECULARTERM\r\nuniform vec4 vSpecularColor;\r\n#endif\r\nuniform vec3 vEmissiveColor;\r\n\r\n// Input\r\nvarying vec3 vPositionW;\r\nvarying vec3 vNormalW;\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n// Lights\r\n#ifdef LIGHT0\r\nuniform vec4 vLightData0;\r\nuniform vec4 vLightDiffuse0;\r\n#ifdef SPECULARTERM\r\nuniform vec3 vLightSpecular0;\r\n#endif\r\n#ifdef SHADOW0\r\nvarying vec4 vPositionFromLight0;\r\nuniform sampler2D shadowSampler0;\r\n#endif\r\n#ifdef SPOTLIGHT0\r\nuniform vec4 vLightDirection0;\r\n#endif\r\n#ifdef HEMILIGHT0\r\nuniform vec3 vLightGround0;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT1\r\nuniform vec4 vLightData1;\r\nuniform vec4 vLightDiffuse1;\r\n#ifdef SPECULARTERM\r\nuniform vec3 vLightSpecular1;\r\n#endif\r\n#ifdef SHADOW1\r\nvarying vec4 vPositionFromLight1;\r\nuniform sampler2D shadowSampler1;\r\n#endif\r\n#ifdef SPOTLIGHT1\r\nuniform vec4 vLightDirection1;\r\n#endif\r\n#ifdef HEMILIGHT1\r\nuniform vec3 vLightGround1;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT2\r\nuniform vec4 vLightData2;\r\nuniform vec4 vLightDiffuse2;\r\n#ifdef SPECULARTERM\r\nuniform vec3 vLightSpecular2;\r\n#endif\r\n#ifdef SHADOW2\r\nvarying vec4 vPositionFromLight2;\r\nuniform sampler2D shadowSampler2;\r\n#endif\r\n#ifdef SPOTLIGHT2\r\nuniform vec4 vLightDirection2;\r\n#endif\r\n#ifdef HEMILIGHT2\r\nuniform vec3 vLightGround2;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT3\r\nuniform vec4 vLightData3;\r\nuniform vec4 vLightDiffuse3;\r\n#ifdef SPECULARTERM\r\nuniform vec3 vLightSpecular3;\r\n#endif\r\n#ifdef SHADOW3\r\nvarying vec4 vPositionFromLight3;\r\nuniform sampler2D shadowSampler3;\r\n#endif\r\n#ifdef SPOTLIGHT3\r\nuniform vec4 vLightDirection3;\r\n#endif\r\n#ifdef HEMILIGHT3\r\nuniform vec3 vLightGround3;\r\n#endif\r\n#endif\r\n\r\n// Samplers\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform sampler2D diffuseSampler;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform sampler2D ambientSampler;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY	\r\nvarying vec2 vOpacityUV;\r\nuniform sampler2D opacitySampler;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nvarying vec3 vReflectionUVW;\r\nuniform samplerCube reflectionCubeSampler;\r\nuniform sampler2D reflection2DSampler;\r\nuniform vec3 vReflectionInfos;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform sampler2D emissiveSampler;\r\n#endif\r\n\r\n#if defined(SPECULAR) && defined(SPECULARTERM)\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform sampler2D specularSampler;\r\n#endif\r\n\r\n// Fresnel\r\n#ifdef FRESNEL\r\nfloat computeFresnelTerm(vec3 viewDirection, vec3 worldNormal, float bias, float power)\r\n{\r\n	float fresnelTerm = pow(bias + abs(dot(viewDirection, worldNormal)), power);\r\n	return clamp(fresnelTerm, 0., 1.);\r\n}\r\n#endif\r\n\r\n#ifdef DIFFUSEFRESNEL\r\nuniform vec4 diffuseLeftColor;\r\nuniform vec4 diffuseRightColor;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\nuniform vec4 opacityParts;\r\n#endif\r\n\r\n#ifdef REFLECTIONFRESNEL\r\nuniform vec4 reflectionLeftColor;\r\nuniform vec4 reflectionRightColor;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\nuniform vec4 emissiveLeftColor;\r\nuniform vec4 emissiveRightColor;\r\n#endif\r\n\r\n// Shadows\r\n#ifdef SHADOWS\r\n\r\nfloat unpack(vec4 color)\r\n{\r\n	const vec4 bitShift = vec4(1. / (255. * 255. * 255.), 1. / (255. * 255.), 1. / 255., 1.);\r\n	return dot(color, bitShift);\r\n}\r\n\r\nfloat unpackHalf(vec2 color)\r\n{\r\n	return color.x + (color.y / 255.0);\r\n}\r\n\r\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float shadow = unpack(texture2D(shadowSampler, uv));\r\n\r\n	if (depth.z > shadow)\r\n	{\r\n		return 0.;\r\n	}\r\n	return 1.;\r\n}\r\n\r\n// Thanks to http://devmaster.net/\r\nfloat ChebychevInequality(vec2 moments, float t)\r\n{\r\n	if (t <= moments.x)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	float variance = moments.y - (moments.x * moments.x);\r\n	variance = max(variance, 0.);\r\n\r\n	float d = t - moments.x;\r\n	return variance / (variance + d * d);\r\n}\r\n\r\nfloat computeShadowWithVSM(vec4 vPositionFromLight, sampler2D shadowSampler)\r\n{\r\n	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\r\n	vec2 uv = 0.5 * depth.xy + vec2(0.5, 0.5);\r\n\r\n	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\r\n	{\r\n		return 1.0;\r\n	}\r\n\r\n	vec4 texel = texture2D(shadowSampler, uv);\r\n\r\n	vec2 moments = vec2(unpackHalf(texel.xy), unpackHalf(texel.zw));\r\n	return clamp(1.3 - ChebychevInequality(moments, depth.z), 0., 1.0);\r\n}\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n// Fog\r\n#ifdef FOG\r\n\r\n#define FOGMODE_NONE    0.\r\n#define FOGMODE_EXP     1.\r\n#define FOGMODE_EXP2    2.\r\n#define FOGMODE_LINEAR  3.\r\n#define E 2.71828\r\n\r\nuniform vec4 vFogInfos;\r\nuniform vec3 vFogColor;\r\nvarying float fFogDistance;\r\n\r\nfloat CalcFogFactor()\r\n{\r\n	float fogCoeff = 1.0;\r\n	float fogStart = vFogInfos.y;\r\n	float fogEnd = vFogInfos.z;\r\n	float fogDensity = vFogInfos.w;\r\n\r\n	if (FOGMODE_LINEAR == vFogInfos.x)\r\n	{\r\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\r\n	}\r\n	else if (FOGMODE_EXP == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\r\n	}\r\n	else if (FOGMODE_EXP2 == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\r\n	}\r\n\r\n	return clamp(fogCoeff, 0.0, 1.0);\r\n}\r\n#endif\r\n\r\n// Light Computing\r\nmat3 computeLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor) {\r\n	mat3 result;\r\n\r\n	vec3 lightVectorW;\r\n	if (lightData.w == 0.)\r\n	{\r\n		lightVectorW = normalize(lightData.xyz - vPositionW);\r\n	}\r\n	else\r\n	{\r\n		lightVectorW = normalize(-lightData.xyz);\r\n	}\r\n\r\n	// diffuse\r\n	float ndl = max(0., dot(vNormal, lightVectorW));\r\n\r\n	result[0] = ndl * diffuseColor.rgb;\r\n\r\n#ifdef SPECULARTERM\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightVectorW);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = max(0., pow(specComp, max(1.0, vSpecularColor.a)));\r\n	result[1] = specComp * specularColor;\r\n#else\r\n	result[1] = vec3(0.);\r\n#endif\r\n\r\n	result[2] = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nmat3 computeSpotLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 lightDirection, vec4 diffuseColor, vec3 specularColor) {\r\n	mat3 result;\r\n\r\n	vec3 lightVectorW = normalize(lightData.xyz - vPositionW);\r\n\r\n	// diffuse\r\n	float cosAngle = max(0., dot(-lightDirection.xyz, lightVectorW));\r\n	float spotAtten = 0.0;\r\n\r\n	if (cosAngle >= lightDirection.w)\r\n	{\r\n		cosAngle = max(0., pow(cosAngle, lightData.w));\r\n		spotAtten = max(0., (cosAngle - lightDirection.w) / (1. - cosAngle));\r\n\r\n		// Diffuse\r\n		float ndl = max(0., dot(vNormal, -lightDirection.xyz));\r\n		result[0] = ndl * spotAtten * diffuseColor.rgb;\r\n\r\n#ifdef SPECULARTERM\r\n		// Specular\r\n		vec3 angleW = normalize(viewDirectionW - lightDirection.xyz);\r\n		float specComp = max(0., dot(vNormal, angleW));\r\n		specComp = pow(specComp, vSpecularColor.a);\r\n		result[1] = specComp * specularColor * spotAtten;\r\n#else\r\n		result[1] = vec3(0.);\r\n#endif\r\n		result[2] = vec3(0.);\r\n\r\n		return result;\r\n	}\r\n\r\n	result[0] = vec3(0.);\r\n	result[1] = vec3(0.);\r\n	result[2] = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nmat3 computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec4 diffuseColor, vec3 specularColor, vec3 groundColor) {\r\n	mat3 result;\r\n\r\n	// Diffuse\r\n	float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\r\n	result[0] = mix(groundColor, diffuseColor.rgb, ndl);\r\n\r\n#ifdef SPECULARTERM\r\n	// Specular\r\n	vec3 angleW = normalize(viewDirectionW + lightData.xyz);\r\n	float specComp = max(0., dot(vNormal, angleW));\r\n	specComp = pow(specComp, vSpecularColor.a);\r\n	result[1] = specComp * specularColor;\r\n#else\r\n	result[1] = vec3(0.);\r\n#endif\r\n\r\n	result[2] = vec3(0.);\r\n\r\n	return result;\r\n}\r\n\r\nvoid main(void) {\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	if (fClipDistance > 0.0)\r\n		discard;\r\n#endif\r\n\r\n	vec3 viewDirectionW = normalize(vEyePosition - vPositionW);\r\n\r\n	// Base color\r\n	vec4 baseColor = vec4(1., 1., 1., 1.);\r\n	vec3 diffuseColor = vDiffuseColor.rgb;\r\n\r\n#ifdef DIFFUSE\r\n	baseColor = texture2D(diffuseSampler, vDiffuseUV);\r\n\r\n#ifdef ALPHATEST\r\n	if (baseColor.a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n	baseColor.rgb *= vDiffuseInfos.y;\r\n#endif\r\n\r\n#ifdef VERTEXCOLOR\r\n	baseColor.rgb *= vColor.rgb;\r\n#endif\r\n\r\n	// Bump\r\n	vec3 normalW = normalize(vNormalW);\r\n\r\n	// Ambient color\r\n	vec3 baseAmbientColor = vec3(1., 1., 1.);\r\n\r\n#ifdef AMBIENT\r\n	baseAmbientColor = texture2D(ambientSampler, vAmbientUV).rgb * vAmbientInfos.y;\r\n#endif\r\n\r\n	// Lighting\r\n	vec3 diffuseBase = vec3(0., 0., 0.);\r\n#ifdef SPECULARTERM\r\n	vec3 specularBase = vec3(0., 0., 0.);\r\n#endif\r\n	float shadow = 1.;\r\n\r\n#ifdef LIGHT0\r\n#ifndef SPECULARTERM\r\n	vec3 vLightSpecular0 = vec3(0.0);\r\n#endif\r\n#ifdef SPOTLIGHT0\r\n	mat3 info = computeSpotLighting(viewDirectionW, normalW, vLightData0, vLightDirection0, vLightDiffuse0, vLightSpecular0);\r\n#endif\r\n#ifdef HEMILIGHT0\r\n	mat3 info = computeHemisphericLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0, vLightGround0);\r\n#endif\r\n#ifdef POINTDIRLIGHT0\r\n	mat3 info = computeLighting(viewDirectionW, normalW, vLightData0, vLightDiffuse0, vLightSpecular0);\r\n#endif\r\n#ifdef SHADOW0\r\n#ifdef SHADOWVSM0\r\n	shadow = computeShadowWithVSM(vPositionFromLight0, shadowSampler0);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight0, shadowSampler0);\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n#ifdef SPECULARTERM\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT1\r\n#ifndef SPECULARTERM\r\n	vec3 vLightSpecular1 = vec3(0.0);\r\n#endif\r\n#ifdef SPOTLIGHT1\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData1, vLightDirection1, vLightDiffuse1, vLightSpecular1);\r\n#endif\r\n#ifdef HEMILIGHT1\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1, vLightGround1);\r\n#endif\r\n#ifdef POINTDIRLIGHT1\r\n	info = computeLighting(viewDirectionW, normalW, vLightData1, vLightDiffuse1, vLightSpecular1);\r\n#endif\r\n#ifdef SHADOW1\r\n#ifdef SHADOWVSM1\r\n	shadow = computeShadowWithVSM(vPositionFromLight1, shadowSampler1);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight1, shadowSampler1);\r\n#endif\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n#ifdef SPECULARTERM\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT2\r\n#ifndef SPECULARTERM\r\n	vec3 vLightSpecular2 = vec3(0.0);\r\n#endif\r\n#ifdef SPOTLIGHT2\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData2, vLightDirection2, vLightDiffuse2, vLightSpecular2);\r\n#endif\r\n#ifdef HEMILIGHT2\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2, vLightGround2);\r\n#endif\r\n#ifdef POINTDIRLIGHT2\r\n	info = computeLighting(viewDirectionW, normalW, vLightData2, vLightDiffuse2, vLightSpecular2);\r\n#endif\r\n#ifdef SHADOW2\r\n#ifdef SHADOWVSM2\r\n	shadow = computeShadowWithVSM(vPositionFromLight2, shadowSampler2);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight2, shadowSampler2);\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n#ifdef SPECULARTERM\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n#endif\r\n\r\n#ifdef LIGHT3\r\n#ifndef SPECULARTERM\r\n	vec3 vLightSpecular3 = vec3(0.0);\r\n#endif\r\n#ifdef SPOTLIGHT3\r\n	info = computeSpotLighting(viewDirectionW, normalW, vLightData3, vLightDirection3, vLightDiffuse3, vLightSpecular3);\r\n#endif\r\n#ifdef HEMILIGHT3\r\n	info = computeHemisphericLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3, vLightGround3);\r\n#endif\r\n#ifdef POINTDIRLIGHT3\r\n	info = computeLighting(viewDirectionW, normalW, vLightData3, vLightDiffuse3, vLightSpecular3);\r\n#endif\r\n#ifdef SHADOW3\r\n#ifdef SHADOWVSM3\r\n	shadow = computeShadowWithVSM(vPositionFromLight3, shadowSampler3);\r\n#else\r\n	shadow = computeShadow(vPositionFromLight3, shadowSampler3);\r\n#endif	\r\n#else\r\n	shadow = 1.;\r\n#endif\r\n	diffuseBase += info[0] * shadow;\r\n#ifdef SPECULARTERM\r\n	specularBase += info[1] * shadow;\r\n#endif\r\n#endif\r\n\r\n	// Reflection\r\n	vec3 reflectionColor = vec3(0., 0., 0.);\r\n\r\n#ifdef REFLECTION\r\n	if (vReflectionInfos.z != 0.0)\r\n	{\r\n		reflectionColor = textureCube(reflectionCubeSampler, vReflectionUVW).rgb * vReflectionInfos.y;\r\n	}\r\n	else\r\n	{\r\n		vec2 coords = vReflectionUVW.xy;\r\n\r\n		if (vReflectionInfos.x == MAP_PROJECTION)\r\n		{\r\n			coords /= vReflectionUVW.z;\r\n		}\r\n\r\n		coords.y = 1.0 - coords.y;\r\n\r\n		reflectionColor = texture2D(reflection2DSampler, coords).rgb * vReflectionInfos.y;\r\n	}\r\n\r\n#ifdef REFLECTIONFRESNEL\r\n	float reflectionFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, reflectionRightColor.a, reflectionLeftColor.a);\r\n\r\n	reflectionColor *= reflectionLeftColor.rgb * (1.0 - reflectionFresnelTerm) + reflectionFresnelTerm * reflectionRightColor.rgb;\r\n#endif\r\n#endif\r\n\r\n	// Alpha\r\n	float alpha = vDiffuseColor.a;\r\n\r\n#ifdef OPACITY\r\n	vec4 opacityMap = texture2D(opacitySampler, vOpacityUV);\r\n#ifdef OPACITYRGB\r\n	opacityMap.rgb = opacityMap.rgb * vec3(0.3, 0.59, 0.11);\r\n	alpha *= (opacityMap.x + opacityMap.y + opacityMap.z)* vOpacityInfos.y;\r\n#else\r\n	alpha *= opacityMap.a * vOpacityInfos.y;\r\n#endif\r\n#endif\r\n\r\n#ifdef VERTEXALPHA\r\n	alpha *= vColor.a;\r\n#endif\r\n\r\n#ifdef OPACITYFRESNEL\r\n	float opacityFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, opacityParts.z, opacityParts.w);\r\n\r\n	alpha += opacityParts.x * (1.0 - opacityFresnelTerm) + opacityFresnelTerm * opacityParts.y;\r\n#endif\r\n\r\n	// Emissive\r\n	vec3 emissiveColor = vEmissiveColor;\r\n#ifdef EMISSIVE\r\n	emissiveColor += texture2D(emissiveSampler, vEmissiveUV).rgb * vEmissiveInfos.y;\r\n#endif\r\n\r\n#ifdef EMISSIVEFRESNEL\r\n	float emissiveFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, emissiveRightColor.a, emissiveLeftColor.a);\r\n\r\n	emissiveColor *= emissiveLeftColor.rgb * (1.0 - emissiveFresnelTerm) + emissiveFresnelTerm * emissiveRightColor.rgb;\r\n#endif\r\n\r\n	// Specular map\r\n#ifdef SPECULARTERM\r\n	vec3 specularColor = vSpecularColor.rgb;\r\n#ifdef SPECULAR\r\n	specularColor = texture2D(specularSampler, vSpecularUV).rgb * vSpecularInfos.y;\r\n#endif\r\n#endif\r\n\r\n	// Fresnel\r\n#ifdef DIFFUSEFRESNEL\r\n	float diffuseFresnelTerm = computeFresnelTerm(viewDirectionW, normalW, diffuseRightColor.a, diffuseLeftColor.a);\r\n\r\n	diffuseBase *= diffuseLeftColor.rgb * (1.0 - diffuseFresnelTerm) + diffuseFresnelTerm * diffuseRightColor.rgb;\r\n#endif\r\n\r\n	// Composition\r\n	vec3 finalDiffuse = clamp(diffuseBase * diffuseColor + emissiveColor + vAmbientColor, 0.0, 1.0) * baseColor.rgb;\r\n#ifdef SPECULARTERM\r\n	vec3 finalSpecular = specularBase * specularColor;\r\n#else\r\n	vec3 finalSpecular = vec3(0.0);\r\n#endif\r\n\r\n	vec4 color = vec4(finalDiffuse * baseAmbientColor + finalSpecular + reflectionColor, alpha);\r\n\r\n#ifdef FOG\r\n	float fog = CalcFogFactor();\r\n	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\r\n#endif\r\n\r\n	gl_FragColor = color;\r\n}",
legacydefaultVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define MAP_EXPLICIT	0.\r\n#define MAP_SPHERICAL	1.\r\n#define MAP_PLANAR		2.\r\n#define MAP_CUBIC		3.\r\n#define MAP_PROJECTION	4.\r\n#define MAP_SKYBOX		5.\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#ifdef VERTEXCOLOR\r\nattribute vec4 color;\r\n#endif\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniforms\r\nuniform mat4 world;\r\nuniform mat4 view;\r\nuniform mat4 viewProjection;\r\n\r\n#ifdef DIFFUSE\r\nvarying vec2 vDiffuseUV;\r\nuniform mat4 diffuseMatrix;\r\nuniform vec2 vDiffuseInfos;\r\n#endif\r\n\r\n#ifdef AMBIENT\r\nvarying vec2 vAmbientUV;\r\nuniform mat4 ambientMatrix;\r\nuniform vec2 vAmbientInfos;\r\n#endif\r\n\r\n#ifdef OPACITY\r\nvarying vec2 vOpacityUV;\r\nuniform mat4 opacityMatrix;\r\nuniform vec2 vOpacityInfos;\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nuniform vec3 vEyePosition;\r\nvarying vec3 vReflectionUVW;\r\nuniform vec3 vReflectionInfos;\r\nuniform mat4 reflectionMatrix;\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\nvarying vec2 vEmissiveUV;\r\nuniform vec2 vEmissiveInfos;\r\nuniform mat4 emissiveMatrix;\r\n#endif\r\n\r\n#if defined(SPECULAR) && defined(SPECULARTERM)\r\nvarying vec2 vSpecularUV;\r\nuniform vec2 vSpecularInfos;\r\nuniform mat4 specularMatrix;\r\n#endif\r\n\r\n#ifdef BUMP\r\nvarying vec2 vBumpUV;\r\nuniform vec2 vBumpInfos;\r\nuniform mat4 bumpMatrix;\r\n#endif\r\n\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n// Output\r\nvarying vec3 vPositionW;\r\nvarying vec3 vNormalW;\r\n\r\n#ifdef VERTEXCOLOR\r\nvarying vec4 vColor;\r\n#endif\r\n\r\n#ifdef CLIPPLANE\r\nuniform vec4 vClipPlane;\r\nvarying float fClipDistance;\r\n#endif\r\n\r\n#ifdef FOG\r\nvarying float fFogDistance;\r\n#endif\r\n\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\nuniform mat4 lightMatrix0;\r\nvarying vec4 vPositionFromLight0;\r\n#endif\r\n#ifdef LIGHT1\r\nuniform mat4 lightMatrix1;\r\nvarying vec4 vPositionFromLight1;\r\n#endif\r\n#ifdef LIGHT2\r\nuniform mat4 lightMatrix2;\r\nvarying vec4 vPositionFromLight2;\r\n#endif\r\n#ifdef LIGHT3\r\nuniform mat4 lightMatrix3;\r\nvarying vec4 vPositionFromLight3;\r\n#endif\r\n#endif\r\n\r\n#ifdef REFLECTION\r\nvec3 computeReflectionCoords(float mode, vec4 worldPos, vec3 worldNormal)\r\n{\r\n	if (mode == MAP_SPHERICAL)\r\n	{\r\n		vec3 coords = vec3(view * vec4(worldNormal, 0.0));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1.0));\r\n	}\r\n	else if (mode == MAP_PLANAR)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = normalize(reflect(viewDir, worldNormal));\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 1));\r\n	}\r\n	else if (mode == MAP_CUBIC)\r\n	{\r\n		vec3 viewDir = worldPos.xyz - vEyePosition;\r\n		vec3 coords = reflect(viewDir, worldNormal);\r\n\r\n		return vec3(reflectionMatrix * vec4(coords, 0));\r\n	}\r\n	else if (mode == MAP_PROJECTION)\r\n	{\r\n		return vec3(reflectionMatrix * (view * worldPos));\r\n	}\r\n	else if (mode == MAP_SKYBOX)\r\n	{\r\n		return position;\r\n	}\r\n\r\n	return vec3(0, 0, 0);\r\n}\r\n#endif\r\n\r\nvoid main(void) {\r\n	mat4 finalWorld;\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n\r\n#ifdef BONES4\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = world * (m0 + m1 + m2 + m3);\r\n#else\r\n	finalWorld = world * (m0 + m1 + m2);\r\n#endif \r\n\r\n#else\r\n	finalWorld = world;\r\n#endif\r\n\r\n	gl_Position = viewProjection * finalWorld * vec4(position, 1.0);\r\n\r\n	vec4 worldPos = finalWorld * vec4(position, 1.0);\r\n	vPositionW = vec3(worldPos);\r\n	vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));\r\n\r\n	// Texture coordinates\r\n#ifndef UV1\r\n	vec2 uv = vec2(0., 0.);\r\n#endif\r\n#ifndef UV2\r\n	vec2 uv2 = vec2(0., 0.);\r\n#endif\r\n\r\n#ifdef DIFFUSE\r\n	if (vDiffuseInfos.x == 0.)\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vDiffuseUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef AMBIENT\r\n	if (vAmbientInfos.x == 0.)\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vAmbientUV = vec2(ambientMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	if (vOpacityInfos.x == 0.)\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vOpacityUV = vec2(opacityMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef REFLECTION\r\n	vReflectionUVW = computeReflectionCoords(vReflectionInfos.x, vec4(vPositionW, 1.0), vNormalW);\r\n#endif\r\n\r\n#ifdef EMISSIVE\r\n	if (vEmissiveInfos.x == 0.)\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vEmissiveUV = vec2(emissiveMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#if defined(SPECULAR) && defined(SPECULARTERM)\r\n	if (vSpecularInfos.x == 0.)\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vSpecularUV = vec2(specularMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n#ifdef BUMP\r\n	if (vBumpInfos.x == 0.)\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv, 1.0, 0.0));\r\n	}\r\n	else\r\n	{\r\n		vBumpUV = vec2(bumpMatrix * vec4(uv2, 1.0, 0.0));\r\n	}\r\n#endif\r\n\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	fClipDistance = dot(worldPos, vClipPlane);\r\n#endif\r\n\r\n	// Fog\r\n#ifdef FOG\r\n	fFogDistance = (view * worldPos).z;\r\n#endif\r\n\r\n	// Shadows\r\n#ifdef SHADOWS\r\n#ifdef LIGHT0\r\n	vPositionFromLight0 = lightMatrix0 * worldPos;\r\n#endif\r\n#ifdef LIGHT1\r\n	vPositionFromLight1 = lightMatrix1 * worldPos;\r\n#endif\r\n#ifdef LIGHT2\r\n	vPositionFromLight2 = lightMatrix2 * worldPos;\r\n#endif\r\n#ifdef LIGHT3\r\n	vPositionFromLight3 = lightMatrix3 * worldPos;\r\n#endif\r\n#endif\r\n\r\n	// Vertex color\r\n#ifdef VERTEXCOLOR\r\n	vColor = color;\r\n#endif\r\n}",lensFlarePixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Color\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	vec4 baseColor = texture2D(textureSampler, vUV);\r\n\r\n	gl_FragColor = baseColor * color;\r\n}",lensFlareVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Uniforms\r\nuniform mat4 viewportMatrix;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n\r\n	vUV = position * madd + madd;\r\n	gl_Position = viewportMatrix * vec4(position, 0.0, 1.0);\r\n}",lensHighlightsPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// samplers\r\nuniform sampler2D textureSampler;	// original color\r\n\r\n// uniforms\r\nuniform float gain;\r\nuniform float threshold;\r\nuniform bool pentagon;\r\nuniform float screen_width;\r\nuniform float screen_height;\r\n\r\n// varyings\r\nvarying vec2 vUV;\r\n\r\n// apply luminance filter\r\nvec4 highlightColor(vec4 color) {\r\n	vec4 highlight = color;\r\n	float luminance = dot(highlight.rgb, vec3(0.2125, 0.7154, 0.0721));\r\n	float lum_threshold;\r\n	if (threshold > 1.0) { lum_threshold = 0.94 + 0.01 * threshold; }\r\n	else { lum_threshold = 0.5 + 0.44 * threshold; }\r\n\r\n	luminance = clamp((luminance - lum_threshold) * (1.0 / (1.0 - lum_threshold)), 0.0, 1.0);\r\n\r\n	highlight *= luminance * gain;\r\n	highlight.a = 1.0;\r\n\r\n	return highlight;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	vec4 original = texture2D(textureSampler, vUV);\r\n\r\n	// quick exit if no highlight computing\r\n	if (gain == -1.0) {\r\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n		return;\r\n	}\r\n\r\n	float w = 2.0 / screen_width;\r\n	float h = 2.0 / screen_height;\r\n\r\n	float weight = 1.0;\r\n\r\n	// compute blurred color\r\n	vec4 blurred = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n	if (pentagon) {\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.84*w, 0.43*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.48*w, -1.29*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.61*w, 1.51*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.55*w, -0.74*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.71*w, -0.52*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.94*w, 1.59*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.40*w, -1.87*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.62*w, 1.16*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.09*w, 0.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.46*w, -1.71*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.08*w, 2.42*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.85*w, -1.89*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.89*w, 0.16*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.29*w, 1.88*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.40*w, -2.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.54*w, 2.26*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.60*w, -0.61*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.31*w, -1.30*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.83*w, 2.53*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.12*w, -2.48*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.60*w, 1.11*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.99*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.50*w, -2.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.85*w, 3.33*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.94*w, -1.92*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.27*w, -0.53*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.95*w, 2.48*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.23*w, -3.04*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.17*w, 2.05*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.97*w, -0.04*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.25*w, -2.00*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.31*w, 3.08*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.94*w, -2.59*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.37*w, 0.64*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.13*w, 1.93*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.03*w, -3.65*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.60*w, 3.17*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.14*w, -1.19*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.00*w, -1.19*h)));\r\n	}\r\n	else {\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.85*w, 0.36*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.52*w, -1.14*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.46*w, 1.42*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.46*w, -0.83*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.79*w, -0.42*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.11*w, 1.62*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.29*w, -2.07*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.69*w, 1.39*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.28*w, 0.12*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.65*w, -1.69*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.08*w, 2.44*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.63*w, -1.90*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.55*w, 0.31*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.13*w, 1.52*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.56*w, -2.61*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.38*w, 2.34*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.64*w, -0.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.53*w, -1.21*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.06*w, 2.63*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.00*w, -2.69*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.59*w, 1.32*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.82*w, 0.78*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.57*w, -2.50*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(0.54*w, 2.93*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.39*w, -1.81*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, -0.28*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.04*w, 2.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.02*w, -3.05*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.09*w, 2.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-3.07*w, -0.25*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.44*w, -1.90*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-0.52*w, 3.05*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-1.68*w, -2.61*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(3.01*w, 0.79*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.76*w, 1.46*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.05*w, -2.94*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(1.21*w, 2.88*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(-2.84*w, -1.30*h)));\r\n		blurred += highlightColor(texture2D(textureSampler, vUV + vec2(2.98*w, -0.96*h)));\r\n	}\r\n\r\n	blurred /= 39.0;\r\n\r\n	gl_FragColor = blurred;\r\n\r\n	//if(vUV.x > 0.5) { gl_FragColor.rgb *= 0.0; }\r\n}",linePixelShader:"precision highp float;\r\n\r\nuniform vec4 color;\r\n\r\nvoid main(void) {\r\n	gl_FragColor = color;\r\n}",lineVertexShader:"precision highp float;\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec4 normal;\r\n\r\n// Uniforms\r\nuniform mat4 worldViewProjection;\r\n\r\nuniform float width;\r\nuniform float aspectRatio;\r\n\r\nvoid main(void) {\r\n	vec4 viewPosition = worldViewProjection * vec4(position, 1.0);\r\n	vec4 viewPositionNext = worldViewProjection * vec4(normal.xyz, 1.0);\r\n\r\n	vec2 currentScreen = viewPosition.xy / viewPosition.w;\r\n	vec2 nextScreen = viewPositionNext.xy / viewPositionNext.w;\r\n\r\n	currentScreen.x *= aspectRatio;\r\n	nextScreen.x *= aspectRatio;\r\n\r\n	vec2 dir = normalize(nextScreen - currentScreen);\r\n	vec2 normalDir = vec2(-dir.y, dir.x);\r\n\r\n	normalDir *= width / 2.0;\r\n	normalDir.x /= aspectRatio;\r\n\r\n	vec4 offset = vec4(normalDir * normal.w, 0.0, 0.0);\r\n	gl_Position = viewPosition + offset;\r\n}",marblePixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform float numberOfTilesHeight;\r\nuniform float numberOfTilesWidth;\r\nuniform float amplitude;\r\nuniform vec3 brickColor;\r\nuniform vec3 jointColor;\r\n\r\nconst vec3 tileSize = vec3(1.1, 1.0, 1.1);\r\nconst vec3 tilePct = vec3(0.98, 1.0, 0.98);\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat turbulence(vec2 P)\r\n{\r\n	float val = 0.0;\r\n	float freq = 1.0;\r\n	for (int i = 0; i < 4; i++)\r\n	{\r\n		val += abs(noise(P*freq) / freq);\r\n		freq *= 2.07;\r\n	}\r\n	return val;\r\n}\r\n\r\nfloat round(float number){\r\n	return sign(number)*floor(abs(number) + 0.5);\r\n}\r\n\r\nvec3 marble_color(float x)\r\n{\r\n	vec3 col;\r\n	x = 0.5*(x + 1.);\r\n	x = sqrt(x);             \r\n	x = sqrt(x);\r\n	x = sqrt(x);\r\n	col = vec3(.2 + .75*x);  \r\n	col.b *= 0.95;           \r\n	return col;\r\n}\r\n\r\nvoid main()\r\n{\r\n	float brickW = 1.0 / numberOfTilesWidth;\r\n	float brickH = 1.0 / numberOfTilesHeight;\r\n	float jointWPercentage = 0.01;\r\n	float jointHPercentage = 0.01;\r\n	vec3 color = brickColor;\r\n	float yi = vUV.y / brickH;\r\n	float nyi = round(yi);\r\n	float xi = vUV.x / brickW;\r\n\r\n	if (mod(floor(yi), 2.0) == 0.0){\r\n		xi = xi - 0.5;\r\n	}\r\n\r\n	float nxi = round(xi);\r\n	vec2 brickvUV = vec2((xi - floor(xi)) / brickH, (yi - floor(yi)) / brickW);\r\n\r\n	if (yi < nyi + jointHPercentage && yi > nyi - jointHPercentage){\r\n		color = mix(jointColor, vec3(0.37, 0.25, 0.25), (yi - nyi) / jointHPercentage + 0.2);\r\n	}\r\n	else if (xi < nxi + jointWPercentage && xi > nxi - jointWPercentage){\r\n		color = mix(jointColor, vec3(0.44, 0.44, 0.44), (xi - nxi) / jointWPercentage + 0.2);\r\n	}\r\n	else {\r\n		float t = 6.28 * brickvUV.x / (tileSize.x + noise(vec2(vUV)*6.0));\r\n		t += amplitude * turbulence(brickvUV.xy);\r\n		t = sin(t);\r\n		color = marble_color(t);\r\n	}\r\n\r\n	gl_FragColor = vec4(color, 0.0);\r\n}",outlinePixelShader:"precision highp float;\r\n\r\nuniform vec4 color;\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\nvoid main(void) {\r\n#ifdef ALPHATEST\r\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n	gl_FragColor = color;\r\n}",outlineVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attribute\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\n\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniform\r\nuniform float offset;\r\n\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 viewProjection;\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform mat4 diffuseMatrix;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef INSTANCES\r\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	mat4 finalWorld = world;\r\n#endif\r\n\r\n	vec3 offsetPosition = position + normal * offset;\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\r\n#else\r\n	gl_Position = viewProjection * finalWorld * vec4(offsetPosition, 1.0);\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n#ifdef UV1\r\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n#endif\r\n#ifdef UV2\r\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n#endif\r\n#endif\r\n}",particlesPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nvarying vec4 vColor;\r\nuniform vec4 textureMask;\r\nuniform sampler2D diffuseSampler;\r\n\r\n#ifdef CLIPPLANE\r\nvarying float fClipDistance;\r\n#endif\r\n\r\nvoid main(void) {\r\n#ifdef CLIPPLANE\r\n	if (fClipDistance > 0.0)\r\n		discard;\r\n#endif\r\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\r\n\r\n	gl_FragColor = (baseColor * textureMask + (vec4(1., 1., 1., 1.) - textureMask)) * vColor;\r\n}",particlesVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec4 color;\r\nattribute vec4 options;\r\n\r\n// Uniforms\r\nuniform mat4 view;\r\nuniform mat4 projection;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\nvarying vec4 vColor;\r\n\r\n#ifdef CLIPPLANE\r\nuniform vec4 vClipPlane;\r\nuniform mat4 invView;\r\nvarying float fClipDistance;\r\n#endif\r\n\r\nvoid main(void) {	\r\n	vec3 viewPos = (view * vec4(position, 1.0)).xyz; \r\n	vec3 cornerPos;\r\n	float size = options.y;\r\n	float angle = options.x;\r\n	vec2 offset = options.zw;\r\n\r\n	cornerPos = vec3(offset.x - 0.5, offset.y  - 0.5, 0.) * size;\r\n\r\n	// Rotate\r\n	vec3 rotatedCorner;\r\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\r\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\r\n	rotatedCorner.z = 0.;\r\n\r\n	// Position\r\n	viewPos += rotatedCorner;\r\n	gl_Position = projection * vec4(viewPos, 1.0);   \r\n	\r\n	vColor = color;\r\n	vUV = offset;\r\n\r\n	// Clip plane\r\n#ifdef CLIPPLANE\r\n	vec4 worldPos = invView * vec4(viewPos, 1.0);\r\n	fClipDistance = dot(worldPos, vClipPlane);\r\n#endif\r\n}",passPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nvoid main(void) \r\n{\r\n	gl_FragColor = texture2D(textureSampler, vUV);\r\n}",postprocessVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n\r\n	vUV = position * madd + madd;\r\n	gl_Position = vec4(position, 0.0, 1.0);\r\n}",proceduralVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec2 position;\r\n\r\n// Output\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nconst vec2 madd = vec2(0.5, 0.5);\r\n\r\nvoid main(void) {	\r\n	vPosition = position;\r\n	vUV = position * madd + madd;\r\n	gl_Position = vec4(position, 0.0, 1.0);\r\n}",refractionPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D refractionSampler;\r\n\r\n// Parameters\r\nuniform vec3 baseColor;\r\nuniform float depth;\r\nuniform float colorLevel;\r\n\r\nvoid main() {\r\n	float ref = 1.0 - texture2D(refractionSampler, vUV).r;\r\n\r\n	vec2 uv = vUV - vec2(0.5);\r\n	vec2 offset = uv * depth * ref;\r\n	vec3 sourceColor = texture2D(textureSampler, vUV - offset).rgb;\r\n\r\n	gl_FragColor = vec4(sourceColor + sourceColor * ref * colorLevel, 1.0);\r\n}",roadPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vUV;                    \r\nuniform vec3 roadColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main(void) {\r\n	float ratioy = mod(gl_FragCoord.y * 100.0 , fbm(vUV * 2.0));\r\n	vec3 color = roadColor * ratioy;\r\n	gl_FragColor = vec4(color, 1.0);\r\n}",shadowMapPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvec4 pack(float depth)\r\n{\r\n	const vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\r\n	const vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\r\n\r\n	vec4 res = fract(depth * bit_shift);\r\n	res -= res.xxyz * bit_mask;\r\n\r\n	return res;\r\n}\r\n\r\n// Thanks to http://devmaster.net/\r\nvec2 packHalf(float depth) \r\n{ \r\n	const vec2 bitOffset = vec2(1.0 / 255., 0.);\r\n	vec2 color = vec2(depth, fract(depth * 255.));\r\n\r\n	return color - (color.yy * bitOffset);\r\n}\r\n\r\nvarying vec4 vPosition;\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef ALPHATEST\r\n	if (texture2D(diffuseSampler, vUV).a < 0.4)\r\n		discard;\r\n#endif\r\n	float depth = vPosition.z / vPosition.w;\r\n	depth = depth * 0.5 + 0.5;\r\n\r\n#ifdef VSM\r\n	float moment1 = depth;\r\n	float moment2 = moment1 * moment1;\r\n\r\n	gl_FragColor = vec4(packHalf(moment1), packHalf(moment2));\r\n#else\r\n	gl_FragColor = pack(depth);\r\n#endif\r\n}",shadowMapVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attribute\r\nattribute vec3 position;\r\n#ifdef BONES\r\nattribute vec4 matricesIndices;\r\nattribute vec4 matricesWeights;\r\n#endif\r\n\r\n// Uniform\r\n#ifdef INSTANCES\r\nattribute vec4 world0;\r\nattribute vec4 world1;\r\nattribute vec4 world2;\r\nattribute vec4 world3;\r\n#else\r\nuniform mat4 world;\r\n#endif\r\n\r\nuniform mat4 viewProjection;\r\n#ifdef BONES\r\nuniform mat4 mBones[BonesPerMesh];\r\n#endif\r\n\r\nvarying vec4 vPosition;\r\n\r\n#ifdef ALPHATEST\r\nvarying vec2 vUV;\r\nuniform mat4 diffuseMatrix;\r\n#ifdef UV1\r\nattribute vec2 uv;\r\n#endif\r\n#ifdef UV2\r\nattribute vec2 uv2;\r\n#endif\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#ifdef INSTANCES\r\n	mat4 finalWorld = mat4(world0, world1, world2, world3);\r\n#else\r\n	mat4 finalWorld = world;\r\n#endif\r\n\r\n#ifdef BONES\r\n	mat4 m0 = mBones[int(matricesIndices.x)] * matricesWeights.x;\r\n	mat4 m1 = mBones[int(matricesIndices.y)] * matricesWeights.y;\r\n	mat4 m2 = mBones[int(matricesIndices.z)] * matricesWeights.z;\r\n	mat4 m3 = mBones[int(matricesIndices.w)] * matricesWeights.w;\r\n	finalWorld = finalWorld * (m0 + m1 + m2 + m3);\r\n#endif\r\n\r\n	vPosition = viewProjection * finalWorld * vec4(position, 1.0);\r\n	gl_Position = vPosition;\r\n\r\n#ifdef ALPHATEST\r\n#ifdef UV1\r\n	vUV = vec2(diffuseMatrix * vec4(uv, 1.0, 0.0));\r\n#endif\r\n#ifdef UV2\r\n	vUV = vec2(diffuseMatrix * vec4(uv2, 1.0, 0.0));\r\n#endif\r\n#endif\r\n}",spritesPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform bool alphaTest;\r\n\r\nvarying vec4 vColor;\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D diffuseSampler;\r\n\r\n// Fog\r\n#ifdef FOG\r\n\r\n#define FOGMODE_NONE    0.\r\n#define FOGMODE_EXP     1.\r\n#define FOGMODE_EXP2    2.\r\n#define FOGMODE_LINEAR  3.\r\n#define E 2.71828\r\n\r\nuniform vec4 vFogInfos;\r\nuniform vec3 vFogColor;\r\nvarying float fFogDistance;\r\n\r\nfloat CalcFogFactor()\r\n{\r\n	float fogCoeff = 1.0;\r\n	float fogStart = vFogInfos.y;\r\n	float fogEnd = vFogInfos.z;\r\n	float fogDensity = vFogInfos.w;\r\n\r\n	if (FOGMODE_LINEAR == vFogInfos.x)\r\n	{\r\n		fogCoeff = (fogEnd - fFogDistance) / (fogEnd - fogStart);\r\n	}\r\n	else if (FOGMODE_EXP == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fogDensity);\r\n	}\r\n	else if (FOGMODE_EXP2 == vFogInfos.x)\r\n	{\r\n		fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity);\r\n	}\r\n\r\n	return min(1., max(0., fogCoeff));\r\n}\r\n#endif\r\n\r\n\r\nvoid main(void) {\r\n	vec4 baseColor = texture2D(diffuseSampler, vUV);\r\n\r\n	if (alphaTest) \r\n	{\r\n		if (baseColor.a < 0.95)\r\n			discard;\r\n	}\r\n\r\n	baseColor *= vColor;\r\n\r\n#ifdef FOG\r\n	float fog = CalcFogFactor();\r\n	baseColor.rgb = fog * baseColor.rgb + (1.0 - fog) * vFogColor;\r\n#endif\r\n\r\n	gl_FragColor = baseColor;\r\n}",spritesVertexShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Attributes\r\nattribute vec4 position;\r\nattribute vec4 options;\r\nattribute vec4 cellInfo;\r\nattribute vec4 color;\r\n\r\n// Uniforms\r\nuniform vec2 textureInfos;\r\nuniform mat4 view;\r\nuniform mat4 projection;\r\n\r\n// Output\r\nvarying vec2 vUV;\r\nvarying vec4 vColor;\r\n\r\n#ifdef FOG\r\nvarying float fFogDistance;\r\n#endif\r\n\r\nvoid main(void) {	\r\n	vec3 viewPos = (view * vec4(position.xyz, 1.0)).xyz; \r\n	vec2 cornerPos;\r\n	\r\n	float angle = position.w;\r\n	vec2 size = vec2(options.x, options.y);\r\n	vec2 offset = options.zw;\r\n	vec2 uvScale = textureInfos.xy;\r\n\r\n	cornerPos = vec2(offset.x - 0.5, offset.y  - 0.5) * size;\r\n\r\n	// Rotate\r\n	vec3 rotatedCorner;\r\n	rotatedCorner.x = cornerPos.x * cos(angle) - cornerPos.y * sin(angle);\r\n	rotatedCorner.y = cornerPos.x * sin(angle) + cornerPos.y * cos(angle);\r\n	rotatedCorner.z = 0.;\r\n\r\n	// Position\r\n	viewPos += rotatedCorner;\r\n	gl_Position = projection * vec4(viewPos, 1.0);   \r\n\r\n	// Color\r\n	vColor = color;\r\n	\r\n	// Texture\r\n	vec2 uvOffset = vec2(abs(offset.x - cellInfo.x), 1.0 - abs(offset.y - cellInfo.y));\r\n\r\n	vUV = (uvOffset + cellInfo.zw) * uvScale;\r\n\r\n	// Fog\r\n#ifdef FOG\r\n	fFogDistance = viewPos.z;\r\n#endif\r\n}",ssaoPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#define SAMPLES 16\r\n\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D randomSampler;\r\n\r\nuniform float randTextureTiles;\r\nuniform float samplesFactor;\r\nuniform vec3 sampleSphere[16];\r\n\r\nuniform float totalStrength;\r\nuniform float radius;\r\nuniform float area;\r\nuniform float fallOff;\r\n\r\nvarying vec2 vUV;\r\n\r\nconst vec2 offset1 = vec2(0.0, 0.001);\r\nconst vec2 offset2 = vec2(0.001, 0.0);\r\n\r\nvec3 normalFromDepth(const float depth, const vec2 coords) {\r\n	float depth1 = texture2D(textureSampler, coords + offset1).r;\r\n	float depth2 = texture2D(textureSampler, coords + offset2).r;\r\n\r\n    vec3 p1 = vec3(offset1, depth1 - depth);\r\n    vec3 p2 = vec3(offset2, depth2 - depth);\r\n\r\n    vec3 normal = cross(p1, p2);\r\n    normal.z = -normal.z;\r\n\r\n    return normalize(normal);\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	const float base = 0.2;\r\n\r\n	vec3 random = texture2D(randomSampler, vUV * randTextureTiles).rgb;\r\n	float depth = texture2D(textureSampler, vUV).r;\r\n	vec3 position = vec3(vUV, depth);\r\n	vec3 normal = normalFromDepth(depth, vUV);\r\n	float radiusDepth = radius / depth;\r\n	float occlusion = 0.0;\r\n\r\n	vec3 ray;\r\n	vec3 hemiRay;\r\n	float occlusionDepth;\r\n	float difference;\r\n\r\n	for (int i = 0; i < SAMPLES; i++)\r\n	{\r\n		ray = radiusDepth * reflect(sampleSphere[i], random);\r\n		hemiRay = position + sign(dot(ray, normal)) * ray;\r\n\r\n		occlusionDepth = texture2D(textureSampler, clamp(hemiRay.xy, 0.0, 1.0)).r;\r\n		difference = depth - occlusionDepth;\r\n\r\n		occlusion += step(fallOff, difference) * (1.0 - smoothstep(fallOff, area, difference));\r\n	}\r\n\r\n	float ao = 1.0 - totalStrength * occlusion * samplesFactor;\r\n\r\n	float result = clamp(ao + base, 0.0, 1.0);\r\n	gl_FragColor.r = result;\r\n	gl_FragColor.g = result;\r\n	gl_FragColor.b = result;\r\n	gl_FragColor.a = 1.0;\r\n}\r\n",ssaoCombinePixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D originalColor;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n	gl_FragColor = texture2D(originalColor, vUV) * texture2D(textureSampler, vUV);\r\n}\r\n",
stereoscopicInterlacePixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\r\n\r\nvarying vec2 vUV;\r\nuniform sampler2D camASampler;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 stepSize;\r\n\r\nvoid main(void)\r\n{\r\n    bool useCamB;\r\n    vec2 texCoord1;\r\n    vec2 texCoord2;\r\n    \r\n    vec3 frag1;\r\n    vec3 frag2;\r\n    \r\n#ifdef IS_STEREOSCOPIC_HORIZ\r\n	    useCamB = vUV.x > 0.5;\r\n	    texCoord1 = vec2(useCamB ? (vUV.x - 0.5) * 2.0 : vUV.x * 2.0, vUV.y);\r\n	    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\r\n#else\r\n	    useCamB = vUV.y > 0.5;\r\n	    texCoord1 = vec2(vUV.x, useCamB ? (vUV.y - 0.5) * 2.0 : vUV.y * 2.0);\r\n	    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\r\n#endif\r\n    \r\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\r\n    if (useCamB){\r\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\r\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\r\n    }else{\r\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\r\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\r\n    }\r\n    \r\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\r\n}",tonemapPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\n// Constants\r\nuniform float _ExposureAdjustment;\r\n\r\n#if defined(HABLE_TONEMAPPING)\r\n    const float A = 0.15;\r\n    const float B = 0.50;\r\n    const float C = 0.10;\r\n    const float D = 0.20;\r\n    const float E = 0.02;\r\n    const float F = 0.30;\r\n    const float W = 11.2;\r\n#endif\r\n\r\nfloat Luminance(vec3 c)\r\n{\r\n    return dot(c, vec3(0.22, 0.707, 0.071));\r\n}\r\n\r\nvoid main(void) \r\n{\r\n    vec3 colour = texture2D(textureSampler, vUV).rgb;\r\n\r\n#if defined(REINHARD_TONEMAPPING)\r\n\r\n    float lum = Luminance(colour.rgb); \r\n    float lumTm = lum * _ExposureAdjustment;\r\n    float scale = lumTm / (1.0 + lumTm);  \r\n\r\n    colour *= scale / lum;\r\n\r\n#elif defined(HABLE_TONEMAPPING)\r\n\r\n    colour *= _ExposureAdjustment;\r\n\r\n    const float ExposureBias = 2.0;\r\n    vec3 x = ExposureBias * colour;\r\n\r\n    vec3 curr = ((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - E / F;\r\n    \r\n    x = vec3(W, W, W);\r\n    vec3 whiteScale = 1.0 / (((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - E / F);\r\n    colour = curr * whiteScale;\r\n\r\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\r\n\r\n    colour *= _ExposureAdjustment;\r\n    \r\n    vec3 X = max(vec3(0.0, 0.0, 0.0), colour - 0.004);\r\n    vec3 retColor = (X * (6.2 * X + 0.5)) / (X * (6.2 * X + 1.7) + 0.06);\r\n\r\n    colour = retColor * retColor;\r\n\r\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\r\n\r\n    colour =  vec3(1.0, 1.0, 1.0) - exp2(-_ExposureAdjustment * colour);\r\n\r\n#endif\r\n\r\n	gl_FragColor = vec4(colour.rgb, 1.0);\r\n}",volumetricLightScatteringPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D textureSampler;\r\nuniform sampler2D lightScatteringSampler;\r\n\r\nuniform float decay;\r\nuniform float exposure;\r\nuniform float weight;\r\nuniform float density;\r\nuniform vec2 meshPositionOnScreen;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n    vec2 tc = vUV;\r\n	vec2 deltaTexCoord = (tc - meshPositionOnScreen.xy);\r\n    deltaTexCoord *= 1.0 / float(NUM_SAMPLES) * density;\r\n\r\n    float illuminationDecay = 1.0;\r\n\r\n	vec4 color = texture2D(lightScatteringSampler, tc) * 0.4;\r\n\r\n    for(int i=0; i < NUM_SAMPLES; i++) {\r\n        tc -= deltaTexCoord;\r\n		vec4 sample = texture2D(lightScatteringSampler, tc) * 0.4;\r\n        sample *= illuminationDecay * weight;\r\n        color += sample;\r\n        illuminationDecay *= decay;\r\n    }\r\n\r\n    vec4 realColor = texture2D(textureSampler, vUV);\r\n    gl_FragColor = ((vec4((vec3(color.r, color.g, color.b) * exposure), 1)) + (realColor * (1.5 - 0.4)));\r\n}\r\n",volumetricLightScatteringPassPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(NEED_UV)\r\nvarying vec2 vUV;\r\n#endif\r\n\r\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\r\nuniform sampler2D diffuseSampler;\r\n#endif\r\n\r\n#if defined(DIFFUSE_COLOR_RENDER)\r\nuniform vec3 color;\r\n#endif\r\n\r\n#if defined(OPACITY)\r\nuniform sampler2D opacitySampler;\r\nuniform float opacityLevel;\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\r\n	vec4 diffuseColor = texture2D(diffuseSampler, vUV);\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n	if (diffuseColor.a < 0.4)\r\n		discard;\r\n#endif\r\n\r\n#ifdef OPACITY\r\n	vec4 opacityColor = texture2D(opacitySampler, vUV);\r\n	float alpha = 1.0;\r\n\r\n	#ifdef OPACITYRGB\r\n	opacityColor.rgb = opacityColor.rgb * vec3(0.3, 0.59, 0.11);\r\n	alpha *= (opacityColor.x + opacityColor.y + opacityColor.z) * opacityLevel;\r\n	#else\r\n	alpha *= opacityColor.a * opacityLevel;\r\n	#endif\r\n\r\n	#if defined(BASIC_RENDER)\r\n	gl_FragColor = vec4(diffuseColor.rgb, alpha);\r\n	#elif defined(DIFFUSE_COLOR_RENDER)\r\n	gl_FragColor = vec4(color.rgb, alpha);\r\n	#else\r\n	gl_FragColor = vec4(0.0, 0.0, 0.0, alpha);\r\n	#endif\r\n\r\n	gl_FragColor.a = alpha;\r\n#else\r\n\r\n	#if defined(BASIC_RENDER)\r\n	gl_FragColor = diffuseColor;\r\n	#elif defined(DIFFUSE_COLOR_RENDER)\r\n	gl_FragColor = vec4(color.rgb, 1.0);\r\n	#else\r\n	gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n	#endif\r\n#endif\r\n\r\n}\r\n",vrDistortionCorrectionPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 LensCenter;\r\nuniform vec2 Scale;\r\nuniform vec2 ScaleIn;\r\nuniform vec4 HmdWarpParam;\r\n\r\nvec2 HmdWarp(vec2 in01) {\r\n\r\n	vec2 theta = (in01 - LensCenter) * ScaleIn; // Scales to [-1, 1]\r\n	float rSq = theta.x * theta.x + theta.y * theta.y;\r\n	vec2 rvector = theta * (HmdWarpParam.x + HmdWarpParam.y * rSq + HmdWarpParam.z * rSq * rSq + HmdWarpParam.w * rSq * rSq * rSq);\r\n	return LensCenter + Scale * rvector;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n	vec2 tc = HmdWarp(vUV);\r\n	if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\r\n		gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n	else{\r\n		gl_FragColor = vec4(texture2D(textureSampler, tc).rgb, 1.0);\r\n	}\r\n}",woodPixelShader:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nvarying vec2 vPosition;\r\nvarying vec2 vUV;\r\n\r\nuniform float ampScale;\r\nuniform vec3 woodColor;\r\n\r\nfloat rand(vec2 n) {\r\n	return fract(cos(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n}\r\n\r\nfloat noise(vec2 n) {\r\n	const vec2 d = vec2(0.0, 1.0);\r\n	vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\r\n	return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\r\n}\r\n\r\nfloat fbm(vec2 n) {\r\n	float total = 0.0, amplitude = 1.0;\r\n	for (int i = 0; i < 4; i++) {\r\n		total += noise(n) * amplitude;\r\n		n += n;\r\n		amplitude *= 0.5;\r\n	}\r\n	return total;\r\n}\r\n\r\nvoid main(void) {\r\n	float ratioy = mod(vUV.x * ampScale, 2.0 + fbm(vUV * 0.8));\r\n	vec3 wood = woodColor * ratioy;\r\n	gl_FragColor = vec4(wood, 1.0);\r\n}"},r.CollisionWorker='var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:o.z-i>e.z?!1:!0},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:e(s,r,this.basePointWorld,this.velocityWorldLength+c)?!0:!1},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=2*g*t.Vector3.Dot(this.velocity,this._baseToVertex)-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?((0!==e.x||0!==e.y||0!==e.z)&&this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i,r;if(r=e.subMeshes,i=r.length,!e.geometryId)return void console.log("no mesh geometry id");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log("couldn\'t find geometry",e.geometryId);for(var s=0;i>s;s++){var l=r[s];i>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){for(var i in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(i)&&this._collisionCache.addGeometry(e.updatedGeometries[i]);for(var r in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(r)&&this._collisionCache.addMesh(e.updatedMeshes[r]);var t={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};postMessage(t,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts("./babylon.collisionCoordinator.js"),importScripts("./babylon.collider.js"),importScripts("../Math/babylon.math.js"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log("single worker init")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker="",function(e){e[e.INIT=0]="INIT",e[e.UPDATE=1]="UPDATE",e[e.COLLIDE=2]="COLLIDE"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn("error returned from worker!");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(o){var i=[];o.subMeshes&&(i=o.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var t=null;return o instanceof e.Mesh?t=o.geometry?o.geometry.id:null:o instanceof e.InstancedMesh&&(t=o.sourceMesh.geometry?o.sourceMesh.geometry.id:null),{uniqueId:o.uniqueId,id:o.id,name:o.name,geometryId:t,sphereCenter:o.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:o.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:o.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:o.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:o.worldMatrixFromCache.asArray(),subMeshes:i,checkCollisions:o.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?((0!==i.x||0!==i.y||0!==i.z)&&t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){var i=function(){function i(t,i,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),this.r=t,this.g=i,this.b=o}return i.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},i.prototype.toColor4=function(t){return void 0===t&&(t=1),new o(this.r,this.g,this.b,t)},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},i.prototype.multiply=function(t){return new i(this.r*t.r,this.g*t.g,this.b*t.b)},i.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},i.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},i.prototype.equalsFloats=function(t,i,o){return this.r===t&&this.g===i&&this.b===o},i.prototype.scale=function(t){return new i(this.r*t,this.g*t,this.b*t)},i.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},i.prototype.add=function(t){return new i(this.r+t.r,this.g+t.g,this.b+t.b)},i.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},i.prototype.subtract=function(t){return new i(this.r-t.r,this.g-t.g,this.b-t.b)},i.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},i.prototype.clone=function(){return new i(this.r,this.g,this.b)},i.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},i.prototype.copyFromFloats=function(t,i,o){return this.r=t,this.g=i,this.b=o,this},i.prototype.toHexString=function(){var i=255*this.r|0,o=255*this.g|0,n=255*this.b|0;return"#"+t.Tools.ToHex(i)+t.Tools.ToHex(o)+t.Tools.ToHex(n)},i.FromHexString=function(o){if("#"!==o.substring(0,1)||7!==o.length)return t.Tools.Warn("Color3.FromHexString must be called with a string like #FFFFFF"),new i(0,0,0);var n=parseInt(o.substring(1,3),16),r=parseInt(o.substring(3,5),16),s=parseInt(o.substring(5,7),16);return i.FromInts(n,r,s)},i.FromArray=function(t,o){return void 0===o&&(o=0),new i(t[o],t[o+1],t[o+2])},i.FromInts=function(t,o,n){return new i(t/255,o/255,n/255)},i.Lerp=function(t,o,n){var r=t.r+(o.r-t.r)*n,s=t.g+(o.g-t.g)*n,e=t.b+(o.b-t.b)*n;return new i(r,s,e)},i.Red=function(){return new i(1,0,0)},i.Green=function(){return new i(0,1,0)},i.Blue=function(){return new i(0,0,1)},i.Black=function(){return new i(0,0,0)},i.White=function(){return new i(1,1,1)},i.Purple=function(){return new i(.5,0,.5)},i.Magenta=function(){return new i(1,0,1)},i.Yellow=function(){return new i(1,1,0)},i.Gray=function(){return new i(.5,.5,.5)},i}();t.Color3=i;var o=function(){function i(t,i,o,n){this.r=t,this.g=i,this.b=o,this.a=n}return i.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},i.prototype.add=function(t){return new i(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},i.prototype.subtract=function(t){return new i(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},i.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},i.prototype.scale=function(t){return new i(this.r*t,this.g*t,this.b*t,this.a*t)},i.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},i.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},i.prototype.clone=function(){return new i(this.r,this.g,this.b,this.a)},i.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.prototype.toHexString=function(){var i=255*this.r|0,o=255*this.g|0,n=255*this.b|0,r=255*this.a|0;return"#"+t.Tools.ToHex(i)+t.Tools.ToHex(o)+t.Tools.ToHex(n)+t.Tools.ToHex(r)},i.FromHexString=function(o){if("#"!==o.substring(0,1)||9!==o.length)return t.Tools.Warn("Color4.FromHexString must be called with a string like #FFFFFFFF"),new i(0,0,0,0);var n=parseInt(o.substring(1,3),16),r=parseInt(o.substring(3,5),16),s=parseInt(o.substring(5,7),16),e=parseInt(o.substring(7,9),16);return i.FromInts(n,r,s,e)},i.Lerp=function(t,o,n){var r=new i(0,0,0,0);return i.LerpToRef(t,o,n,r),r},i.LerpToRef=function(t,i,o,n){n.r=t.r+(i.r-t.r)*o,n.g=t.g+(i.g-t.g)*o,n.b=t.b+(i.b-t.b)*o,n.a=t.a+(i.a-t.a)*o},i.FromArray=function(t,o){return void 0===o&&(o=0),new i(t[o],t[o+1],t[o+2],t[o+3])},i.FromInts=function(t,o,n,r){return new i(t/255,o/255,n/255,r/255)},i}();t.Color4=o;var n=function(){function i(t,i){this.x=t,this.y=i}return i.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.addVector3=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},i.prototype.multiplyByFloats=function(t,o){return new i(this.x*t,this.y*o)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},i.prototype.negate=function(){return new i(-this.x,-this.y)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t)},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},i.prototype.equalsWithEpsilon=function(i,o){return void 0===o&&(o=t.Engine.Epsilon),i&&t.Tools.WithinEpsilon(this.x,i.x,o)&&t.Tools.WithinEpsilon(this.y,i.y,o)},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=function(){return new i(0,0)},i.FromArray=function(t,o){return void 0===o&&(o=0),new i(t[o],t[o+1])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a);return new i(h,u)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;return s=s>n.y?n.y:s,s=s<o.y?o.y:s,new i(r,s)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m;return new i(f,x)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n;return new i(r,s)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y},i.Normalize=function(t){var i=t.clone();return i.normalize(),i},i.Minimize=function(t,o){var n=t.x<o.x?t.x:o.x,r=t.y<o.y?t.y:o.y;return new i(n,r)},i.Maximize=function(t,o){var n=t.x>o.x?t.x:o.x,r=t.y>o.y?t.y:o.y;return new i(n,r)},i.Transform=function(t,o){var n=t.x*o.m[0]+t.y*o.m[4],r=t.x*o.m[1]+t.y*o.m[5];return new i(n,r)},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y;return o*o+n*n},i}();t.Vector2=n;var r=function(){function i(t,i,o){this.x=t,this.y=i,this.z=o}return i.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},i.prototype.toQuaternion=function(){var t=new e(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),o=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),r=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),a=Math.sin(.5*this.y);return t.x=n*a,t.y=-r*a,t.z=o*s,t.w=i*s,t},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},i.prototype.subtractFromFloats=function(t,o,n){return new i(this.x-t,this.y-o,this.z-n)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n){return n.x=this.x-t,n.y=this.y-i,n.z=this.z-o,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},i.prototype.equalsWithEpsilon=function(i,o){return void 0===o&&(o=t.Engine.Epsilon),i&&t.Tools.WithinEpsilon(this.x,i.x,o)&&t.Tools.WithinEpsilon(this.y,i.y,o)&&t.Tools.WithinEpsilon(this.z,i.z,o)},i.prototype.equalsToFloats=function(t,i,o){return this.x===t&&this.y===i&&this.z===o},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},i.prototype.multiplyByFloats=function(t,o,n){return new i(this.x*t,this.y*o,this.z*n)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.copyFromFloats=function(t,i,o){return this.x=t,this.y=i,this.z=o,this},i.GetClipFactor=function(t,o,n,r){var s=i.Dot(t,n)-r,e=i.Dot(o,n)-r,a=s/(s-e);return a},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2])},i.FromFloatArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2]},i.FromFloatsToRef=function(t,i,o,n){n.x=t,n.y=i,n.z=o},i.Zero=function(){return new i(0,0,0)},i.Up=function(){return new i(0,1,0)},i.TransformCoordinates=function(t,o){var n=i.Zero();return i.TransformCoordinatesToRef(t,o,n),n},i.TransformCoordinatesToRef=function(t,i,o){var n=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],r=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];o.x=n/e,o.y=r/e,o.z=s/e},i.TransformCoordinatesFromFloatsToRef=function(t,i,o,n,r){var s=t*n.m[0]+i*n.m[4]+o*n.m[8]+n.m[12],e=t*n.m[1]+i*n.m[5]+o*n.m[9]+n.m[13],a=t*n.m[2]+i*n.m[6]+o*n.m[10]+n.m[14],h=t*n.m[3]+i*n.m[7]+o*n.m[11]+n.m[15];r.x=s/h,r.y=e/h,r.z=a/h},i.TransformCoordinatesToRefSIMD=function(t,i,o){var n=SIMD.float32x4.loadXYZ(t._data,0),r=SIMD.float32x4.load(i.m,0),s=SIMD.float32x4.load(i.m,4),e=SIMD.float32x4.load(i.m,8),a=SIMD.float32x4.load(i.m,12),h=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),s)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),e),a));h=SIMD.float32x4.div(h,SIMD.float32x4.swizzle(h,3,3,3,3)),SIMD.float32x4.storeXYZ(o._data,0,h)},i.TransformCoordinatesFromFloatsToRefSIMD=function(t,i,o,n,r){var s=SIMD.float32x4.splat(t),e=SIMD.float32x4.splat(i),a=SIMD.float32x4.splat(o),h=SIMD.float32x4.load(n.m,0),u=SIMD.float32x4.load(n.m,4),l=SIMD.float32x4.load(n.m,8),m=SIMD.float32x4.load(n.m,12),f=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(s,h),SIMD.float32x4.mul(e,u)),SIMD.float32x4.add(SIMD.float32x4.mul(a,l),m));f=SIMD.float32x4.div(f,SIMD.float32x4.swizzle(f,3,3,3,3)),SIMD.float32x4.storeXYZ(r._data,0,f)},i.TransformNormal=function(t,o){var n=i.Zero();return i.TransformNormalToRef(t,o,n),n},i.TransformNormalToRef=function(t,i,o){o.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],o.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],o.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},i.TransformNormalFromFloatsToRef=function(t,i,o,n,r){r.x=t*n.m[0]+i*n.m[4]+o*n.m[8],r.y=t*n.m[1]+i*n.m[5]+o*n.m[9],r.z=t*n.m[2]+i*n.m[6]+o*n.m[10]},i.CatmullRom=function(t,o,n,r,s){var e=s*s,a=s*e,h=.5*(2*o.x+(-t.x+n.x)*s+(2*t.x-5*o.x+4*n.x-r.x)*e+(-t.x+3*o.x-3*n.x+r.x)*a),u=.5*(2*o.y+(-t.y+n.y)*s+(2*t.y-5*o.y+4*n.y-r.y)*e+(-t.y+3*o.y-3*n.y+r.y)*a),l=.5*(2*o.z+(-t.z+n.z)*s+(2*t.z-5*o.z+4*n.z-r.z)*e+(-t.z+3*o.z-3*n.z+r.z)*a);return new i(h,u,l)},i.Clamp=function(t,o,n){var r=t.x;r=r>n.x?n.x:r,r=r<o.x?o.x:r;var s=t.y;s=s>n.y?n.y:s,s=s<o.y?o.y:s;var e=t.z;return e=e>n.z?n.z:e,e=e<o.z?o.z:e,new i(r,s,e)},i.Hermite=function(t,o,n,r,s){var e=s*s,a=s*e,h=2*a-3*e+1,u=-2*a+3*e,l=a-2*e+s,m=a-e,f=t.x*h+n.x*u+o.x*l+r.x*m,x=t.y*h+n.y*u+o.y*l+r.y*m,y=t.z*h+n.z*u+o.z*l+r.z*m;return new i(f,x,y)},i.Lerp=function(t,o,n){var r=t.x+(o.x-t.x)*n,s=t.y+(o.y-t.y)*n,e=t.z+(o.z-t.z)*n;return new i(r,s,e)},i.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},i.Cross=function(t,o){var n=i.Zero();return i.CrossToRef(t,o,n),n},i.CrossToRef=function(t,i,o){o.x=t.y*i.z-t.z*i.y,o.y=t.z*i.x-t.x*i.z,o.z=t.x*i.y-t.y*i.x},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Project=function(t,o,n,r){var s=r.width,e=r.height,h=r.x,u=r.y,l=a.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+u,0,1),m=o.multiply(n).multiply(l);return i.TransformCoordinates(t,m)},i.UnprojectFromTransform=function(o,n,r,s,e){var a=s.multiply(e);a.invert(),o.x=o.x/n*2-1,o.y=-(o.y/r*2-1);var h=i.TransformCoordinates(o,a),u=o.x*a.m[3]+o.y*a.m[7]+o.z*a.m[11]+a.m[15];return t.Tools.WithinEpsilon(u,1)&&(h=h.scale(1/u)),h},i.Unproject=function(o,n,r,s,e,a){var h=s.multiply(e).multiply(a);h.invert();var u=new i(o.x/n*2-1,-(o.y/r*2-1),o.z),l=i.TransformCoordinates(u,h),m=u.x*h.m[3]+u.y*h.m[7]+u.z*h.m[11]+h.m[15];return t.Tools.WithinEpsilon(m,1)&&(l=l.scale(1/m)),l},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z;return o*o+n*n+r*r},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i.RotationFromAxis=function(t,o,n){var r=i.Zero();return i.RotationFromAxisToRef(t,o,n,r),r},i.RotationFromAxisToRef=function(o,n,r,s){var e,a,h,u=i.Normalize(o),l=i.Normalize(r),m=f.X,x=f.Y,y=0,c=0,p=0,z=0,M=0,w=0,d=0,I=-1,D=0,S=0;t.Tools.WithinEpsilon(l.z,0,t.Engine.Epsilon)?w=1:t.Tools.WithinEpsilon(l.x,0,t.Engine.Epsilon)?z=1:(d=l.z/l.x,z=-d*Math.sqrt(1/(1+d*d)),w=Math.sqrt(1/(1+d*d))),a=new i(z,M,w),a.normalize(),h=i.Cross(l,a),h.normalize(),e=i.Cross(u,a),e.normalize(),i.Dot(l,e)<0&&(I=1),S=i.Dot(u,a),S=Math.min(1,Math.max(-1,S)),p=Math.acos(S)*I,i.Dot(a,m)<0&&(p=Math.PI+p,a=a.scaleInPlace(-1),h=h.scaleInPlace(-1),D++);var v,g;z=0,M=0,w=0,I=-1,t.Tools.WithinEpsilon(l.z,0,t.Engine.Epsilon)?z=1:(d=a.z/a.x,z=-d*Math.sqrt(1/(1+d*d)),w=Math.sqrt(1/(1+d*d))),v=new i(z,M,w),v.normalize(),g=i.Cross(v,a),g.normalize(),e=i.Cross(l,v),e.normalize(),i.Dot(a,e)<0&&(I=1),S=i.Dot(l,v),S=Math.min(1,Math.max(-1,S)),c=Math.acos(S)*I,i.Dot(g,x)<0&&(c=Math.PI+c,g=g.scaleInPlace(-1),v=v.scaleInPlace(-1),D++),I=-1,e=i.Cross(m,a),e.normalize(),i.Dot(e,x)<0&&(I=1),S=i.Dot(a,m),S=Math.min(1,Math.max(-1,S)),y=-Math.acos(S)*I,0>S&&2>D&&(y=Math.PI+y),s.x=c,s.y=y,s.z=p},i}();t.Vector3=r;var s=function(){function i(t,i,o,n){this.x=t,this.y=i,this.z=o,this.w=n}return i.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},i.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},i.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},i.prototype.subtractFromFloats=function(t,o,n,r){return new i(this.x-t,this.y-o,this.z-n,this.w-r)},i.prototype.subtractFromFloatsToRef=function(t,i,o,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-o,r.w=this.w-n,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z,-this.w)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},i.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.prototype.equalsWithEpsilon=function(i,o){return void 0===o&&(o=t.Engine.Epsilon),i&&t.Tools.WithinEpsilon(this.x,i.x,o)&&t.Tools.WithinEpsilon(this.y,i.y,o)&&t.Tools.WithinEpsilon(this.z,i.z,o)&&t.Tools.WithinEpsilon(this.w,i.w,o)},i.prototype.equalsToFloats=function(t,i,o,n){return this.x===t&&this.y===i&&this.z===o&&this.w===n},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},i.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},i.prototype.multiplyByFloats=function(t,o,n,r){return new i(this.x*t,this.y*o,this.z*n,this.w*r)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},i.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},i.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},i.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},i.FromArray=function(t,o){return o||(o=0),new i(t[o],t[o+1],t[o+2],t[o+3])},i.FromArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatArrayToRef=function(t,i,o){o.x=t[i],o.y=t[i+1],o.z=t[i+2],o.w=t[i+3]},i.FromFloatsToRef=function(t,i,o,n,r){r.x=t,r.y=i,r.z=o,r.w=n},i.Zero=function(){return new i(0,0,0,0)},i.Normalize=function(t){var o=i.Zero();return i.NormalizeToRef(t,o),o},i.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},i.Minimize=function(t,i){var o=t.clone();return o.MinimizeInPlace(i),o},i.Maximize=function(t,i){var o=t.clone();return o.MaximizeInPlace(i),o},i.Distance=function(t,o){return Math.sqrt(i.DistanceSquared(t,o))},i.DistanceSquared=function(t,i){var o=t.x-i.x,n=t.y-i.y,r=t.z-i.z,s=t.w-i.w;return o*o+n*n+r*r+s*s},i.Center=function(t,i){var o=t.add(i);return o.scaleInPlace(.5),o},i}();t.Vector4=s;var e=function(){function t(t,i,o,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=1),this.x=t,this.y=i,this.z=o,this.w=n}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,o,n){return this.x=t,this.y=i,this.z=o,this.w=n,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var o=new t(0,0,0,1);return this.multiplyToRef(i,o),o},t.prototype.multiplyToRef=function(t,i){var o=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,r=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(o,n,r,s),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(){var t=r.Zero();return this.toEulerAnglesToRef(t),t},t.prototype.toEulerAnglesToRef=function(t){var i=this.x,o=this.y,n=this.z,r=this.w,s=i*o,e=i*n,a=r*o,h=r*n,u=r*i,l=o*n,m=i*i,f=o*o,x=m+f;return 0!==x&&1!==x?(t.x=Math.atan2(e+a,u-l),t.y=Math.acos(1-2*x),t.z=Math.atan2(e-a,u+l)):0===x?(t.x=0,t.y=0,t.z=Math.atan2(s-h,.5-f-n*n)):(t.x=Math.atan2(s-h,.5-f-n*n),t.y=Math.PI,t.z=0),this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,o=this.y*this.y,n=this.z*this.z,r=this.x*this.y,s=this.z*this.w,e=this.z*this.x,a=this.y*this.w,h=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(o+n),t.m[1]=2*(r+s),t.m[2]=2*(e-a),t.m[3]=0,t.m[4]=2*(r-s),t.m[5]=1-2*(n+i),t.m[6]=2*(h+u),t.m[7]=0,t.m[8]=2*(e+a),t.m[9]=2*(h-u),t.m[10]=1-2*(o+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var o=new t;return t.FromRotationMatrixToRef(i,o),o},t.FromRotationMatrixToRef=function(t,i){var o,n=t.m,r=n[0],s=n[4],e=n[8],a=n[1],h=n[5],u=n[9],l=n[2],m=n[6],f=n[10],x=r+h+f;x>0?(o=.5/Math.sqrt(x+1),i.w=.25/o,i.x=(m-u)*o,i.y=(e-l)*o,i.z=(a-s)*o):r>h&&r>f?(o=2*Math.sqrt(1+r-h-f),i.w=(m-u)/o,i.x=.25*o,i.y=(s+a)/o,i.z=(e+l)/o):h>f?(o=2*Math.sqrt(1+h-r-f),i.w=(e-l)/o,i.x=(s+a)/o,i.y=.25*o,i.z=(u+m)/o):(o=2*Math.sqrt(1+f-r-h),i.w=(a-s)/o,i.x=(e+l)/o,i.y=(u+m)/o,i.z=.25*o)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,o){var n=new t,r=Math.sin(o/2);return n.w=Math.cos(o/2),n.x=i.x*r,n.y=i.y*r,n.z=i.z*r,n},t.FromArray=function(i,o){return o||(o=0),new t(i[o],i[o+1],i[o+2],i[o+3])},t.RotationYawPitchRoll=function(i,o,n){var r=new t;return t.RotationYawPitchRollToRef(i,o,n,r),r},t.RotationYawPitchRollToRef=function(t,i,o,n){var r=.5*o,s=.5*i,e=.5*t,a=Math.sin(r),h=Math.cos(r),u=Math.sin(s),l=Math.cos(s),m=Math.sin(e),f=Math.cos(e);n.x=f*u*h+m*l*a,n.y=m*l*h-f*u*a,n.z=f*l*a-m*u*h,n.w=f*l*h+m*u*a},t.RotationAlphaBetaGamma=function(i,o,n){var r=new t;return t.RotationAlphaBetaGammaToRef(i,o,n,r),r},t.RotationAlphaBetaGammaToRef=function(t,i,o,n){var r=.5*(o+t),s=.5*(o-t),e=.5*i;n.x=Math.cos(s)*Math.sin(e),n.y=Math.sin(s)*Math.sin(e),n.z=Math.sin(r)*Math.cos(e),n.w=Math.cos(r)*Math.cos(e)},t.Slerp=function(i,o,n){var r,s,e=n,a=i.x*o.x+i.y*o.y+i.z*o.z+i.w*o.w,h=!1;if(0>a&&(h=!0,a=-a),a>.999999)s=1-e,r=h?-e:e;else{var u=Math.acos(a),l=1/Math.sin(u);s=Math.sin((1-e)*u)*l,r=h?-Math.sin(e*u)*l:Math.sin(e*u)*l}return new t(s*i.x+r*o.x,s*i.y+r*o.y,s*i.z+r*o.z,s*i.w+r*o.w)},t}();t.Quaternion=e;var a=function(){function i(){this.m=new Float32Array(16)}return i.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?!1:!0},i.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],o=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*o)-this.m[1]*(this.m[4]*t-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*i-this.m[5]*n+this.m[7]*s)-this.m[3]*(this.m[4]*o-this.m[5]*r+this.m[6]*s)},i.prototype.toArray=function(){return this.m},i.prototype.asArray=function(){return this.toArray()},i.prototype.invert=function(){return this.invertToRef(this),this},i.prototype.reset=function(){for(var t=0;16>t;t++)this.m[t]=0;return this},i.prototype.add=function(t){var o=new i;return this.addToRef(t,o),o},i.prototype.addToRef=function(t,i){for(var o=0;16>o;o++)i.m[o]=this.m[o]+t.m[o];return this},i.prototype.addToSelf=function(t){for(var i=0;16>i;i++)this.m[i]+=t.m[i];return this},i.prototype.invertToRef=function(t){var i=this.m[0],o=this.m[1],n=this.m[2],r=this.m[3],s=this.m[4],e=this.m[5],a=this.m[6],h=this.m[7],u=this.m[8],l=this.m[9],m=this.m[10],f=this.m[11],x=this.m[12],y=this.m[13],c=this.m[14],p=this.m[15],z=m*p-f*c,M=l*p-f*y,w=l*c-m*y,d=u*p-f*x,I=u*c-m*x,D=u*y-l*x,S=e*z-a*M+h*w,v=-(s*z-a*d+h*I),g=s*M-e*d+h*D,T=-(s*w-e*I+a*D),R=1/(i*S+o*v+n*g+r*T),_=a*p-h*c,b=e*p-h*y,F=e*c-a*y,A=s*p-h*x,P=s*c-a*x,C=s*y-e*x,E=a*f-h*m,L=e*f-h*l,q=e*m-a*l,Z=s*f-h*u,H=s*m-a*u,W=s*l-e*u;return t.m[0]=S*R,t.m[4]=v*R,t.m[8]=g*R,t.m[12]=T*R,t.m[1]=-(o*z-n*M+r*w)*R,t.m[5]=(i*z-n*d+r*I)*R,t.m[9]=-(i*M-o*d+r*D)*R,t.m[13]=(i*w-o*I+n*D)*R,t.m[2]=(o*_-n*b+r*F)*R,t.m[6]=-(i*_-n*A+r*P)*R,t.m[10]=(i*b-o*A+r*C)*R,t.m[14]=-(i*F-o*P+n*C)*R,t.m[3]=-(o*E-n*L+r*q)*R,t.m[7]=(i*E-n*Z+r*H)*R,t.m[11]=-(i*L-o*Z+r*W)*R,t.m[15]=(i*q-o*H+n*W)*R,this},i.prototype.invertToRefSIMD=function(t){var i,o,n,r,s,e,a,h,u,l,m=this.m,f=t.m,x=SIMD.float32x4.load(m,0),y=SIMD.float32x4.load(m,4),c=SIMD.float32x4.load(m,8),p=SIMD.float32x4.load(m,12);return s=SIMD.float32x4.shuffle(x,y,0,1,4,5),o=SIMD.float32x4.shuffle(c,p,0,1,4,5),i=SIMD.float32x4.shuffle(s,o,0,2,4,6),o=SIMD.float32x4.shuffle(o,s,1,3,5,7),s=SIMD.float32x4.shuffle(x,y,2,3,6,7),r=SIMD.float32x4.shuffle(c,p,2,3,6,7),n=SIMD.float32x4.shuffle(s,r,0,2,4,6),r=SIMD.float32x4.shuffle(r,s,1,3,5,7),s=SIMD.float32x4.mul(n,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.mul(o,s),a=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(SIMD.float32x4.mul(o,s),e),a=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),a),a=SIMD.float32x4.swizzle(a,2,3,0,1),s=SIMD.float32x4.mul(o,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),e=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),e),u=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),u),u=SIMD.float32x4.swizzle(u,2,3,0,1),s=SIMD.float32x4.mul(SIMD.float32x4.swizzle(o,2,3,0,1),r),s=SIMD.float32x4.swizzle(s,1,0,3,2),n=SIMD.float32x4.swizzle(n,2,3,0,1),e=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),e),h=SIMD.float32x4.mul(i,s),s=SIMD.float32x4.swizzle(s,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.sub(SIMD.float32x4.mul(i,s),h),h=SIMD.float32x4.swizzle(h,2,3,0,1),s=SIMD.float32x4.mul(i,o),s=SIMD.float32x4.swizzle(s,1,0,3,2),h=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(SIMD.float32x4.mul(n,s),u),s=SIMD.float32x4.swizzle(s,2,3,0,1),h=SIMD.float32x4.sub(SIMD.float32x4.mul(r,s),h),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(n,s)),s=SIMD.float32x4.mul(i,r),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(n,s)),h=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),h),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.add(SIMD.float32x4.mul(n,s),a),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.mul(i,n),s=SIMD.float32x4.swizzle(s,1,0,3,2),a=SIMD.float32x4.add(SIMD.float32x4.mul(r,s),a),u=SIMD.float32x4.sub(u,SIMD.float32x4.mul(o,s)),s=SIMD.float32x4.swizzle(s,2,3,0,1),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(r,s)),u=SIMD.float32x4.add(SIMD.float32x4.mul(o,s),u),l=SIMD.float32x4.mul(i,e),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,2,3,0,1),l),l=SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,0,3,2),l),s=SIMD.float32x4.reciprocalApproximation(l),l=SIMD.float32x4.sub(SIMD.float32x4.add(s,s),SIMD.float32x4.mul(l,SIMD.float32x4.mul(s,s))),l=SIMD.float32x4.swizzle(l,0,0,0,0),e=SIMD.float32x4.mul(l,e),a=SIMD.float32x4.mul(l,a),h=SIMD.float32x4.mul(l,h),u=SIMD.float32x4.mul(l,u),SIMD.float32x4.store(f,0,e),SIMD.float32x4.store(f,4,a),SIMD.float32x4.store(f,8,h),SIMD.float32x4.store(f,12,u),this},i.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},i.prototype.multiply=function(t){var o=new i;return this.multiplyToRef(t,o),o},i.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},i.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var o=0;16>o;o++)t[i+o]=this.m[o];return this},i.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},i.prototype.multiplyToArray=function(t,i,o){var n=this.m[0],r=this.m[1],s=this.m[2],e=this.m[3],a=this.m[4],h=this.m[5],u=this.m[6],l=this.m[7],m=this.m[8],f=this.m[9],x=this.m[10],y=this.m[11],c=this.m[12],p=this.m[13],z=this.m[14],M=this.m[15],w=t.m[0],d=t.m[1],I=t.m[2],D=t.m[3],S=t.m[4],v=t.m[5],g=t.m[6],T=t.m[7],R=t.m[8],_=t.m[9],b=t.m[10],F=t.m[11],A=t.m[12],P=t.m[13],C=t.m[14],E=t.m[15];return i[o]=n*w+r*S+s*R+e*A,i[o+1]=n*d+r*v+s*_+e*P,i[o+2]=n*I+r*g+s*b+e*C,i[o+3]=n*D+r*T+s*F+e*E,i[o+4]=a*w+h*S+u*R+l*A,i[o+5]=a*d+h*v+u*_+l*P,i[o+6]=a*I+h*g+u*b+l*C,i[o+7]=a*D+h*T+u*F+l*E,i[o+8]=m*w+f*S+x*R+y*A,i[o+9]=m*d+f*v+x*_+y*P,i[o+10]=m*I+f*g+x*b+y*C,i[o+11]=m*D+f*T+x*F+y*E,i[o+12]=c*w+p*S+z*R+M*A,i[o+13]=c*d+p*v+z*_+M*P,i[o+14]=c*I+p*g+z*b+M*C,i[o+15]=c*D+p*T+z*F+M*E,this},i.prototype.multiplyToArraySIMD=function(t,i,o){void 0===o&&(o=0);var n=this.m,r=t.m,s=SIMD.float32x4.load(r,0),e=SIMD.float32x4.load(r,4),a=SIMD.float32x4.load(r,8),h=SIMD.float32x4.load(r,12),u=SIMD.float32x4.load(n,0);SIMD.float32x4.store(i,o+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,3,3,3,3),h)))));\n\nvar l=SIMD.float32x4.load(n,4);SIMD.float32x4.store(i,o+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),h)))));var m=SIMD.float32x4.load(n,8);SIMD.float32x4.store(i,o+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,3,3,3,3),h)))));var f=SIMD.float32x4.load(n,12);SIMD.float32x4.store(i,o+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),e),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),h)))))},i.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},i.prototype.clone=function(){return i.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},i.prototype.decompose=function(o,n,r){r.x=this.m[12],r.y=this.m[13],r.z=this.m[14];var s=t.Tools.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,a=t.Tools.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=t.Tools.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(o.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),o.y=a*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),o.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===o.x||0===o.y||0===o.z)return n.x=0,n.y=0,n.z=0,n.w=1,!1;var u=i.FromValues(this.m[0]/o.x,this.m[1]/o.x,this.m[2]/o.x,0,this.m[4]/o.y,this.m[5]/o.y,this.m[6]/o.y,0,this.m[8]/o.z,this.m[9]/o.z,this.m[10]/o.z,0,0,0,0,1);return e.FromRotationMatrixToRef(u,n),!0},i.FromArray=function(t,o){var n=new i;return o||(o=0),i.FromArrayToRef(t,o,n),n},i.FromArrayToRef=function(t,i,o){for(var n=0;16>n;n++)o.m[n]=t[n+i]},i.FromFloat32ArrayToRefScaled=function(t,i,o,n){for(var r=0;16>r;r++)n.m[r]=t[r+i]*o},i.FromValuesToRef=function(t,i,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){p.m[0]=t,p.m[1]=i,p.m[2]=o,p.m[3]=n,p.m[4]=r,p.m[5]=s,p.m[6]=e,p.m[7]=a,p.m[8]=h,p.m[9]=u,p.m[10]=l,p.m[11]=m,p.m[12]=f,p.m[13]=x,p.m[14]=y,p.m[15]=c},i.FromValues=function(t,o,n,r,s,e,a,h,u,l,m,f,x,y,c,p){var z=new i;return z.m[0]=t,z.m[1]=o,z.m[2]=n,z.m[3]=r,z.m[4]=s,z.m[5]=e,z.m[6]=a,z.m[7]=h,z.m[8]=u,z.m[9]=l,z.m[10]=m,z.m[11]=f,z.m[12]=x,z.m[13]=y,z.m[14]=c,z.m[15]=p,z},i.Compose=function(t,o,n){var r=i.FromValues(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1),s=i.Identity();return o.toRotationMatrix(s),r=r.multiply(s),r.setTranslation(n),r},i.Identity=function(){return i.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},i.IdentityToRef=function(t){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},i.Zero=function(){return i.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},i.RotationX=function(t){var o=new i;return i.RotationXToRef(t,o),o},i.Invert=function(t){var o=new i;return t.invertToRef(o),o},i.RotationXToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=n,i.m[10]=n,i.m[9]=-o,i.m[6]=o,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationY=function(t){var o=new i;return i.RotationYToRef(t,o),o},i.RotationYToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=n,i.m[2]=-o,i.m[8]=o,i.m[10]=n,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationZ=function(t){var o=new i;return i.RotationZToRef(t,o),o},i.RotationZToRef=function(t,i){var o=Math.sin(t),n=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=n,i.m[1]=o,i.m[4]=-o,i.m[5]=n,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},i.RotationAxis=function(t,o){var n=Math.sin(-o),r=Math.cos(-o),s=1-r;t.normalize();var e=i.Zero();return e.m[0]=t.x*t.x*s+r,e.m[1]=t.x*t.y*s-t.z*n,e.m[2]=t.x*t.z*s+t.y*n,e.m[3]=0,e.m[4]=t.y*t.x*s+t.z*n,e.m[5]=t.y*t.y*s+r,e.m[6]=t.y*t.z*s-t.x*n,e.m[7]=0,e.m[8]=t.z*t.x*s-t.y*n,e.m[9]=t.z*t.y*s+t.x*n,e.m[10]=t.z*t.z*s+r,e.m[11]=0,e.m[15]=1,e},i.RotationYawPitchRoll=function(t,o,n){var r=new i;return i.RotationYawPitchRollToRef(t,o,n,r),r},i.RotationYawPitchRollToRef=function(t,i,o,n){e.RotationYawPitchRollToRef(t,i,o,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},i.Scaling=function(t,o,n){var r=i.Zero();return i.ScalingToRef(t,o,n,r),r},i.ScalingToRef=function(t,i,o,n){n.m[0]=t,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=i,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=o,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},i.Translation=function(t,o,n){var r=i.Identity();return i.TranslationToRef(t,o,n,r),r},i.TranslationToRef=function(t,o,n,r){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,o,n,1,r)},i.LookAtLH=function(t,o,n){var r=i.Zero();return i.LookAtLHToRef(t,o,n,r),r},i.LookAtLHToRef=function(t,o,n,s){o.subtractToRef(t,this._zAxis),this._zAxis.normalize(),r.CrossToRef(n,this._zAxis,this._xAxis),this._xAxis.normalize(),r.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-r.Dot(this._xAxis,t),a=-r.Dot(this._yAxis,t),h=-r.Dot(this._zAxis,t);return i.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,a,h,1,s)},i.LookAtLHToRefSIMD=function(t,i,o,n){var r=n.m,s=SIMD.float32x4(i.x,i.y,i.z,0),e=SIMD.float32x4(t.x,t.y,t.z,0),a=SIMD.float32x4(o.x,o.y,o.z,0),h=SIMD.float32x4.sub(s,e),u=SIMD.float32x4.mul(h,h);u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(u)),u=SIMD.float32x4.mul(a,a),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(u));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var m=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));u=SIMD.float32x4.mul(l,l),u=SIMD.float32x4.add(u,SIMD.float32x4.add(SIMD.float32x4.swizzle(u,1,2,0,3),SIMD.float32x4.swizzle(u,2,0,1,3))),l=SIMD.float32x4.mul(l,SIMD.float32x4.reciprocalSqrtApproximation(u));var f=SIMD.float32x4.splat(0);l=SIMD.float32x4.neg(l);var x=SIMD.float32x4.shuffle(l,m,0,1,4,5),y=SIMD.float32x4.shuffle(h,f,0,1,4,5),c=SIMD.float32x4.shuffle(x,y,0,2,4,6),p=SIMD.float32x4.shuffle(x,y,1,3,5,7);x=SIMD.float32x4.shuffle(l,m,2,3,6,7),y=SIMD.float32x4.shuffle(h,f,2,3,6,7);var z=SIMD.float32x4.shuffle(x,y,0,2,4,6),M=SIMD.float32x4(0,0,0,1),w=SIMD.float32x4(1,0,0,0),d=SIMD.float32x4(0,1,0,0),I=SIMD.float32x4(0,0,1,0),D=SIMD.float32x4.neg(e);D=SIMD.float32x4.withW(D,1),SIMD.float32x4.store(r,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,3,3,3,3),M))))),SIMD.float32x4.store(r,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,3,3,3,3),M))))),SIMD.float32x4.store(r,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(I,3,3,3,3),M))))),SIMD.float32x4.store(r,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,1,1,1,1),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,2,2,2,2),z),SIMD.float32x4.mul(SIMD.float32x4.swizzle(D,3,3,3,3),M)))))},i.OrthoLH=function(t,o,n,r){var s=i.Zero();return i.OrthoLHToRef(t,o,n,r,s),s},i.OrthoLHToRef=function(t,o,n,r,s){var e=2/t,a=2/o,h=1/(r-n),u=n/(n-r);i.FromValuesToRef(e,0,0,0,0,a,0,0,0,0,h,0,0,0,u,1,s)},i.OrthoOffCenterLH=function(t,o,n,r,s,e){var a=i.Zero();return i.OrthoOffCenterLHToRef(t,o,n,r,s,e,a),a},i.OrthoOffCenterLHToRef=function(t,i,o,n,r,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(n-o),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(r-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(n+o)/(o-n),e.m[14]=r/(r-s),e.m[15]=1},i.PerspectiveLH=function(t,o,n,r){var s=i.Zero();return s.m[0]=2*n/t,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*n/o,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-r/(n-r),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r),s},i.PerspectiveFovLH=function(t,o,n,r){var s=i.Zero();return i.PerspectiveFovLHToRef(t,o,n,r,s),s},i.PerspectiveFovLHToRef=function(i,o,n,r,s,e){void 0===e&&(e=t.Camera.FOVMODE_VERTICAL_FIXED);var a=1/Math.tan(.5*i),h=e===t.Camera.FOVMODE_VERTICAL_FIXED;s.m[0]=h?a/o:a,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=h?a:a*o,s.m[4]=s.m[6]=s.m[7]=0,s.m[8]=s.m[9]=0,s.m[10]=-r/(n-r),s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=n*r/(n-r)},i.GetFinalMatrix=function(t,o,n,r,s,e){var a=t.width,h=t.height,u=t.x,l=t.y,m=i.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,e-s,0,u+a/2,h/2+l,s,1);return o.multiply(n).multiply(r).multiply(m)},i.GetAsMatrix2x2=function(t){return new Float32Array([t.m[0],t.m[1],t.m[4],t.m[5]])},i.GetAsMatrix3x3=function(t){return new Float32Array([t.m[0],t.m[1],t.m[2],t.m[4],t.m[5],t.m[6],t.m[8],t.m[9],t.m[10]])},i.Transpose=function(t){var o=new i;return o.m[0]=t.m[0],o.m[1]=t.m[4],o.m[2]=t.m[8],o.m[3]=t.m[12],o.m[4]=t.m[1],o.m[5]=t.m[5],o.m[6]=t.m[9],o.m[7]=t.m[13],o.m[8]=t.m[2],o.m[9]=t.m[6],o.m[10]=t.m[10],o.m[11]=t.m[14],o.m[12]=t.m[3],o.m[13]=t.m[7],o.m[14]=t.m[11],o.m[15]=t.m[15],o},i.Reflection=function(t){var o=new i;return i.ReflectionToRef(t,o),o},i.ReflectionToRef=function(t,i){t.normalize();var o=t.normal.x,n=t.normal.y,r=t.normal.z,s=-2*o,e=-2*n,a=-2*r;i.m[0]=s*o+1,i.m[1]=e*o,i.m[2]=a*o,i.m[3]=0,i.m[4]=s*n,i.m[5]=e*n+1,i.m[6]=a*n,i.m[7]=0,i.m[8]=s*r,i.m[9]=e*r,i.m[10]=a*r+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=a*t.d,i.m[15]=1},i._tempQuaternion=new e,i._xAxis=r.Zero(),i._yAxis=r.Zero(),i._zAxis=r.Zero(),i}();t.Matrix=a;var h=function(){function t(t,i,o,n){this.normal=new r(t,i,o),this.d=n}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var o=a.Transpose(i),n=this.normal.x,r=this.normal.y,s=this.normal.z,e=this.d,h=n*o.m[0]+r*o.m[1]+s*o.m[2]+e*o.m[3],u=n*o.m[4]+r*o.m[5]+s*o.m[6]+e*o.m[7],l=n*o.m[8]+r*o.m[9]+s*o.m[10]+e*o.m[11],m=n*o.m[12]+r*o.m[13]+s*o.m[14]+e*o.m[15];return new t(h,u,l,m)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,o){var n,r=i.x-t.x,s=i.y-t.y,e=i.z-t.z,a=o.x-t.x,h=o.y-t.y,u=o.z-t.z,l=s*u-e*h,m=e*a-r*u,f=r*h-s*a,x=Math.sqrt(l*l+m*m+f*f);return n=0!==x?1/x:0,this.normal.x=l*n,this.normal.y=m*n,this.normal.z=f*n,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var o=r.Dot(this.normal,t);return i>=o},t.prototype.signedDistanceTo=function(t){return r.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,o,n){var r=new t(0,0,0,0);return r.copyFromPoints(i,o,n),r},t.FromPositionAndNormal=function(i,o){var n=new t(0,0,0,0);return o.normalize(),n.normal=o,n.d=-(o.x*i.x+o.y*i.y+o.z*i.z),n},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,o){var n=-(i.x*t.x+i.y*t.y+i.z*t.z);return r.Dot(o,i)+n},t}();t.Plane=h;var u=function(){function t(t,i,o,n){this.x=t,this.y=i,this.width=o,this.height=n}return t.prototype.toGlobal=function(i){var o=i.getRenderWidth(),n=i.getRenderHeight();return new t(this.x*o,this.y*n,this.width*o,this.height*n)},t}();t.Viewport=u;var l=function(){function t(){}return t.GetPlanes=function(i){for(var o=[],n=0;6>n;n++)o.push(new h(0,0,0,0));return t.GetPlanesToRef(i,o),o},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[11]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=l;var m=function(){function i(t,i,o){void 0===o&&(o=Number.MAX_VALUE),this.origin=t,this.direction=i,this.length=o}return i.prototype.intersectsBoxMinMax=function(t,i){var o,n,r,s,e=0,a=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>i.x)return!1}else if(o=1/this.direction.x,n=(t.x-this.origin.x)*o,r=(i.x-this.origin.x)*o,r===-(1/0)&&(r=1/0),n>r&&(s=n,n=r,r=s),e=Math.max(n,e),a=Math.min(r,a),e>a)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>i.y)return!1}else if(o=1/this.direction.y,n=(t.y-this.origin.y)*o,r=(i.y-this.origin.y)*o,r===-(1/0)&&(r=1/0),n>r&&(s=n,n=r,r=s),e=Math.max(n,e),a=Math.min(r,a),e>a)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>i.z)return!1}else if(o=1/this.direction.z,n=(t.z-this.origin.z)*o,r=(i.z-this.origin.z)*o,r===-(1/0)&&(r=1/0),n>r&&(s=n,n=r,r=s),e=Math.max(n,e),a=Math.min(r,a),e>a)return!1;return!0},i.prototype.intersectsBox=function(t){return this.intersectsBoxMinMax(t.minimum,t.maximum)},i.prototype.intersectsSphere=function(t){var i=t.center.x-this.origin.x,o=t.center.y-this.origin.y,n=t.center.z-this.origin.z,r=i*i+o*o+n*n,s=t.radius*t.radius;if(s>=r)return!0;var e=i*this.direction.x+o*this.direction.y+n*this.direction.z;if(0>e)return!1;var a=r-e*e;return s>=a},i.prototype.intersectsTriangle=function(i,o,n){this._edge1||(this._edge1=r.Zero(),this._edge2=r.Zero(),this._pvec=r.Zero(),this._tvec=r.Zero(),this._qvec=r.Zero()),o.subtractToRef(i,this._edge1),n.subtractToRef(i,this._edge2),r.CrossToRef(this.direction,this._edge2,this._pvec);var s=r.Dot(this._edge1,this._pvec);if(0===s)return null;var e=1/s;this.origin.subtractToRef(i,this._tvec);var a=r.Dot(this._tvec,this._pvec)*e;if(0>a||a>1)return null;r.CrossToRef(this._tvec,this._edge1,this._qvec);var h=r.Dot(this.direction,this._qvec)*e;if(0>h||a+h>1)return null;var u=r.Dot(this._edge2,this._qvec)*e;return u>this.length?null:new t.IntersectionInfo(a,h,u)},i.CreateNew=function(t,o,n,s,e,a,h){var u=r.Unproject(new r(t,o,0),n,s,e,a,h),l=r.Unproject(new r(t,o,1),n,s,e,a,h),m=l.subtract(u);return m.normalize(),new i(u,m)},i.CreateNewFromTo=function(t,o,n){void 0===n&&(n=a.Identity());var r=o.subtract(t),s=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),i.Transform(new i(t,r,s),n)},i.Transform=function(t,o){var n=r.TransformCoordinates(t.origin,o),s=r.TransformNormal(t.direction,o);return new i(n,s,t.length)},i}();t.Ray=m,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(t.Space||(t.Space={}));var f=(t.Space,function(){function t(){}return t.X=new r(1,0,0),t.Y=new r(0,1,0),t.Z=new r(0,0,1),t}());t.Axis=f;var x=function(){function t(){}return t.interpolate=function(t,i,o,n,r){for(var s=1-3*n+3*i,e=3*n-6*i,a=3*i,h=t,u=0;5>u;u++){var l=h*h,m=l*h,f=s*m+e*l+a*h,x=1/(3*s*l+2*e*h+a);h-=(f-t)*x,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*o+3*(1-h)*Math.pow(h,2)*r+Math.pow(h,3)},t}();t.BezierCurve=x,function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(t.Orientation||(t.Orientation={}));var y=t.Orientation,c=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,o){var n=o.subtract(i),r=Math.atan2(n.y,n.x);return new t(r)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=c;var p=function(){function t(t,i,o){this.startPoint=t,this.midPoint=i,this.endPoint=o;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(o.x,2)-Math.pow(o.y,2))/2,a=(t.x-i.x)*(i.y-o.y)-(i.x-o.x)*(t.y-i.y);this.centerPoint=new n((s*(i.y-o.y)-e*(t.y-i.y))/a,((t.x-i.x)*e-(i.x-o.x)*s)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=c.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),u=c.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),l=c.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-h>180&&(u-=360),-180>u-h&&(u+=360),l-u>180&&(l-=360),-180>l-u&&(l+=360),this.orientation=0>u-h?y.CW:y.CCW,this.angle=c.FromDegrees(this.orientation===y.CW?h-l:l-h)}return t}();t.Arc2=p;var z=function(){function t(t){this.path=t,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new r(t.x,0,t.y)},t.prototype.moveAhead=function(t){return void 0===t&&(t=.002),this.move(t),this},t.prototype.moveBack=function(t){return void 0===t&&(t=.002),this.move(-t),this},t.prototype.move=function(t){if(Math.abs(t)>1)throw"step size should be less than 1.";return this.value+=t,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.markAsDirty=function(t){return this.ensureLimits(),this.raiseOnChange(),this},t.prototype.raiseOnChange=function(){var t=this;return this._onchange.forEach(function(i){return i(t)}),this},t.prototype.onchange=function(t){return this._onchange.push(t),this},t}();t.PathCursor=z;var M=function(){function i(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new n(t,i))}return i.prototype.addLineTo=function(i,o){if(closed)return t.Tools.Error("cannot add lines to closed paths"),this;var r=new n(i,o),s=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(s).length(),this},i.prototype.addArcTo=function(i,o,r,s,e){if(void 0===e&&(e=36),closed)return t.Tools.Error("cannot add arcs to closed paths"),this;var a=this._points[this._points.length-1],h=new n(i,o),u=new n(r,s),l=new p(a,h,u),m=l.angle.radians()/e;l.orientation===y.CW&&(m*=-1);for(var f=l.startAngle.radians()+m,x=0;e>x;x++){var c=Math.cos(f)*l.radius+l.centerPoint.x,z=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(c,z),f+=m}return this},i.prototype.close=function(){return this.closed=!0,this},i.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],o=this._points[0];t+=o.subtract(i).length()}return t},i.prototype.getPoints=function(){return this._points},i.prototype.getPointAtLengthPosition=function(i){if(0>i||i>1)return t.Tools.Error("normalized length position should be between 0 and 1."),n.Zero();for(var o=i*this.length(),r=0,s=0;s<this._points.length;s++){var e=(s+1)%this._points.length,a=this._points[s],h=this._points[e],u=h.subtract(a),l=u.length()+r;if(o>=r&&l>=o){var m=u.normalize(),f=o-r;return new n(a.x+m.x*f,a.y+m.y*f)}r=l}return t.Tools.Error("internal error"),n.Zero()},i.StartingAt=function(t,o){return new i(t,o)},i}();t.Path2=M;var w=function(){function i(t,i,o){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var n=0;n<t.length;n++)this._curve[n]=t[n].clone();this._raw=o||!1,this._compute(i)}return i.prototype.getCurve=function(){return this._curve},i.prototype.getTangents=function(){return this._tangents},i.prototype.getNormals=function(){return this._normals},i.prototype.getBinormals=function(){return this._binormals},i.prototype.getDistances=function(){return this._distances},i.prototype.update=function(t,i){for(var o=0;o<t.length;o++)this._curve[o].x=t[o].x,this._curve[o].y=t[o].y,this._curve[o].z=t[o].z;return this._compute(i),this},i.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();var o=this._tangents[0],n=this._normalVector(this._curve[0],o,t);this._normals[0]=n,this._raw||this._normals[0].normalize(),this._binormals[0]=r.Cross(o,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var s,e,a,h,u=1;i>u;u++)s=this._getLastNonNullVector(u),i-1>u&&(e=this._getFirstNonNullVector(u),this._tangents[u]=s.add(e),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+s.length(),a=this._tangents[u],h=this._binormals[u-1],this._normals[u]=r.Cross(h,a),this._raw||this._normals[u].normalize(),this._binormals[u]=r.Cross(a,this._normals[u]),this._raw||this._binormals[u].normalize()},i.prototype._getFirstNonNullVector=function(t){for(var i=1,o=this._curve[t+i].subtract(this._curve[t]);0===o.length()&&t+i+1<this._curve.length;)i++,o=this._curve[t+i].subtract(this._curve[t]);return o},i.prototype._getLastNonNullVector=function(t){for(var i=1,o=this._curve[t].subtract(this._curve[t-i]);0===o.length()&&t>i+1;)i++,o=this._curve[t].subtract(this._curve[t-i]);return o},i.prototype._normalVector=function(i,o,n){var s;if(void 0===n||null===n){var e;t.Tools.WithinEpsilon(o.y,1,t.Engine.Epsilon)?t.Tools.WithinEpsilon(o.x,1,t.Engine.Epsilon)?t.Tools.WithinEpsilon(o.z,1,t.Engine.Epsilon)||(e=new r(0,0,1)):e=new r(1,0,0):e=new r(0,-1,0),s=r.Cross(o,e)}else s=r.Cross(o,n),r.CrossToRef(s,o,s);return s.normalize(),s},i}();t.Path3D=w;var d=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,o,n,s){s=s>2?s:3;for(var e=new Array,a=function(t,i,o,n){var r=(1-t)*(1-t)*i+2*t*(1-t)*o+t*t*n;return r},h=0;s>=h;h++)e.push(new r(a(h/s,i.x,o.x,n.x),a(h/s,i.y,o.y,n.y),a(h/s,i.z,o.z,n.z)));return new t(e)},t.CreateCubicBezier=function(i,o,n,s,e){e=e>3?e:4;for(var a=new Array,h=function(t,i,o,n,r){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*o+3*t*t*(1-t)*n+t*t*t*r;return s},u=0;e>=u;u++)a.push(new r(h(u/e,i.x,o.x,n.x,s.x),h(u/e,i.y,o.y,n.y,s.y),h(u/e,i.z,o.z,n.z,s.z)));return new t(a)},t.CreateHermiteSpline=function(i,o,n,s,e){for(var a=new Array,h=1/e,u=0;e>=u;u++)a.push(r.Hermite(i,o,n,s,u*h));return new t(a)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype["continue"]=function(i){for(var o=this._points[this._points.length-1],n=this._points.slice(),r=i.getPoints(),s=1;s<r.length;s++)n.push(r[s].subtract(r[0]).add(o));var e=new t(n);return e},t.prototype._computeLength=function(t){for(var i=0,o=1;o<t.length;o++)i+=t[o].subtract(t[o-1]).length();return i},t}();t.Curve3=d;var I=function(){function t(t,i){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=I;var D=function(){function t(t,i,o){void 0===t&&(t=r.Zero()),void 0===i&&(i=r.Up()),void 0===o&&(o=n.Zero()),this.position=t,this.normal=i,this.uv=o}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=D;var S=a.prototype.multiplyToArray,v=a.prototype.invertToRef,g=a.LookAtLHToRef,T=r.TransformCoordinatesToRef,R=r.TransformCoordinatesFromFloatsToRef,_=function(){function t(){}return Object.defineProperty(t,"IsEnabled",{get:function(){return t._isEnabled},enumerable:!0,configurable:!0}),t.DisableSIMD=function(){a.prototype.multiplyToArray=S,a.prototype.invertToRef=v,a.LookAtLHToRef=g,r.TransformCoordinatesToRef=T,r.TransformCoordinatesFromFloatsToRef=R,t._isEnabled=!1},t.EnableSIMD=function(){void 0!==window.SIMD&&(a.prototype.multiplyToArray=a.prototype.multiplyToArraySIMD,a.prototype.invertToRef=a.prototype.invertToRefSIMD,a.LookAtLHToRef=a.LookAtLHToRefSIMD,r.TransformCoordinatesToRef=r.TransformCoordinatesToRefSIMD,r.TransformCoordinatesFromFloatsToRef=r.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(r.prototype,"x",{get:function(){return this._data[0]},set:function(t){this._data||(this._data=new Float32Array(3)),this._data[0]=t}}),Object.defineProperty(r.prototype,"y",{get:function(){return this._data[1]},set:function(t){this._data[1]=t}}),Object.defineProperty(r.prototype,"z",{get:function(){return this._data[2]},set:function(t){this._data[2]=t}}),t._isEnabled=!0)},t._isEnabled=!1,t}();t.SIMDHelper=_}(BABYLON||(BABYLON={}));',
("undefined"!=typeof window&&window.module||"undefined"!=typeof e)&&"undefined"!=typeof e.exports&&(e.exports=r)},function(e,t,r){var n=r(25),i=r(19),o=r(60);e.exports=function(e){return function(t,r,s){var a,u=n(t),c=i(u.length),l=o(s,c);if(e&&r!=r){for(;c>l;)if(a=u[l++],a!=a)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===r)return e||l;return!e&&-1}}},function(e,t,r){"use strict";var n=r(3),i=r(29),o=r(77),s=r(27),a=r(79),u=r(28),c=r(57),l=r(95),h=r(151),f=r(49)("id"),d=r(18),p=r(6),m=r(78),g=r(22),v=Object.isExtensible||p,_=g?"_s":"size",y=0,x=function(e,t){if(!p(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!d(e,f)){if(!v(e))return"F";if(!t)return"E";i(e,f,++y)}return"O"+e[f]},b=function(e,t){var r,n=x(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,i){var l=e(function(e,o){a(e,l,t),e._i=n.create(null),e._f=void 0,e._l=void 0,e[_]=0,void 0!=o&&c(o,r,e[i],e)});return o(l.prototype,{clear:function(){for(var e=this,t=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete t[r.i];e._f=e._l=void 0,e[_]=0},"delete":function(e){var t=this,r=b(t,e);if(r){var n=r.n,i=r.p;delete t._i[r.i],r.r=!0,i&&(i.n=n),n&&(n.p=i),t._f==r&&(t._f=n),t._l==r&&(t._l=i),t[_]--}return!!r},forEach:function(e){for(var t,r=s(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(r(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!b(this,e)}}),g&&n.setDesc(l.prototype,"size",{get:function(){return u(this[_])}}),l},def:function(e,t,r){var n,i,o=b(e,t);return o?o.v=r:(e._l=o={i:i=x(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[_]++,"F"!==i&&(e._i[i]=o)),e},getEntry:b,setStrong:function(e,t,r){l(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,r=e._l;r&&r.r;)r=r.p;return e._t&&(e._l=r=r?r.n:e._t._f)?"keys"==t?h(0,r.k):"values"==t?h(0,r.v):h(0,[r.k,r.v]):(e._t=void 0,h(1))},r?"entries":"values",!r,!0),m(t)}}},function(e,t,r){var n=r(57),i=r(72);e.exports=function(e){return function(){if(i(this)!=e)throw TypeError(e+"#toJSON isn't generic");var t=[];return n(this,!1,t.push,t),t}}},function(e,t,r){"use strict";var n=r(29),i=r(77),o=r(8),s=r(6),a=r(79),u=r(57),c=r(71),l=r(18),h=r(49)("weak"),f=Object.isExtensible||s,d=c(5),p=c(6),m=0,g=function(e){return e._l||(e._l=new v)},v=function(){this.a=[]},_=function(e,t){return d(e.a,function(e){return e[0]===t})};v.prototype={get:function(e){var t=_(this,e);return t?t[1]:void 0},has:function(e){return!!_(this,e)},set:function(e,t){var r=_(this,e);r?r[1]=t:this.a.push([e,t])},"delete":function(e){var t=p(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,r,n){var o=e(function(e,i){a(e,o,t),e._i=m++,e._l=void 0,void 0!=i&&u(i,r,e[n],e)});return i(o.prototype,{"delete":function(e){return s(e)?f(e)?l(e,h)&&l(e[h],this._i)&&delete e[h][this._i]:g(this)["delete"](e):!1},has:function(e){return s(e)?f(e)?l(e,h)&&l(e[h],this._i):g(this).has(e):!1}}),o},def:function(e,t,r){return f(o(t))?(l(t,h)||n(t,h,{}),t[h][e._i]=r):g(e).set(t,r),e},frozenStore:g,WEAK:h}},function(e,t,r){var n=r(6),i=r(10).document,o=n(i)&&n(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,r){"use strict";var n=r(8);e.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,r){var n=r(25),i=r(3).getNames,o={}.toString,s="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return i(e)}catch(t){return s.slice()}};e.exports.get=function(e){return s&&"[object Window]"==o.call(e)?a(e):i(n(e))}},function(e,t,r){e.exports=r(10).document&&document.documentElement},function(e,t,r){var n=r(58),i=r(9)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},function(e,t,r){var n=r(6),i=Math.floor;e.exports=function(e){return!n(e)&&isFinite(e)&&i(e)===e}},function(e,t,r){var n=r(6),i=r(33),o=r(9)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==i(e))}},function(e,t,r){var n=r(8);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(o){var s=e["return"];throw void 0!==s&&n(s.call(e)),o}}},function(e,t,r){"use strict";var n=r(3),i=r(40),o=r(59),s={};r(29)(s,r(9)("iterator"),function(){return this}),e.exports=function(e,t,r){e.prototype=n.create(s,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t){e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&1e-8>e?e-e*e/2:Math.log(1+e)}},function(e,t,r){var n=r(3),i=r(25),o=n.isEnum;e.exports=function(e){return function(t){for(var r,s=i(t),a=n.getKeys(s),u=a.length,c=0,l=[];u>c;)o.call(s,r=a[c++])&&l.push(e?[r,s[r]]:s[r]);return l}}},function(e,t,r){var n=r(3),i=r(8),o=r(10).Reflect;e.exports=o&&o.ownKeys||function(e){var t=n.getNames(i(e)),r=n.getSymbols;return r?t.concat(r(e)):t}},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},function(e,t,r){var n=r(10),i="__core-js_shared__",o=n[i]||(n[i]={});e.exports=function(e){return o[e]||(o[e]={})}},function(e,t,r){var n=r(19),i=r(158),o=r(28);e.exports=function(e,t,r,s){var a=String(o(e)),u=a.length,c=void 0===r?" ":String(r),l=n(t);if(u>=l)return a;""==c&&(c=" ");var h=l-u,f=i.call(c,Math.ceil(h/c.length));return f.length>h&&(f=f.slice(0,h)),s?f+a:a+f}},function(e,t,r){"use strict";var n=r(61),i=r(28);e.exports=function(e){var t=String(i(this)),r="",o=n(e);if(0>o||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(r+=t);return r}},function(e,t,r){var n,i,o,s=r(27),a=r(75),u=r(145),c=r(142),l=r(10),h=l.process,f=l.setImmediate,d=l.clearImmediate,p=l.MessageChannel,m=0,g={},v="onreadystatechange",_=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},y=function(e){_.call(e.data)};f&&d||(f=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return g[++m]=function(){a("function"==typeof e?e:Function(e),t)},n(m),m},d=function(e){delete g[e]},"process"==r(33)(h)?n=function(e){h.nextTick(s(_,e,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=y,n=s(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",y,!1)):n=v in c("script")?function(e){u.appendChild(c("script"))[v]=function(){u.removeChild(this),_.call(e)}}:function(e){setTimeout(s(_,e,1),0)}),e.exports={set:f,clear:d}},function(e,t,r){var n=r(72),i=r(9)("iterator"),o=r(58);e.exports=r(34).getIteratorMethod=function(e){return void 0!=e?e[i]||e["@@iterator"]||o[n(e)]:void 0}},function(e,t,r){"use strict";var n=r(48),i=r(151),o=r(58),s=r(25);e.exports=r(95)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,r):"values"==t?i(0,e[r]):i(0,[r,e[r]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var r=this[t];r[2]?e.push("@media "+r[2]+"{"+r[1]+"}"):e.push(r[1])}return e.join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(n[o]=!0)}for(i=0;i<t.length;i++){var s=t[i];"number"==typeof s[0]&&n[s[0]]||(r&&!s[2]?s[2]=r:r&&(s[2]="("+s[2]+") and ("+r+")"),e.push(s))}},e}},function(e,t,r){function n(e){return null===e||void 0===e}function i(e){return e&&"object"==typeof e&&"number"==typeof e.length?"function"!=typeof e.copy||"function"!=typeof e.slice?!1:e.length>0&&"number"!=typeof e[0]?!1:!0:!1}function o(e,t,r){var o,l;if(n(e)||n(t))return!1;if(e.prototype!==t.prototype)return!1;if(u(e))return u(t)?(e=s.call(e),t=s.call(t),c(e,t,r)):!1;if(i(e)){if(!i(t))return!1;if(e.length!==t.length)return!1;for(o=0;o<e.length;o++)if(e[o]!==t[o])return!1;return!0}try{var h=a(e),f=a(t)}catch(d){return!1}if(h.length!=f.length)return!1;for(h.sort(),f.sort(),o=h.length-1;o>=0;o--)if(h[o]!=f[o])return!1;for(o=h.length-1;o>=0;o--)if(l=h[o],!c(e[l],t[l],r))return!1;return typeof e==typeof t}var s=Array.prototype.slice,a=r(353),u=r(352),c=e.exports=function(e,t,r){return r||(r={}),e===t?!0:e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?r.strict?e===t:e==t:o(e,t,r)}},function(e,t,r){"use strict";var n=r(26),i={listen:function(e,t,r){return e.addEventListener?(e.addEventListener(t,r,!1),{remove:function(){e.removeEventListener(t,r,!1)}}):e.attachEvent?(e.attachEvent("on"+t,r),{remove:function(){e.detachEvent("on"+t,r)}}):void 0},capture:function(e,t,r){return e.addEventListener?(e.addEventListener(t,r,!0),{remove:function(){e.removeEventListener(t,r,!0)}}):{remove:n}},registerDefault:function(){}};e.exports=i},function(e,t,r){"use strict";function n(e,t){var r=!0;e:for(;r;){var n=e,o=t;if(r=!1,n&&o){if(n===o)return!0;if(i(n))return!1;if(i(o)){e=n,t=o.parentNode,r=!0;continue e}return n.contains?n.contains(o):n.compareDocumentPosition?!!(16&n.compareDocumentPosition(o)):!1}return!1}}var i=r(362);e.exports=n},function(e,t){"use strict";function r(e){try{e.focus()}catch(t){}}e.exports=r},function(e,t){"use strict";function r(){try{return document.activeElement||document.body}catch(e){return document.body}}e.exports=r},function(e,t,r){"use strict";function n(e){return s?void 0:o(!1),f.hasOwnProperty(e)||(e="*"),a.hasOwnProperty(e)||("*"===e?s.innerHTML="<link />":s.innerHTML="<"+e+"></"+e+">",a[e]=!s.firstChild),a[e]?f[e]:null}var i=r(12),o=r(2),s=i.canUseDOM?document.createElement("div"):null,a={},u=[1,'<select multiple="true">',"</select>"],c=[1,"<table>","</table>"],l=[3,"<table><tbody><tr>","</tr></tbody></table>"],h=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"],f={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:u,option:u,caption:c,colgroup:c,tbody:c,tfoot:c,thead:c,td:l,th:l},d=["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"];d.forEach(function(e){f[e]=h,a[e]=!0}),e.exports=n},function(e,t){"use strict";function r(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(var o=n.bind(t),s=0;s<r.length;s++)if(!o(r[s])||e[r[s]]!==t[r[s]])return!1;return!0}var n=Object.prototype.hasOwnProperty;e.exports=r},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return u+e}function o(e,t){try{window.sessionStorage.setItem(i(e),JSON.stringify(t))}catch(r){if(r.name===l)return;if(r.name===c&&0===window.sessionStorage.length)return;throw r}}function s(e){var t=void 0;try{t=window.sessionStorage.getItem(i(e))}catch(r){if(r.name===l)return null}if(t)try{return JSON.parse(t)}catch(r){}return null}t.__esModule=!0,t.saveState=o,t.readState=s;var a=r(17),u=(n(a),"@@History/"),c="QuotaExceededError",l="SecurityError"},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){function t(e){return u.canUseDOM?void 0:a["default"](!1),r.listen(e)}var r=h["default"](o({getUserConfirmation:c.getUserConfirmation},e,{go:c.go}));return o({},r,{listen:t})}t.__esModule=!0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=r(14),a=n(s),u=r(82),c=r(105),l=r(172),h=n(l);t["default"]=i,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return Math.random().toString(36).substr(2,e)}function o(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.key===t.key&&c["default"](e.state,t.state)}function s(){function e(e){return k.push(e),function(){k=k.filter(function(t){return t!==e})}}function t(){return z&&z.action===h.POP?B.indexOf(z.key):U?B.indexOf(U.key):-1}function r(e){var r=t();U=e,U.action===h.PUSH?B=[].concat(B.slice(0,r+1),[U.key]):U.action===h.REPLACE&&(B[r]=U.key),N.forEach(function(e){e(U)})}function n(e){if(N.push(e),U)e(U);else{var t=I();B=[t.key],r(t)}return function(){N=N.filter(function(t){return t!==e})}}function s(e,t){l.loopAsync(k.length,function(t,r,n){m["default"](k[t],e,function(e){null!=e?n(e):r()})},function(e){V&&"string"==typeof e?V(e,function(e){t(e!==!1)}):t(e!==!1)})}function u(e){U&&o(U,e)||(z=e,s(e,function(t){if(z===e)if(t){if(e.action===h.PUSH){var n=b(U),i=b(e);i===n&&(e.action=h.REPLACE)}R(e)!==!1&&r(e)}else if(U&&e.action===h.POP){var o=B.indexOf(U.key),s=B.indexOf(e.key);-1!==o&&-1!==s&&L(o-s)}}))}function c(e){u(E(e,h.PUSH,_()))}function f(e){u(E(e,h.REPLACE,_()))}function p(){L(-1)}function g(){L(1)}function _(){return i(F)}function b(e){if(null==e||"string"==typeof e)return e;var t=e.pathname,r=e.search,n=e.hash,i=t;return r&&(i+=r),n&&(i+=n),i}function S(e){return b(e)}function E(e,t){var r=arguments.length<=2||void 0===arguments[2]?_():arguments[2];return"object"==typeof t&&("string"==typeof e&&(e=v["default"](e)),e=a({},e,{state:t}),t=r,r=arguments[3]||_()),d["default"](e,t,r)}function M(e){U?(T(U,e),r(U)):T(I(),e)}function T(e,t){e.state=a({},e.state,t),O(e.key,e.state)}function P(e){-1===k.indexOf(e)&&k.push(e)}function C(e){k=k.filter(function(t){return t!==e})}function w(e,t){"string"==typeof t&&(t=v["default"](t)),c(a({state:e},t))}function A(e,t){"string"==typeof t&&(t=v["default"](t)),f(a({state:e},t))}var D=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],I=D.getCurrentLocation,R=D.finishTransition,O=D.saveState,L=D.go,F=D.keyLength,V=D.getUserConfirmation;"number"!=typeof F&&(F=x);var k=[],B=[],N=[],U=void 0,z=void 0;return{listenBefore:e,listen:n,transitionTo:u,push:c,replace:f,go:L,goBack:p,goForward:g,createKey:_,createPath:b,createHref:S,createLocation:E,setState:y["default"](M,"setState is deprecated; use location.key to save state instead"),registerTransitionHook:y["default"](P,"registerTransitionHook is deprecated; use listenBefore instead"),unregisterTransitionHook:y["default"](C,"unregisterTransitionHook is deprecated; use the callback returned from listenBefore instead"),pushState:y["default"](w,"pushState is deprecated; use push instead"),replaceState:y["default"](A,"replaceState is deprecated; use replace instead")}}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=r(163),c=n(u),l=r(366),h=r(50),f=r(369),d=n(f),p=r(107),m=n(p),g=r(41),v=n(g),_=r(106),y=n(_),x=6;t["default"]=s,e.exports=t["default"]},function(e,t){"use strict";function r(e){var t=e.match(/^https?:\/\/[^\/]*/);return null==t?e:e.substring(t[0].length)}t.__esModule=!0,t["default"]=r,e.exports=t["default"]},function(e,t){function r(e,t){if("function"!=typeof e)throw new TypeError(n);return t=i(void 0===t?e.length-1:+t||0,0),function(){for(var r=arguments,n=-1,o=i(r.length-t,0),s=Array(o);++n<o;)s[n]=r[t+n];switch(t){case 0:return e.call(this,s);case 1:return e.call(this,r[0],s);case 2:return e.call(this,r[0],r[1],s)}var a=Array(t+1);for(n=-1;++n<t;)a[n]=r[n];return a[t]=s,e.apply(this,a)}}var n="Expected a function",i=Math.max;e.exports=r},function(e,t,r){var n=r(401),i=n();e.exports=i},function(e,t,r){function n(e,t,r){if(null!=e){void 0!==r&&r in i(e)&&(t=[r]);for(var n=0,o=t.length;null!=e&&o>n;)e=e[t[n++]];return n&&n==o?e:void 0}}var i=r(42);e.exports=n},function(e,t){function r(e){return function(t){return null==t?void 0:t[e]}}e.exports=r},function(e,t,r){function n(e,t){var r=typeof e;if("string"==r&&a.test(e)||"number"==r)return!0;if(i(e))return!1;var n=!s.test(e);return n||null!=t&&e in o(t)}var i=r(30),o=r(42),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=n},function(e,t,r){function n(e){return e===e&&!i(e)}var i=r(16);e.exports=n},function(e,t,r){function n(e){if(o(e))return e;var t=[];return i(e).replace(s,function(e,r,n,i){t.push(n?i.replace(a,"$1"):r||e)}),t}var i=r(396),o=r(30),s=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,a=/\\(\\)?/g;e.exports=n},function(e,t,r){var n=r(392),i=r(400),o=i(n);e.exports=o},function(e,t){function r(e){return e}e.exports=r},function(e,t){"use strict";function r(e){return e.shape({subscribe:e.func.isRequired,dispatch:e.func.isRequired,getState:e.func.isRequired})}t.__esModule=!0,t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return 0===e.button}function u(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function c(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}t.__esModule=!0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},h=r(7),f=n(h),d=f["default"].PropTypes,p=d.bool,m=d.object,g=d.string,v=d.func,_=function(e){function t(){o(this,t),e.apply(this,arguments)}return s(t,e),t.prototype.handleClick=function(e){var t=!0;if(this.props.onClick&&this.props.onClick(e),!u(e)&&a(e)){if(e.defaultPrevented===!0&&(t=!1),this.props.target)return void(t||e.preventDefault());if(e.preventDefault(),t){var r=this.props,n=r.state,i=r.to,o=r.query,s=r.hash;s&&(i+=s),this.context.history.pushState(n,i,o)}}},t.prototype.render=function(){var e=this,t=this.props,r=t.to,n=t.query,o=t.hash,s=(t.state,t.activeClassName),a=t.activeStyle,u=t.onlyActiveOnIndex,h=i(t,["to","query","hash","state","activeClassName","activeStyle","onlyActiveOnIndex"]);h.onClick=function(t){return e.handleClick(t)};var d=this.context.history;return d&&(h.href=d.createHref(r,n),o&&(h.href+=o),(s||null!=a&&!c(a))&&d.isActive(r,n,u)&&(s&&(h.className+=""===h.className?s:" "+s),a&&(h.style=l({},h.style,a)))),f["default"].createElement("a",h)},t}(h.Component);_.contextTypes={history:m},_.propTypes={to:g.isRequired,query:m,hash:g,state:m,activeStyle:m,activeClassName:g,onlyActiveOnIndex:p.isRequired,onClick:v},_.defaultProps={onlyActiveOnIndex:!1,className:"",style:{}},t["default"]=_,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=r(14),a=n(s),u=r(7),c=n(u),l=r(38),h=r(65),f=r(43),d=c["default"].PropTypes,p=d.string,m=d.object,g=function(e){function t(){i(this,t),e.apply(this,arguments)}return o(t,e),t.prototype.render=function(){a["default"](!1)},t}(u.Component);g.createRouteFromReactElement=function(e){var t=l.createRouteFromReactElement(e);return t.from&&(t.path=t.from),t.onEnter=function(e,r){var n=e.location,i=e.params,o=void 0;if("/"===t.to.charAt(0))o=h.formatPattern(t.to,i);else if(t.to){var s=e.routes.indexOf(t),a=g.getRoutePattern(e.routes,s-1),u=a.replace(/\/*$/,"/")+t.to;o=h.formatPattern(u,i)}else o=n.pathname;r(t.state||n.state,o,t.query||n.query)},t},g.getRoutePattern=function(e,t){for(var r="",n=t;n>=0;n--){var i=e[n],o=i.path||"";if(r=o.replace(/\/*$/,"/")+r,0===o.indexOf("/"))break}return"/"+r},g.propTypes={path:p,from:p,to:p.isRequired,query:m,state:m,onEnter:f.falsy,children:f.falsy},t["default"]=g,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(14),u=n(a),c=r(7),l=n(c),h=r(38),f=r(443),d=n(f),p=l["default"].PropTypes,m=p.array,g=p.func,v=p.object,_=function(e){function t(){i(this,t),e.apply(this,arguments)}return o(t,e),t.prototype.getChildContext=function(){var e=this.props,t=e.history,r=e.location;return{history:t,location:r}},t.prototype.createElement=function(e,t){return null==e?null:this.props.createElement(e,t)},t.prototype.render=function(){var e=this,t=this.props,r=t.history,n=t.location,i=t.routes,o=t.params,a=t.components,c=null;return a&&(c=a.reduceRight(function(t,a,u){if(null==a)return t;var c=i[u],l=d["default"](c,o),f={history:r,location:n,params:o,route:c,routeParams:l,routes:i};if(h.isReactChildren(t))f.children=t;else if(t)for(var p in t)t.hasOwnProperty(p)&&(f[p]=t[p]);if("object"==typeof a){var m={};for(var g in a)a.hasOwnProperty(g)&&(m[g]=e.createElement(a[g],s({key:g},f)));return m}return e.createElement(a,f)},c)),null===c||c===!1||l["default"].isValidElement(c)?void 0:u["default"](!1),c},t}(c.Component);_.propTypes={history:v.isRequired,createElement:g.isRequired,location:v.isRequired,routes:m.isRequired,params:v.isRequired,components:m.isRequired},_.defaultProps={createElement:l["default"].createElement},_.childContextTypes={history:v.isRequired,location:v.isRequired},t["default"]=_,e.exports=t["default"]},function(e,t,r){"use strict";function n(e,t){if(e==t)return!0;if(null==e||null==t)return!1;if(Array.isArray(e))return Array.isArray(t)&&e.length===t.length&&e.every(function(e,r){return n(e,t[r])});if("object"==typeof e){for(var r in e)if(e.hasOwnProperty(r))if(void 0===e[r]){if(void 0!==t[r])return!1}else{if(!t.hasOwnProperty(r))return!1;if(!n(e[r],t[r]))return!1}return!0}return String(e)===String(t)}function i(e,t,r){return e.every(function(e,n){return String(t[n])===String(r[e])})}function o(e,t,r){for(var n=e,o=[],s=[],a=0,u=t.length;u>a;++a){var l=t[a],h=l.path||"";if("/"===h.charAt(0)&&(n=e,o=[],s=[]),null!==n){var f=c.matchPattern(h,n);n=f.remainingPathname,o=[].concat(o,f.paramNames),s=[].concat(s,f.paramValues)}if(""===n&&l.path&&i(o,s,r))return a}return null}function s(e,t,r,n){var i=o(e,t,r);return null===i?!1:n?t.slice(i+1).every(function(e){return!e.path}):!0}function a(e,t){return null==t?null==e:null==e?!0:n(e,t)}function u(e,t,r,n,i,o){return null==n?!1:s(e,i,o,r)?a(t,n.query):!1}t.__esModule=!0;var c=r(65);t["default"]=u,e.exports=t["default"]},function(e,t){"use strict";function r(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var n={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0},i=["Webkit","ms","Moz","O"];Object.keys(n).forEach(function(e){i.forEach(function(t){n[r(t,e)]=n[e]})});var o={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},s={isUnitlessNumber:n,shorthandPropertyExpansions:o};e.exports=s},function(e,t,r){"use strict";function n(e,t,r){var n=r>=e.childNodes.length?null:e.childNodes.item(r);e.insertBefore(t,n)}var i=r(451),o=r(206),s=r(20),a=r(92),u=r(130),c=r(2),l={dangerouslyReplaceNodeWithMarkup:i.dangerouslyReplaceNodeWithMarkup,updateTextContent:u,processUpdates:function(e,t){for(var r,s=null,l=null,h=0;h<e.length;h++)if(r=e[h],r.type===o.MOVE_EXISTING||r.type===o.REMOVE_NODE){var f=r.fromIndex,d=r.parentNode.childNodes[f],p=r.parentID;d?void 0:c(!1),s=s||{},s[p]=s[p]||[],s[p][f]=d,l=l||[],l.push(d)}var m;if(m=t.length&&"string"==typeof t[0]?i.dangerouslyRenderMarkup(t):t,l)for(var g=0;g<l.length;g++)l[g].parentNode.removeChild(l[g]);for(var v=0;v<e.length;v++)switch(r=e[v],r.type){case o.INSERT_MARKUP:n(r.parentNode,m[r.markupIndex],r.toIndex);break;case o.MOVE_EXISTING:n(r.parentNode,s[r.parentID][r.fromIndex],r.toIndex);break;case o.SET_MARKUP:a(r.parentNode,r.content);break;case o.TEXT_CONTENT:u(r.parentNode,r.content);break;case o.REMOVE_NODE:}}};s.measureMethods(l,"DOMChildrenOperations",{updateTextContent:"updateTextContent"}),e.exports=l},function(e,t,r){"use strict";function n(){if(a)for(var e in u){var t=u[e],r=a.indexOf(e);if(r>-1?void 0:s(!1),!c.plugins[r]){t.extractEvents?void 0:s(!1),c.plugins[r]=t;var n=t.eventTypes;for(var o in n)i(n[o],t,o)?void 0:s(!1)}}}function i(e,t,r){c.eventNameDispatchConfigs.hasOwnProperty(r)?s(!1):void 0,c.eventNameDispatchConfigs[r]=e;var n=e.phasedRegistrationNames;if(n){for(var i in n)if(n.hasOwnProperty(i)){var a=n[i];o(a,t,r)}return!0}return e.registrationName?(o(e.registrationName,t,r),!0):!1}function o(e,t,r){c.registrationNameModules[e]?s(!1):void 0,c.registrationNameModules[e]=t,c.registrationNameDependencies[e]=t.eventTypes[r].dependencies}var s=r(2),a=null,u={},c={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},injectEventPluginOrder:function(e){a?s(!1):void 0,a=Array.prototype.slice.call(e),n()},injectEventPluginsByName:function(e){var t=!1;for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];u.hasOwnProperty(r)&&u[r]===i||(u[r]?s(!1):void 0,u[r]=i,t=!0)}t&&n()},getPluginModuleForEvent:function(e){var t=e.dispatchConfig;if(t.registrationName)return c.registrationNameModules[t.registrationName]||null;for(var r in t.phasedRegistrationNames)if(t.phasedRegistrationNames.hasOwnProperty(r)){var n=c.registrationNameModules[t.phasedRegistrationNames[r]];if(n)return n}return null},_resetEventPlugins:function(){a=null;for(var e in u)u.hasOwnProperty(e)&&delete u[e];c.plugins.length=0;var t=c.eventNameDispatchConfigs;for(var r in t)t.hasOwnProperty(r)&&delete t[r];var n=c.registrationNameModules;for(var i in n)n.hasOwnProperty(i)&&delete n[i]}};e.exports=c},function(e,t,r){"use strict";function n(e){return(""+e).replace(x,"//")}function i(e,t){this.func=e,this.context=t,this.count=0}function o(e,t,r){var n=e.func,i=e.context;n.call(i,t,e.count++)}function s(e,t,r){if(null==e)return e;var n=i.getPooled(t,r);v(e,o,n),i.release(n)}function a(e,t,r,n){this.result=e,this.keyPrefix=t,this.func=r,this.context=n,this.count=0}function u(e,t,r){var i=e.result,o=e.keyPrefix,s=e.func,a=e.context,u=s.call(a,t,e.count++);Array.isArray(u)?c(u,i,r,g.thatReturnsArgument):null!=u&&(m.isValidElement(u)&&(u=m.cloneAndReplaceKey(u,o+(u!==t?n(u.key||"")+"/":"")+r)),i.push(u))}function c(e,t,r,i,o){var s="";null!=r&&(s=n(r)+"/");var c=a.getPooled(t,s,i,o);v(e,u,c),a.release(c)}function l(e,t,r){if(null==e)return e;var n=[];return c(e,n,null,t,r),n}function h(e,t,r){return null}function f(e,t){return v(e,h,null)}function d(e){var t=[];return c(e,t,null,g.thatReturnsArgument),t}var p=r(39),m=r(15),g=r(26),v=r(132),_=p.twoArgumentPooler,y=p.fourArgumentPooler,x=/\/(?!\/)/g;i.prototype.destructor=function(){this.func=null,this.context=null,this.count=0},p.addPoolingTo(i,_),a.prototype.destructor=function(){this.result=null,this.keyPrefix=null,this.func=null,this.context=null,this.count=0},p.addPoolingTo(a,y);var b={forEach:s,map:l,mapIntoWithKeyPrefixInternal:c,count:f,toArray:d};e.exports=b},function(e,t,r){"use strict";function n(e,t){var r=S.hasOwnProperty(t)?S[t]:null;M.hasOwnProperty(t)&&(r!==x.OVERRIDE_BASE?g(!1):void 0),e.hasOwnProperty(t)&&(r!==x.DEFINE_MANY&&r!==x.DEFINE_MANY_MERGED?g(!1):void 0)}function i(e,t){if(t){"function"==typeof t?g(!1):void 0,f.isValidElement(t)?g(!1):void 0;var r=e.prototype;t.hasOwnProperty(y)&&E.mixins(e,t.mixins);for(var i in t)if(t.hasOwnProperty(i)&&i!==y){var o=t[i];if(n(r,i),E.hasOwnProperty(i))E[i](e,o);else{var s=S.hasOwnProperty(i),c=r.hasOwnProperty(i),l="function"==typeof o,h=l&&!s&&!c&&t.autobind!==!1;if(h)r.__reactAutoBindMap||(r.__reactAutoBindMap={}),r.__reactAutoBindMap[i]=o,r[i]=o;else if(c){var d=S[i];!s||d!==x.DEFINE_MANY_MERGED&&d!==x.DEFINE_MANY?g(!1):void 0,d===x.DEFINE_MANY_MERGED?r[i]=a(r[i],o):d===x.DEFINE_MANY&&(r[i]=u(r[i],o))}else r[i]=o}}}}function o(e,t){if(t)for(var r in t){var n=t[r];if(t.hasOwnProperty(r)){var i=r in E;i?g(!1):void 0;var o=r in e;o?g(!1):void 0,e[r]=n}}}function s(e,t){e&&t&&"object"==typeof e&&"object"==typeof t?void 0:g(!1);for(var r in t)t.hasOwnProperty(r)&&(void 0!==e[r]?g(!1):void 0,e[r]=t[r]);return e}function a(e,t){return function(){var r=e.apply(this,arguments),n=t.apply(this,arguments);if(null==r)return n;if(null==n)return r;var i={};return s(i,r),s(i,n),i}}function u(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function c(e,t){var r=t.bind(e);return r}function l(e){for(var t in e.__reactAutoBindMap)if(e.__reactAutoBindMap.hasOwnProperty(t)){var r=e.__reactAutoBindMap[t];e[t]=c(e,r)}}var h=r(193),f=r(15),d=(r(87),r(86),r(208)),p=r(5),m=r(62),g=r(2),v=r(81),_=r(36),y=(r(4),_({mixins:null})),x=v({DEFINE_ONCE:null,DEFINE_MANY:null,OVERRIDE_BASE:null,DEFINE_MANY_MERGED:null}),b=[],S={mixins:x.DEFINE_MANY,statics:x.DEFINE_MANY,propTypes:x.DEFINE_MANY,contextTypes:x.DEFINE_MANY,childContextTypes:x.DEFINE_MANY,getDefaultProps:x.DEFINE_MANY_MERGED,getInitialState:x.DEFINE_MANY_MERGED,getChildContext:x.DEFINE_MANY_MERGED,render:x.DEFINE_ONCE,componentWillMount:x.DEFINE_MANY,componentDidMount:x.DEFINE_MANY,componentWillReceiveProps:x.DEFINE_MANY,shouldComponentUpdate:x.DEFINE_ONCE,componentWillUpdate:x.DEFINE_MANY,componentDidUpdate:x.DEFINE_MANY,componentWillUnmount:x.DEFINE_MANY,updateComponent:x.OVERRIDE_BASE},E={displayName:function(e,t){e.displayName=t},mixins:function(e,t){if(t)for(var r=0;r<t.length;r++)i(e,t[r])},childContextTypes:function(e,t){e.childContextTypes=p({},e.childContextTypes,t)},contextTypes:function(e,t){e.contextTypes=p({},e.contextTypes,t)},getDefaultProps:function(e,t){e.getDefaultProps?e.getDefaultProps=a(e.getDefaultProps,t):e.getDefaultProps=t},propTypes:function(e,t){e.propTypes=p({},e.propTypes,t)},statics:function(e,t){o(e,t)},autobind:function(){}},M={replaceState:function(e,t){this.updater.enqueueReplaceState(this,e),t&&this.updater.enqueueCallback(this,t)},isMounted:function(){return this.updater.isMounted(this)},setProps:function(e,t){this.updater.enqueueSetProps(this,e),t&&this.updater.enqueueCallback(this,t);
},replaceProps:function(e,t){this.updater.enqueueReplaceProps(this,e),t&&this.updater.enqueueCallback(this,t)}},T=function(){};p(T.prototype,h.prototype,M);var P={createClass:function(e){var t=function(e,t,r){this.__reactAutoBindMap&&l(this),this.props=e,this.context=t,this.refs=m,this.updater=r||d,this.state=null;var n=this.getInitialState?this.getInitialState():null;"object"!=typeof n||Array.isArray(n)?g(!1):void 0,this.state=n};t.prototype=new T,t.prototype.constructor=t,b.forEach(i.bind(null,t)),i(t,e),t.getDefaultProps&&(t.defaultProps=t.getDefaultProps()),t.prototype.render?void 0:g(!1);for(var r in S)t.prototype[r]||(t.prototype[r]=null);return t},injection:{injectMixin:function(e){b.push(e)}}};e.exports=P},function(e,t,r){"use strict";function n(e,t,r){this.props=e,this.context=t,this.refs=o,this.updater=r||i}var i=r(208),o=(r(90),r(62)),s=r(2);r(4);n.prototype.isReactComponent={},n.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e?s(!1):void 0,this.updater.enqueueSetState(this,e),t&&this.updater.enqueueCallback(this,t)},n.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this),e&&this.updater.enqueueCallback(this,e)};e.exports=n},function(e,t,r){"use strict";var n=r(32),i=r(197),o=r(199),s=r(55),a=r(13),u=r(20),c=r(44),l=r(21),h=r(122),f=r(123),d=r(500);r(4);o.inject();var p=u.measure("React","render",a.render),m={findDOMNode:f,render:p,unmountComponentAtNode:a.unmountComponentAtNode,version:h,unstable_batchedUpdates:l.batchedUpdates,unstable_renderSubtreeIntoContainer:d};"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject&&__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({CurrentOwner:n,InstanceHandles:s,Mount:a,Reconciler:c,TextComponent:i});e.exports=m},function(e,t){"use strict";var r={useCreateElement:!1};e.exports=r},function(e,t,r){"use strict";function n(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=!1;var e=this._currentElement.props,t=s.getValue(e);null!=t&&i(this,Boolean(e.multiple),t)}}function i(e,t,r){var n,i,o=a.getNode(e._rootNodeID).options;if(t){for(n={},i=0;i<r.length;i++)n[""+r[i]]=!0;for(i=0;i<o.length;i++){var s=n.hasOwnProperty(o[i].value);o[i].selected!==s&&(o[i].selected=s)}}else{for(n=""+r,i=0;i<o.length;i++)if(o[i].value===n)return void(o[i].selected=!0);o.length&&(o[0].selected=!0)}}function o(e){var t=this._currentElement.props,r=s.executeOnChange(t,e);return this._wrapperState.pendingUpdate=!0,u.asap(n,this),r}var s=r(117),a=r(13),u=r(21),c=r(5),l=(r(4),"__ReactDOMSelect_value$"+Math.random().toString(36).slice(2)),h={valueContextKey:l,getNativeProps:function(e,t,r){return c({},t,{onChange:e._wrapperState.onChange,value:void 0})},mountWrapper:function(e,t){var r=s.getValue(t);e._wrapperState={pendingUpdate:!1,initialValue:null!=r?r:t.defaultValue,onChange:o.bind(e),wasMultiple:Boolean(t.multiple)}},processChildContext:function(e,t,r){var n=c({},r);return n[l]=e._wrapperState.initialValue,n},postUpdateWrapper:function(e){var t=e._currentElement.props;e._wrapperState.initialValue=void 0;var r=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=Boolean(t.multiple);var n=s.getValue(t);null!=n?(e._wrapperState.pendingUpdate=!1,i(e,Boolean(t.multiple),n)):r!==Boolean(t.multiple)&&(null!=t.defaultValue?i(e,Boolean(t.multiple),t.defaultValue):i(e,Boolean(t.multiple),t.multiple?[]:""))}};e.exports=h},function(e,t,r){"use strict";var n=r(189),i=r(116),o=r(118),s=r(13),a=r(5),u=r(91),c=r(130),l=(r(133),function(e){});a(l.prototype,{construct:function(e){this._currentElement=e,this._stringText=""+e,this._rootNodeID=null,this._mountIndex=0},mountComponent:function(e,t,r){if(this._rootNodeID=e,t.useCreateElement){var n=r[s.ownerDocumentContextKey],o=n.createElement("span");return i.setAttributeForID(o,e),s.getID(o),c(o,this._stringText),o}var a=u(this._stringText);return t.renderToStaticMarkup?a:"<span "+i.createMarkupForID(e)+">"+a+"</span>"},receiveComponent:function(e,t){if(e!==this._currentElement){this._currentElement=e;var r=""+e;if(r!==this._stringText){this._stringText=r;var i=s.getNode(this._rootNodeID);n.updateTextContent(i,r)}}},unmountComponent:function(){o.unmountIDFromEnvironment(this._rootNodeID)}}),e.exports=l},function(e,t,r){"use strict";function n(){this.reinitializeTransaction()}var i=r(21),o=r(89),s=r(5),a=r(26),u={initialize:a,close:function(){f.isBatchingUpdates=!1}},c={initialize:a,close:i.flushBatchedUpdates.bind(i)},l=[c,u];s(n.prototype,o.Mixin,{getTransactionWrappers:function(){return l}});var h=new n,f={isBatchingUpdates:!1,batchedUpdates:function(e,t,r,n,i,o){var s=f.isBatchingUpdates;f.isBatchingUpdates=!0,s?e(t,r,n,i,o):h.perform(e,null,t,r,n,i,o)}};e.exports=f},function(e,t,r){"use strict";function n(){if(!T){T=!0,v.EventEmitter.injectReactEventListener(g),v.EventPluginHub.injectEventPluginOrder(a),v.EventPluginHub.injectInstanceHandle(_),v.EventPluginHub.injectMount(y),v.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:E,EnterLeaveEventPlugin:u,ChangeEventPlugin:o,SelectEventPlugin:b,BeforeInputEventPlugin:i}),v.NativeComponent.injectGenericComponentClass(p),v.NativeComponent.injectTextComponentClass(m),v.Class.injectMixin(h),v.DOMProperty.injectDOMPropertyConfig(l),v.DOMProperty.injectDOMPropertyConfig(M),v.EmptyComponent.injectEmptyComponent("noscript"),v.Updates.injectReconcileTransaction(x),v.Updates.injectBatchingStrategy(d),v.RootIndex.injectCreateReactRootIndex(c.canUseDOM?s.createReactRootIndex:S.createReactRootIndex),v.Component.injectEnvironment(f)}}var i=r(447),o=r(449),s=r(450),a=r(452),u=r(453),c=r(12),l=r(456),h=r(458),f=r(118),d=r(198),p=r(462),m=r(197),g=r(470),v=r(471),_=r(55),y=r(13),x=r(475),b=r(481),S=r(482),E=r(483),M=r(480),T=!1;e.exports={inject:n}},function(e,t,r){"use strict";function n(){if(h.current){var e=h.current.getName();if(e)return" Check the render method of `"+e+"`."}return""}function i(e,t){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;o("uniqueKey",e,t)}}function o(e,t,r){var i=n();if(!i){var o="string"==typeof r?r:r.displayName||r.name;o&&(i=" Check the top-level render call using <"+o+">.")}var s=p[e]||(p[e]={});if(s[i])return null;s[i]=!0;var a={parentOrOwner:i,url:" See https://fb.me/react-warning-keys for more information.",childOwner:null};return t&&t._owner&&t._owner!==h.current&&(a.childOwner=" It was passed a child from "+t._owner.getName()+"."),a}function s(e,t){if("object"==typeof e)if(Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];c.isValidElement(n)&&i(n,t)}else if(c.isValidElement(e))e._store&&(e._store.validated=!0);else if(e){var o=f(e);if(o&&o!==e.entries)for(var s,a=o.call(e);!(s=a.next()).done;)c.isValidElement(s.value)&&i(s.value,t)}}function a(e,t,r,i){for(var o in t)if(t.hasOwnProperty(o)){var s;try{"function"!=typeof t[o]?d(!1):void 0,s=t[o](r,o,e,i)}catch(a){s=a}if(s instanceof Error&&!(s.message in m)){m[s.message]=!0;n()}}}function u(e){var t=e.type;if("function"==typeof t){var r=t.displayName||t.name;t.propTypes&&a(r,t.propTypes,e.props,l.prop),"function"==typeof t.getDefaultProps}}var c=r(15),l=r(87),h=(r(86),r(32)),f=(r(90),r(127)),d=r(2),p=(r(4),{}),m={},g={createElement:function(e,t,r){var n="string"==typeof e||"function"==typeof e,i=c.createElement.apply(this,arguments);if(null==i)return i;if(n)for(var o=2;o<arguments.length;o++)s(arguments[o],e);return u(i),i},createFactory:function(e){var t=g.createElement.bind(null,e);return t.type=e,t},cloneElement:function(e,t,r){for(var n=c.cloneElement.apply(this,arguments),i=2;i<arguments.length;i++)s(arguments[i],n.type);return u(n),n}};e.exports=g},function(e,t,r){"use strict";var n,i=r(15),o=r(202),s=r(44),a=r(5),u={injectEmptyComponent:function(e){n=i.createElement(e)}},c=function(e){this._currentElement=null,this._rootNodeID=null,this._renderedComponent=e(n)};a(c.prototype,{construct:function(e){},mountComponent:function(e,t,r){return o.registerNullComponentID(e),this._rootNodeID=e,s.mountComponent(this._renderedComponent,e,t,r)},receiveComponent:function(){},unmountComponent:function(e,t,r){s.unmountComponent(this._renderedComponent),o.deregisterNullComponentID(this._rootNodeID),this._rootNodeID=null,this._renderedComponent=null}}),c.injection=u,e.exports=c},function(e,t){"use strict";function r(e){return!!o[e]}function n(e){o[e]=!0}function i(e){delete o[e]}var o={},s={isNullComponentID:r,registerNullComponentID:n,deregisterNullComponentID:i};e.exports=s},function(e,t,r){"use strict";function n(e,t,r,n){try{return t(r,n)}catch(o){return void(null===i&&(i=o))}}var i=null,o={invokeGuardedCallback:n,invokeGuardedCallbackWithCatch:n,rethrowCaughtError:function(){if(i){var e=i;throw i=null,e}}};e.exports=o},function(e,t,r){"use strict";function n(e){return o(document.documentElement,e)}var i=r(466),o=r(165),s=r(166),a=r(167),u={hasSelectionCapabilities:function(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&"text"===e.type||"textarea"===t||"true"===e.contentEditable)},getSelectionInformation:function(){var e=a();return{focusedElem:e,selectionRange:u.hasSelectionCapabilities(e)?u.getSelection(e):null}},restoreSelection:function(e){var t=a(),r=e.focusedElem,i=e.selectionRange;t!==r&&n(r)&&(u.hasSelectionCapabilities(r)&&u.setSelection(r,i),s(r))},getSelection:function(e){var t;if("selectionStart"in e)t={start:e.selectionStart,end:e.selectionEnd};else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var r=document.selection.createRange();r.parentElement()===e&&(t={start:-r.moveStart("character",-e.value.length),end:-r.moveEnd("character",-e.value.length)})}else t=i.getOffsets(e);return t||{start:0,end:0}},setSelection:function(e,t){var r=t.start,n=t.end;if("undefined"==typeof n&&(n=r),"selectionStart"in e)e.selectionStart=r,e.selectionEnd=Math.min(n,e.value.length);else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var o=e.createTextRange();o.collapse(!0),o.moveStart("character",r),o.moveEnd("character",n-r),o.select()}else i.setOffsets(e,t)}};e.exports=u},function(e,t,r){"use strict";var n=r(492),i=/\/?>/,o={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(e){var t=n(e);return e.replace(i," "+o.CHECKSUM_ATTR_NAME+'="'+t+'"$&')},canReuseMarkup:function(e,t){var r=t.getAttribute(o.CHECKSUM_ATTR_NAME);r=r&&parseInt(r,10);var i=n(e);return i===r}};e.exports=o},function(e,t,r){"use strict";var n=r(81),i=n({INSERT_MARKUP:null,MOVE_EXISTING:null,REMOVE_NODE:null,SET_MARKUP:null,TEXT_CONTENT:null});e.exports=i},function(e,t,r){"use strict";function n(e){if("function"==typeof e.type)return e.type;var t=e.type,r=h[t];return null==r&&(h[t]=r=c(t)),r}function i(e){return l?void 0:u(!1),new l(e.type,e.props)}function o(e){return new f(e)}function s(e){return e instanceof f}var a=r(5),u=r(2),c=null,l=null,h={},f=null,d={injectGenericComponentClass:function(e){l=e},injectTextComponentClass:function(e){f=e},injectComponentClasses:function(e){a(h,e)}},p={getComponentClassForElement:n,createInternalComponent:i,createInstanceForText:o,isTextComponent:s,injection:d};e.exports=p},function(e,t,r){"use strict";function n(e,t){}var i=(r(4),{isMounted:function(e){return!1},enqueueCallback:function(e,t){},enqueueForceUpdate:function(e){n(e,"forceUpdate")},enqueueReplaceState:function(e,t){n(e,"replaceState")},enqueueSetState:function(e,t){n(e,"setState")},enqueueSetProps:function(e,t){n(e,"setProps")},enqueueReplaceProps:function(e,t){n(e,"replaceProps")}});e.exports=i},function(e,t,r){"use strict";function n(e){function t(t,r,n,i,o,s){if(i=i||S,s=s||n,null==r[n]){var a=y[o];return t?new Error("Required "+a+" `"+s+"` was not specified in "+("`"+i+"`.")):null}return e(r,n,i,o,s)}var r=t.bind(null,!1);return r.isRequired=t.bind(null,!0),r}function i(e){function t(t,r,n,i,o){var s=t[r],a=m(s);if(a!==e){var u=y[i],c=g(s);return new Error("Invalid "+u+" `"+o+"` of type "+("`"+c+"` supplied to `"+n+"`, expected ")+("`"+e+"`."))}return null}return n(t)}function o(){return n(x.thatReturns(null))}function s(e){function t(t,r,n,i,o){var s=t[r];if(!Array.isArray(s)){var a=y[i],u=m(s);return new Error("Invalid "+a+" `"+o+"` of type "+("`"+u+"` supplied to `"+n+"`, expected an array."))}for(var c=0;c<s.length;c++){var l=e(s,c,n,i,o+"["+c+"]");if(l instanceof Error)return l}return null}return n(t)}function a(){function e(e,t,r,n,i){if(!_.isValidElement(e[t])){var o=y[n];return new Error("Invalid "+o+" `"+i+"` supplied to "+("`"+r+"`, expected a single ReactElement."))}return null}return n(e)}function u(e){function t(t,r,n,i,o){if(!(t[r]instanceof e)){var s=y[i],a=e.name||S,u=v(t[r]);return new Error("Invalid "+s+" `"+o+"` of type "+("`"+u+"` supplied to `"+n+"`, expected ")+("instance of `"+a+"`."))}return null}return n(t)}function c(e){function t(t,r,n,i,o){for(var s=t[r],a=0;a<e.length;a++)if(s===e[a])return null;var u=y[i],c=JSON.stringify(e);return new Error("Invalid "+u+" `"+o+"` of value `"+s+"` "+("supplied to `"+n+"`, expected one of "+c+"."))}return n(Array.isArray(e)?t:function(){return new Error("Invalid argument supplied to oneOf, expected an instance of array.")})}function l(e){function t(t,r,n,i,o){var s=t[r],a=m(s);if("object"!==a){var u=y[i];return new Error("Invalid "+u+" `"+o+"` of type "+("`"+a+"` supplied to `"+n+"`, expected an object."))}for(var c in s)if(s.hasOwnProperty(c)){var l=e(s,c,n,i,o+"."+c);if(l instanceof Error)return l}return null}return n(t)}function h(e){function t(t,r,n,i,o){for(var s=0;s<e.length;s++){var a=e[s];if(null==a(t,r,n,i,o))return null}var u=y[i];return new Error("Invalid "+u+" `"+o+"` supplied to "+("`"+n+"`."))}return n(Array.isArray(e)?t:function(){return new Error("Invalid argument supplied to oneOfType, expected an instance of array.")})}function f(){function e(e,t,r,n,i){if(!p(e[t])){var o=y[n];return new Error("Invalid "+o+" `"+i+"` supplied to "+("`"+r+"`, expected a ReactNode."))}return null}return n(e)}function d(e){function t(t,r,n,i,o){var s=t[r],a=m(s);if("object"!==a){var u=y[i];return new Error("Invalid "+u+" `"+o+"` of type `"+a+"` "+("supplied to `"+n+"`, expected `object`."))}for(var c in e){var l=e[c];if(l){var h=l(s,c,n,i,o+"."+c);if(h)return h}}return null}return n(t)}function p(e){switch(typeof e){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(p);if(null===e||_.isValidElement(e))return!0;var t=b(e);if(!t)return!1;var r,n=t.call(e);if(t!==e.entries){for(;!(r=n.next()).done;)if(!p(r.value))return!1}else for(;!(r=n.next()).done;){var i=r.value;if(i&&!p(i[1]))return!1}return!0;default:return!1}}function m(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":t}function g(e){var t=m(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function v(e){return e.constructor&&e.constructor.name?e.constructor.name:"<<anonymous>>"}var _=r(15),y=r(86),x=r(26),b=r(127),S="<<anonymous>>",E={array:i("array"),bool:i("boolean"),func:i("function"),number:i("number"),object:i("object"),string:i("string"),any:o(),arrayOf:s,element:a(),instanceOf:u,node:f(),objectOf:l,oneOf:c,oneOfType:h,shape:d};e.exports=E},function(e,t){"use strict";var r={injectCreateReactRootIndex:function(e){n.createReactRootIndex=e}},n={createReactRootIndex:null,injection:r};e.exports=n},function(e,t){"use strict";var r={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(e){r.currentScrollLeft=e.x,r.currentScrollTop=e.y}};e.exports=r},function(e,t,r){"use strict";function n(e,t){if(null==t?i(!1):void 0,null==e)return t;var r=Array.isArray(e),n=Array.isArray(t);return r&&n?(e.push.apply(e,t),e):r?(e.push(t),e):n?[e].concat(t):[e,t]}var i=r(2);e.exports=n},function(e,t){"use strict";var r=function(e,t,r){Array.isArray(e)?e.forEach(t,r):e&&t.call(r,e)};e.exports=r},function(e,t,r){"use strict";function n(){return!o&&i.canUseDOM&&(o="textContent"in document.documentElement?"textContent":"innerText"),o}var i=r(12),o=null;e.exports=n},function(e,t){"use strict";function r(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&n[e.type]||"textarea"===t)}var n={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};e.exports=r},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return e||t?e&&!t||!e&&t?!1:e[a.DOES_NEED_REFRESH]||t[a.DOES_NEED_REFRESH]?!1:e.location.pathname===t.location.pathname&&e.location.search===t.location.search&&s["default"](e.location.state,t.location.state):!0}t.__esModule=!0,t["default"]=i;var o=r(163),s=n(o),a=r(46);e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){function r(){return c}function n(e){l.push(e);var t=!0;return function(){if(t){t=!1;var r=l.indexOf(e);l.splice(r,1)}}}function i(e){if(!s["default"](e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if("undefined"==typeof e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(h)throw new Error("Reducers may not dispatch actions.");try{h=!0,c=u(c,e)}finally{h=!1}return l.slice().forEach(function(e){return e()}),e}function o(e){u=e,i({type:a.INIT})}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var u=e,c=t,l=[],h=!1;return i({type:a.INIT}),{dispatch:i,subscribe:n,getState:r,replaceReducer:o}}t.__esModule=!0,t["default"]=i;var o=r(219),s=n(o),a={INIT:"@@redux/INIT"};t.ActionTypes=a},function(e,t){"use strict";function r(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return function(e){return t.reduceRight(function(e,t){return t(e)},e)}}t.__esModule=!0,t["default"]=r,e.exports=t["default"]},function(e,t){"use strict";function r(e){if(!e||"object"!=typeof e)return!1;var t="function"==typeof e.constructor?Object.getPrototypeOf(e):Object.prototype;if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&n(r)===i}t.__esModule=!0,t["default"]=r;var n=function(e){return Function.prototype.toString.call(e)},i=n(Object);e.exports=t["default"]},function(e,t){"use strict";function r(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=t(e[n],n),r},{})}t.__esModule=!0,t["default"]=r,e.exports=t["default"]},function(e,t,r){function n(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=d[n.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](n.parts[o]);for(;o<n.parts.length;o++)i.parts.push(c(n.parts[o],t))}else{for(var s=[],o=0;o<n.parts.length;o++)s.push(c(n.parts[o],t));d[n.id]={id:n.id,refs:1,parts:s}}}}function i(e){for(var t=[],r={},n=0;n<e.length;n++){var i=e[n],o=i[0],s=i[1],a=i[2],u=i[3],c={css:s,media:a,sourceMap:u};r[o]?r[o].parts.push(c):t.push(r[o]={id:o,parts:[c]})}return t}function o(e,t){var r=g(),n=y[y.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),y.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(t)}}function s(e){e.parentNode.removeChild(e);var t=y.indexOf(e);t>=0&&y.splice(t,1)}function a(e){var t=document.createElement("style");return t.type="text/css",o(e,t),t}function u(e){var t=document.createElement("link");return t.rel="stylesheet",o(e,t),t}function c(e,t){var r,n,i;if(t.singleton){var o=_++;r=v||(v=a(t)),n=l.bind(null,r,o,!1),i=l.bind(null,r,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=u(t),n=f.bind(null,r),i=function(){s(r),r.href&&URL.revokeObjectURL(r.href)}):(r=a(t),n=h.bind(null,r),i=function(){s(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}function l(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=x(t,i);else{var o=document.createTextNode(i),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(o,s[t]):e.appendChild(o)}}function h(e,t){var r=t.css,n=t.media;t.sourceMap;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function f(e,t){var r=t.css,n=(t.media,t.sourceMap);n&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var i=new Blob([r],{type:"text/css"}),o=e.href;e.href=URL.createObjectURL(i),o&&URL.revokeObjectURL(o)}var d={},p=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},m=p(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),g=p(function(){return document.head||document.getElementsByTagName("head")[0]}),v=null,_=0,y=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=m()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var r=i(e);return n(r,t),function(e){for(var o=[],s=0;s<r.length;s++){var a=r[s],u=d[a.id];u.refs--,o.push(u)}if(e){var c=i(e);n(c,t)}for(var s=0;s<o.length;s++){var u=o[s];if(0===u.refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete d[u.id]}}}};var x=function(){var e=[];return function(t,r){return e[t]=r,e.filter(Boolean).join("\n")}}()},function(e,t,r){(function(e){"use strict";if(r(351),r(515),e._babelPolyfill)throw new Error("only one instance of babel/polyfill is allowed");e._babelPolyfill=!0}).call(t,function(){return this}())},function(e,t,r){e.exports=r(222)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e,t,r){for(var n=!0;n;){var i=e,o=t,s=r;n=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(s)}var c=Object.getPrototypeOf(i);if(null===c)return;e=c,t=o,r=s,n=!0,a=c=void 0}},u=r(7),c=n(u),l=r(137),h=n(l),f=function(e){function t(e){i(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.renderView=this.renderView.bind(this),this.rotateLeft=this.rotateLeft.bind(this),this.rotateRight=this.rotateRight.bind(this),this.zoomIn=this.zoomIn.bind(this),this.zoomOut=this.zoomOut.bind(this),this.animationPlay=this.animationPlay.bind(this),this.animationStop=this.animationStop.bind(this),this.state={rotating:e.rotating,sceneOptions:e.sceneOptions,babylonScene:{},showPreloader:!0,preloaderText:this.props.preloaderText,cacheModel:this.props.cacheModel||!1}}return o(t,e),s(t,[{key:"componentDidMount",value:function(){this.renderView()}},{key:"renderView",value:function(){var e=this.props,t=(e.children,e.inputValue,e.modelSource),r=this;r.state.sceneOptions={rotating:this.props.rotating,cameraTargetVector:this.props.cameraTargetVector||new h["default"].Vector3(0,0,0),cameraPositionVector:this.props.cameraPositionVector||new h["default"].Vector3(1,2,-6),lightVector:this.props.lightVector||new h["default"].Vector3(0,5,1),lightIntensity:this.props.lightIntensity||1.2},r.showPreloader();var n=document.getElementById("viewer3dCanvas"),i=new h["default"].Engine(n,!0);this.state.cacheModel===!1&&(i.enableOfflineSupport=!1),h["default"].SceneLoader.ShowLoadingScreen=!1,h["default"].SceneLoader.Load("",t,i,function(e){var t=new h["default"].ArcRotateCamera("Camera",0,0,20,r.state.sceneOptions.cameraTargetVector,e);r.state.babylonScene=e,r.babylonCamera=t,t.attachControl(n,!0),t.setPosition(r.state.sceneOptions.cameraPositionVector),e.clearColor=new h["default"].Color4(0,0,0,0);var o=new h["default"].HemisphericLight("hemi",r.state.sceneOptions.lightVector,e);o.diffuse=new h["default"].Color3(1,1,1),o.specular=new h["default"].Color3(1,1,1),o.groundColor=new h["default"].Color3(.4,.4,.4),o.intensity=r.state.sceneOptions.lightIntensity,r.hidePreloader(),i.runRenderLoop(function(){e.render(),r.state.rotating===!0&&(e.activeCamera.alpha+=.005)})}),window.addEventListener("resize",function(){i.resize()})}},{key:"getMainObject",value:function(){return this.state.babylonScene.meshes[0]}},{key:"rotateObj",value:function(e,t,r){r||(r=1),"left"===t&&(r=-r);var n=new h["default"].Animation("myAnimation","rotation.y",30,h["default"].Animation.ANIMATIONTYPE_FLOAT,h["default"].Animation.ANIMATIONLOOPMODE_CYCLE);e.animations.length=0,e.rotation.y;var i=[];i.push({frame:0,value:e.rotation.y}),i.push({frame:20,value:e.rotation.y+r}),n.setKeys(i);var o=new h["default"].QuarticEase;o.setEasingMode(h["default"].EasingFunction.EASINGMODE_EASEINOUT),n.setEasingFunction(o),e.animations.push(n),this.state.babylonScene.beginAnimation(e,0,20,!1)}},{key:"rotateLeft",value:function(){var e=this.getMainObject();this.rotateObj(e,"left",1.2)}},{key:"rotateRight",value:function(){var e=this.getMainObject();this.rotateObj(e,"right",1.2)}},{key:"zoomIn",value:function(){this.babylonCamera.radius-=1}},{key:"zoomOut",value:function(){this.babylonCamera.radius+=1}},{key:"showPreloader",value:function(){var e={showPreloader:!0};this.setState(e)}},{key:"hidePreloader",value:function(){var e={showPreloader:!1};this.setState(e)}},{key:"animationPlay",value:function(){var e={rotating:!0};this.setState(e)}},{key:"animationStop",value:function(){var e={rotating:!1};this.setState(e)}},{key:"renderPlayBtn",value:function(e){return e===!1?c["default"].createElement("button",{onClick:this.animationPlay,className:"viewer3d-btn-animation-play"},c["default"].createElement("i",{className:"material-icons"},"play_circle_outline")):c["default"].createElement("button",{onClick:this.animationStop,className:"viewer3d-btn-animation-stop"},c["default"].createElement("i",{className:"material-icons"},"pause_circle_outline"))}},{key:"renderPreloader",value:function(e,t){var r=e?"viewer3d-preloader shown":"viewer3d-preloader hidden";return c["default"].createElement("div",{className:r},c["default"].createElement("div",{className:"preloader-content-wrap"},c["default"].createElement("div",{className:"preloader-circle"}),c["default"].createElement("span",{className:"preloader-title"},t)))}},{key:"render",value:function(){var e=this.props,t=(e.children,e.showControls),r=(e.inputValue,e.modelSource,e.sceneDimensions),n=void 0===r?{}:r,i=(e.rotating,n.width||800),o=n.height||500;return c["default"].createElement("div",{id:"viewer3dContainer"},c["default"].createElement("canvas",{width:i,height:o,id:"viewer3dCanvas",onLoad:this.renderView}),this.renderPreloader(this.state.showPreloader,this.state.preloaderText),t?c["default"].createElement("section",{className:"viewer3d-controls"},c["default"].createElement("button",{onClick:this.rotateLeft,className:"viewer3d-btn-rotate-left"},c["default"].createElement("i",{className:"material-icons"},"undo")),c["default"].createElement("button",{onClick:this.rotateRight,className:"viewer3d-btn-rotate-right"},c["default"].createElement("i",{className:"material-icons"},"redo")),c["default"].createElement("button",{onClick:this.zoomIn,className:"viewer3d-btn-rotate-zoom-in"},c["default"].createElement("i",{className:"material-icons"},"zoom_in")),c["default"].createElement("button",{onClick:this.zoomOut,className:"viewer3d-btn-rotate-zoom-out"},c["default"].createElement("i",{className:"material-icons"},"zoom_out")),this.renderPlayBtn(this.state.rotating)):null)}}]),t}(u.Component);t["default"]=f,f.propTypes={modelSource:u.PropTypes.string.isRequired,cacheModel:u.PropTypes.bool,rotating:u.PropTypes.bool,cameraPositionVector:u.PropTypes.object,lightVector:u.PropTypes.object,lightIntensity:u.PropTypes.number,showControls:u.PropTypes.bool,sceneDimensions:u.PropTypes.object,rotating:u.PropTypes.bool,preloaderText:u.PropTypes.string},e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e,t,r){for(var n=!0;n;){var i=e,o=t,s=r;n=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(s)}var c=Object.getPrototypeOf(i);if(null===c)return;e=c,t=o,r=s,n=!0,a=c=void 0}},u=r(7),c=n(u);r(52),r(70);r(517);var l=r(53),h=function(e){function t(e){i(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}return o(t,e),s(t,[{key:"render",value:function(){var e=this.props.currentUrl;return c["default"].createElement("nav",{className:"top-menu"},c["default"].createElement("ul",null,this.props.menuLinks.map(function(t,r){var n=t.url===e?"active":"normal";return c["default"].createElement("li",{key:r},c["default"].createElement(l.Link,{to:t.url,className:n},t.label))})))}}]),t}(u.Component);t["default"]=h,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return{errorMessage:e.errorMessage,inputValue:e.router.location.pathname.substring(1),currentUrl:e.router.location.pathname}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function(e,t,r){for(var n=!0;n;){var i=e,o=t,s=r;n=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(s)}var c=Object.getPrototypeOf(i);if(null===c)return;e=c,t=o,r=s,n=!0,a=c=void 0}},c=r(7),l=n(c),h=r(52),f=r(70),d=r(225),p=n(d),m=r(135);r(518);var g=function(e){function t(e){i(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.handleChange=this.handleChange.bind(this),this.handleDismissClick=this.handleDismissClick.bind(this)}return o(t,e),a(t,[{key:"handleDismissClick",value:function(e){this.props.resetErrorMessage(),e.preventDefault()}},{key:"handleChange",value:function(e){this.props.pushState(null,"/"+e)}},{key:"renderErrorMessage",value:function(){var e=this.props.errorMessage;
return e?l["default"].createElement("p",{style:{backgroundColor:"#e99",padding:10}},l["default"].createElement("b",null,e)," ","(",l["default"].createElement("a",{href:"#",onClick:this.handleDismissClick},"Dismiss"),")"):null}},{key:"render",value:function(){var e=this.props,t=e.children,r=(e.inputValue,e.currentUrl),n=[{label:"Home",url:"/"},{label:"React starter kit",url:"/StarterKitPage"}];return l["default"].createElement("div",null,l["default"].createElement(p["default"],{currentUrl:r,menuLinks:n}),this.renderErrorMessage(),t)}}]),t}(c.Component);g.propTypes={errorMessage:c.PropTypes.string,resetErrorMessage:c.PropTypes.func.isRequired,pushState:c.PropTypes.func.isRequired,inputValue:c.PropTypes.string.isRequired,children:c.PropTypes.node},t["default"]=(0,h.connect)(s,{resetErrorMessage:m.resetErrorMessage,pushState:f.pushState})(g),e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return{}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function(e,t,r){for(var n=!0;n;){var i=e,o=t,s=r;n=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(s)}var c=Object.getPrototypeOf(i);if(null===c)return;e=c,t=o,r=s,n=!0,a=c=void 0}},c=r(7),l=n(c),h=r(52),f=r(137),d=n(f),p=r(224),m=n(p),g=(r(53),function(e){function t(){i(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),a(t,[{key:"render",value:function(){return l["default"].createElement("div",null,l["default"].createElement("h1",{className:"page-title"},"Viewer3D example",l["default"].createElement("span",{className:"page-subtitle"},"ReactJS component for BabylonJS 3D models")),l["default"].createElement(m["default"],{modelSource:"CupExample.babylon",cacheModel:!1,rotating:!0,sceneDimensions:{width:document.body.clientWidth,height:500},cameraTargetVector:new d["default"].Vector3(0,0,0),cameraPositionVector:new d["default"].Vector3(1,2,-6),lightVector:new d["default"].Vector3(0,5,1),lightIntensity:1.4,preloaderText:"Loading...",showControls:!0}),l["default"].createElement("article",{className:"page-article"},l["default"].createElement("h3",null,"Usage:"),l["default"].createElement("ol",null,l["default"].createElement("li",null,"Install required dependency (babylonjs library) in your project:",l["default"].createElement("br",null),l["default"].createElement("div",{className:"code"},"npm install babylonjs --save")),l["default"].createElement("li",null,"Copy Viewer3D component (Viewer3D.js) into your project"),l["default"].createElement("li",null,"Import required files in your React view:",l["default"].createElement("br",null),l["default"].createElement("div",{className:"code"},"import BABYLON from 'babylonjs';",l["default"].createElement("br",null),"import Viewer3D from '../components/Viewer3D'")),l["default"].createElement("li",null,"Use component.",l["default"].createElement("br",null),l["default"].createElement("div",{className:"code"},"<Viewer3D modelSource='CupExample.babylon' />"),l["default"].createElement("p",null,"Note - modelSource is the only property that is required, but be sure to check out ",l["default"].createElement("a",{href:"#optionalParams"},"optional params")," as well.")),l["default"].createElement("li",null,"(optional) Install material icons (used in controls buttons) ",l["default"].createElement("br",null),l["default"].createElement("div",{className:"code"},'<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />'))),l["default"].createElement("h3",{id:"optionalParams"},"Options:"),l["default"].createElement("table",null,l["default"].createElement("tbody",null,l["default"].createElement("tr",null,l["default"].createElement("th",null,"Prop"),l["default"].createElement("th",null,"type"),l["default"].createElement("th",null,"default value"),l["default"].createElement("th",null,"required"),l["default"].createElement("th",null,"description")),l["default"].createElement("tr",null,l["default"].createElement("td",null,"showControls"),l["default"].createElement("td",null,"boolean"),l["default"].createElement("td",null,"true"),l["default"].createElement("td",null,"no"),l["default"].createElement("td",null,"Defines whether controls should be visible or not.")),l["default"].createElement("tr",null,l["default"].createElement("td",null,"modelSource"),l["default"].createElement("td",null,"string"),l["default"].createElement("td",null,"-"),l["default"].createElement("td",null,"yes"),l["default"].createElement("td",null,"Url to 3d .babylon model. More info about exporting proper models from Blender, 3dMax etc.: ",l["default"].createElement("a",{href:"http://doc.babylonjs.com/exporters",target:"_blank"},"http://doc.babylonjs.com/exporters"))),l["default"].createElement("tr",null,l["default"].createElement("td",null,"cacheModel"),l["default"].createElement("td",null,"boolean"),l["default"].createElement("td",null,"false"),l["default"].createElement("td",null,"no"),l["default"].createElement("td",null,"Should browser cache 3d models. If set to true, .manifest file must be provided along with .babylon model.")),l["default"].createElement("tr",null,l["default"].createElement("td",null,"sceneDimensions"),l["default"].createElement("td",null,"object"),l["default"].createElement("td",null,"width:800, height:500"),l["default"].createElement("td",null,"no"),l["default"].createElement("td",null,"Dimensions of created scene.")),l["default"].createElement("tr",null,l["default"].createElement("td",null,"cameraPositionVector"),l["default"].createElement("td",null,"object (babylonjs object)"),l["default"].createElement("td",null,"BABYLON.Vector3(1, 2, -6)"),l["default"].createElement("td",null,"no"),l["default"].createElement("td",null,"Defines where the camera is placed in 3d scene.")),l["default"].createElement("tr",null,l["default"].createElement("td",null,"cameraTargetVector"),l["default"].createElement("td",null,"object (babylonjs object)"),l["default"].createElement("td",null,"BABYLON.Vector3(0,0,0)"),l["default"].createElement("td",null,"no"),l["default"].createElement("td",null,"Defines direction where camera is 'looking' in 3d scene.")),l["default"].createElement("tr",null,l["default"].createElement("td",null,"lightVector"),l["default"].createElement("td",null,"object (babylonjs object)"),l["default"].createElement("td",null,"BABYLON.Vector3(0, 5, 1)"),l["default"].createElement("td",null,"no"),l["default"].createElement("td",null,"Defines direction where light is pointing in 3d scene.")),l["default"].createElement("tr",null,l["default"].createElement("td",null,"lightIntensity"),l["default"].createElement("td",null,"int"),l["default"].createElement("td",null,"1.2"),l["default"].createElement("td",null,"no"),l["default"].createElement("td",null,"Defines how strong light should be.")),l["default"].createElement("tr",null,l["default"].createElement("td",null,"preloaderText"),l["default"].createElement("td",null,"string"),l["default"].createElement("td",null,"null"),l["default"].createElement("td",null,"no"),l["default"].createElement("td",null,"Text displayed in preloader."))))))}}]),t}(c.Component));g.propTypes={},t["default"]=(0,h.connect)(s)(g),e.exports=t["default"]},function(e,t,r){"use strict";e.exports=r(229)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e,t,r){for(var n=!0;n;){var i=e,o=t,s=r;n=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(s)}var c=Object.getPrototypeOf(i);if(null===c)return;e=c,t=o,r=s,n=!0,a=c=void 0}},u=r(7),c=n(u),l=r(52),h=r(70),f=function(e){function t(){i(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),s(t,[{key:"render",value:function(){var e=this.props.store;return c["default"].createElement(l.Provider,{store:e},c["default"].createElement(h.ReduxRouter,null))}}]),t}(u.Component);t["default"]=f,f.propTypes={store:u.PropTypes.object.isRequired},e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return{}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function(e,t,r){for(var n=!0;n;){var i=e,o=t,s=r;n=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(s)}var c=Object.getPrototypeOf(i);if(null===c)return;e=c,t=o,r=s,n=!0,a=c=void 0}},c=r(7),l=n(c),h=r(52),f=function(e){function t(){i(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),a(t,[{key:"render",value:function(){return l["default"].createElement("div",null,l["default"].createElement("h1",{className:"page-title"},"Example as an React + Redux boilerplate"),l["default"].createElement("article",{className:"page-article"},l["default"].createElement("h3",null,"Basic info:"),l["default"].createElement("p",null,"This example app may be used as a React + Redux starter kit for other apps. It's small, yet consist modern app essentials:"),l["default"].createElement("ul",null,l["default"].createElement("li",null,l["default"].createElement("a",{target:"_blank",href:"https://webpack.github.io/"},"Webpack")," module builder"),l["default"].createElement("li",null,"React + ",l["default"].createElement("a",{href:"http://rackt.org/redux/index.html",target:"_blank"},"Redux")),l["default"].createElement("li",null,"Redux ",l["default"].createElement("a",{href:"https://github.com/gaearon/redux-devtools",target:"_blank"},"Devtools")," (press ctrl + H to toggle devtools panel, ctrl + Q to change its position)"),l["default"].createElement("li",null,"React router"),l["default"].createElement("li",null,"Written in ",l["default"].createElement("a",{href:"https://babeljs.io/docs/learn-es2015/"},"es6"),", with ",l["default"].createElement("a",{href:"https://babeljs.io/"},"babeljs")," compiling to es5."),l["default"].createElement("li",null,"CSS/SCSS loader - you can import your styles directly in your components like so:",l["default"].createElement("br",null)," ",l["default"].createElement("span",{className:"code"},"import './header.scss'"))),l["default"].createElement("h3",null,"Installation of project:"),l["default"].createElement("ol",null,l["default"].createElement("li",null,"get the project from repo"),l["default"].createElement("li",null,"cd to project, then npm install"),l["default"].createElement("li",null,"npm start for development server")),l["default"].createElement("h3",null,"Build to production:"),l["default"].createElement("ol",null,l["default"].createElement("li",null,"npm run build"),l["default"].createElement("li",null,"bundle scripts are generated and placed inside /dist folder"))))}}]),t}(c.Component);f.propTypes={},t["default"]=(0,h.connect)(s)(f),e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}r(223);var i=r(7),o=n(i),s=r(425),a=r(228),u=n(a),c=r(235),l=n(c),h=(0,l["default"])();(0,s.render)(o["default"].createElement(u["default"],{store:h}),document.getElementById("root"))},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function o(e,t){return void 0===e&&(e={users:{},repos:{}}),t.response&&t.response.entities?(0,l["default"])({},e,t.response.entities):e}function s(e,t){void 0===e&&(e=null);var r=t.type,n=t.error;return r===u.RESET_ERROR_MESSAGE?null:n?t.error:e}Object.defineProperty(t,"__esModule",{value:!0});var a=r(135),u=i(a),c=r(181),l=n(c),h=r(233),f=n(h),d=r(70),p=r(56),m=(0,p.combineReducers)({starredByUser:(0,f["default"])({mapActionToKey:function(e){return e.login},types:[u.STARRED_REQUEST,u.STARRED_SUCCESS,u.STARRED_FAILURE]}),stargazersByRepo:(0,f["default"])({mapActionToKey:function(e){return e.fullName},types:[u.STARGAZERS_REQUEST,u.STARGAZERS_SUCCESS,u.STARGAZERS_FAILURE]})}),g=(0,p.combineReducers)({entities:o,pagination:m,errorMessage:s,router:d.routerStateReducer});t["default"]=g,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){function t(e,t){switch(void 0===e&&(e={isFetching:!1,nextPageUrl:void 0,pageCount:0,ids:[]}),t.type){case a:return(0,u["default"])({},e,{isFetching:!0});case c:return(0,u["default"])({},e,{isFetching:!1,ids:(0,l["default"])(e.ids,t.response.result),nextPageUrl:t.response.nextPageUrl,pageCount:e.pageCount+1});case h:return(0,u["default"])({},e,{isFetching:!1});default:return e}}var r=e.types,n=e.mapActionToKey;if(!Array.isArray(r)||3!==r.length)throw new Error("Expected types to be an array of three elements.");if(!r.every(function(e){return"string"==typeof e}))throw new Error("Expected types to be strings.");if("function"!=typeof n)throw new Error("Expected mapActionToKey to be a function.");var o=s(r,3),a=o[0],c=o[1],h=o[2];return function(e,r){switch(void 0===e&&(e={}),r.type){case a:case c:case h:var o=n(r);if("string"!=typeof o)throw new Error("Expected key to be a string.");return(0,u["default"])({},e,i({},o,t(e[o],r)));default:return e}}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t["default"]=o;var a=r(181),u=n(a),c=r(376),l=n(c);e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(7),o=n(i),s=r(53),a=r(226),u=n(a),c=r(230),l=n(c),h=r(227),f=n(h);t["default"]=o["default"].createElement(s.Route,{path:"/",component:u["default"]},o["default"].createElement(s.IndexRoute,{component:f["default"]}),o["default"].createElement(s.Route,{path:"/StarterKitPage",component:l["default"]})),e.exports=t["default"]},function(e,t,r){"use strict";e.exports=r(236)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return v(g["default"],e)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=r(56),s=r(70),a=r(367),u=n(a),c=r(234),l=n(c),h=r(510),f=n(h),d=r(136),p=n(d),m=r(232),g=n(m),v=(0,o.compose)((0,o.applyMiddleware)(f["default"],p["default"]),(0,s.reduxReactRouter)({routes:l["default"],createHistory:u["default"]}))(o.createStore);e.exports=t["default"]},function(e,t,r){"use strict";var n=r(35),i=r(60),o=r(19);e.exports=[].copyWithin||function(e,t){var r=n(this),s=o(r.length),a=i(e,s),u=i(t,s),c=arguments,l=c.length>2?c[2]:void 0,h=Math.min((void 0===l?s:i(l,s))-u,s-a),f=1;for(a>u&&u+h>a&&(f=-1,u+=h-1,a+=h-1);h-- >0;)u in r?r[a]=r[u]:delete r[a],a+=f,u+=f;return r}},function(e,t,r){"use strict";var n=r(35),i=r(60),o=r(19);e.exports=[].fill||function(e){for(var t=n(this),r=o(t.length),s=arguments,a=s.length,u=i(a>1?s[1]:void 0,r),c=a>2?s[2]:void 0,l=void 0===c?r:i(c,r);l>u;)t[u++]=e;return t}},function(e,t,r){var n=r(6),i=r(94),o=r(9)("species");e.exports=function(e,t){var r;return i(e)&&(r=e.constructor,"function"!=typeof r||r!==Array&&!i(r.prototype)||(r=void 0),n(r)&&(r=r[o],null===r&&(r=void 0))),new(void 0===r?Array:r)(t)}},function(e,t,r){var n=r(3);e.exports=function(e){var t=n.getKeys(e),r=n.getSymbols;if(r)for(var i,o=r(e),s=n.isEnum,a=0;o.length>a;)s.call(e,i=o[a++])&&t.push(i);return t}},function(e,t,r){var n=r(3),i=r(25);e.exports=function(e,t){for(var r,o=i(e),s=n.getKeys(o),a=s.length,u=0;a>u;)if(o[r=s[u++]]===t)return r}},function(e,t,r){var n,i,o,s=r(10),a=r(159).set,u=s.MutationObserver||s.WebKitMutationObserver,c=s.process,l=s.Promise,h="process"==r(33)(c),f=function(){var e,t,r;for(h&&(e=c.domain)&&(c.domain=null,e.exit());n;)t=n.domain,r=n.fn,t&&t.enter(),r(),t&&t.exit(),n=n.next;i=void 0,e&&e.enter()};if(h)o=function(){c.nextTick(f)};else if(u){var d=1,p=document.createTextNode("");new u(f).observe(p,{characterData:!0}),o=function(){p.data=d=-d}}else o=l&&l.resolve?function(){l.resolve().then(f)}:function(){a.call(s,f)};e.exports=function(e){var t={fn:e,next:void 0,domain:h&&c.domain};i&&(i.next=t),n||(n=t,o()),i=t}},function(e,t,r){var n=r(3),i=r(35),o=r(76);e.exports=r(11)(function(){var e=Object.assign,t={},r={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(e){r[e]=e}),7!=e({},t)[n]||Object.keys(e({},r)).join("")!=i})?function(e,t){for(var r=i(e),s=arguments,a=s.length,u=1,c=n.getKeys,l=n.getSymbols,h=n.isEnum;a>u;)for(var f,d=o(s[u++]),p=l?c(d).concat(l(d)):c(d),m=p.length,g=0;m>g;)h.call(d,f=p[g++])&&(r[f]=d[f]);return r}:Object.assign},function(e,t,r){"use strict";var n=r(245),i=r(75),o=r(47);e.exports=function(){for(var e=o(this),t=arguments.length,r=Array(t),s=0,a=n._,u=!1;t>s;)(r[s]=arguments[s++])===a&&(u=!0);return function(){var n,o=this,s=arguments,c=s.length,l=0,h=0;if(!u&&!c)return i(e,r,o);if(n=r.slice(),u)for(;t>l;l++)n[l]===a&&(n[l]=s[h++]);for(;c>h;)n.push(s[h++]);return i(e,n,o)}}},function(e,t,r){e.exports=r(10)},function(e,t){e.exports=function(e,t){var r=t===Object(t)?function(e){return t[e]}:t;return function(t){return String(t).replace(e,r)}}},function(e,t,r){var n=r(8),i=r(47),o=r(9)("species");e.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||void 0==(r=n(s)[o])?t:i(r)}},function(e,t,r){var n=r(6);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){"use strict";var n,i=r(3),o=r(1),s=r(22),a=r(40),u=r(145),c=r(142),l=r(18),h=r(33),f=r(75),d=r(11),p=r(8),m=r(47),g=r(6),v=r(35),_=r(25),y=r(61),x=r(60),b=r(19),S=r(76),E=r(49)("__proto__"),M=r(71),T=r(138)(!1),P=Object.prototype,C=Array.prototype,w=C.slice,A=C.join,D=i.setDesc,I=i.getDesc,R=i.setDescs,O={};s||(n=!d(function(){return 7!=D(c("div"),"a",{get:function(){return 7}}).a}),i.setDesc=function(e,t,r){if(n)try{return D(e,t,r)}catch(i){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(p(e)[t]=r.value),e},i.getDesc=function(e,t){if(n)try{return I(e,t)}catch(r){}return l(e,t)?a(!P.propertyIsEnumerable.call(e,t),e[t]):void 0},i.setDescs=R=function(e,t){p(e);for(var r,n=i.getKeys(t),o=n.length,s=0;o>s;)i.setDesc(e,r=n[s++],t[r]);return e}),o(o.S+o.F*!s,"Object",{getOwnPropertyDescriptor:i.getDesc,defineProperty:i.setDesc,defineProperties:R});var L="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),F=L.concat("length","prototype"),V=L.length,k=function(){var e,t=c("iframe"),r=V,n=">";for(t.style.display="none",u.appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write("<script>document.F=Object</script"+n),e.close(),k=e.F;r--;)delete k.prototype[L[r]];return k()},B=function(e,t){return function(r){var n,i=_(r),o=0,s=[];for(n in i)n!=E&&l(i,n)&&s.push(n);for(;t>o;)l(i,n=e[o++])&&(~T(s,n)||s.push(n));return s}},N=function(){};o(o.S,"Object",{getPrototypeOf:i.getProto=i.getProto||function(e){return e=v(e),l(e,E)?e[E]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?P:null},getOwnPropertyNames:i.getNames=i.getNames||B(F,F.length,!0),create:i.create=i.create||function(e,t){var r;return null!==e?(N.prototype=p(e),r=new N,N.prototype=null,r[E]=e):r=k(),void 0===t?r:R(r,t)},keys:i.getKeys=i.getKeys||B(L,V,!1)});var U=function(e,t,r){if(!(t in O)){for(var n=[],i=0;t>i;i++)n[i]="a["+i+"]";O[t]=Function("F,a","return new F("+n.join(",")+")")}return O[t](e,r)};o(o.P,"Function",{bind:function(e){var t=m(this),r=w.call(arguments,1),n=function(){var i=r.concat(w.call(arguments));return this instanceof n?U(t,i.length,i):f(t,i,e)};return g(t.prototype)&&(n.prototype=t.prototype),n}}),o(o.P+o.F*d(function(){u&&w.call(u)}),"Array",{slice:function(e,t){var r=b(this.length),n=h(this);if(t=void 0===t?r:t,"Array"==n)return w.call(this,e,t);for(var i=x(e,r),o=x(t,r),s=b(o-i),a=Array(s),u=0;s>u;u++)a[u]="String"==n?this.charAt(i+u):this[i+u];return a}}),o(o.P+o.F*(S!=Object),"Array",{join:function(e){return A.call(S(this),void 0===e?",":e)}}),o(o.S,"Array",{isArray:r(94)});var z=function(e){return function(t,r){m(t);var n=S(this),i=b(n.length),o=e?i-1:0,s=e?-1:1;if(arguments.length<2)for(;;){if(o in n){r=n[o],o+=s;break}if(o+=s,e?0>o:o>=i)throw TypeError("Reduce of empty array with no initial value")}for(;e?o>=0:i>o;o+=s)o in n&&(r=t(r,n[o],o,this));return r}},W=function(e){return function(t){return e(this,t,arguments[1])}};o(o.P,"Array",{forEach:i.each=i.each||W(M(0)),map:W(M(1)),filter:W(M(2)),some:W(M(3)),every:W(M(4)),reduce:z(!1),reduceRight:z(!0),indexOf:W(T),lastIndexOf:function(e,t){var r=_(this),n=b(r.length),i=n-1;for(arguments.length>1&&(i=Math.min(i,y(t))),0>i&&(i=b(n+i));i>=0;i--)if(i in r&&r[i]===e)return i;return-1}}),o(o.S,"Date",{now:function(){return+new Date}});var j=function(e){return e>9?e:"0"+e};o(o.P+o.F*(d(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!d(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){if(!isFinite(this))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),r=e.getUTCMilliseconds(),n=0>t?"-":t>9999?"+":"";return n+("00000"+Math.abs(t)).slice(n?-6:-4)+"-"+j(e.getUTCMonth()+1)+"-"+j(e.getUTCDate())+"T"+j(e.getUTCHours())+":"+j(e.getUTCMinutes())+":"+j(e.getUTCSeconds())+"."+(r>99?r:"0"+j(r))+"Z"}})},function(e,t,r){var n=r(1);n(n.P,"Array",{copyWithin:r(237)}),r(48)("copyWithin")},function(e,t,r){var n=r(1);n(n.P,"Array",{fill:r(238)}),r(48)("fill")},function(e,t,r){"use strict";var n=r(1),i=r(71)(6),o="findIndex",s=!0;o in[]&&Array(1)[o](function(){s=!1}),n(n.P+n.F*s,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(48)(o)},function(e,t,r){"use strict";var n=r(1),i=r(71)(5),o="find",s=!0;o in[]&&Array(1)[o](function(){s=!1}),n(n.P+n.F*s,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(48)(o)},function(e,t,r){"use strict";var n=r(27),i=r(1),o=r(35),s=r(149),a=r(146),u=r(19),c=r(160);i(i.S+i.F*!r(96)(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,i,l,h=o(e),f="function"==typeof this?this:Array,d=arguments,p=d.length,m=p>1?d[1]:void 0,g=void 0!==m,v=0,_=c(h);if(g&&(m=n(m,p>2?d[2]:void 0,2)),void 0==_||f==Array&&a(_))for(t=u(h.length),r=new f(t);t>v;v++)r[v]=g?m(h[v],v):h[v];else for(l=_.call(h),r=new f;!(i=l.next()).done;v++)r[v]=g?s(l,m,[i.value,v],!0):i.value;return r.length=v,r}})},function(e,t,r){"use strict";var n=r(1);n(n.S+n.F*r(11)(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments,r=t.length,n=new("function"==typeof this?this:Array)(r);r>e;)n[e]=t[e++];return n.length=r,n}})},function(e,t,r){r(78)("Array")},function(e,t,r){"use strict";var n=r(3),i=r(6),o=r(9)("hasInstance"),s=Function.prototype;o in s||n.setDesc(s,o,{value:function(e){if("function"!=typeof this||!i(e))return!1;if(!i(this.prototype))return e instanceof this;for(;e=n.getProto(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,r){var n=r(3).setDesc,i=r(40),o=r(18),s=Function.prototype,a=/^\s*function ([^ (]*)/,u="name";u in s||r(22)&&n(s,u,{configurable:!0,get:function(){var e=(""+this).match(a),t=e?e[1]:"";return o(this,u)||n(this,u,i(5,t)),t}})},function(e,t,r){"use strict";var n=r(139);r(73)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(this,e);return t&&t.v},set:function(e,t){return n.def(this,0===e?0:e,t)}},n,!0)},function(e,t,r){var n=r(1),i=r(152),o=Math.sqrt,s=Math.acosh;n(n.S+n.F*!(s&&710==Math.floor(s(Number.MAX_VALUE))),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+o(e-1)*o(e+1))}})},function(e,t,r){function n(e){return isFinite(e=+e)&&0!=e?0>e?-n(-e):Math.log(e+Math.sqrt(e*e+1)):e}var i=r(1);i(i.S,"Math",{asinh:n})},function(e,t,r){var n=r(1);n(n.S,"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,r){var n=r(1),i=r(99);n(n.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t,r){var n=r(1);n(n.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,r){var n=r(1),i=Math.exp;n(n.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},function(e,t,r){var n=r(1);n(n.S,"Math",{expm1:r(98)})},function(e,t,r){var n=r(1),i=r(99),o=Math.pow,s=o(2,-52),a=o(2,-23),u=o(2,127)*(2-a),c=o(2,-126),l=function(e){return e+1/s-1/s};n(n.S,"Math",{fround:function(e){var t,r,n=Math.abs(e),o=i(e);return c>n?o*l(n/c/a)*c*a:(t=(1+a/s)*n,r=t-(t-n),r>u||r!=r?o*(1/0):o*r)}})},function(e,t,r){var n=r(1),i=Math.abs;n(n.S,"Math",{hypot:function(e,t){for(var r,n,o=0,s=0,a=arguments,u=a.length,c=0;u>s;)r=i(a[s++]),r>c?(n=c/r,o=o*n*n+1,c=r):r>0?(n=r/c,o+=n*n):o+=r;return c===1/0?1/0:c*Math.sqrt(o)}})},function(e,t,r){var n=r(1),i=Math.imul;n(n.S+n.F*r(11)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(e,t){var r=65535,n=+e,i=+t,o=r&n,s=r&i;return 0|o*s+((r&n>>>16)*s+o*(r&i>>>16)<<16>>>0)}})},function(e,t,r){var n=r(1);n(n.S,"Math",{log10:function(e){return Math.log(e)/Math.LN10}})},function(e,t,r){var n=r(1);n(n.S,"Math",{log1p:r(152)})},function(e,t,r){var n=r(1);n(n.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,r){var n=r(1);n(n.S,"Math",{sign:r(99)})},function(e,t,r){var n=r(1),i=r(98),o=Math.exp;n(n.S+n.F*r(11)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(o(e-1)-o(-e-1))*(Math.E/2)}})},function(e,t,r){var n=r(1),i=r(98),o=Math.exp;n(n.S,"Math",{tanh:function(e){var t=i(e=+e),r=i(-e);return t==1/0?1:r==1/0?-1:(t-r)/(o(e)+o(-e))}})},function(e,t,r){var n=r(1);n(n.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,r){"use strict";var n=r(3),i=r(10),o=r(18),s=r(33),a=r(248),u=r(11),c=r(80).trim,l="Number",h=i[l],f=h,d=h.prototype,p=s(n.create(d))==l,m="trim"in String.prototype,g=function(e){var t=a(e,!1);if("string"==typeof t&&t.length>2){t=m?t.trim():c(t,3);var r,n,i,o=t.charCodeAt(0);if(43===o||45===o){if(r=t.charCodeAt(2),88===r||120===r)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+t}for(var s,u=t.slice(2),l=0,h=u.length;h>l;l++)if(s=u.charCodeAt(l),48>s||s>i)return NaN;return parseInt(u,n)}}return+t};h(" 0o1")&&h("0b1")&&!h("+0x1")||(h=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof h&&(p?u(function(){d.valueOf.call(r)}):s(r)!=l)?new f(g(t)):g(t)},n.each.call(r(22)?n.getNames(f):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),function(e){o(f,e)&&!o(h,e)&&n.setDesc(h,e,n.getDesc(f,e))}),h.prototype=d,d.constructor=h,r(24)(i,l,h))},function(e,t,r){var n=r(1);n(n.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,r){var n=r(1),i=r(10).isFinite;n(n.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},function(e,t,r){var n=r(1);n(n.S,"Number",{isInteger:r(147)})},function(e,t,r){var n=r(1);n(n.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,r){var n=r(1),i=r(147),o=Math.abs;n(n.S,"Number",{isSafeInteger:function(e){return i(e)&&o(e)<=9007199254740991}})},function(e,t,r){var n=r(1);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,r){var n=r(1);n(n.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,r){var n=r(1);n(n.S,"Number",{parseFloat:parseFloat})},function(e,t,r){var n=r(1);n(n.S,"Number",{parseInt:parseInt})},function(e,t,r){var n=r(1);n(n.S+n.F,"Object",{assign:r(243)})},function(e,t,r){var n=r(6);r(23)("freeze",function(e){return function(t){return e&&n(t)?e(t):t}})},function(e,t,r){var n=r(25);r(23)("getOwnPropertyDescriptor",function(e){return function(t,r){return e(n(t),r)}})},function(e,t,r){r(23)("getOwnPropertyNames",function(){return r(144).get})},function(e,t,r){var n=r(35);r(23)("getPrototypeOf",function(e){return function(t){return e(n(t))}})},function(e,t,r){var n=r(6);r(23)("isExtensible",function(e){return function(t){return n(t)?e?e(t):!0:!1}})},function(e,t,r){var n=r(6);r(23)("isFrozen",function(e){return function(t){return n(t)?e?e(t):!1:!0}})},function(e,t,r){var n=r(6);r(23)("isSealed",function(e){return function(t){return n(t)?e?e(t):!1:!0}})},function(e,t,r){var n=r(1);n(n.S,"Object",{is:r(155)})},function(e,t,r){var n=r(35);r(23)("keys",function(e){return function(t){return e(n(t))}})},function(e,t,r){var n=r(6);r(23)("preventExtensions",function(e){return function(t){return e&&n(t)?e(t):t}})},function(e,t,r){var n=r(6);r(23)("seal",function(e){return function(t){return e&&n(t)?e(t):t}})},function(e,t,r){var n=r(1);n(n.S,"Object",{setPrototypeOf:r(100).set})},function(e,t,r){"use strict";var n=r(72),i={};i[r(9)("toStringTag")]="z",i+""!="[object z]"&&r(24)(Object.prototype,"toString",function(){return"[object "+n(this)+"]"},!0)},function(e,t,r){"use strict";var n,i=r(3),o=r(97),s=r(10),a=r(27),u=r(72),c=r(1),l=r(6),h=r(8),f=r(47),d=r(79),p=r(57),m=r(100).set,g=r(155),v=r(9)("species"),_=r(247),y=r(242),x="Promise",b=s.process,S="process"==u(b),E=s[x],M=function(e){
var t=new E(function(){});return e&&(t.constructor=Object),E.resolve(t)===t},T=function(){function e(t){var r=new E(t);return m(r,e.prototype),r}var t=!1;try{if(t=E&&E.resolve&&M(),m(e,E),e.prototype=i.create(E.prototype,{constructor:{value:e}}),e.resolve(5).then(function(){})instanceof e||(t=!1),t&&r(22)){var n=!1;E.resolve(i.setDesc({},"then",{get:function(){n=!0}})),t=n}}catch(o){t=!1}return t}(),P=function(e,t){return o&&e===E&&t===n?!0:g(e,t)},C=function(e){var t=h(e)[v];return void 0!=t?t:e},w=function(e){var t;return l(e)&&"function"==typeof(t=e.then)?t:!1},A=function(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=f(t),this.reject=f(r)},D=function(e){try{e()}catch(t){return{error:t}}},I=function(e,t){if(!e.n){e.n=!0;var r=e.c;y(function(){for(var n=e.v,i=1==e.s,o=0,a=function(t){var r,o,s=i?t.ok:t.fail,a=t.resolve,u=t.reject;try{s?(i||(e.h=!0),r=s===!0?n:s(n),r===t.promise?u(TypeError("Promise-chain cycle")):(o=w(r))?o.call(r,a,u):a(r)):u(n)}catch(c){u(c)}};r.length>o;)a(r[o++]);r.length=0,e.n=!1,t&&setTimeout(function(){var t,r,i=e.p;R(i)&&(S?b.emit("unhandledRejection",n,i):(t=s.onunhandledrejection)?t({promise:i,reason:n}):(r=s.console)&&r.error&&r.error("Unhandled promise rejection",n)),e.a=void 0},1)})}},R=function(e){var t,r=e._d,n=r.a||r.c,i=0;if(r.h)return!1;for(;n.length>i;)if(t=n[i++],t.fail||!R(t.promise))return!1;return!0},O=function(e){var t=this;t.d||(t.d=!0,t=t.r||t,t.v=e,t.s=2,t.a=t.c.slice(),I(t,!0))},L=function(e){var t,r=this;if(!r.d){r.d=!0,r=r.r||r;try{if(r.p===e)throw TypeError("Promise can't be resolved itself");(t=w(e))?y(function(){var n={r:r,d:!1};try{t.call(e,a(L,n,1),a(O,n,1))}catch(i){O.call(n,i)}}):(r.v=e,r.s=1,I(r,!1))}catch(n){O.call({r:r,d:!1},n)}}};T||(E=function(e){f(e);var t=this._d={p:d(this,E,x),c:[],a:void 0,s:0,d:!1,v:void 0,h:!1,n:!1};try{e(a(L,t,1),a(O,t,1))}catch(r){O.call(t,r)}},r(77)(E.prototype,{then:function(e,t){var r=new A(_(this,E)),n=r.promise,i=this._d;return r.ok="function"==typeof e?e:!0,r.fail="function"==typeof t&&t,i.c.push(r),i.a&&i.a.push(r),i.s&&I(i,!1),n},"catch":function(e){return this.then(void 0,e)}})),c(c.G+c.W+c.F*!T,{Promise:E}),r(59)(E,x),r(78)(x),n=r(34)[x],c(c.S+c.F*!T,x,{reject:function(e){var t=new A(this),r=t.reject;return r(e),t.promise}}),c(c.S+c.F*(!T||M(!0)),x,{resolve:function(e){if(e instanceof E&&P(e.constructor,this))return e;var t=new A(this),r=t.resolve;return r(e),t.promise}}),c(c.S+c.F*!(T&&r(96)(function(e){E.all(e)["catch"](function(){})})),x,{all:function(e){var t=C(this),r=new A(t),n=r.resolve,o=r.reject,s=[],a=D(function(){p(e,!1,s.push,s);var r=s.length,a=Array(r);r?i.each.call(s,function(e,i){var s=!1;t.resolve(e).then(function(e){s||(s=!0,a[i]=e,--r||n(a))},o)}):n(a)});return a&&o(a.error),r.promise},race:function(e){var t=C(this),r=new A(t),n=r.reject,i=D(function(){p(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i&&n(i.error),r.promise}})},function(e,t,r){var n=r(1),i=Function.apply;n(n.S,"Reflect",{apply:function(e,t,r){return i.call(e,t,r)}})},function(e,t,r){var n=r(3),i=r(1),o=r(47),s=r(8),a=r(6),u=Function.bind||r(34).Function.prototype.bind;i(i.S+i.F*r(11)(function(){function e(){}return!(Reflect.construct(function(){},[],e)instanceof e)}),"Reflect",{construct:function(e,t){o(e);var r=arguments.length<3?e:o(arguments[2]);if(e==r){if(void 0!=t)switch(s(t).length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var i=[null];return i.push.apply(i,t),new(u.apply(e,i))}var c=r.prototype,l=n.create(a(c)?c:Object.prototype),h=Function.apply.call(e,l,t);return a(h)?h:l}})},function(e,t,r){var n=r(3),i=r(1),o=r(8);i(i.S+i.F*r(11)(function(){Reflect.defineProperty(n.setDesc({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,r){o(e);try{return n.setDesc(e,t,r),!0}catch(i){return!1}}})},function(e,t,r){var n=r(1),i=r(3).getDesc,o=r(8);n(n.S,"Reflect",{deleteProperty:function(e,t){var r=i(o(e),t);return r&&!r.configurable?!1:delete e[t]}})},function(e,t,r){"use strict";var n=r(1),i=r(8),o=function(e){this._t=i(e),this._i=0;var t,r=this._k=[];for(t in e)r.push(t)};r(150)(o,"Object",function(){var e,t=this,r=t._k;do if(t._i>=r.length)return{value:void 0,done:!0};while(!((e=r[t._i++])in t._t));return{value:e,done:!1}}),n(n.S,"Reflect",{enumerate:function(e){return new o(e)}})},function(e,t,r){var n=r(3),i=r(1),o=r(8);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return n.getDesc(o(e),t)}})},function(e,t,r){var n=r(1),i=r(3).getProto,o=r(8);n(n.S,"Reflect",{getPrototypeOf:function(e){return i(o(e))}})},function(e,t,r){function n(e,t){var r,s,c=arguments.length<3?e:arguments[2];return u(e)===c?e[t]:(r=i.getDesc(e,t))?o(r,"value")?r.value:void 0!==r.get?r.get.call(c):void 0:a(s=i.getProto(e))?n(s,t,c):void 0}var i=r(3),o=r(18),s=r(1),a=r(6),u=r(8);s(s.S,"Reflect",{get:n})},function(e,t,r){var n=r(1);n(n.S,"Reflect",{has:function(e,t){return t in e}})},function(e,t,r){var n=r(1),i=r(8),o=Object.isExtensible;n(n.S,"Reflect",{isExtensible:function(e){return i(e),o?o(e):!0}})},function(e,t,r){var n=r(1);n(n.S,"Reflect",{ownKeys:r(154)})},function(e,t,r){var n=r(1),i=r(8),o=Object.preventExtensions;n(n.S,"Reflect",{preventExtensions:function(e){i(e);try{return o&&o(e),!0}catch(t){return!1}}})},function(e,t,r){var n=r(1),i=r(100);i&&n(n.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(r){return!1}}})},function(e,t,r){function n(e,t,r){var s,l,h=arguments.length<4?e:arguments[3],f=i.getDesc(u(e),t);if(!f){if(c(l=i.getProto(e)))return n(l,t,r,h);f=a(0)}return o(f,"value")?f.writable!==!1&&c(h)?(s=i.getDesc(h,t)||a(0),s.value=r,i.setDesc(h,t,s),!0):!1:void 0===f.set?!1:(f.set.call(h,r),!0)}var i=r(3),o=r(18),s=r(1),a=r(40),u=r(8),c=r(6);s(s.S,"Reflect",{set:n})},function(e,t,r){var n=r(3),i=r(10),o=r(148),s=r(143),a=i.RegExp,u=a,c=a.prototype,l=/a/g,h=/a/g,f=new a(l)!==l;!r(22)||f&&!r(11)(function(){return h[r(9)("match")]=!1,a(l)!=l||a(h)==h||"/a/i"!=a(l,"i")})||(a=function(e,t){var r=o(e),n=void 0===t;return this instanceof a||!r||e.constructor!==a||!n?f?new u(r&&!n?e.source:e,t):u((r=e instanceof a)?e.source:e,r&&n?s.call(e):t):e},n.each.call(n.getNames(u),function(e){e in a||n.setDesc(a,e,{configurable:!0,get:function(){return u[e]},set:function(t){u[e]=t}})}),c.constructor=a,a.prototype=c,r(24)(i,"RegExp",a)),r(78)("RegExp")},function(e,t,r){var n=r(3);r(22)&&"g"!=/./g.flags&&n.setDesc(RegExp.prototype,"flags",{configurable:!0,get:r(143)})},function(e,t,r){r(74)("match",1,function(e,t){return function(r){"use strict";var n=e(this),i=void 0==r?void 0:r[t];return void 0!==i?i.call(r,n):new RegExp(r)[t](String(n))}})},function(e,t,r){r(74)("replace",2,function(e,t,r){return function(n,i){"use strict";var o=e(this),s=void 0==n?void 0:n[t];return void 0!==s?s.call(n,o,i):r.call(String(o),n,i)}})},function(e,t,r){r(74)("search",1,function(e,t){return function(r){"use strict";var n=e(this),i=void 0==r?void 0:r[t];return void 0!==i?i.call(r,n):new RegExp(r)[t](String(n))}})},function(e,t,r){r(74)("split",2,function(e,t,r){return function(n,i){"use strict";var o=e(this),s=void 0==n?void 0:n[t];return void 0!==s?s.call(n,o,i):r.call(String(o),n,i)}})},function(e,t,r){"use strict";var n=r(139);r(73)("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return n.def(this,e=0===e?0:e,e)}},n)},function(e,t,r){"use strict";var n=r(1),i=r(101)(!1);n(n.P,"String",{codePointAt:function(e){return i(this,e)}})},function(e,t,r){"use strict";var n=r(1),i=r(19),o=r(102),s="endsWith",a=""[s];n(n.P+n.F*r(93)(s),"String",{endsWith:function(e){var t=o(this,e,s),r=arguments,n=r.length>1?r[1]:void 0,u=i(t.length),c=void 0===n?u:Math.min(i(n),u),l=String(e);return a?a.call(t,l,c):t.slice(c-l.length,c)===l}})},function(e,t,r){var n=r(1),i=r(60),o=String.fromCharCode,s=String.fromCodePoint;n(n.S+n.F*(!!s&&1!=s.length),"String",{fromCodePoint:function(e){for(var t,r=[],n=arguments,s=n.length,a=0;s>a;){if(t=+n[a++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");r.push(65536>t?o(t):o(((t-=65536)>>10)+55296,t%1024+56320))}return r.join("")}})},function(e,t,r){"use strict";var n=r(1),i=r(102),o="includes";n(n.P+n.F*r(93)(o),"String",{includes:function(e){return!!~i(this,e,o).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,r){"use strict";var n=r(101)(!0);r(95)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},function(e,t,r){var n=r(1),i=r(25),o=r(19);n(n.S,"String",{raw:function(e){for(var t=i(e.raw),r=o(t.length),n=arguments,s=n.length,a=[],u=0;r>u;)a.push(String(t[u++])),s>u&&a.push(String(n[u]));return a.join("")}})},function(e,t,r){var n=r(1);n(n.P,"String",{repeat:r(158)})},function(e,t,r){"use strict";var n=r(1),i=r(19),o=r(102),s="startsWith",a=""[s];n(n.P+n.F*r(93)(s),"String",{startsWith:function(e){var t=o(this,e,s),r=arguments,n=i(Math.min(r.length>1?r[1]:void 0,t.length)),u=String(e);return a?a.call(t,u,n):t.slice(n,n+u.length)===u}})},function(e,t,r){"use strict";r(80)("trim",function(e){return function(){return e(this,3)}})},function(e,t,r){"use strict";var n=r(3),i=r(10),o=r(18),s=r(22),a=r(1),u=r(24),c=r(11),l=r(156),h=r(59),f=r(49),d=r(9),p=r(241),m=r(144),g=r(240),v=r(94),_=r(8),y=r(25),x=r(40),b=n.getDesc,S=n.setDesc,E=n.create,M=m.get,T=i.Symbol,P=i.JSON,C=P&&P.stringify,w=!1,A=d("_hidden"),D=n.isEnum,I=l("symbol-registry"),R=l("symbols"),O="function"==typeof T,L=Object.prototype,F=s&&c(function(){return 7!=E(S({},"a",{get:function(){return S(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=b(L,t);n&&delete L[t],S(e,t,r),n&&e!==L&&S(L,t,n)}:S,V=function(e){var t=R[e]=E(T.prototype);return t._k=e,s&&w&&F(L,e,{configurable:!0,set:function(t){o(this,A)&&o(this[A],e)&&(this[A][e]=!1),F(this,e,x(1,t))}}),t},k=function(e){return"symbol"==typeof e},B=function(e,t,r){return r&&o(R,t)?(r.enumerable?(o(e,A)&&e[A][t]&&(e[A][t]=!1),r=E(r,{enumerable:x(0,!1)})):(o(e,A)||S(e,A,x(1,{})),e[A][t]=!0),F(e,t,r)):S(e,t,r)},N=function(e,t){_(e);for(var r,n=g(t=y(t)),i=0,o=n.length;o>i;)B(e,r=n[i++],t[r]);return e},U=function(e,t){return void 0===t?E(e):N(E(e),t)},z=function(e){var t=D.call(this,e);return t||!o(this,e)||!o(R,e)||o(this,A)&&this[A][e]?t:!0},W=function(e,t){var r=b(e=y(e),t);return!r||!o(R,t)||o(e,A)&&e[A][t]||(r.enumerable=!0),r},j=function(e){for(var t,r=M(y(e)),n=[],i=0;r.length>i;)o(R,t=r[i++])||t==A||n.push(t);return n},G=function(e){for(var t,r=M(y(e)),n=[],i=0;r.length>i;)o(R,t=r[i++])&&n.push(R[t]);return n},H=function(e){if(void 0!==e&&!k(e)){for(var t,r,n=[e],i=1,o=arguments;o.length>i;)n.push(o[i++]);return t=n[1],"function"==typeof t&&(r=t),(r||!v(t))&&(t=function(e,t){return r&&(t=r.call(this,e,t)),k(t)?void 0:t}),n[1]=t,C.apply(P,n)}},K=c(function(){var e=T();return"[null]"!=C([e])||"{}"!=C({a:e})||"{}"!=C(Object(e))});O||(T=function(){if(k(this))throw TypeError("Symbol is not a constructor");return V(f(arguments.length>0?arguments[0]:void 0))},u(T.prototype,"toString",function(){return this._k}),k=function(e){return e instanceof T},n.create=U,n.isEnum=z,n.getDesc=W,n.setDesc=B,n.setDescs=N,n.getNames=m.get=j,n.getSymbols=G,s&&!r(97)&&u(L,"propertyIsEnumerable",z,!0));var X={"for":function(e){return o(I,e+="")?I[e]:I[e]=T(e)},keyFor:function(e){return p(I,e)},useSetter:function(){w=!0},useSimple:function(){w=!1}};n.each.call("hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),function(e){var t=d(e);X[e]=O?t:V(t)}),w=!0,a(a.G+a.W,{Symbol:T}),a(a.S,"Symbol",X),a(a.S+a.F*!O,"Object",{create:U,defineProperty:B,defineProperties:N,getOwnPropertyDescriptor:W,getOwnPropertyNames:j,getOwnPropertySymbols:G}),P&&a(a.S+a.F*(!O||K),"JSON",{stringify:H}),h(T,"Symbol"),h(Math,"Math",!0),h(i.JSON,"JSON",!0)},function(e,t,r){"use strict";var n=r(3),i=r(24),o=r(141),s=r(6),a=r(18),u=o.frozenStore,c=o.WEAK,l=Object.isExtensible||s,h={},f=r(73)("WeakMap",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){if(s(e)){if(!l(e))return u(this).get(e);if(a(e,c))return e[c][this._i]}},set:function(e,t){return o.def(this,e,t)}},o,!0,!0);7!=(new f).set((Object.freeze||Object)(h),7).get(h)&&n.each.call(["delete","has","get","set"],function(e){var t=f.prototype,r=t[e];i(t,e,function(t,n){if(s(t)&&!l(t)){var i=u(this)[e](t,n);return"set"==e?this:i}return r.call(this,t,n)})})},function(e,t,r){"use strict";var n=r(141);r(73)("WeakSet",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return n.def(this,e,!0)}},n,!1,!0)},function(e,t,r){"use strict";var n=r(1),i=r(138)(!0);n(n.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r(48)("includes")},function(e,t,r){var n=r(1);n(n.P,"Map",{toJSON:r(140)("Map")})},function(e,t,r){var n=r(1),i=r(153)(!0);n(n.S,"Object",{entries:function(e){return i(e)}})},function(e,t,r){var n=r(3),i=r(1),o=r(154),s=r(25),a=r(40);i(i.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,r,i=s(e),u=n.setDesc,c=n.getDesc,l=o(i),h={},f=0;l.length>f;)r=c(i,t=l[f++]),t in h?u(h,t,a(0,r)):h[t]=r;return h}})},function(e,t,r){var n=r(1),i=r(153)(!1);n(n.S,"Object",{values:function(e){return i(e)}})},function(e,t,r){var n=r(1),i=r(246)(/[\\^$*+?.()|[\]{}]/g,"\\$&");n(n.S,"RegExp",{escape:function(e){return i(e)}})},function(e,t,r){var n=r(1);n(n.P,"Set",{toJSON:r(140)("Set")})},function(e,t,r){"use strict";var n=r(1),i=r(101)(!0);n(n.P,"String",{at:function(e){return i(this,e)}})},function(e,t,r){"use strict";var n=r(1),i=r(157);n(n.P,"String",{padLeft:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,r){"use strict";var n=r(1),i=r(157);n(n.P,"String",{padRight:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},function(e,t,r){"use strict";r(80)("trimLeft",function(e){return function(){return e(this,1)}})},function(e,t,r){"use strict";r(80)("trimRight",function(e){return function(){return e(this,2)}})},function(e,t,r){var n=r(3),i=r(1),o=r(27),s=r(34).Array||Array,a={},u=function(e,t){n.each.call(e.split(","),function(e){void 0==t&&e in s?a[e]=s[e]:e in[]&&(a[e]=o(Function.call,[][e],t))})};u("pop,reverse,shift,keys,values,entries",1),u("indexOf,every,some,forEach,map,filter,find,findIndex,includes",3),u("join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill"),i(i.S,"Array",a)},function(e,t,r){r(161);var n=r(10),i=r(29),o=r(58),s=r(9)("iterator"),a=n.NodeList,u=n.HTMLCollection,c=a&&a.prototype,l=u&&u.prototype,h=o.NodeList=o.HTMLCollection=o.Array;c&&!c[s]&&i(c,s,h),l&&!l[s]&&i(l,s,h)},function(e,t,r){var n=r(1),i=r(159);n(n.G+n.B,{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,r){var n=r(10),i=r(1),o=r(75),s=r(244),a=n.navigator,u=!!a&&/MSIE .\./.test(a.userAgent),c=function(e){return u?function(t,r){return e(o(s,[].slice.call(arguments,2),"function"==typeof t?t:Function(t)),r)}:e};i(i.G+i.B+i.F*u,{setTimeout:c(n.setTimeout),setInterval:c(n.setInterval)})},function(e,t,r){r(249),r(332),r(287),r(295),r(299),r(300),r(288),r(298),r(297),r(293),r(294),r(292),r(289),r(291),r(296),r(290),r(258),r(257),r(277),r(278),r(279),r(280),r(281),r(282),r(283),r(284),r(285),r(286),r(260),r(261),r(262),r(263),r(264),r(265),r(266),r(267),r(268),r(269),r(270),r(271),r(272),r(273),r(274),r(275),r(276),r(325),r(328),r(331),r(327),r(323),r(324),r(326),r(329),r(330),r(254),r(255),r(161),r(256),r(250),r(251),r(253),r(252),r(316),r(317),r(318),r(319),r(320),r(321),r(301),r(259),r(322),r(333),r(334),r(302),r(303),r(304),r(305),r(306),r(309),r(307),r(308),r(310),r(311),r(312),r(313),r(315),r(314),r(335),r(342),r(343),r(344),r(345),r(346),r(340),r(338),r(339),r(337),r(336),r(341),r(347),r(350),r(349),r(348),e.exports=r(34)},function(e,t){function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function n(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}var i="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();t=e.exports=i?r:n,t.supported=r,t.unsupported=n},function(e,t){function r(e){var t=[];for(var r in e)t.push(r);return t}t=e.exports="function"==typeof Object.keys?Object.keys:r,t.shim=r},function(e,t){"use strict";function r(e){return e.replace(n,function(e,t){return t.toUpperCase()})}var n=/-(.)/g;e.exports=r},function(e,t,r){"use strict";function n(e){return i(e.replace(o,"ms-"))}var i=r(354),o=/^-ms-/;e.exports=n},function(e,t,r){"use strict";function n(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"length"in e&&!("setInterval"in e)&&"number"!=typeof e.nodeType&&(Array.isArray(e)||"callee"in e||"item"in e)}function i(e){return n(e)?Array.isArray(e)?e.slice():o(e):[e]}var o=r(365);e.exports=i},function(e,t,r){"use strict";function n(e){var t=e.match(l);return t&&t[1].toLowerCase()}function i(e,t){var r=c;c?void 0:u(!1);var i=n(e),o=i&&a(i);if(o){r.innerHTML=o[1]+e+o[2];for(var l=o[0];l--;)r=r.lastChild}else r.innerHTML=e;var h=r.getElementsByTagName("script");h.length&&(t?void 0:u(!1),s(h).forEach(t));for(var f=s(r.childNodes);r.lastChild;)r.removeChild(r.lastChild);return f}var o=r(12),s=r(356),a=r(168),u=r(2),c=o.canUseDOM?document.createElement("div"):null,l=/^\s*<(\w+)/;e.exports=i},function(e,t){"use strict";function r(e){return e===window?{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}:{x:e.scrollLeft,y:e.scrollTop}}e.exports=r},function(e,t){"use strict";function r(e){return e.replace(n,"-$1").toLowerCase()}var n=/([A-Z])/g;e.exports=r},function(e,t,r){"use strict";function n(e){return i(e).replace(o,"-ms-")}var i=r(359),o=/^ms-/;e.exports=n},function(e,t){"use strict";function r(e){return!(!e||!("function"==typeof Node?e instanceof Node:"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName))}e.exports=r},function(e,t,r){"use strict";function n(e){return i(e)&&3==e.nodeType}var i=r(361);e.exports=n},function(e,t){"use strict";function r(e,t,r){if(!e)return null;var i={};for(var o in e)n.call(e,o)&&(i[o]=t.call(r,e[o],o,e));return i}var n=Object.prototype.hasOwnProperty;e.exports=r},function(e,t){"use strict";function r(e){var t={};return function(r){return t.hasOwnProperty(r)||(t[r]=e.call(this,r)),t[r]}}e.exports=r},function(e,t,r){"use strict";function n(e){var t=e.length;if(Array.isArray(e)||"object"!=typeof e&&"function"!=typeof e?i(!1):void 0,"number"!=typeof t?i(!1):void 0,0===t||t-1 in e?void 0:i(!1),e.hasOwnProperty)try{return Array.prototype.slice.call(e)}catch(r){}for(var n=Array(t),o=0;t>o;o++)n[o]=e[o];return n}var i=r(2);e.exports=n},function(e,t){"use strict";function r(e,t,r){function n(){s=!0,r.apply(this,arguments)}function i(){s||(e>o?t.call(this,o++,i,n):n.apply(this,arguments))}var o=0,s=!1;i()}t.__esModule=!0,t.loopAsync=r},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){function e(e){e=e||window.history.state||{};var t=l.getWindowPath(),r=e,n=r.key,i=void 0;n?i=h.readState(n):(i=null,n=y.createKey(),v&&window.history.replaceState(o({},e,{key:n}),null,t));var s=m["default"](t);return y.createLocation(o({},s,{state:i}),void 0,n)}function t(t){function r(t){void 0!==t.state&&n(e(t.state))}var n=t.transitionTo;return l.addEventListener(window,"popstate",r),function(){l.removeEventListener(window,"popstate",r)}}function r(e){var t=e.basename,r=e.pathname,n=e.search,i=e.hash,o=e.state,s=e.action,a=e.key;if(s!==u.POP){h.saveState(a,o);var c=(t||"")+r+n+i,l={key:a};if(s===u.PUSH){if(_)return window.location.href=c,!1;window.history.pushState(l,null,c)}else{if(_)return window.location.replace(c),!1;window.history.replaceState(l,null,c)}}}function n(e){1===++x&&(b=t(y));var r=y.listenBefore(e);return function(){r(),0===--x&&b()}}function i(e){1===++x&&(b=t(y));var r=y.listen(e);return function(){r(),0===--x&&b()}}function s(e){1===++x&&(b=t(y)),y.registerTransitionHook(e)}function f(e){y.unregisterTransitionHook(e),0===--x&&b()}var p=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];c.canUseDOM?void 0:a["default"](!1);var g=p.forceRefresh,v=l.supportsHistory(),_=!v||g,y=d["default"](o({},p,{getCurrentLocation:e,finishTransition:r,saveState:h.saveState})),x=0,b=void 0;return o({},y,{listenBefore:n,listen:i,registerTransitionHook:s,unregisterTransitionHook:f})}t.__esModule=!0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=r(14),a=n(s),u=r(50),c=r(82),l=r(105),h=r(170),f=r(171),d=n(f),p=r(41),m=n(p);t["default"]=i,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return"string"==typeof e&&"/"===e.charAt(0)}function o(){var e=g.getHashPath();return i(e)?!0:(g.replaceHashPath("/"+e),!1)}function s(e,t,r){return e+(-1===e.indexOf("?")?"?":"&")+(t+"="+r)}function a(e,t){return e.replace(new RegExp("[?&]?"+t+"=[a-zA-Z0-9]+"),"")}function u(e,t){var r=e.match(new RegExp("\\?.*?\\b"+t+"=(.+?)\\b"));return r&&r[1]}function c(){function e(){var e=g.getHashPath(),t=void 0,r=void 0;C?(t=u(e,C),e=a(e,C),t?r=v.readState(t):(r=null,t=w.createKey(),g.replaceHashPath(s(e,C,t)))):t=r=null;var n=b["default"](e);return w.createLocation(l({},n,{state:r}),void 0,t)}function t(t){function r(){o()&&n(e())}var n=t.transitionTo;return o(),g.addEventListener(window,"hashchange",r),function(){g.removeEventListener(window,"hashchange",r)}}function r(e){var t=e.basename,r=e.pathname,n=e.search,i=e.state,o=e.action,a=e.key;if(o!==p.POP){var u=(t||"")+r+n;C?(u=s(u,C,a),v.saveState(a,i)):e.key=e.state=null;var c=g.getHashPath();o===p.PUSH?c!==u&&(window.location.hash=u):c!==u&&g.replaceHashPath(u)}}function n(e){1===++A&&(D=t(w));var r=w.listenBefore(e);return function(){r(),0===--A&&D()}}function i(e){1===++A&&(D=t(w));var r=w.listen(e);return function(){r(),0===--A&&D()}}function c(e){w.push(e)}function h(e){w.replace(e)}function f(e){w.go(e)}function _(e){return"#"+w.createHref(e)}function x(e){1===++A&&(D=t(w)),w.registerTransitionHook(e)}function E(e){w.unregisterTransitionHook(e),0===--A&&D()}function M(e,t){w.pushState(e,t)}function T(e,t){w.replaceState(e,t)}var P=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];m.canUseDOM?void 0:d["default"](!1);var C=P.queryKey;(void 0===C||C)&&(C="string"==typeof C?C:S);var w=y["default"](l({},P,{getCurrentLocation:e,finishTransition:r,saveState:v.saveState})),A=0,D=void 0;g.supportsGoWithoutReloadUsingHash();return l({},w,{listenBefore:n,listen:i,push:c,replace:h,go:f,createHref:_,registerTransitionHook:x,unregisterTransitionHook:E,pushState:M,replaceState:T})}t.__esModule=!0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},h=r(17),f=(n(h),r(14)),d=n(f),p=r(50),m=r(82),g=r(105),v=r(170),_=r(171),y=n(_),x=r(41),b=n(x),S="_k";t["default"]=c,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=arguments.length<=0||void 0===arguments[0]?"/":arguments[0],t=arguments.length<=1||void 0===arguments[1]?s.POP:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=arguments.length<=3||void 0===arguments[3]?null:arguments[3];"string"==typeof e&&(e=u["default"](e)),"object"==typeof t&&(e=o({},e,{state:t}),t=r||s.POP,r=n);var i=e.pathname||"/",a=e.search||"",c=e.hash||"",l=e.state||null;return{pathname:i,search:a,hash:c,state:l,action:t,key:r}}t.__esModule=!0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=r(50),a=r(41),u=n(a);t["default"]=i,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return e.filter(function(e){return e.state}).reduce(function(e,t){return e[t.key]=t.state,e},{})}function o(){function e(e,t){v[e]=t}function t(e){return v[e]}function r(){var e=m[g],r=e.key,n=e.basename,i=e.pathname,o=e.search,a=(n||"")+i+(o||""),u=void 0;r?u=t(r):(u=null,r=h.createKey(),e.key=r);var c=p["default"](a);return h.createLocation(s({},c,{state:u}),void 0,r)}function n(e){var t=g+e;return t>=0&&t<m.length}function o(e){if(e){if(!n(e))return;g+=e;var t=r();h.transitionTo(s({},t,{action:l.POP}))}}function a(t){switch(t.action){case l.PUSH:g+=1,g<m.length&&m.splice(g),m.push(t),e(t.key,t.state);break;case l.REPLACE:m[g]=t,e(t.key,t.state)}}var u=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Array.isArray(u)?u={entries:u}:"string"==typeof u&&(u={entries:[u]});var h=f["default"](s({},u,{getCurrentLocation:r,finishTransition:a,saveState:e,go:o})),d=u,m=d.entries,g=d.current;"string"==typeof m?m=[m]:Array.isArray(m)||(m=["/"]),m=m.map(function(e){var t=h.createKey();return"string"==typeof e?{pathname:e,key:t}:"object"==typeof e&&e?s({},e,{key:t}):void c["default"](!1)}),null==g?g=m.length-1:g>=0&&g<m.length?void 0:c["default"](!1);var v=i(m);return h}t.__esModule=!0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(17),u=(n(a),r(14)),c=n(u),l=r(50),h=r(172),f=n(h),d=r(41),p=n(d);t["default"]=o,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function o(e){return function(){function t(e){return x&&null==e.basename&&(0===e.pathname.indexOf(x)?(e.pathname=e.pathname.substring(x.length),e.basename=x,""===e.pathname&&(e.pathname="/")):e.basename=""),e}function r(e){if(!x)return e;"string"==typeof e&&(e=d["default"](e));var t=e.pathname,r="/"===x.slice(-1)?x:x+"/",n="/"===t.charAt(0)?t.slice(1):t,i=r+n;return s({},e,{pathname:i})}function n(e){return S.listenBefore(function(r,n){c["default"](e,t(r),n)})}function o(e){return S.listen(function(r){e(t(r))})}function u(e){S.push(r(e))}function l(e){S.replace(r(e))}function f(e){return S.createPath(r(e))}function p(e){return S.createHref(r(e))}function g(){return t(S.createLocation.apply(S,arguments))}function v(e,t){"string"==typeof t&&(t=d["default"](t)),u(s({state:e},t))}function _(e,t){"string"==typeof t&&(t=d["default"](t)),l(s({state:e},t))}var y=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],x=y.basename,b=i(y,["basename"]),S=e(b);if(null==x&&a.canUseDOM){var E=document.getElementsByTagName("base")[0];E&&(x=h["default"](E.href))}return s({},S,{listenBefore:n,listen:o,push:u,replace:l,createPath:f,createHref:p,createLocation:g,pushState:m["default"](v,"pushState is deprecated; use push instead"),replaceState:m["default"](_,"replaceState is deprecated; use replace instead")})}}t.__esModule=!0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(82),u=r(107),c=n(u),l=r(173),h=n(l),f=r(41),d=n(f),p=r(106),m=n(p);t["default"]=o,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function o(e){return c.stringify(e).replace(/%20/g,"+")}function s(e){return function(){function t(e){if(null==e.query){var t=e.search;e.query=S(t.substring(1)),e[g]={search:t,searchBase:""}}return e}function r(e,t){var r,n=void 0;if(!t||""===(n=b(t)))return e;"string"==typeof e&&(e=d["default"](e));var i=e[g],o=void 0;o=i&&e.search===i.search?i.searchBase:e.search||"";var s=o+(o?"&":"?")+n;return a({},e,(r={search:s},r[g]={search:s,searchBase:o},r))}function n(e){return M.listenBefore(function(r,n){h["default"](e,t(r),n)})}function s(e){return M.listen(function(r){e(t(r))})}function u(e){M.push(r(e,e.query))}function c(e){M.replace(r(e,e.query))}function l(e,t){return M.createPath(r(e,t||e.query))}function f(e,t){return M.createHref(r(e,t||e.query))}function p(){return t(M.createLocation.apply(M,arguments))}function _(e,t,r){"string"==typeof t&&(t=d["default"](t)),u(a({state:e},t,{query:r}))}function y(e,t,r){"string"==typeof t&&(t=d["default"](t)),c(a({state:e},t,{query:r}))}var x=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=x.stringifyQuery,S=x.parseQueryString,E=i(x,["stringifyQuery","parseQueryString"]),M=e(E);return"function"!=typeof b&&(b=o),"function"!=typeof S&&(S=v),a({},M,{listenBefore:n,listen:s,push:u,replace:c,createPath:l,createHref:f,createLocation:p,pushState:m["default"](_,"pushState is deprecated; use push instead"),replaceState:m["default"](y,"replaceState is deprecated; use replace instead")})}}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=r(17),c=(n(u),r(424)),l=r(107),h=n(l),f=r(41),d=n(f),p=r(106),m=n(p),g="$searchBase",v=c.parse;t["default"]=s,e.exports=t["default"]},function(e,t,r){var n,i;!function(o){var s=function(e,t,r){if(!f(t)||p(t)||m(t))return t;var n,i=0,o=0;if(d(t))for(n=[],o=t.length;o>i;i++)n.push(s(e,t[i],r));else{n={};for(var a in t)t.hasOwnProperty(a)&&(n[e(a,r)]=s(e,t[a],r))}return n},a=function(e,t){return"undefined"==typeof t&&(t="_"),e.replace(/([a-z])([A-Z0-9])/g,"$1"+t+"$2")},u=function(e){return g(e)?e:(e=e.replace(/[\-_\s]+(.)?/g,function(e,t){return t?t.toUpperCase():""}),e.substr(0,1).toLowerCase()+e.substr(1))},c=function(e){var t=u(e);return t.substr(0,1).toUpperCase()+t.substr(1)},l=function(e,t){return a(e,t).toLowerCase()},h=Object.prototype.toString,f=function(e){return e===Object(e)},d=function(e){return"[object Array]"==h.call(e)},p=function(e){return"[object Date]"==h.call(e)},m=function(e){return"[object RegExp]"==h.call(e)},g=function(e){return e-=0,e===e},v={camelize:u,decamelize:l,pascalize:c,depascalize:l,camelizeKeys:function(e){return s(u,e)},decamelizeKeys:function(e,t){return s(l,e,t)},pascalizeKeys:function(e){return s(c,e)},depascalizeKeys:function(){return this.decamelizeKeys.apply(this,arguments)}};n=v,i="function"==typeof n?n.call(t,r,t,e):n,!(void 0!==i&&(e.exports=i))}(this)},function(e,t,r){r(525),e.exports=self.fetch.bind(self)},function(e,t){function r(e){var t=e?e.length:0;return t?e[t-1]:void 0}e.exports=r},function(e,t,r){var n=r(384),i=r(397),o=r(174),s=o(function(e){return i(n(e,!1,!0))});e.exports=s},function(e,t,r){(function(t){function n(e){var t=e?e.length:0;for(this.data={hash:a(null),set:new s};t--;)this.push(e[t])}var i=r(399),o=r(83),s=o(t,"Set"),a=o(Object,"create");n.prototype.push=i,e.exports=n}).call(t,function(){return this}())},function(e,t){function r(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}e.exports=r},function(e,t){function r(e,t){for(var r=-1,n=e.length;++r<n&&t(e[r],r,e)!==!1;);return e}e.exports=r},function(e,t){function r(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}e.exports=r},function(e,t){function r(e,t){for(var r=-1,n=e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}e.exports=r},function(e,t,r){function n(e,t,r){var n=typeof e;return"function"==n?void 0===t?e:s(e,t,r):null==e?a:"object"==n?i(e):void 0===t?u(e):o(e,t)}var i=r(390),o=r(391),s=r(109),a=r(182),u=r(419);e.exports=n},function(e,t){function r(e,t,r){r||(r={});for(var n=-1,i=t.length;++n<i;){var o=t[n];
r[o]=e[o]}return r}e.exports=r},function(e,t,r){function n(e,t,r,c){c||(c=[]);for(var l=-1,h=e.length;++l<h;){var f=e[l];u(f)&&a(f)&&(r||s(f)||o(f))?t?n(f,t,r,c):i(c,f):r||(c[c.length]=f)}return c}var i=r(380),o=r(64),s=r(30),a=r(51),u=r(37);e.exports=n},function(e,t,r){function n(e,t){return i(e,t,o)}var i=r(175),o=r(112);e.exports=n},function(e,t,r){function n(e,t){return i(e,t,o)}var i=r(175),o=r(84);e.exports=n},function(e,t,r){function n(e,t,r){if(t!==t)return i(e,r);for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}var i=r(409);e.exports=n},function(e,t,r){function n(e,t,r,n,f,m,g){var v=a(e),_=a(t),y=l,x=l;v||(y=p.call(e),y==c?y=h:y!=h&&(v=u(e))),_||(x=p.call(t),x==c?x=h:x!=h&&(_=u(t)));var b=y==h,S=x==h,E=y==x;if(E&&!v&&!b)return o(e,t,y);if(!f){var M=b&&d.call(e,"__wrapped__"),T=S&&d.call(t,"__wrapped__");if(M||T)return r(M?e.value():e,T?t.value():t,n,f,m,g)}if(!E)return!1;m||(m=[]),g||(g=[]);for(var P=m.length;P--;)if(m[P]==e)return g[P]==t;m.push(e),g.push(t);var C=(v?i:s)(e,t,r,n,f,m,g);return m.pop(),g.pop(),C}var i=r(404),o=r(405),s=r(406),a=r(30),u=r(111),c="[object Arguments]",l="[object Array]",h="[object Object]",f=Object.prototype,d=f.hasOwnProperty,p=f.toString;e.exports=n},function(e,t,r){function n(e,t,r){var n=t.length,s=n,a=!r;if(null==e)return!s;for(e=o(e);n--;){var u=t[n];if(a&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++n<s;){u=t[n];var c=u[0],l=e[c],h=u[1];if(a&&u[2]){if(void 0===l&&!(c in e))return!1}else{var f=r?r(l,h,c):void 0;if(!(void 0===f?i(h,l,r,!0):f))return!1}}return!0}var i=r(108),o=r(42);e.exports=n},function(e,t,r){function n(e){var t=o(e);if(1==t.length&&t[0][2]){var r=t[0][0],n=t[0][1];return function(e){return null==e?!1:e[r]===n&&(void 0!==n||r in s(e))}}return function(e){return i(e,t)}}var i=r(389),o=r(408),s=r(42);e.exports=n},function(e,t,r){function n(e,t){var r=a(e),n=u(e)&&c(t),d=e+"";return e=f(e),function(a){if(null==a)return!1;var u=d;if(a=h(a),(r||!n)&&!(u in a)){if(a=1==e.length?a:i(a,s(e,0,-1)),null==a)return!1;u=l(e),a=h(a)}return a[u]===t?void 0!==t||u in a:o(t,a[u],void 0,!0)}}var i=r(176),o=r(108),s=r(395),a=r(30),u=r(178),c=r(179),l=r(375),h=r(42),f=r(180);e.exports=n},function(e,t,r){function n(e,t,r,f,d){if(!u(e))return e;var p=a(t)&&(s(t)||l(t)),m=p?void 0:h(t);return i(m||t,function(i,s){if(m&&(s=i,i=t[s]),c(i))f||(f=[]),d||(d=[]),o(e,t,s,n,r,f,d);else{var a=e[s],u=r?r(a,i,s,e,t):void 0,l=void 0===u;l&&(u=i),void 0===u&&(!p||s in e)||!l&&(u===u?u===a:a!==a)||(e[s]=u)}}),e}var i=r(379),o=r(393),s=r(30),a=r(51),u=r(16),c=r(37),l=r(111),h=r(84);e.exports=n},function(e,t,r){function n(e,t,r,n,h,f,d){for(var p=f.length,m=t[r];p--;)if(f[p]==m)return void(e[r]=d[p]);var g=e[r],v=h?h(g,m,r,e,t):void 0,_=void 0===v;_&&(v=m,a(m)&&(s(m)||c(m))?v=s(g)?g:a(g)?i(g):[]:u(m)||o(m)?v=o(g)?l(g):u(g)?g:{}:_=!1),f.push(m),d.push(v),_?e[r]=n(v,m,h,f,d):(v===v?v!==g:g===g)&&(e[r]=v)}var i=r(378),o=r(64),s=r(30),a=r(51),u=r(415),c=r(111),l=r(416);e.exports=n},function(e,t,r){function n(e){var t=e+"";return e=o(e),function(r){return i(r,e,t)}}var i=r(176),o=r(180);e.exports=n},function(e,t){function r(e,t,r){var n=-1,i=e.length;t=null==t?0:+t||0,0>t&&(t=-t>i?0:i+t),r=void 0===r||r>i?i:+r||0,0>r&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o}e.exports=r},function(e,t){function r(e){return null==e?"":e+""}e.exports=r},function(e,t,r){function n(e,t){var r=-1,n=i,u=e.length,c=!0,l=c&&u>=a,h=l?s():null,f=[];h?(n=o,c=!1):(l=!1,h=t?[]:f);e:for(;++r<u;){var d=e[r],p=t?t(d,r,e):d;if(c&&d===d){for(var m=h.length;m--;)if(h[m]===p)continue e;t&&h.push(p),f.push(d)}else n(h,p,0)<0&&((t||l)&&h.push(p),f.push(d))}return f}var i=r(387),o=r(398),s=r(402),a=200;e.exports=n},function(e,t,r){function n(e,t){var r=e.data,n="string"==typeof t||i(t)?r.set.has(t):r.hash[t];return n?0:-1}var i=r(16);e.exports=n},function(e,t,r){function n(e){var t=this.data;"string"==typeof e||i(e)?t.set.add(e):t.hash[e]=!0}var i=r(16);e.exports=n},function(e,t,r){function n(e){return s(function(t,r){var n=-1,s=null==t?0:r.length,a=s>2?r[s-2]:void 0,u=s>2?r[2]:void 0,c=s>1?r[s-1]:void 0;for("function"==typeof a?(a=i(a,c,5),s-=2):(a="function"==typeof c?c:void 0,s-=a?1:0),u&&o(r[0],r[1],u)&&(a=3>s?void 0:a,s=1);++n<s;){var l=r[n];l&&e(t,l,a)}return t})}var i=r(109),o=r(410),s=r(174);e.exports=n},function(e,t,r){function n(e){return function(t,r,n){for(var o=i(t),s=n(t),a=s.length,u=e?a:-1;e?u--:++u<a;){var c=s[u];if(r(o[c],c,o)===!1)break}return t}}var i=r(42);e.exports=n},function(e,t,r){(function(t){function n(e){return a&&s?new i(e):null}var i=r(377),o=r(83),s=o(t,"Set"),a=o(Object,"create");e.exports=n}).call(t,function(){return this}())},function(e,t,r){function n(e){return function(t,r,n){var s={};return r=i(r,n,3),o(t,function(t,n,i){var o=r(t,n,i);n=e?o:n,t=e?t:o,s[n]=t}),s}}var i=r(382),o=r(386);e.exports=n},function(e,t,r){function n(e,t,r,n,o,s,a){var u=-1,c=e.length,l=t.length;if(c!=l&&!(o&&l>c))return!1;for(;++u<c;){var h=e[u],f=t[u],d=n?n(o?f:h,o?h:f,u):void 0;if(void 0!==d){if(d)continue;return!1}if(o){if(!i(t,function(e){return h===e||r(h,e,n,o,s,a)}))return!1}else if(h!==f&&!r(h,f,n,o,s,a))return!1}return!0}var i=r(381);e.exports=n},function(e,t){function r(e,t,r){switch(r){case n:case i:return+e==+t;case o:return e.name==t.name&&e.message==t.message;case s:return e!=+e?t!=+t:e==+t;case a:case u:return e==t+""}return!1}var n="[object Boolean]",i="[object Date]",o="[object Error]",s="[object Number]",a="[object RegExp]",u="[object String]";e.exports=r},function(e,t,r){function n(e,t,r,n,o,a,u){var c=i(e),l=c.length,h=i(t),f=h.length;if(l!=f&&!o)return!1;for(var d=l;d--;){var p=c[d];if(!(o?p in t:s.call(t,p)))return!1}for(var m=o;++d<l;){p=c[d];var g=e[p],v=t[p],_=n?n(o?v:g,o?g:v,p):void 0;if(!(void 0===_?r(g,v,n,o,a,u):_))return!1;m||(m="constructor"==p)}if(!m){var y=e.constructor,x=t.constructor;if(y!=x&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof x&&x instanceof x))return!1}return!0}var i=r(84),o=Object.prototype,s=o.hasOwnProperty;e.exports=n},function(e,t,r){var n=r(177),i=n("length");e.exports=i},function(e,t,r){function n(e){for(var t=o(e),r=t.length;r--;)t[r][2]=i(t[r][1]);return t}var i=r(179),o=r(418);e.exports=n},function(e,t){function r(e,t,r){for(var n=e.length,i=t+(r?0:-1);r?i--:++i<n;){var o=e[i];if(o!==o)return i}return-1}e.exports=r},function(e,t,r){function n(e,t,r){if(!s(r))return!1;var n=typeof t;if("number"==n?i(r)&&o(t,r.length):"string"==n&&t in r){var a=r[t];return e===e?e===a:a!==a}return!1}var i=r(51),o=r(110),s=r(16);e.exports=n},function(e,t,r){function n(e){for(var t=u(e),r=t.length,n=r&&e.length,c=!!n&&a(n)&&(o(e)||i(e)),h=-1,f=[];++h<r;){var d=t[h];(c&&s(d,n)||l.call(e,d))&&f.push(d)}return f}var i=r(64),o=r(30),s=r(110),a=r(63),u=r(112),c=Object.prototype,l=c.hasOwnProperty;e.exports=n},function(e,t,r){function n(e,t,r,n){r="function"==typeof r?o(r,n,3):void 0;var s=r?r(e,t):void 0;return void 0===s?i(e,t,r):!!s}var i=r(108),o=r(109);e.exports=n},function(e,t,r){function n(e){return i(e)&&a.call(e)==o}var i=r(16),o="[object Function]",s=Object.prototype,a=s.toString;e.exports=n},function(e,t,r){function n(e){return null==e?!1:i(e)?l.test(u.call(e)):o(e)&&s.test(e)}var i=r(413),o=r(37),s=/^\[object .+?Constructor\]$/,a=Object.prototype,u=Function.prototype.toString,c=a.hasOwnProperty,l=RegExp("^"+u.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=n},function(e,t,r){function n(e){var t;if(!s(e)||l.call(e)!=a||o(e)||!c.call(e,"constructor")&&(t=e.constructor,"function"==typeof t&&!(t instanceof t)))return!1;var r;return i(e,function(e,t){r=t}),void 0===r||c.call(e,r)}var i=r(385),o=r(64),s=r(37),a="[object Object]",u=Object.prototype,c=u.hasOwnProperty,l=u.toString;e.exports=n},function(e,t,r){function n(e){return i(e,o(e))}var i=r(383),o=r(112);e.exports=n},function(e,t,r){var n=r(403),i=n();e.exports=i},function(e,t,r){function n(e){e=o(e);for(var t=-1,r=i(e),n=r.length,s=Array(n);++t<n;){var a=r[t];s[t]=[a,e[a]]}return s}var i=r(84),o=r(42);e.exports=n},function(e,t,r){function n(e){return s(e)?i(e):o(e)}var i=r(177),o=r(394),s=r(178);e.exports=n},function(e,t){function r(){c=!1,s.length?u=s.concat(u):l=-1,u.length&&n()}function n(){if(!c){var e=setTimeout(r);c=!0;for(var t=u.length;t;){for(s=u,u=[];++l<t;)s&&s[l].run();l=-1,t=u.length}s=null,c=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function o(){}var s,a=e.exports={},u=[],c=!1,l=-1;a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new i(e,t)),1!==u.length||c||setTimeout(n,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=o,a.addListener=o,a.once=o,a.off=o,a.removeListener=o,a.removeAllListeners=o,a.emit=o,a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var n=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(r(this,e),!t||"string"!=typeof t)throw new Error("A string non-empty key is required");this._key=t;var i=n.idAttribute||"id";this._getId="function"==typeof i?i:function(e){return e[i]}}return e.prototype.getKey=function(){return this._key},e.prototype.getId=function(e){return this._getId(e)},e.prototype.define=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},e}();t["default"]=n,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var o=r(16),s=n(o),a=function(){function e(t){var r=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(i(this,e),!s["default"](t))throw new Error("ArraySchema requires item schema to be an object.");this._itemSchema=t,n.schemaAttribute&&!function(){var e=n.schemaAttribute;r._getSchema="function"==typeof e?e:function(t){return t[e]}}()}return e.prototype.getItemSchema=function(){return this._itemSchema},e.prototype.isPolymorphicSchema=function(){return!!this._getSchema},e.prototype.getSchemaKey=function(e){return this._getSchema(e)},e}();t["default"]=a,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,r){e[t]=r}function o(e,t,r,n){var o=n.assignEntity,s=void 0===o?i:o,a={};for(var u in e)if(e.hasOwnProperty(u)){var c=h(e[u],t[u],r,n);s.call(null,a,u,c)}return a}function s(e,t,r,n){return function(e){return h(e,t,r,n)}}function a(e,t,r,n){return function(i){var o=e.getSchemaKey(i),s=h(i,t[o],r,n);return{id:s,schema:o}}}function u(e,t,r,n){var i=t.isPolymorphicSchema(),o=t.getItemSchema(),u=i?a:s,c=u(t,o,r,n);return Array.isArray(e)?e.map(c):M["default"](e,c)}function c(e,t,r){for(var n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)&&!S["default"](e[n],t[n])?console.warn("When merging two "+r+', found unequal data in their "'+n+'" values. Using the earlier value.',e[n],t[n]):e[n]=t[n])}function l(e,t,r,n){var i=n.mergeIntoEntity,s=void 0===i?c:i,a=t.getKey(),u=t.getId(e);r.hasOwnProperty(a)||(r[a]={}),r[a].hasOwnProperty(u)||(r[a][u]={});var l=r[a][u],h=o(e,t,r,n);return s(l,h,a),u}function h(e,t,r,n){return x["default"](e)&&x["default"](t)?t instanceof g["default"]?l(e,t,r,n):t instanceof _["default"]?u(e,t,r,n):o(e,t,r,n):e}function f(e,t){return new _["default"](e,t)}function d(e,t){return new _["default"](e,t)}function p(e,t){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!x["default"](e)&&!Array.isArray(e))throw new Error("Normalize accepts an object or an array as its input.");if(!x["default"](t)||Array.isArray(t))throw new Error("Normalize accepts an object for schema.");var n={},i=h(e,t,n,r);return{entities:n,result:i}}t.__esModule=!0,t.arrayOf=f,t.valuesOf=d,t.normalize=p;var m=r(421),g=n(m),v=r(422),_=n(v),y=r(16),x=n(y),b=r(412),S=n(b),E=r(417),M=n(E);t.Schema=g["default"]},function(e,t,r){"use strict";var n=r(516);t.extract=function(e){return e.split("?")[1]||""},t.parse=function(e){return"string"!=typeof e?{}:(e=e.trim().replace(/^(\?|#|&)/,""),e?e.split("&").reduce(function(e,t){var r=t.replace(/\+/g," ").split("="),n=r.shift(),i=r.length>0?r.join("="):void 0;return n=decodeURIComponent(n),i=void 0===i?null:decodeURIComponent(i),e.hasOwnProperty(n)?Array.isArray(e[n])?e[n].push(i):e[n]=[e[n],i]:e[n]=i,e},{}):{})},t.stringify=function(e){return e?Object.keys(e).sort().map(function(t){var r=e[t];return void 0===r?"":null===r?t:Array.isArray(r)?r.sort().map(function(e){return n(t)+"="+n(e)}).join("&"):n(t)+"="+n(r)}).filter(function(e){return e.length>0}).join("&"):""}},function(e,t,r){"use strict";e.exports=r(194)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=s["default"](e),r=u["default"](e);return{Provider:t,connect:r}}t.__esModule=!0,t["default"]=i;var o=r(428),s=n(o),a=r(427),u=n(a);e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return e.displayName||e.name||"Component"}function a(e){var t=e.Component,r=e.PropTypes,n=h["default"](r);return function(r,a,l){function h(e,t){var r=e.getState(),n=C?M(r,t):M(r);return y["default"](m["default"](n),"`mapStateToProps` must return an object. Instead received %s.",n),n}function f(e,t){var r=e.dispatch,n=w?T(r,t):T(r);return y["default"](m["default"](n),"`mapDispatchToProps` must return an object. Instead received %s.",n),n}function p(e,t,r){var n=P(e,t,r);return y["default"](m["default"](n),"`mergeProps` must return an object. Instead received %s.",n),n}var g=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],_=Boolean(r),M=r||x,T=m["default"](a)?v["default"](a):a||b,P=l||S,C=M.length>1,w=T.length>1,A=g.pure,D=void 0===A?!0:A,I=E++;return function(r){var a=function(t){function a(e,r){i(this,a),t.call(this,e,r),this.version=I,this.store=e.store||r.store,y["default"](this.store,'Could not find "store" in either the context or '+('props of "'+this.constructor.displayName+'". ')+"Either wrap the root component in a <Provider>, "+('or explicitly pass "store" as a prop to "'+this.constructor.displayName+'".')),this.stateProps=h(this.store,e),this.dispatchProps=f(this.store,e),this.state={props:this.computeNextState()}}return o(a,t),a.prototype.shouldComponentUpdate=function(e,t){return!D||!d["default"](this.state.props,t.props)},u(a,null,[{key:"displayName",value:"Connect("+s(r)+")",enumerable:!0},{key:"WrappedComponent",value:r,enumerable:!0},{key:"contextTypes",value:{store:n},enumerable:!0},{key:"propTypes",value:{store:n},enumerable:!0}]),a.prototype.computeNextState=function(){var e=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0];return p(this.stateProps,this.dispatchProps,e)},a.prototype.updateStateProps=function(){var e=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0],t=h(this.store,e);return d["default"](t,this.stateProps)?!1:(this.stateProps=t,!0)},a.prototype.updateDispatchProps=function(){var e=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0],t=f(this.store,e);return d["default"](t,this.dispatchProps)?!1:(this.dispatchProps=t,!0)},a.prototype.updateState=function(){var e=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0],t=this.computeNextState(e);d["default"](t,this.state.props)||this.setState({props:t})},a.prototype.isSubscribed=function(){return"function"==typeof this.unsubscribe},a.prototype.trySubscribe=function(){_&&!this.unsubscribe&&(this.unsubscribe=this.store.subscribe(this.handleChange.bind(this)),this.handleChange())},a.prototype.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)},a.prototype.componentDidMount=function(){this.trySubscribe()},a.prototype.componentWillReceiveProps=function(e){d["default"](e,this.props)||(C&&this.updateStateProps(e),w&&this.updateDispatchProps(e),this.updateState(e))},a.prototype.componentWillUnmount=function(){this.tryUnsubscribe()},a.prototype.handleChange=function(){this.unsubscribe&&this.updateStateProps()&&this.updateState()},a.prototype.getWrappedInstance=function(){return this.refs.wrappedInstance},a.prototype.render=function(){return e.createElement(r,c({ref:"wrappedInstance"},this.state.props))},a}(t);return a}}}t.__esModule=!0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t["default"]=a;var l=r(183),h=n(l),f=r(430),d=n(f),p=r(429),m=n(p),g=r(431),v=n(g),_=r(14),y=n(_),x=function(){return{}},b=function(e){return{dispatch:e}},S=function(e,t,r){return c({},r,e,t)},E=0;e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=e.version;if("string"!=typeof t)return!0;var r=t.split("."),n=parseInt(r[0],10),i=parseInt(r[1],10);return 0===n&&13===i}function a(e){function t(){p||d||(p=!0,console.error("With React 0.14 and later versions, you no longer need to wrap <Provider> child into a function."))}function r(){!p&&d&&(p=!0,console.error("With React 0.13, you need to wrap <Provider> child into a function. This restriction will be removed with React 0.14."))}function n(){m||(m=!0,console.error("<Provider> does not support changing `store` on the fly. It is most likely that you see this error because you updated to Redux 2.x and React Redux 2.x which no longer hot reload reducers automatically. See https://github.com/rackt/react-redux/releases/tag/v2.0.0 for the migration instructions."))}var a=e.Component,c=e.PropTypes,h=e.Children,f=l["default"](c),d=s(e),p=!1,m=!1;return function(e){function s(t,r){i(this,s),e.call(this,t,r),this.store=t.store}return o(s,e),s.prototype.getChildContext=function(){return{store:this.store}},u(s,null,[{key:"childContextTypes",value:{store:f.isRequired},enumerable:!0},{key:"propTypes",value:{store:f.isRequired,children:(d?c.func:c.element).isRequired},enumerable:!0}]),s.prototype.componentWillReceiveProps=function(e){var t=this.store,r=e.store;t!==r&&n()},s.prototype.render=function(){var e=this.props.children;return"function"==typeof e?(t(),e=e()):r(),h.only(e)},s}(a)}t.__esModule=!0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t["default"]=a;var c=r(183),l=n(c);e.exports=t["default"]},function(e,t){"use strict";function r(e){if(!e||"object"!=typeof e)return!1;var t="function"==typeof e.constructor?Object.getPrototypeOf(e):Object.prototype;if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&n(r)===n(Object)}t.__esModule=!0,t["default"]=r;var n=function(e){return Function.prototype.toString.call(e)};e.exports=t["default"]},function(e,t){"use strict";function r(e,t){if(e===t)return!0;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var i=Object.prototype.hasOwnProperty,o=0;o<r.length;o++)if(!i.call(t,r[o])||e[r[o]]!==t[r[o]])return!1;return!0}t.__esModule=!0,t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return function(t){return i.bindActionCreators(e,t)}}t.__esModule=!0,t["default"]=n;var i=r(56);e.exports=t["default"]},function(e,t,r){"use strict";t.__esModule=!0;var n=r(43),i={contextTypes:{history:n.history},componentWillMount:function(){this.history=this.context.history}};t["default"]=i,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(7),u=n(a),c=r(184),l=n(c),h=function(e){function t(){i(this,t),e.apply(this,arguments)}return o(t,e),t.prototype.render=function(){return u["default"].createElement(l["default"],s({},this.props,{onlyActiveOnIndex:!0}))},t}(a.Component);t["default"]=h,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=r(17),a=(n(s),r(14)),u=n(a),c=r(7),l=n(c),h=r(185),f=n(h),d=r(43),p=l["default"].PropTypes,m=p.string,g=p.object,v=function(e){function t(){i(this,t),e.apply(this,arguments)}return o(t,e),t.prototype.render=function(){u["default"](!1)},t}(c.Component);v.propTypes={to:m.isRequired,query:g,state:g,onEnter:d.falsy,children:d.falsy},v.createRouteFromReactElement=function(e,t){t&&(t.indexRoute=f["default"].createRouteFromReactElement(e))},t["default"]=v,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=r(17),a=(n(s),r(14)),u=n(a),c=r(7),l=n(c),h=r(38),f=r(43),d=l["default"].PropTypes.func,p=function(e){function t(){i(this,t),e.apply(this,arguments)}return o(t,e),t.prototype.render=function(){u["default"](!1)},t}(c.Component);p.propTypes={path:f.falsy,component:f.component,components:f.components,getComponent:d,getComponents:d},p.createRouteFromReactElement=function(e,t){t&&(t.indexRoute=h.createRouteFromReactElement(e))},t["default"]=p,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),s=r(14),a=n(s),u=o["default"].PropTypes.object,c={contextTypes:{history:u.isRequired,route:u},propTypes:{route:u},componentDidMount:function(){this.routerWillLeave?void 0:a["default"](!1);var e=this.props.route||this.context.route;e?void 0:a["default"](!1),this._unlistenBeforeLeavingRoute=this.context.history.listenBeforeLeavingRoute(e,this.routerWillLeave)},componentWillUnmount:function(){this._unlistenBeforeLeavingRoute&&this._unlistenBeforeLeavingRoute()}};t["default"]=c,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=r(14),a=n(s),u=r(7),c=n(u),l=r(38),h=r(43),f=c["default"].PropTypes,d=f.string,p=f.func,m=function(e){function t(){i(this,t),e.apply(this,arguments)}return o(t,e),t.prototype.render=function(){a["default"](!1)},t}(u.Component);m.createRouteFromReactElement=l.createRouteFromReactElement,m.propTypes={path:d,component:h.component,components:h.components,getComponent:p,getComponents:p},t["default"]=m,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var i=r(7),o=n(i),s=o["default"].PropTypes.object,a={propTypes:{route:s.isRequired},childContextTypes:{route:s.isRequired},getChildContext:function(){return{route:this.props.route}}};t["default"]=a,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=r(17),c=(n(u),r(7)),l=n(c),h=r(368),f=n(h),d=r(38),p=r(186),m=n(p),g=r(114),v=n(g),_=r(43),y=l["default"].PropTypes,x=y.func,b=y.object,S=function(e){function t(r,n){o(this,t),e.call(this,r,n),this.state={location:null,routes:null,params:null,components:null}}return s(t,e),t.prototype.handleError=function(e){if(!this.props.onError)throw e;this.props.onError.call(this,e)},t.prototype.componentWillMount=function(){var e=this,t=this.props,r=t.history,n=t.children,i=t.routes,o=t.parseQueryString,s=t.stringifyQuery,a=r?function(){return r}:f["default"];this.history=v["default"](a)({routes:d.createRoutes(i||n),parseQueryString:o,stringifyQuery:s}),this._unlisten=this.history.listen(function(t,r){t?e.handleError(t):e.setState(r,e.props.onUpdate)})},t.prototype.componentWillReceiveProps=function(e){},t.prototype.componentWillUnmount=function(){this._unlisten&&this._unlisten()},t.prototype.render=function(){var e=this.state,r=e.location,n=e.routes,o=e.params,s=e.components,u=this.props,c=u.RoutingContext,h=u.createElement,f=i(u,["RoutingContext","createElement"]);return null==r?null:(Object.keys(t.propTypes).forEach(function(e){return delete f[e]}),l["default"].createElement(c,a({},f,{history:this.history,createElement:h,location:r,routes:n,params:o,components:s})))},t}(c.Component);S.propTypes={history:b,children:_.routes,routes:_.routes,RoutingContext:x.isRequired,createElement:x,onError:x,onUpdate:x,parseQueryString:x,stringifyQuery:x},S.defaultProps={RoutingContext:m["default"]},t["default"]=S,e.exports=t["default"]},function(e,t,r){"use strict";function n(e,t){return function(r,n,i){e.apply(t,arguments),e.length<3&&i()}}function i(e){return e.reduce(function(e,t){return t.onEnter&&e.push(n(t.onEnter,t)),e},[])}function o(e,t,r){function n(e,t,r){s={pathname:t,query:r,state:e}}var o=i(e);if(!o.length)return void r();var s=void 0;a.loopAsync(o.length,function(e,r,i){o[e](t,n,function(e){e||s?i(e,s):r()})},r)}function s(e){for(var t=0,r=e.length;r>t;++t)e[t].onLeave&&e[t].onLeave.call(e[t])}t.__esModule=!0,t.runEnterHooks=o,t.runLeaveHooks=s;var a=r(113)},function(e,t,r){"use strict";function n(e,t,r){if(!e.path)return!1;var n=o.getParamNames(e.path);return n.some(function(e){return t.params[e]!==r.params[e]})}function i(e,t){var r=e&&e.routes,i=t.routes,o=void 0,s=void 0;return r?(o=r.filter(function(r){return-1===i.indexOf(r)||n(r,e,t)}),o.reverse(),s=i.filter(function(e){return-1===r.indexOf(e)||-1!==o.indexOf(e)})):(o=[],s=i),{leaveRoutes:o,enterRoutes:s}}t.__esModule=!0;var o=r(65);t["default"]=i,e.exports=t["default"]},function(e,t,r){"use strict";function n(e,t,r){t.component||t.components?r(null,t.component||t.components):t.getComponent?t.getComponent(e,r):t.getComponents?t.getComponents(e,r):r()}function i(e,t){o.mapAsync(e.routes,function(t,r,i){n(e.location,t,i)},t)}t.__esModule=!0;var o=r(113);t["default"]=i,e.exports=t["default"]},function(e,t,r){"use strict";function n(e,t){var r={};if(!e.path)return r;var n=i.getParamNames(e.path);for(var o in t)t.hasOwnProperty(o)&&-1!==n.indexOf(o)&&(r[o]=t[o]);return r}t.__esModule=!0;var i=r(65);t["default"]=n,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var r=e.routes,n=e.location,i=e.parseQueryString,s=e.stringifyQuery,u=e.basename;n?void 0:a["default"](!1);var c=m({routes:f.createRoutes(r),parseQueryString:i,stringifyQuery:s,basename:u});"string"==typeof n&&(n=c.createLocation(n)),c.match(n,function(e,r,n){t(e,r,n&&o({},n,{history:c}))})}t.__esModule=!0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=r(14),a=n(s),u=r(370),c=n(u),l=r(371),h=n(l),f=r(38),d=r(114),p=n(d),m=p["default"](h["default"](c["default"]));t["default"]=i,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,r){e.childRoutes?r(null,e.childRoutes):e.getChildRoutes?e.getChildRoutes(t,function(e,t){r(e,!e&&d.createRoutes(t))}):r()}function o(e,t,r){e.indexRoute?r(null,e.indexRoute):e.getIndexRoute?e.getIndexRoute(t,function(e,t){r(e,!e&&d.createRoutes(t)[0])}):e.childRoutes?!function(){var n=e.childRoutes.filter(function(e){return!e.hasOwnProperty("path")});h.loopAsync(n.length,function(e,r,i){o(n[e],t,function(t,o){if(t||o){var s=[n[e]].concat(Array.isArray(o)?o:[o]);i(t,s)}else r()})},function(e,t){r(null,t)})}():r()}function s(e,t,r){return t.reduce(function(e,t,n){var i=r&&r[n];return Array.isArray(e[t])?e[t].push(i):t in e?e[t]=[e[t],i]:e[t]=i,e},e)}function a(e,t){return s({},e,t)}function u(e,t,r,n,s,u){var l=e.path||"";if("/"===l.charAt(0)&&(r=t.pathname,n=[],s=[]),null!==r){var h=f.matchPattern(l,r);if(r=h.remainingPathname,n=[].concat(n,h.paramNames),s=[].concat(s,h.paramValues),""===r&&e.path){var d=function(){var r={routes:[e],params:a(n,s)};return o(e,t,function(e,t){if(e)u(e);else{if(Array.isArray(t)){var n;(n=r.routes).push.apply(n,t)}else t&&r.routes.push(t);u(null,r)}}),{v:void 0}}();if("object"==typeof d)return d.v}}null!=r||e.childRoutes?i(e,t,function(i,o){i?u(i):o?c(o,t,function(t,r){t?u(t):r?(r.routes.unshift(e),u(null,r)):u()},r,n,s):u()}):u()}function c(e,t,r){var n=arguments.length<=3||void 0===arguments[3]?t.pathname:arguments[3],i=arguments.length<=4||void 0===arguments[4]?[]:arguments[4],o=arguments.length<=5||void 0===arguments[5]?[]:arguments[5];
return function(){h.loopAsync(e.length,function(r,s,a){u(e[r],t,n,i,o,function(e,t){e||t?a(e,t):s()})},r)}()}t.__esModule=!0;var l=r(17),h=(n(l),r(113)),f=r(65),d=r(38);t["default"]=c,e.exports=t["default"]},function(e,t,r){"use strict";var n=r(13),i=r(123),o=r(166),s={componentDidMount:function(){this.props.autoFocus&&o(i(this))}},a={Mixin:s,focusDOMComponent:function(){o(n.getNode(this._rootNodeID))}};e.exports=a},function(e,t,r){"use strict";function n(){var e=window.opera;return"object"==typeof e&&"function"==typeof e.version&&parseInt(e.version(),10)<=12}function i(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}function o(e){switch(e){case w.topCompositionStart:return A.compositionStart;case w.topCompositionEnd:return A.compositionEnd;case w.topCompositionUpdate:return A.compositionUpdate}}function s(e,t){return e===w.topKeyDown&&t.keyCode===b}function a(e,t){switch(e){case w.topKeyUp:return-1!==x.indexOf(t.keyCode);case w.topKeyDown:return t.keyCode!==b;case w.topKeyPress:case w.topMouseDown:case w.topBlur:return!0;default:return!1}}function u(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function c(e,t,r,n,i){var c,l;if(S?c=o(e):I?a(e,n)&&(c=A.compositionEnd):s(e,n)&&(c=A.compositionStart),!c)return null;T&&(I||c!==A.compositionStart?c===A.compositionEnd&&I&&(l=I.getData()):I=g.getPooled(t));var h=v.getPooled(c,r,n,i);if(l)h.data=l;else{var f=u(n);null!==f&&(h.data=f)}return p.accumulateTwoPhaseDispatches(h),h}function l(e,t){switch(e){case w.topCompositionEnd:return u(t);case w.topKeyPress:var r=t.which;return r!==P?null:(D=!0,C);case w.topTextInput:var n=t.data;return n===C&&D?null:n;default:return null}}function h(e,t){if(I){if(e===w.topCompositionEnd||a(e,t)){var r=I.getData();return g.release(I),I=null,r}return null}switch(e){case w.topPaste:return null;case w.topKeyPress:return t.which&&!i(t)?String.fromCharCode(t.which):null;case w.topCompositionEnd:return T?null:t.data;default:return null}}function f(e,t,r,n,i){var o;if(o=M?l(e,n):h(e,n),!o)return null;var s=_.getPooled(A.beforeInput,r,n,i);return s.data=o,p.accumulateTwoPhaseDispatches(s),s}var d=r(31),p=r(67),m=r(12),g=r(455),v=r(485),_=r(488),y=r(36),x=[9,13,27,32],b=229,S=m.canUseDOM&&"CompositionEvent"in window,E=null;m.canUseDOM&&"documentMode"in document&&(E=document.documentMode);var M=m.canUseDOM&&"TextEvent"in window&&!E&&!n(),T=m.canUseDOM&&(!S||E&&E>8&&11>=E),P=32,C=String.fromCharCode(P),w=d.topLevelTypes,A={beforeInput:{phasedRegistrationNames:{bubbled:y({onBeforeInput:null}),captured:y({onBeforeInputCapture:null})},dependencies:[w.topCompositionEnd,w.topKeyPress,w.topTextInput,w.topPaste]},compositionEnd:{phasedRegistrationNames:{bubbled:y({onCompositionEnd:null}),captured:y({onCompositionEndCapture:null})},dependencies:[w.topBlur,w.topCompositionEnd,w.topKeyDown,w.topKeyPress,w.topKeyUp,w.topMouseDown]},compositionStart:{phasedRegistrationNames:{bubbled:y({onCompositionStart:null}),captured:y({onCompositionStartCapture:null})},dependencies:[w.topBlur,w.topCompositionStart,w.topKeyDown,w.topKeyPress,w.topKeyUp,w.topMouseDown]},compositionUpdate:{phasedRegistrationNames:{bubbled:y({onCompositionUpdate:null}),captured:y({onCompositionUpdateCapture:null})},dependencies:[w.topBlur,w.topCompositionUpdate,w.topKeyDown,w.topKeyPress,w.topKeyUp,w.topMouseDown]}},D=!1,I=null,R={eventTypes:A,extractEvents:function(e,t,r,n,i){return[c(e,t,r,n,i),f(e,t,r,n,i)]}};e.exports=R},function(e,t,r){"use strict";var n=r(188),i=r(12),o=r(20),s=(r(355),r(493)),a=r(360),u=r(364),c=(r(4),u(function(e){return a(e)})),l=!1,h="cssFloat";if(i.canUseDOM){var f=document.createElement("div").style;try{f.font=""}catch(d){l=!0}void 0===document.documentElement.style.cssFloat&&(h="styleFloat")}var p={createMarkupForStyles:function(e){var t="";for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];null!=n&&(t+=c(r)+":",t+=s(r,n)+";")}return t||null},setValueForStyles:function(e,t){var r=e.style;for(var i in t)if(t.hasOwnProperty(i)){var o=s(i,t[i]);if("float"===i&&(i=h),o)r[i]=o;else{var a=l&&n.shorthandPropertyExpansions[i];if(a)for(var u in a)r[u]="";else r[i]=""}}}};o.measureMethods(p,"CSSPropertyOperations",{setValueForStyles:"setValueForStyles"}),e.exports=p},function(e,t,r){"use strict";function n(e){var t=e.nodeName&&e.nodeName.toLowerCase();return"select"===t||"input"===t&&"file"===e.type}function i(e){var t=E.getPooled(A.change,I,e,M(e));x.accumulateTwoPhaseDispatches(t),S.batchedUpdates(o,t)}function o(e){y.enqueueEvents(e),y.processEventQueue(!1)}function s(e,t){D=e,I=t,D.attachEvent("onchange",i)}function a(){D&&(D.detachEvent("onchange",i),D=null,I=null)}function u(e,t,r){return e===w.topChange?r:void 0}function c(e,t,r){e===w.topFocus?(a(),s(t,r)):e===w.topBlur&&a()}function l(e,t){D=e,I=t,R=e.value,O=Object.getOwnPropertyDescriptor(e.constructor.prototype,"value"),Object.defineProperty(D,"value",V),D.attachEvent("onpropertychange",f)}function h(){D&&(delete D.value,D.detachEvent("onpropertychange",f),D=null,I=null,R=null,O=null)}function f(e){if("value"===e.propertyName){var t=e.srcElement.value;t!==R&&(R=t,i(e))}}function d(e,t,r){return e===w.topInput?r:void 0}function p(e,t,r){e===w.topFocus?(h(),l(t,r)):e===w.topBlur&&h()}function m(e,t,r){return e!==w.topSelectionChange&&e!==w.topKeyUp&&e!==w.topKeyDown||!D||D.value===R?void 0:(R=D.value,I)}function g(e){return e.nodeName&&"input"===e.nodeName.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}function v(e,t,r){return e===w.topClick?r:void 0}var _=r(31),y=r(66),x=r(67),b=r(12),S=r(21),E=r(45),M=r(126),T=r(129),P=r(215),C=r(36),w=_.topLevelTypes,A={change:{phasedRegistrationNames:{bubbled:C({onChange:null}),captured:C({onChangeCapture:null})},dependencies:[w.topBlur,w.topChange,w.topClick,w.topFocus,w.topInput,w.topKeyDown,w.topKeyUp,w.topSelectionChange]}},D=null,I=null,R=null,O=null,L=!1;b.canUseDOM&&(L=T("change")&&(!("documentMode"in document)||document.documentMode>8));var F=!1;b.canUseDOM&&(F=T("input")&&(!("documentMode"in document)||document.documentMode>9));var V={get:function(){return O.get.call(this)},set:function(e){R=""+e,O.set.call(this,e)}},k={eventTypes:A,extractEvents:function(e,t,r,i,o){var s,a;if(n(t)?L?s=u:a=c:P(t)?F?s=d:(s=m,a=p):g(t)&&(s=v),s){var l=s(e,t,r);if(l){var h=E.getPooled(A.change,l,i,o);return h.type="change",x.accumulateTwoPhaseDispatches(h),h}}a&&a(e,t,r)}};e.exports=k},function(e,t){"use strict";var r=0,n={createReactRootIndex:function(){return r++}};e.exports=n},function(e,t,r){"use strict";function n(e){return e.substring(1,e.indexOf(" "))}var i=r(12),o=r(357),s=r(26),a=r(168),u=r(2),c=/^(<[^ \/>]+)/,l="data-danger-index",h={dangerouslyRenderMarkup:function(e){i.canUseDOM?void 0:u(!1);for(var t,r={},h=0;h<e.length;h++)e[h]?void 0:u(!1),t=n(e[h]),t=a(t)?t:"*",r[t]=r[t]||[],r[t][h]=e[h];var f=[],d=0;for(t in r)if(r.hasOwnProperty(t)){var p,m=r[t];for(p in m)if(m.hasOwnProperty(p)){var g=m[p];m[p]=g.replace(c,"$1 "+l+'="'+p+'" ')}for(var v=o(m.join(""),s),_=0;_<v.length;++_){var y=v[_];y.hasAttribute&&y.hasAttribute(l)&&(p=+y.getAttribute(l),y.removeAttribute(l),f.hasOwnProperty(p)?u(!1):void 0,f[p]=y,d+=1)}}return d!==f.length?u(!1):void 0,f.length!==e.length?u(!1):void 0,f},dangerouslyReplaceNodeWithMarkup:function(e,t){i.canUseDOM?void 0:u(!1),t?void 0:u(!1),"html"===e.tagName.toLowerCase()?u(!1):void 0;var r;r="string"==typeof t?o(t,s)[0]:t,e.parentNode.replaceChild(r,e)}};e.exports=h},function(e,t,r){"use strict";var n=r(36),i=[n({ResponderEventPlugin:null}),n({SimpleEventPlugin:null}),n({TapEventPlugin:null}),n({EnterLeaveEventPlugin:null}),n({ChangeEventPlugin:null}),n({SelectEventPlugin:null}),n({BeforeInputEventPlugin:null})];e.exports=i},function(e,t,r){"use strict";var n=r(31),i=r(67),o=r(88),s=r(13),a=r(36),u=n.topLevelTypes,c=s.getFirstReactDOM,l={mouseEnter:{registrationName:a({onMouseEnter:null}),dependencies:[u.topMouseOut,u.topMouseOver]},mouseLeave:{registrationName:a({onMouseLeave:null}),dependencies:[u.topMouseOut,u.topMouseOver]}},h=[null,null],f={eventTypes:l,extractEvents:function(e,t,r,n,a){if(e===u.topMouseOver&&(n.relatedTarget||n.fromElement))return null;if(e!==u.topMouseOut&&e!==u.topMouseOver)return null;var f;if(t.window===t)f=t;else{var d=t.ownerDocument;f=d?d.defaultView||d.parentWindow:window}var p,m,g="",v="";if(e===u.topMouseOut?(p=t,g=r,m=c(n.relatedTarget||n.toElement),m?v=s.getID(m):m=f,m=m||f):(p=f,m=t,v=r),p===m)return null;var _=o.getPooled(l.mouseLeave,g,n,a);_.type="mouseleave",_.target=p,_.relatedTarget=m;var y=o.getPooled(l.mouseEnter,v,n,a);return y.type="mouseenter",y.target=m,y.relatedTarget=p,i.accumulateEnterLeaveDispatches(_,y,g,v),h[0]=_,h[1]=y,h}};e.exports=f},function(e,t,r){"use strict";function n(e){return e===g.topMouseUp||e===g.topTouchEnd||e===g.topTouchCancel}function i(e){return e===g.topMouseMove||e===g.topTouchMove}function o(e){return e===g.topMouseDown||e===g.topTouchStart}function s(e,t,r,n){var i=e.type||"unknown-event";e.currentTarget=m.Mount.getNode(n),t?d.invokeGuardedCallbackWithCatch(i,r,e,n):d.invokeGuardedCallback(i,r,e,n),e.currentTarget=null}function a(e,t){var r=e._dispatchListeners,n=e._dispatchIDs;if(Array.isArray(r))for(var i=0;i<r.length&&!e.isPropagationStopped();i++)s(e,t,r[i],n[i]);else r&&s(e,t,r,n);e._dispatchListeners=null,e._dispatchIDs=null}function u(e){var t=e._dispatchListeners,r=e._dispatchIDs;if(Array.isArray(t)){for(var n=0;n<t.length&&!e.isPropagationStopped();n++)if(t[n](e,r[n]))return r[n]}else if(t&&t(e,r))return r;return null}function c(e){var t=u(e);return e._dispatchIDs=null,e._dispatchListeners=null,t}function l(e){var t=e._dispatchListeners,r=e._dispatchIDs;Array.isArray(t)?p(!1):void 0;var n=t?t(e,r):null;return e._dispatchListeners=null,e._dispatchIDs=null,n}function h(e){return!!e._dispatchListeners}var f=r(31),d=r(203),p=r(2),m=(r(4),{Mount:null,injectMount:function(e){m.Mount=e}}),g=f.topLevelTypes,v={isEndish:n,isMoveish:i,isStartish:o,executeDirectDispatch:l,executeDispatchesInOrder:a,executeDispatchesInOrderStopAtTrue:c,hasDispatches:h,getNode:function(e){return m.Mount.getNode(e)},getID:function(e){return m.Mount.getID(e)},injection:m};e.exports=v},function(e,t,r){"use strict";function n(e){this._root=e,this._startText=this.getText(),this._fallbackText=null}var i=r(39),o=r(5),s=r(214);o(n.prototype,{destructor:function(){this._root=null,this._startText=null,this._fallbackText=null},getText:function(){return"value"in this._root?this._root.value:this._root[s()]},getData:function(){if(this._fallbackText)return this._fallbackText;var e,t,r=this._startText,n=r.length,i=this.getText(),o=i.length;for(e=0;n>e&&r[e]===i[e];e++);var s=n-e;for(t=1;s>=t&&r[n-t]===i[o-t];t++);var a=t>1?1-t:void 0;return this._fallbackText=i.slice(e,a),this._fallbackText}}),i.addPoolingTo(n),e.exports=n},function(e,t,r){"use strict";var n,i=r(54),o=r(12),s=i.injection.MUST_USE_ATTRIBUTE,a=i.injection.MUST_USE_PROPERTY,u=i.injection.HAS_BOOLEAN_VALUE,c=i.injection.HAS_SIDE_EFFECTS,l=i.injection.HAS_NUMERIC_VALUE,h=i.injection.HAS_POSITIVE_NUMERIC_VALUE,f=i.injection.HAS_OVERLOADED_BOOLEAN_VALUE;if(o.canUseDOM){var d=document.implementation;n=d&&d.hasFeature&&d.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")}var p={isCustomAttribute:RegExp.prototype.test.bind(/^(data|aria)-[a-z_][a-z\d_.\-]*$/),Properties:{accept:null,acceptCharset:null,accessKey:null,action:null,allowFullScreen:s|u,allowTransparency:s,alt:null,async:u,autoComplete:null,autoPlay:u,capture:s|u,cellPadding:null,cellSpacing:null,charSet:s,challenge:s,checked:a|u,classID:s,className:n?s:a,cols:s|h,colSpan:null,content:null,contentEditable:null,contextMenu:s,controls:a|u,coords:null,crossOrigin:null,data:null,dateTime:s,"default":u,defer:u,dir:null,disabled:s|u,download:f,draggable:null,encType:null,form:s,formAction:s,formEncType:s,formMethod:s,formNoValidate:u,formTarget:s,frameBorder:s,headers:null,height:s,hidden:s|u,high:null,href:null,hrefLang:null,htmlFor:null,httpEquiv:null,icon:null,id:a,inputMode:s,integrity:null,is:s,keyParams:s,keyType:s,kind:null,label:null,lang:null,list:s,loop:a|u,low:null,manifest:s,marginHeight:null,marginWidth:null,max:null,maxLength:s,media:s,mediaGroup:null,method:null,min:null,minLength:s,multiple:a|u,muted:a|u,name:null,nonce:s,noValidate:u,open:u,optimum:null,pattern:null,placeholder:null,poster:null,preload:null,radioGroup:null,readOnly:a|u,rel:null,required:u,reversed:u,role:s,rows:s|h,rowSpan:null,sandbox:null,scope:null,scoped:u,scrolling:null,seamless:s|u,selected:a|u,shape:null,size:s|h,sizes:s,span:h,spellCheck:null,src:null,srcDoc:a,srcLang:null,srcSet:s,start:l,step:null,style:null,summary:null,tabIndex:null,target:null,title:null,type:null,useMap:null,value:a|c,width:s,wmode:s,wrap:null,about:s,datatype:s,inlist:s,prefix:s,property:s,resource:s,"typeof":s,vocab:s,autoCapitalize:s,autoCorrect:s,autoSave:null,color:null,itemProp:s,itemScope:s|u,itemType:s,itemID:s,itemRef:s,results:null,security:s,unselectable:s},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{autoComplete:"autocomplete",autoFocus:"autofocus",autoPlay:"autoplay",autoSave:"autosave",encType:"encoding",hrefLang:"hreflang",radioGroup:"radiogroup",spellCheck:"spellcheck",srcDoc:"srcdoc",srcSet:"srcset"}};e.exports=p},function(e,t,r){"use strict";var n=r(194),i=r(467),o=r(472),s=r(5),a=r(494),u={};s(u,o),s(u,{findDOMNode:a("findDOMNode","ReactDOM","react-dom",n,n.findDOMNode),render:a("render","ReactDOM","react-dom",n,n.render),unmountComponentAtNode:a("unmountComponentAtNode","ReactDOM","react-dom",n,n.unmountComponentAtNode),renderToString:a("renderToString","ReactDOMServer","react-dom/server",i,i.renderToString),renderToStaticMarkup:a("renderToStaticMarkup","ReactDOMServer","react-dom/server",i,i.renderToStaticMarkup)}),u.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=n,u.__SECRET_DOM_SERVER_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=i,e.exports=u},function(e,t,r){"use strict";var n=(r(68),r(123)),i=(r(4),"_getDOMNodeDidWarn"),o={getDOMNode:function(){return this.constructor[i]=!0,n(this)}};e.exports=o},function(e,t,r){"use strict";function n(e,t,r){var n=void 0===e[r];null!=t&&n&&(e[r]=o(t,null))}var i=r(44),o=r(128),s=r(131),a=r(132),u=(r(4),{instantiateChildren:function(e,t,r){if(null==e)return null;var i={};return a(e,n,i),i},updateChildren:function(e,t,r,n){if(!t&&!e)return null;var a;for(a in t)if(t.hasOwnProperty(a)){var u=e&&e[a],c=u&&u._currentElement,l=t[a];if(null!=u&&s(c,l))i.receiveComponent(u,l,r,n),t[a]=u;else{u&&i.unmountComponent(u,a);var h=o(l,null);t[a]=h}}for(a in e)!e.hasOwnProperty(a)||t&&t.hasOwnProperty(a)||i.unmountComponent(e[a]);return t},unmountChildren:function(e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];i.unmountComponent(r)}}});e.exports=u},function(e,t,r){"use strict";function n(e){var t=e._currentElement._owner||null;if(t){var r=t.getName();if(r)return" Check the render method of `"+r+"`."}return""}function i(e){}var o=r(119),s=r(32),a=r(15),u=r(68),c=r(20),l=r(87),h=(r(86),r(44)),f=r(121),d=r(5),p=r(62),m=r(2),g=r(131);r(4);i.prototype.render=function(){var e=u.get(this)._currentElement.type;return e(this.props,this.context,this.updater)};var v=1,_={construct:function(e){this._currentElement=e,this._rootNodeID=null,this._instance=null,this._pendingElement=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._renderedComponent=null,this._context=null,this._mountOrder=0,this._topLevelWrapper=null,this._pendingCallbacks=null},mountComponent:function(e,t,r){this._context=r,this._mountOrder=v++,this._rootNodeID=e;var n,o,s=this._processProps(this._currentElement.props),c=this._processContext(r),l=this._currentElement.type,d="prototype"in l;d&&(n=new l(s,c,f)),(!d||null===n||n===!1||a.isValidElement(n))&&(o=n,n=new i(l)),n.props=s,n.context=c,n.refs=p,n.updater=f,this._instance=n,u.set(n,this);var g=n.state;void 0===g&&(n.state=g=null),"object"!=typeof g||Array.isArray(g)?m(!1):void 0,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,n.componentWillMount&&(n.componentWillMount(),this._pendingStateQueue&&(n.state=this._processPendingState(n.props,n.context))),void 0===o&&(o=this._renderValidatedComponent()),this._renderedComponent=this._instantiateReactComponent(o);var _=h.mountComponent(this._renderedComponent,e,t,this._processChildContext(r));return n.componentDidMount&&t.getReactMountReady().enqueue(n.componentDidMount,n),_},unmountComponent:function(){var e=this._instance;e.componentWillUnmount&&e.componentWillUnmount(),h.unmountComponent(this._renderedComponent),this._renderedComponent=null,this._instance=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._pendingCallbacks=null,this._pendingElement=null,this._context=null,this._rootNodeID=null,this._topLevelWrapper=null,u.remove(e)},_maskContext:function(e){var t=null,r=this._currentElement.type,n=r.contextTypes;if(!n)return p;t={};for(var i in n)t[i]=e[i];return t},_processContext:function(e){var t=this._maskContext(e);return t},_processChildContext:function(e){var t=this._currentElement.type,r=this._instance,n=r.getChildContext&&r.getChildContext();if(n){"object"!=typeof t.childContextTypes?m(!1):void 0;for(var i in n)i in t.childContextTypes?void 0:m(!1);return d({},e,n)}return e},_processProps:function(e){return e},_checkPropTypes:function(e,t,r){var i=this.getName();for(var o in e)if(e.hasOwnProperty(o)){var s;try{"function"!=typeof e[o]?m(!1):void 0,s=e[o](t,o,i,r)}catch(a){s=a}if(s instanceof Error){n(this);r===l.prop}}},receiveComponent:function(e,t,r){var n=this._currentElement,i=this._context;this._pendingElement=null,this.updateComponent(t,n,e,i,r)},performUpdateIfNecessary:function(e){null!=this._pendingElement&&h.receiveComponent(this,this._pendingElement||this._currentElement,e,this._context),(null!==this._pendingStateQueue||this._pendingForceUpdate)&&this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context)},updateComponent:function(e,t,r,n,i){var o,s=this._instance,a=this._context===i?s.context:this._processContext(i);t===r?o=r.props:(o=this._processProps(r.props),s.componentWillReceiveProps&&s.componentWillReceiveProps(o,a));var u=this._processPendingState(o,a),c=this._pendingForceUpdate||!s.shouldComponentUpdate||s.shouldComponentUpdate(o,u,a);c?(this._pendingForceUpdate=!1,this._performComponentUpdate(r,o,u,a,e,i)):(this._currentElement=r,this._context=i,s.props=o,s.state=u,s.context=a)},_processPendingState:function(e,t){var r=this._instance,n=this._pendingStateQueue,i=this._pendingReplaceState;if(this._pendingReplaceState=!1,this._pendingStateQueue=null,!n)return r.state;if(i&&1===n.length)return n[0];for(var o=d({},i?n[0]:r.state),s=i?1:0;s<n.length;s++){var a=n[s];d(o,"function"==typeof a?a.call(r,o,e,t):a)}return o},_performComponentUpdate:function(e,t,r,n,i,o){var s,a,u,c=this._instance,l=Boolean(c.componentDidUpdate);l&&(s=c.props,a=c.state,u=c.context),c.componentWillUpdate&&c.componentWillUpdate(t,r,n),this._currentElement=e,this._context=o,c.props=t,c.state=r,c.context=n,this._updateRenderedComponent(i,o),l&&i.getReactMountReady().enqueue(c.componentDidUpdate.bind(c,s,a,u),c)},_updateRenderedComponent:function(e,t){var r=this._renderedComponent,n=r._currentElement,i=this._renderValidatedComponent();if(g(n,i))h.receiveComponent(r,i,e,this._processChildContext(t));else{var o=this._rootNodeID,s=r._rootNodeID;h.unmountComponent(r),this._renderedComponent=this._instantiateReactComponent(i);var a=h.mountComponent(this._renderedComponent,o,e,this._processChildContext(t));this._replaceNodeWithMarkupByID(s,a)}},_replaceNodeWithMarkupByID:function(e,t){o.replaceNodeWithMarkupByID(e,t)},_renderValidatedComponentWithoutOwnerOrContext:function(){var e=this._instance,t=e.render();return t},_renderValidatedComponent:function(){var e;s.current=this;try{e=this._renderValidatedComponentWithoutOwnerOrContext()}finally{s.current=null}return null===e||e===!1||a.isValidElement(e)?void 0:m(!1),e},attachRef:function(e,t){var r=this.getPublicInstance();null==r?m(!1):void 0;var n=t.getPublicInstance(),i=r.refs===p?r.refs={}:r.refs;i[e]=n},detachRef:function(e){var t=this.getPublicInstance().refs;delete t[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){var e=this._instance;return e instanceof i?null:e},_instantiateReactComponent:null};c.measureMethods(_,"ReactCompositeComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent",_renderValidatedComponent:"_renderValidatedComponent"});var y={Mixin:_};e.exports=y},function(e,t){"use strict";var r={onClick:!0,onDoubleClick:!0,onMouseDown:!0,onMouseMove:!0,onMouseUp:!0,onClickCapture:!0,onDoubleClickCapture:!0,onMouseDownCapture:!0,onMouseMoveCapture:!0,onMouseUpCapture:!0},n={getNativeProps:function(e,t,n){if(!t.disabled)return t;var i={};for(var o in t)t.hasOwnProperty(o)&&!r[o]&&(i[o]=t[o]);return i}};e.exports=n},function(e,t,r){"use strict";function n(){return this}function i(){var e=this._reactInternalComponent;return!!e}function o(){}function s(e,t){var r=this._reactInternalComponent;r&&(R.enqueueSetPropsInternal(r,e),t&&R.enqueueCallbackInternal(r,t))}function a(e,t){var r=this._reactInternalComponent;r&&(R.enqueueReplacePropsInternal(r,e),t&&R.enqueueCallbackInternal(r,t))}function u(e,t){t&&(null!=t.dangerouslySetInnerHTML&&(null!=t.children?V(!1):void 0,"object"==typeof t.dangerouslySetInnerHTML&&K in t.dangerouslySetInnerHTML?void 0:V(!1)),null!=t.style&&"object"!=typeof t.style?V(!1):void 0)}function c(e,t,r,n){var i=A.findReactContainerForID(e);if(i){var o=i.nodeType===X?i.ownerDocument:i;z(t,o)}n.getReactMountReady().enqueue(l,{id:e,registrationName:t,listener:r})}function l(){var e=this;S.putListener(e.id,e.registrationName,e.listener)}function h(){var e=this;e._rootNodeID?void 0:V(!1);var t=A.getNode(e._rootNodeID);switch(t?void 0:V(!1),e._tag){case"iframe":e._wrapperState.listeners=[S.trapBubbledEvent(b.topLevelTypes.topLoad,"load",t)];break;case"video":case"audio":e._wrapperState.listeners=[];for(var r in Y)Y.hasOwnProperty(r)&&e._wrapperState.listeners.push(S.trapBubbledEvent(b.topLevelTypes[r],Y[r],t));break;case"img":e._wrapperState.listeners=[S.trapBubbledEvent(b.topLevelTypes.topError,"error",t),S.trapBubbledEvent(b.topLevelTypes.topLoad,"load",t)];break;case"form":e._wrapperState.listeners=[S.trapBubbledEvent(b.topLevelTypes.topReset,"reset",t),S.trapBubbledEvent(b.topLevelTypes.topSubmit,"submit",t)]}}function f(){T.mountReadyWrapper(this)}function d(){C.postUpdateWrapper(this)}function p(e){$.call(J,e)||(Q.test(e)?void 0:V(!1),J[e]=!0)}function m(e,t){return e.indexOf("-")>=0||null!=t.is}function g(e){p(e),this._tag=e.toLowerCase(),this._renderedChildren=null,this._previousStyle=null,this._previousStyleCopy=null,this._rootNodeID=null,this._wrapperState=null,this._topLevelWrapper=null,this._nodeWithLegacyProperties=null}var v=r(446),_=r(448),y=r(54),x=r(116),b=r(31),S=r(85),E=r(118),M=r(461),T=r(464),P=r(465),C=r(196),w=r(468),A=r(13),D=r(473),I=r(20),R=r(121),O=r(5),L=r(90),F=r(91),V=r(2),k=(r(129),r(36)),B=r(92),N=r(130),U=(r(169),r(133),r(4),S.deleteListener),z=S.listenTo,W=S.registrationNameModules,j={string:!0,number:!0},G=k({children:null}),H=k({style:null}),K=k({__html:null}),X=1,Y={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"},q={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},Z={listing:!0,pre:!0,textarea:!0},Q=(O({menuitem:!0},q),/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/),J={},$={}.hasOwnProperty;g.displayName="ReactDOMComponent",g.Mixin={construct:function(e){this._currentElement=e},mountComponent:function(e,t,r){this._rootNodeID=e;var n=this._currentElement.props;switch(this._tag){case"iframe":case"img":case"form":case"video":case"audio":this._wrapperState={listeners:null},t.getReactMountReady().enqueue(h,this);break;case"button":n=M.getNativeProps(this,n,r);break;case"input":T.mountWrapper(this,n,r),n=T.getNativeProps(this,n,r);break;case"option":P.mountWrapper(this,n,r),n=P.getNativeProps(this,n,r);break;case"select":C.mountWrapper(this,n,r),n=C.getNativeProps(this,n,r),r=C.processChildContext(this,n,r);break;case"textarea":w.mountWrapper(this,n,r),n=w.getNativeProps(this,n,r)}u(this,n);var i;if(t.useCreateElement){var o=r[A.ownerDocumentContextKey],s=o.createElement(this._currentElement.type);x.setAttributeForID(s,this._rootNodeID),A.getID(s),this._updateDOMProperties({},n,t,s),this._createInitialChildren(t,n,r,s),i=s}else{var a=this._createOpenTagMarkupAndPutListeners(t,n),c=this._createContentMarkup(t,n,r);i=!c&&q[this._tag]?a+"/>":a+">"+c+"</"+this._currentElement.type+">"}switch(this._tag){case"input":t.getReactMountReady().enqueue(f,this);case"button":case"select":case"textarea":n.autoFocus&&t.getReactMountReady().enqueue(v.focusDOMComponent,this)}return i},_createOpenTagMarkupAndPutListeners:function(e,t){var r="<"+this._currentElement.type;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];if(null!=i)if(W.hasOwnProperty(n))i&&c(this._rootNodeID,n,i,e);else{n===H&&(i&&(i=this._previousStyleCopy=O({},t.style)),i=_.createMarkupForStyles(i));var o=null;null!=this._tag&&m(this._tag,t)?n!==G&&(o=x.createMarkupForCustomAttribute(n,i)):o=x.createMarkupForProperty(n,i),o&&(r+=" "+o)}}if(e.renderToStaticMarkup)return r;var s=x.createMarkupForID(this._rootNodeID);return r+" "+s},_createContentMarkup:function(e,t,r){var n="",i=t.dangerouslySetInnerHTML;if(null!=i)null!=i.__html&&(n=i.__html);else{var o=j[typeof t.children]?t.children:null,s=null!=o?null:t.children;if(null!=o)n=F(o);else if(null!=s){var a=this.mountChildren(s,e,r);n=a.join("")}}return Z[this._tag]&&"\n"===n.charAt(0)?"\n"+n:n},_createInitialChildren:function(e,t,r,n){var i=t.dangerouslySetInnerHTML;if(null!=i)null!=i.__html&&B(n,i.__html);else{var o=j[typeof t.children]?t.children:null,s=null!=o?null:t.children;if(null!=o)N(n,o);else if(null!=s)for(var a=this.mountChildren(s,e,r),u=0;u<a.length;u++)n.appendChild(a[u])}},receiveComponent:function(e,t,r){var n=this._currentElement;this._currentElement=e,this.updateComponent(t,n,e,r)},updateComponent:function(e,t,r,n){var i=t.props,o=this._currentElement.props;switch(this._tag){case"button":i=M.getNativeProps(this,i),o=M.getNativeProps(this,o);break;case"input":T.updateWrapper(this),i=T.getNativeProps(this,i),o=T.getNativeProps(this,o);break;case"option":i=P.getNativeProps(this,i),o=P.getNativeProps(this,o);break;case"select":i=C.getNativeProps(this,i),o=C.getNativeProps(this,o);break;case"textarea":w.updateWrapper(this),i=w.getNativeProps(this,i),o=w.getNativeProps(this,o)}u(this,o),this._updateDOMProperties(i,o,e,null),this._updateDOMChildren(i,o,e,n),!L&&this._nodeWithLegacyProperties&&(this._nodeWithLegacyProperties.props=o),"select"===this._tag&&e.getReactMountReady().enqueue(d,this)},_updateDOMProperties:function(e,t,r,n){var i,o,s;for(i in e)if(!t.hasOwnProperty(i)&&e.hasOwnProperty(i))if(i===H){var a=this._previousStyleCopy;for(o in a)a.hasOwnProperty(o)&&(s=s||{},s[o]="");this._previousStyleCopy=null}else W.hasOwnProperty(i)?e[i]&&U(this._rootNodeID,i):(y.properties[i]||y.isCustomAttribute(i))&&(n||(n=A.getNode(this._rootNodeID)),x.deleteValueForProperty(n,i));for(i in t){var u=t[i],l=i===H?this._previousStyleCopy:e[i];if(t.hasOwnProperty(i)&&u!==l)if(i===H)if(u?u=this._previousStyleCopy=O({},u):this._previousStyleCopy=null,l){for(o in l)!l.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(s=s||{},s[o]="");for(o in u)u.hasOwnProperty(o)&&l[o]!==u[o]&&(s=s||{},s[o]=u[o])}else s=u;else W.hasOwnProperty(i)?u?c(this._rootNodeID,i,u,r):l&&U(this._rootNodeID,i):m(this._tag,t)?(n||(n=A.getNode(this._rootNodeID)),i===G&&(u=null),x.setValueForAttribute(n,i,u)):(y.properties[i]||y.isCustomAttribute(i))&&(n||(n=A.getNode(this._rootNodeID)),null!=u?x.setValueForProperty(n,i,u):x.deleteValueForProperty(n,i))}s&&(n||(n=A.getNode(this._rootNodeID)),_.setValueForStyles(n,s))},_updateDOMChildren:function(e,t,r,n){var i=j[typeof e.children]?e.children:null,o=j[typeof t.children]?t.children:null,s=e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html,a=t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html,u=null!=i?null:e.children,c=null!=o?null:t.children,l=null!=i||null!=s,h=null!=o||null!=a;null!=u&&null==c?this.updateChildren(null,r,n):l&&!h&&this.updateTextContent(""),null!=o?i!==o&&this.updateTextContent(""+o):null!=a?s!==a&&this.updateMarkup(""+a):null!=c&&this.updateChildren(c,r,n)},unmountComponent:function(){switch(this._tag){case"iframe":case"img":case"form":case"video":case"audio":var e=this._wrapperState.listeners;if(e)for(var t=0;t<e.length;t++)e[t].remove();break;case"input":T.unmountWrapper(this);break;case"html":case"head":case"body":V(!1)}if(this.unmountChildren(),S.deleteAllListeners(this._rootNodeID),E.unmountIDFromEnvironment(this._rootNodeID),this._rootNodeID=null,this._wrapperState=null,this._nodeWithLegacyProperties){var r=this._nodeWithLegacyProperties;r._reactInternalComponent=null,this._nodeWithLegacyProperties=null}},getPublicInstance:function(){if(!this._nodeWithLegacyProperties){var e=A.getNode(this._rootNodeID);e._reactInternalComponent=this,e.getDOMNode=n,e.isMounted=i,e.setState=o,e.replaceState=o,e.forceUpdate=o,e.setProps=s,e.replaceProps=a,e.props=this._currentElement.props,this._nodeWithLegacyProperties=e}return this._nodeWithLegacyProperties}},I.measureMethods(g,"ReactDOMComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent"}),O(g.prototype,g.Mixin,D.Mixin),e.exports=g},function(e,t,r){"use strict";function n(e){return i.createFactory(e)}var i=r(15),o=(r(200),r(363)),s=o({a:"a",abbr:"abbr",address:"address",area:"area",article:"article",aside:"aside",audio:"audio",b:"b",base:"base",bdi:"bdi",bdo:"bdo",big:"big",blockquote:"blockquote",body:"body",br:"br",button:"button",canvas:"canvas",caption:"caption",cite:"cite",code:"code",col:"col",colgroup:"colgroup",data:"data",datalist:"datalist",dd:"dd",del:"del",details:"details",dfn:"dfn",dialog:"dialog",div:"div",dl:"dl",dt:"dt",em:"em",embed:"embed",fieldset:"fieldset",figcaption:"figcaption",figure:"figure",footer:"footer",form:"form",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",head:"head",header:"header",hgroup:"hgroup",hr:"hr",html:"html",i:"i",iframe:"iframe",img:"img",input:"input",ins:"ins",kbd:"kbd",keygen:"keygen",label:"label",legend:"legend",li:"li",link:"link",main:"main",map:"map",mark:"mark",menu:"menu",menuitem:"menuitem",meta:"meta",meter:"meter",nav:"nav",noscript:"noscript",object:"object",ol:"ol",optgroup:"optgroup",option:"option",output:"output",p:"p",param:"param",picture:"picture",pre:"pre",progress:"progress",q:"q",rp:"rp",rt:"rt",ruby:"ruby",s:"s",samp:"samp",script:"script",section:"section",select:"select",small:"small",source:"source",span:"span",strong:"strong",style:"style",sub:"sub",summary:"summary",sup:"sup",table:"table",tbody:"tbody",td:"td",textarea:"textarea",tfoot:"tfoot",th:"th",thead:"thead",time:"time",title:"title",tr:"tr",track:"track",u:"u",ul:"ul","var":"var",video:"video",wbr:"wbr",circle:"circle",clipPath:"clipPath",defs:"defs",ellipse:"ellipse",g:"g",image:"image",line:"line",linearGradient:"linearGradient",mask:"mask",path:"path",pattern:"pattern",polygon:"polygon",polyline:"polyline",radialGradient:"radialGradient",rect:"rect",stop:"stop",svg:"svg",text:"text",
tspan:"tspan"},n);e.exports=s},function(e,t,r){"use strict";function n(){this._rootNodeID&&f.updateWrapper(this)}function i(e){var t=this._currentElement.props,r=s.executeOnChange(t,e);u.asap(n,this);var i=t.name;if("radio"===t.type&&null!=i){for(var o=a.getNode(this._rootNodeID),c=o;c.parentNode;)c=c.parentNode;for(var f=c.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),d=0;d<f.length;d++){var p=f[d];if(p!==o&&p.form===o.form){var m=a.getID(p);m?void 0:l(!1);var g=h[m];g?void 0:l(!1),u.asap(n,g)}}}return r}var o=r(120),s=r(117),a=r(13),u=r(21),c=r(5),l=r(2),h={},f={getNativeProps:function(e,t,r){var n=s.getValue(t),i=s.getChecked(t),o=c({},t,{defaultChecked:void 0,defaultValue:void 0,value:null!=n?n:e._wrapperState.initialValue,checked:null!=i?i:e._wrapperState.initialChecked,onChange:e._wrapperState.onChange});return o},mountWrapper:function(e,t){var r=t.defaultValue;e._wrapperState={initialChecked:t.defaultChecked||!1,initialValue:null!=r?r:null,onChange:i.bind(e)}},mountReadyWrapper:function(e){h[e._rootNodeID]=e},unmountWrapper:function(e){delete h[e._rootNodeID]},updateWrapper:function(e){var t=e._currentElement.props,r=t.checked;null!=r&&o.updatePropertyByID(e._rootNodeID,"checked",r||!1);var n=s.getValue(t);null!=n&&o.updatePropertyByID(e._rootNodeID,"value",""+n)}};e.exports=f},function(e,t,r){"use strict";var n=r(191),i=r(196),o=r(5),s=(r(4),i.valueContextKey),a={mountWrapper:function(e,t,r){var n=r[s],i=null;if(null!=n)if(i=!1,Array.isArray(n)){for(var o=0;o<n.length;o++)if(""+n[o]==""+t.value){i=!0;break}}else i=""+n==""+t.value;e._wrapperState={selected:i}},getNativeProps:function(e,t,r){var i=o({selected:void 0,children:void 0},t);null!=e._wrapperState.selected&&(i.selected=e._wrapperState.selected);var s="";return n.forEach(t.children,function(e){null!=e&&("string"==typeof e||"number"==typeof e)&&(s+=e)}),i.children=s,i}};e.exports=a},function(e,t,r){"use strict";function n(e,t,r,n){return e===r&&t===n}function i(e){var t=document.selection,r=t.createRange(),n=r.text.length,i=r.duplicate();i.moveToElementText(e),i.setEndPoint("EndToStart",r);var o=i.text.length,s=o+n;return{start:o,end:s}}function o(e){var t=window.getSelection&&window.getSelection();if(!t||0===t.rangeCount)return null;var r=t.anchorNode,i=t.anchorOffset,o=t.focusNode,s=t.focusOffset,a=t.getRangeAt(0);try{a.startContainer.nodeType,a.endContainer.nodeType}catch(u){return null}var c=n(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),l=c?0:a.toString().length,h=a.cloneRange();h.selectNodeContents(e),h.setEnd(a.startContainer,a.startOffset);var f=n(h.startContainer,h.startOffset,h.endContainer,h.endOffset),d=f?0:h.toString().length,p=d+l,m=document.createRange();m.setStart(r,i),m.setEnd(o,s);var g=m.collapsed;return{start:g?p:d,end:g?d:p}}function s(e,t){var r,n,i=document.selection.createRange().duplicate();"undefined"==typeof t.end?(r=t.start,n=r):t.start>t.end?(r=t.end,n=t.start):(r=t.start,n=t.end),i.moveToElementText(e),i.moveStart("character",r),i.setEndPoint("EndToStart",i),i.moveEnd("character",n-r),i.select()}function a(e,t){if(window.getSelection){var r=window.getSelection(),n=e[l()].length,i=Math.min(t.start,n),o="undefined"==typeof t.end?i:Math.min(t.end,n);if(!r.extend&&i>o){var s=o;o=i,i=s}var a=c(e,i),u=c(e,o);if(a&&u){var h=document.createRange();h.setStart(a.node,a.offset),r.removeAllRanges(),i>o?(r.addRange(h),r.extend(u.node,u.offset)):(h.setEnd(u.node,u.offset),r.addRange(h))}}}var u=r(12),c=r(497),l=r(214),h=u.canUseDOM&&"selection"in document&&!("getSelection"in window),f={getOffsets:h?i:o,setOffsets:h?s:a};e.exports=f},function(e,t,r){"use strict";var n=r(199),i=r(478),o=r(122);n.inject();var s={renderToString:i.renderToString,renderToStaticMarkup:i.renderToStaticMarkup,version:o};e.exports=s},function(e,t,r){"use strict";function n(){this._rootNodeID&&l.updateWrapper(this)}function i(e){var t=this._currentElement.props,r=o.executeOnChange(t,e);return a.asap(n,this),r}var o=r(117),s=r(120),a=r(21),u=r(5),c=r(2),l=(r(4),{getNativeProps:function(e,t,r){null!=t.dangerouslySetInnerHTML?c(!1):void 0;var n=u({},t,{defaultValue:void 0,value:void 0,children:e._wrapperState.initialValue,onChange:e._wrapperState.onChange});return n},mountWrapper:function(e,t){var r=t.defaultValue,n=t.children;null!=n&&(null!=r?c(!1):void 0,Array.isArray(n)&&(n.length<=1?void 0:c(!1),n=n[0]),r=""+n),null==r&&(r="");var s=o.getValue(t);e._wrapperState={initialValue:""+(null!=s?s:r),onChange:i.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,r=o.getValue(t);null!=r&&s.updatePropertyByID(e._rootNodeID,"value",""+r)}});e.exports=l},function(e,t,r){"use strict";function n(e){i.enqueueEvents(e),i.processEventQueue(!1)}var i=r(66),o={handleTopLevel:function(e,t,r,o,s){var a=i.extractEvents(e,t,r,o,s);n(a)}};e.exports=o},function(e,t,r){"use strict";function n(e){var t=f.getID(e),r=h.getReactRootIDFromNodeID(t),n=f.findReactContainerForID(r),i=f.getFirstReactDOM(n);return i}function i(e,t){this.topLevelType=e,this.nativeEvent=t,this.ancestors=[]}function o(e){s(e)}function s(e){for(var t=f.getFirstReactDOM(m(e.nativeEvent))||window,r=t;r;)e.ancestors.push(r),r=n(r);for(var i=0;i<e.ancestors.length;i++){t=e.ancestors[i];var o=f.getID(t)||"";v._handleTopLevel(e.topLevelType,t,o,e.nativeEvent,m(e.nativeEvent))}}function a(e){var t=g(window);e(t)}var u=r(164),c=r(12),l=r(39),h=r(55),f=r(13),d=r(21),p=r(5),m=r(126),g=r(358);p(i.prototype,{destructor:function(){this.topLevelType=null,this.nativeEvent=null,this.ancestors.length=0}}),l.addPoolingTo(i,l.twoArgumentPooler);var v={_enabled:!0,_handleTopLevel:null,WINDOW_HANDLE:c.canUseDOM?window:null,setHandleTopLevel:function(e){v._handleTopLevel=e},setEnabled:function(e){v._enabled=!!e},isEnabled:function(){return v._enabled},trapBubbledEvent:function(e,t,r){var n=r;return n?u.listen(n,t,v.dispatchEvent.bind(null,e)):null},trapCapturedEvent:function(e,t,r){var n=r;return n?u.capture(n,t,v.dispatchEvent.bind(null,e)):null},monitorScrollValue:function(e){var t=a.bind(null,e);u.listen(window,"scroll",t)},dispatchEvent:function(e,t){if(v._enabled){var r=i.getPooled(e,t);try{d.batchedUpdates(o,r)}finally{i.release(r)}}}};e.exports=v},function(e,t,r){"use strict";var n=r(54),i=r(66),o=r(119),s=r(192),a=r(201),u=r(85),c=r(207),l=r(20),h=r(210),f=r(21),d={Component:o.injection,Class:s.injection,DOMProperty:n.injection,EmptyComponent:a.injection,EventPluginHub:i.injection,EventEmitter:u.injection,NativeComponent:c.injection,Perf:l.injection,RootIndex:h.injection,Updates:f.injection};e.exports=d},function(e,t,r){"use strict";var n=r(191),i=r(193),o=r(192),s=r(463),a=r(15),u=(r(200),r(209)),c=r(122),l=r(5),h=r(498),f=a.createElement,d=a.createFactory,p=a.cloneElement,m={Children:{map:n.map,forEach:n.forEach,count:n.count,toArray:n.toArray,only:h},Component:i,createElement:f,cloneElement:p,isValidElement:a.isValidElement,PropTypes:u,createClass:o.createClass,createFactory:d,createMixin:function(e){return e},DOM:s,version:c,__spread:l};e.exports=m},function(e,t,r){"use strict";function n(e,t,r){g.push({parentID:e,parentNode:null,type:h.INSERT_MARKUP,markupIndex:v.push(t)-1,content:null,fromIndex:null,toIndex:r})}function i(e,t,r){g.push({parentID:e,parentNode:null,type:h.MOVE_EXISTING,markupIndex:null,content:null,fromIndex:t,toIndex:r})}function o(e,t){g.push({parentID:e,parentNode:null,type:h.REMOVE_NODE,markupIndex:null,content:null,fromIndex:t,toIndex:null})}function s(e,t){g.push({parentID:e,parentNode:null,type:h.SET_MARKUP,markupIndex:null,content:t,fromIndex:null,toIndex:null})}function a(e,t){g.push({parentID:e,parentNode:null,type:h.TEXT_CONTENT,markupIndex:null,content:t,fromIndex:null,toIndex:null})}function u(){g.length&&(l.processChildrenUpdates(g,v),c())}function c(){g.length=0,v.length=0}var l=r(119),h=r(206),f=(r(32),r(44)),d=r(459),p=r(495),m=0,g=[],v=[],_={Mixin:{_reconcilerInstantiateChildren:function(e,t,r){return d.instantiateChildren(e,t,r)},_reconcilerUpdateChildren:function(e,t,r,n){var i;return i=p(t),d.updateChildren(e,i,r,n)},mountChildren:function(e,t,r){var n=this._reconcilerInstantiateChildren(e,t,r);this._renderedChildren=n;var i=[],o=0;for(var s in n)if(n.hasOwnProperty(s)){var a=n[s],u=this._rootNodeID+s,c=f.mountComponent(a,u,t,r);a._mountIndex=o++,i.push(c)}return i},updateTextContent:function(e){m++;var t=!0;try{var r=this._renderedChildren;d.unmountChildren(r);for(var n in r)r.hasOwnProperty(n)&&this._unmountChild(r[n]);this.setTextContent(e),t=!1}finally{m--,m||(t?c():u())}},updateMarkup:function(e){m++;var t=!0;try{var r=this._renderedChildren;d.unmountChildren(r);for(var n in r)r.hasOwnProperty(n)&&this._unmountChildByName(r[n],n);this.setMarkup(e),t=!1}finally{m--,m||(t?c():u())}},updateChildren:function(e,t,r){m++;var n=!0;try{this._updateChildren(e,t,r),n=!1}finally{m--,m||(n?c():u())}},_updateChildren:function(e,t,r){var n=this._renderedChildren,i=this._reconcilerUpdateChildren(n,e,t,r);if(this._renderedChildren=i,i||n){var o,s=0,a=0;for(o in i)if(i.hasOwnProperty(o)){var u=n&&n[o],c=i[o];u===c?(this.moveChild(u,a,s),s=Math.max(u._mountIndex,s),u._mountIndex=a):(u&&(s=Math.max(u._mountIndex,s),this._unmountChild(u)),this._mountChildByNameAtIndex(c,o,a,t,r)),a++}for(o in n)!n.hasOwnProperty(o)||i&&i.hasOwnProperty(o)||this._unmountChild(n[o])}},unmountChildren:function(){var e=this._renderedChildren;d.unmountChildren(e),this._renderedChildren=null},moveChild:function(e,t,r){e._mountIndex<r&&i(this._rootNodeID,e._mountIndex,t)},createChild:function(e,t){n(this._rootNodeID,t,e._mountIndex)},removeChild:function(e){o(this._rootNodeID,e._mountIndex)},setTextContent:function(e){a(this._rootNodeID,e)},setMarkup:function(e){s(this._rootNodeID,e)},_mountChildByNameAtIndex:function(e,t,r,n,i){var o=this._rootNodeID+t,s=f.mountComponent(e,o,n,i);e._mountIndex=r,this.createChild(e,s)},_unmountChild:function(e){this.removeChild(e),e._mountIndex=null}}};e.exports=_},function(e,t,r){"use strict";var n=r(2),i={isValidOwner:function(e){return!(!e||"function"!=typeof e.attachRef||"function"!=typeof e.detachRef)},addComponentAsRefTo:function(e,t,r){i.isValidOwner(r)?void 0:n(!1),r.attachRef(t,e)},removeComponentAsRefFrom:function(e,t,r){i.isValidOwner(r)?void 0:n(!1),r.getPublicInstance().refs[t]===e.getPublicInstance()&&r.detachRef(t)}};e.exports=i},function(e,t,r){"use strict";function n(e){this.reinitializeTransaction(),this.renderToStaticMarkup=!1,this.reactMountReady=i.getPooled(null),this.useCreateElement=!e&&a.useCreateElement}var i=r(115),o=r(39),s=r(85),a=r(195),u=r(204),c=r(89),l=r(5),h={initialize:u.getSelectionInformation,close:u.restoreSelection},f={initialize:function(){var e=s.isEnabled();return s.setEnabled(!1),e},close:function(e){s.setEnabled(e)}},d={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}},p=[h,f,d],m={getTransactionWrappers:function(){return p},getReactMountReady:function(){return this.reactMountReady},destructor:function(){i.release(this.reactMountReady),this.reactMountReady=null}};l(n.prototype,c.Mixin,m),o.addPoolingTo(n),e.exports=n},function(e,t,r){"use strict";function n(e,t,r){"function"==typeof e?e(t.getPublicInstance()):o.addComponentAsRefTo(t,e,r)}function i(e,t,r){"function"==typeof e?e(null):o.removeComponentAsRefFrom(t,e,r)}var o=r(474),s={};s.attachRefs=function(e,t){if(null!==t&&t!==!1){var r=t.ref;null!=r&&n(r,e,t._owner)}},s.shouldUpdateRefs=function(e,t){var r=null===e||e===!1,n=null===t||t===!1;return r||n||t._owner!==e._owner||t.ref!==e.ref},s.detachRefs=function(e,t){if(null!==t&&t!==!1){var r=t.ref;null!=r&&i(r,e,t._owner)}},e.exports=s},function(e,t){"use strict";var r={isBatchingUpdates:!1,batchedUpdates:function(e){}};e.exports=r},function(e,t,r){"use strict";function n(e){s.isValidElement(e)?void 0:p(!1);var t;try{h.injection.injectBatchingStrategy(c);var r=a.createReactRootID();return t=l.getPooled(!1),t.perform(function(){var n=d(e,null),i=n.mountComponent(r,t,f);return u.addChecksumToMarkup(i)},null)}finally{l.release(t),h.injection.injectBatchingStrategy(o)}}function i(e){s.isValidElement(e)?void 0:p(!1);var t;try{h.injection.injectBatchingStrategy(c);var r=a.createReactRootID();return t=l.getPooled(!0),t.perform(function(){var n=d(e,null);return n.mountComponent(r,t,f)},null)}finally{l.release(t),h.injection.injectBatchingStrategy(o)}}var o=r(198),s=r(15),a=r(55),u=r(205),c=r(477),l=r(479),h=r(21),f=r(62),d=r(128),p=r(2);e.exports={renderToString:n,renderToStaticMarkup:i}},function(e,t,r){"use strict";function n(e){this.reinitializeTransaction(),this.renderToStaticMarkup=e,this.reactMountReady=o.getPooled(null),this.useCreateElement=!1}var i=r(39),o=r(115),s=r(89),a=r(5),u=r(26),c={initialize:function(){this.reactMountReady.reset()},close:u},l=[c],h={getTransactionWrappers:function(){return l},getReactMountReady:function(){return this.reactMountReady},destructor:function(){o.release(this.reactMountReady),this.reactMountReady=null}};a(n.prototype,s.Mixin,h),i.addPoolingTo(n),e.exports=n},function(e,t,r){"use strict";var n=r(54),i=n.injection.MUST_USE_ATTRIBUTE,o={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},s={Properties:{clipPath:i,cx:i,cy:i,d:i,dx:i,dy:i,fill:i,fillOpacity:i,fontFamily:i,fontSize:i,fx:i,fy:i,gradientTransform:i,gradientUnits:i,markerEnd:i,markerMid:i,markerStart:i,offset:i,opacity:i,patternContentUnits:i,patternUnits:i,points:i,preserveAspectRatio:i,r:i,rx:i,ry:i,spreadMethod:i,stopColor:i,stopOpacity:i,stroke:i,strokeDasharray:i,strokeLinecap:i,strokeOpacity:i,strokeWidth:i,textAnchor:i,transform:i,version:i,viewBox:i,x1:i,x2:i,x:i,xlinkActuate:i,xlinkArcrole:i,xlinkHref:i,xlinkRole:i,xlinkShow:i,xlinkTitle:i,xlinkType:i,xmlBase:i,xmlLang:i,xmlSpace:i,y1:i,y2:i,y:i},DOMAttributeNamespaces:{xlinkActuate:o.xlink,xlinkArcrole:o.xlink,xlinkHref:o.xlink,xlinkRole:o.xlink,xlinkShow:o.xlink,xlinkTitle:o.xlink,xlinkType:o.xlink,xmlBase:o.xml,xmlLang:o.xml,xmlSpace:o.xml},DOMAttributeNames:{clipPath:"clip-path",fillOpacity:"fill-opacity",fontFamily:"font-family",fontSize:"font-size",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",patternContentUnits:"patternContentUnits",patternUnits:"patternUnits",preserveAspectRatio:"preserveAspectRatio",spreadMethod:"spreadMethod",stopColor:"stop-color",stopOpacity:"stop-opacity",strokeDasharray:"stroke-dasharray",strokeLinecap:"stroke-linecap",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",viewBox:"viewBox",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlLang:"xml:lang",xmlSpace:"xml:space"}};e.exports=s},function(e,t,r){"use strict";function n(e){if("selectionStart"in e&&u.hasSelectionCapabilities(e))return{start:e.selectionStart,end:e.selectionEnd};if(window.getSelection){var t=window.getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}if(document.selection){var r=document.selection.createRange();return{parentElement:r.parentElement(),text:r.text,top:r.boundingTop,left:r.boundingLeft}}}function i(e,t){if(x||null==v||v!==l())return null;var r=n(v);if(!y||!d(y,r)){y=r;var i=c.getPooled(g.select,_,e,t);return i.type="select",i.target=v,s.accumulateTwoPhaseDispatches(i),i}return null}var o=r(31),s=r(67),a=r(12),u=r(204),c=r(45),l=r(167),h=r(215),f=r(36),d=r(169),p=o.topLevelTypes,m=a.canUseDOM&&"documentMode"in document&&document.documentMode<=11,g={select:{phasedRegistrationNames:{bubbled:f({onSelect:null}),captured:f({onSelectCapture:null})},dependencies:[p.topBlur,p.topContextMenu,p.topFocus,p.topKeyDown,p.topMouseDown,p.topMouseUp,p.topSelectionChange]}},v=null,_=null,y=null,x=!1,b=!1,S=f({onSelect:null}),E={eventTypes:g,extractEvents:function(e,t,r,n,o){if(!b)return null;switch(e){case p.topFocus:(h(t)||"true"===t.contentEditable)&&(v=t,_=r,y=null);break;case p.topBlur:v=null,_=null,y=null;break;case p.topMouseDown:x=!0;break;case p.topContextMenu:case p.topMouseUp:return x=!1,i(n,o);case p.topSelectionChange:if(m)break;case p.topKeyDown:case p.topKeyUp:return i(n,o)}return null},didPutListener:function(e,t,r){t===S&&(b=!0)}};e.exports=E},function(e,t){"use strict";var r=Math.pow(2,53),n={createReactRootIndex:function(){return Math.ceil(Math.random()*r)}};e.exports=n},function(e,t,r){"use strict";var n=r(31),i=r(164),o=r(67),s=r(13),a=r(484),u=r(45),c=r(487),l=r(489),h=r(88),f=r(486),d=r(490),p=r(69),m=r(491),g=r(26),v=r(124),_=r(2),y=r(36),x=n.topLevelTypes,b={abort:{phasedRegistrationNames:{bubbled:y({onAbort:!0}),captured:y({onAbortCapture:!0})}},blur:{phasedRegistrationNames:{bubbled:y({onBlur:!0}),captured:y({onBlurCapture:!0})}},canPlay:{phasedRegistrationNames:{bubbled:y({onCanPlay:!0}),captured:y({onCanPlayCapture:!0})}},canPlayThrough:{phasedRegistrationNames:{bubbled:y({onCanPlayThrough:!0}),captured:y({onCanPlayThroughCapture:!0})}},click:{phasedRegistrationNames:{bubbled:y({onClick:!0}),captured:y({onClickCapture:!0})}},contextMenu:{phasedRegistrationNames:{bubbled:y({onContextMenu:!0}),captured:y({onContextMenuCapture:!0})}},copy:{phasedRegistrationNames:{bubbled:y({onCopy:!0}),captured:y({onCopyCapture:!0})}},cut:{phasedRegistrationNames:{bubbled:y({onCut:!0}),captured:y({onCutCapture:!0})}},doubleClick:{phasedRegistrationNames:{bubbled:y({onDoubleClick:!0}),captured:y({onDoubleClickCapture:!0})}},drag:{phasedRegistrationNames:{bubbled:y({onDrag:!0}),captured:y({onDragCapture:!0})}},dragEnd:{phasedRegistrationNames:{bubbled:y({onDragEnd:!0}),captured:y({onDragEndCapture:!0})}},dragEnter:{phasedRegistrationNames:{bubbled:y({onDragEnter:!0}),captured:y({onDragEnterCapture:!0})}},dragExit:{phasedRegistrationNames:{bubbled:y({onDragExit:!0}),captured:y({onDragExitCapture:!0})}},dragLeave:{phasedRegistrationNames:{bubbled:y({onDragLeave:!0}),captured:y({onDragLeaveCapture:!0})}},dragOver:{phasedRegistrationNames:{bubbled:y({onDragOver:!0}),captured:y({onDragOverCapture:!0})}},dragStart:{phasedRegistrationNames:{bubbled:y({onDragStart:!0}),captured:y({onDragStartCapture:!0})}},drop:{phasedRegistrationNames:{bubbled:y({onDrop:!0}),captured:y({onDropCapture:!0})}},durationChange:{phasedRegistrationNames:{bubbled:y({onDurationChange:!0}),captured:y({onDurationChangeCapture:!0})}},emptied:{phasedRegistrationNames:{bubbled:y({onEmptied:!0}),captured:y({onEmptiedCapture:!0})}},encrypted:{phasedRegistrationNames:{bubbled:y({onEncrypted:!0}),captured:y({onEncryptedCapture:!0})}},ended:{phasedRegistrationNames:{bubbled:y({onEnded:!0}),captured:y({onEndedCapture:!0})}},error:{phasedRegistrationNames:{bubbled:y({onError:!0}),captured:y({onErrorCapture:!0})}},focus:{phasedRegistrationNames:{bubbled:y({onFocus:!0}),captured:y({onFocusCapture:!0})}},input:{phasedRegistrationNames:{bubbled:y({onInput:!0}),captured:y({onInputCapture:!0})}},keyDown:{phasedRegistrationNames:{bubbled:y({onKeyDown:!0}),captured:y({onKeyDownCapture:!0})}},keyPress:{phasedRegistrationNames:{bubbled:y({onKeyPress:!0}),captured:y({onKeyPressCapture:!0})}},keyUp:{phasedRegistrationNames:{bubbled:y({onKeyUp:!0}),captured:y({onKeyUpCapture:!0})}},load:{phasedRegistrationNames:{bubbled:y({onLoad:!0}),captured:y({onLoadCapture:!0})}},loadedData:{phasedRegistrationNames:{bubbled:y({onLoadedData:!0}),captured:y({onLoadedDataCapture:!0})}},loadedMetadata:{phasedRegistrationNames:{bubbled:y({onLoadedMetadata:!0}),captured:y({onLoadedMetadataCapture:!0})}},loadStart:{phasedRegistrationNames:{bubbled:y({onLoadStart:!0}),captured:y({onLoadStartCapture:!0})}},mouseDown:{phasedRegistrationNames:{bubbled:y({onMouseDown:!0}),captured:y({onMouseDownCapture:!0})}},mouseMove:{phasedRegistrationNames:{bubbled:y({onMouseMove:!0}),captured:y({onMouseMoveCapture:!0})}},mouseOut:{phasedRegistrationNames:{bubbled:y({onMouseOut:!0}),captured:y({onMouseOutCapture:!0})}},mouseOver:{phasedRegistrationNames:{bubbled:y({onMouseOver:!0}),captured:y({onMouseOverCapture:!0})}},mouseUp:{phasedRegistrationNames:{bubbled:y({onMouseUp:!0}),captured:y({onMouseUpCapture:!0})}},paste:{phasedRegistrationNames:{bubbled:y({onPaste:!0}),captured:y({onPasteCapture:!0})}},pause:{phasedRegistrationNames:{bubbled:y({onPause:!0}),captured:y({onPauseCapture:!0})}},play:{phasedRegistrationNames:{bubbled:y({onPlay:!0}),captured:y({onPlayCapture:!0})}},playing:{phasedRegistrationNames:{bubbled:y({onPlaying:!0}),captured:y({onPlayingCapture:!0})}},progress:{phasedRegistrationNames:{bubbled:y({onProgress:!0}),captured:y({onProgressCapture:!0})}},rateChange:{phasedRegistrationNames:{bubbled:y({onRateChange:!0}),captured:y({onRateChangeCapture:!0})}},reset:{phasedRegistrationNames:{bubbled:y({onReset:!0}),captured:y({onResetCapture:!0})}},scroll:{phasedRegistrationNames:{bubbled:y({onScroll:!0}),captured:y({onScrollCapture:!0})}},seeked:{phasedRegistrationNames:{bubbled:y({onSeeked:!0}),captured:y({onSeekedCapture:!0})}},seeking:{phasedRegistrationNames:{bubbled:y({onSeeking:!0}),captured:y({onSeekingCapture:!0})}},stalled:{phasedRegistrationNames:{bubbled:y({onStalled:!0}),captured:y({onStalledCapture:!0})}},submit:{phasedRegistrationNames:{bubbled:y({onSubmit:!0}),captured:y({onSubmitCapture:!0})}},suspend:{phasedRegistrationNames:{bubbled:y({onSuspend:!0}),captured:y({onSuspendCapture:!0})}},timeUpdate:{phasedRegistrationNames:{bubbled:y({onTimeUpdate:!0}),captured:y({onTimeUpdateCapture:!0})}},touchCancel:{phasedRegistrationNames:{bubbled:y({onTouchCancel:!0}),captured:y({onTouchCancelCapture:!0})}},touchEnd:{phasedRegistrationNames:{bubbled:y({onTouchEnd:!0}),captured:y({onTouchEndCapture:!0})}},touchMove:{phasedRegistrationNames:{bubbled:y({onTouchMove:!0}),captured:y({onTouchMoveCapture:!0})}},touchStart:{phasedRegistrationNames:{bubbled:y({onTouchStart:!0}),captured:y({onTouchStartCapture:!0})}},volumeChange:{phasedRegistrationNames:{bubbled:y({onVolumeChange:!0}),captured:y({onVolumeChangeCapture:!0})}},waiting:{phasedRegistrationNames:{bubbled:y({onWaiting:!0}),captured:y({onWaitingCapture:!0})}},wheel:{phasedRegistrationNames:{bubbled:y({onWheel:!0}),captured:y({onWheelCapture:!0})}}},S={topAbort:b.abort,topBlur:b.blur,topCanPlay:b.canPlay,topCanPlayThrough:b.canPlayThrough,topClick:b.click,topContextMenu:b.contextMenu,topCopy:b.copy,topCut:b.cut,topDoubleClick:b.doubleClick,topDrag:b.drag,topDragEnd:b.dragEnd,topDragEnter:b.dragEnter,topDragExit:b.dragExit,topDragLeave:b.dragLeave,topDragOver:b.dragOver,topDragStart:b.dragStart,topDrop:b.drop,topDurationChange:b.durationChange,topEmptied:b.emptied,topEncrypted:b.encrypted,topEnded:b.ended,topError:b.error,topFocus:b.focus,topInput:b.input,topKeyDown:b.keyDown,topKeyPress:b.keyPress,topKeyUp:b.keyUp,topLoad:b.load,topLoadedData:b.loadedData,topLoadedMetadata:b.loadedMetadata,topLoadStart:b.loadStart,topMouseDown:b.mouseDown,topMouseMove:b.mouseMove,topMouseOut:b.mouseOut,topMouseOver:b.mouseOver,topMouseUp:b.mouseUp,topPaste:b.paste,topPause:b.pause,topPlay:b.play,topPlaying:b.playing,topProgress:b.progress,topRateChange:b.rateChange,topReset:b.reset,topScroll:b.scroll,topSeeked:b.seeked,topSeeking:b.seeking,topStalled:b.stalled,topSubmit:b.submit,topSuspend:b.suspend,topTimeUpdate:b.timeUpdate,topTouchCancel:b.touchCancel,topTouchEnd:b.touchEnd,topTouchMove:b.touchMove,topTouchStart:b.touchStart,topVolumeChange:b.volumeChange,topWaiting:b.waiting,topWheel:b.wheel};for(var E in S)S[E].dependencies=[E];var M=y({onClick:null}),T={},P={eventTypes:b,extractEvents:function(e,t,r,n,i){var s=S[e];if(!s)return null;var g;switch(e){case x.topAbort:case x.topCanPlay:case x.topCanPlayThrough:case x.topDurationChange:case x.topEmptied:case x.topEncrypted:case x.topEnded:case x.topError:case x.topInput:case x.topLoad:case x.topLoadedData:case x.topLoadedMetadata:case x.topLoadStart:case x.topPause:case x.topPlay:case x.topPlaying:case x.topProgress:case x.topRateChange:case x.topReset:case x.topSeeked:case x.topSeeking:case x.topStalled:case x.topSubmit:case x.topSuspend:case x.topTimeUpdate:case x.topVolumeChange:case x.topWaiting:g=u;break;case x.topKeyPress:if(0===v(n))return null;case x.topKeyDown:case x.topKeyUp:g=l;break;case x.topBlur:case x.topFocus:g=c;break;case x.topClick:if(2===n.button)return null;case x.topContextMenu:case x.topDoubleClick:case x.topMouseDown:case x.topMouseMove:case x.topMouseOut:case x.topMouseOver:case x.topMouseUp:g=h;break;case x.topDrag:case x.topDragEnd:case x.topDragEnter:case x.topDragExit:case x.topDragLeave:case x.topDragOver:case x.topDragStart:case x.topDrop:g=f;break;case x.topTouchCancel:case x.topTouchEnd:case x.topTouchMove:case x.topTouchStart:g=d;break;case x.topScroll:g=p;break;case x.topWheel:g=m;break;case x.topCopy:case x.topCut:case x.topPaste:g=a}g?void 0:_(!1);var y=g.getPooled(s,r,n,i);return o.accumulateTwoPhaseDispatches(y),y},didPutListener:function(e,t,r){if(t===M){var n=s.getNode(e);T[e]||(T[e]=i.listen(n,"click",g))}},willDeleteListener:function(e,t){t===M&&(T[e].remove(),delete T[e])}};e.exports=P},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(45),o={clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}};i.augmentClass(n,o),e.exports=n},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(45),o={data:null};i.augmentClass(n,o),e.exports=n},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(88),o={dataTransfer:null};i.augmentClass(n,o),e.exports=n},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(69),o={relatedTarget:null};i.augmentClass(n,o),e.exports=n},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(45),o={data:null};i.augmentClass(n,o),e.exports=n},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(69),o=r(124),s=r(496),a=r(125),u={key:s,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:a,charCode:function(e){return"keypress"===e.type?o(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?o(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}};i.augmentClass(n,u),e.exports=n},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(69),o=r(125),s={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:o};i.augmentClass(n,s),e.exports=n},function(e,t,r){"use strict";function n(e,t,r,n){i.call(this,e,t,r,n)}var i=r(88),o={deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null};i.augmentClass(n,o),e.exports=n},function(e,t){"use strict";function r(e){for(var t=1,r=0,i=0,o=e.length,s=-4&o;s>i;){for(;i<Math.min(i+4096,s);i+=4)r+=(t+=e.charCodeAt(i))+(t+=e.charCodeAt(i+1))+(t+=e.charCodeAt(i+2))+(t+=e.charCodeAt(i+3));t%=n,r%=n}for(;o>i;i++)r+=t+=e.charCodeAt(i);return t%=n,r%=n,t|r<<16}var n=65521;e.exports=r},function(e,t,r){"use strict";function n(e,t){var r=null==t||"boolean"==typeof t||""===t;if(r)return"";var n=isNaN(t);return n||0===t||o.hasOwnProperty(e)&&o[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}var i=r(188),o=i.isUnitlessNumber;e.exports=n},function(e,t,r){"use strict";function n(e,t,r,n,i){return i}r(5),r(4);e.exports=n},function(e,t,r){"use strict";function n(e,t,r){var n=e,i=void 0===n[r];i&&null!=t&&(n[r]=t)}function i(e){if(null==e)return e;var t={};return o(e,n,t),t}var o=r(132);r(4);e.exports=i},function(e,t,r){"use strict";function n(e){if(e.key){var t=o[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var r=i(e);return 13===r?"Enter":String.fromCharCode(r)}return"keydown"===e.type||"keyup"===e.type?s[e.keyCode]||"Unidentified":""}var i=r(124),o={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},s={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};e.exports=n},function(e,t){"use strict";function r(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function n(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function i(e,t){for(var i=r(e),o=0,s=0;i;){if(3===i.nodeType){if(s=o+i.textContent.length,t>=o&&s>=t)return{node:i,offset:t-o};o=s}i=r(n(i))}}e.exports=i},function(e,t,r){"use strict";function n(e){return i.isValidElement(e)?void 0:o(!1),e}var i=r(15),o=r(2);e.exports=n},function(e,t,r){"use strict";function n(e){return'"'+i(e)+'"'}var i=r(91);e.exports=n},function(e,t,r){"use strict";var n=r(13);e.exports=n.renderSubtreeIntoContainer},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=null;return function(r){var n=e(r);return m["default"](t,n)?t:(t=n,n)}}function a(e){return e.routes||e.children}t.__esModule=!0;var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(7),h=n(l),f=r(52),d=r(53),p=r(216),m=n(p),g=r(46),v=r(134),_=function(e){function t(r,n){i(this,t),e.call(this,r,n),n.store.dispatch(v.initRoutes(a(r)))}return o(t,e),c(t,null,[{key:"propTypes",value:{children:l.PropTypes.node},enumerable:!0},{key:"contextTypes",value:{store:l.PropTypes.object},enumerable:!0}]),t.prototype.componentWillReceiveProps=function(e){this.receiveRoutes(a(e))},t.prototype.receiveRoutes=function(e){if(e){var t=this.context.store;t.dispatch(v.replaceRoutes(e))}},t.prototype.render=function(){var e=this.context.store;if(!e)throw new Error("Redux store missing from context of <ReduxRouter>. Make sure you're using a <Provider>");var t=e.history,r=e[g.ROUTER_STATE_SELECTOR];if(!t||!r)throw new Error("Redux store not configured properly for <ReduxRouter>. Make sure you're using the reduxReactRouter() store enhancer.");return h["default"].createElement(y,u({history:t,routerStateSelector:s(r)},this.props))},t}(l.Component),y=function(e){function t(){i(this,r),e.apply(this,arguments)}o(t,e),t.prototype.render=function(){var e=this.props.location;if(null===e||void 0===e)return null;var t=this.props.RoutingContext||d.RoutingContext;return h["default"].createElement(t,this.props)},c(t,null,[{key:"propTypes",value:{location:l.PropTypes.object,RoutingContext:l.PropTypes.element},enumerable:!0}]);var r=t;return t=f.connect(function(e,t){var r=t.routerStateSelector;return r(e)||{}})(t)||t}(l.Component);t["default"]=_,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return function(t){return function(r){return function(n,i){var o=t.onError,a=t.routerStateSelector,c=e(t)(r)(n,i),l=c.history,h=void 0,f=void 0;
return l.listen(function(e,t){return e?void o(e):void(u["default"](f,t)||(h=f,f=t,c.dispatch(s.routerDidChange(t))))}),c.subscribe(function(){var e=a(c.getState());if(e&&h!==e&&!u["default"](f,e)){f=e;var t=e.location,r=t.state,n=t.pathname,i=t.query;l.replace({state:r,pathname:n,query:i})}}),c}}}}t.__esModule=!0;var o=r(56),s=r(134),a=r(216),u=n(a),c=r(505),l=n(c),h=r(509),f=n(h),d=r(507),p=n(d);t["default"]=o.compose(f["default"],p["default"],i)(l["default"]),e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return function(){return function(t){return function(r){if(r.type===i.HISTORY_API){var n=r.payload,o=n.method,s=n.args;return e[o].apply(e,s)}return t(r)}}}}t.__esModule=!0,t["default"]=n;var i=r(46);e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];return function(n){if(!n)return!1;var i=n.location,o=n.params,a=n.routes;return s["default"](e,t,r,i,a,o)}}t.__esModule=!0,t["default"]=i;var o=r(187),s=n(o);e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.routes,r=e.createHistory,n=e.parseQueryString,i=e.stringifyQuery,a=e.routerStateSelector;return function(e){return function(l,h){var f=void 0;"function"==typeof r?f=r:r&&(f=function(){return r});var d=s.useRoutes(f)({routes:t,parseQueryString:n,stringifyQuery:i});["pushState","push","replaceState","replace","setState","go","goBack","goForward","listen","createLocation","match"].forEach(function(e){if(!d.hasOwnProperty(e)&&"function"==typeof d[e])throw new Error("History API does not support function: "+e)});var p=o.applyMiddleware(u["default"](d))(e)(l,h);return p.history=d,p[c.ROUTER_STATE_SELECTOR]=a,p}}}t.__esModule=!0,t["default"]=i;var o=r(56),s=r(53),a=r(503),u=n(a),c=r(46);e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return function(){return function(t){return function(r){var n=r.type===i.INIT_ROUTES;return(n||r.type===i.REPLACE_ROUTES)&&e(r.payload,n),t(r)}}}}t.__esModule=!0,t["default"]=n;var i=r(46);e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return function(t){return function(r){return function(n,i){function u(e,t){p=a.createRoutes(e);var r=f(d.getState());if(r&&!t){var n=r.location,i=n.state,o=n.pathname,s=n.query;d.history.replace({state:i,pathname:o,query:s})}m||(m=!0,g.forEach(function(e){return e(null,p)}))}var l=t.routes,h=t.getRoutes,f=t.routerStateSelector,d=void 0,p=[],m=!1,g=[],v=void 0;return v=l?l:h?h({dispatch:function(e){return d.dispatch(e)},getState:function(){return d.getState()}}):[{getChildRoutes:function(e,t){return m?void t(null,p):void g.push(t)}}],d=s.compose(s.applyMiddleware(c["default"](u)),e(o({},t,{routes:a.createRoutes(v)})))(r)(n,i)}}}}t.__esModule=!0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t["default"]=i;var s=r(56),a=r(53),u=r(506),c=n(u);e.exports=t["default"]},function(e,t,r){"use strict";function n(e,t){void 0===e&&(e=null);var r;switch(t.type){case o.ROUTER_DID_CHANGE:return t.payload;case o.REPLACE_ROUTES:return e?i({},e,(r={},r[o.DOES_NEED_REFRESH]=!0,r)):e;default:return e}}t.__esModule=!0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t["default"]=n;var o=r(46);e.exports=t["default"]},function(e,t){"use strict";function r(e){return function(t){return function(r){return function(o,s){var a=n({},i,t),u=a.createHistory,c=a.history,l=void 0;return l="function"==typeof u?u:c?function(){return c}:null,e(n({},a,{createHistory:l}))(r)(o,s)}}}}t.__esModule=!0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t["default"]=r;var i={onError:function(e){throw e},routerStateSelector:function(e){return e.router}};e.exports=t["default"]},function(e,t){"use strict";function r(e){var t=e.dispatch,r=e.getState;return function(e){return function(n){return"function"==typeof n?n(t,r):e(n)}}}t.__esModule=!0,t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return function(e){return function(r,n){var i=e(r,n),s=i.dispatch,u=[],c={getState:i.getState,dispatch:function(e){return s(e)}};return u=t.map(function(e){return e(c)}),s=a["default"].apply(void 0,u)(i.dispatch),o({},i,{dispatch:s})}}}t.__esModule=!0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t["default"]=i;var s=r(218),a=n(s);e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return function(){return t(e.apply(void 0,arguments))}}function o(e,t){if("function"==typeof e)return i(e,t);if("object"!=typeof e||null===e||void 0===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');return a["default"](e,function(e){return i(e,t)})}t.__esModule=!0,t["default"]=o;var s=r(220),a=n(s);e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var r=t&&t.type,n=r&&'"'+r.toString()+'"'||"an action";return'Reducer "'+e+'" returned undefined handling '+n+". To ignore an action, you must explicitly return the previous state."}function o(e){Object.keys(e).forEach(function(t){var r=e[t],n=r(void 0,{type:a.ActionTypes.INIT});if("undefined"==typeof n)throw new Error('Reducer "'+t+'" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined.');var i="@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".");if("undefined"==typeof r(void 0,{type:i}))throw new Error('Reducer "'+t+'" returned undefined when probed with a random type. '+("Don't try to handle "+a.ActionTypes.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined.")})}function s(e){var t,r=f["default"](e,function(e){return"function"==typeof e});try{o(r)}catch(n){t=n}var s=l["default"](r,function(){});return function(e,n){if(void 0===e&&(e=s),t)throw t;var o=!1,a=l["default"](r,function(t,r){var s=e[r],a=t(s,n);if("undefined"==typeof a){var u=i(r,n);throw new Error(u)}return o=o||a!==s,a});return o?a:e}}t.__esModule=!0,t["default"]=s;var a=r(217),u=r(219),c=(n(u),r(220)),l=n(c),h=r(514),f=n(h);e.exports=t["default"]},function(e,t){"use strict";function r(e,t){return Object.keys(e).reduce(function(r,n){return t(e[n])&&(r[n]=e[n]),r},{})}t.__esModule=!0,t["default"]=r,e.exports=t["default"]},function(e,t,r){(function(t,r){!function(t){"use strict";function n(e,t,r,n){var i=Object.create((t||o).prototype),s=new p(n||[]);return i._invoke=h(e,r,s),i}function i(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}function o(){}function s(){}function a(){}function u(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function c(e){this.arg=e}function l(e){function t(t,r){var n=e[t](r),i=n.value;return i instanceof c?Promise.resolve(i.arg).then(o,s):Promise.resolve(i).then(function(e){return n.value=e,n})}function n(e,r){function n(){return t(e,r)}return i=i?i.then(n,n):new Promise(function(e){e(n())})}"object"==typeof r&&r.domain&&(t=r.domain.bind(t));var i,o=t.bind(e,"next"),s=t.bind(e,"throw");t.bind(e,"return");this._invoke=n}function h(e,t,r){var n=S;return function(o,s){if(n===M)throw new Error("Generator is already running");if(n===T){if("throw"===o)throw s;return g()}for(;;){var a=r.delegate;if(a){if("return"===o||"throw"===o&&a.iterator[o]===v){r.delegate=null;var u=a.iterator["return"];if(u){var c=i(u,a.iterator,s);if("throw"===c.type){o="throw",s=c.arg;continue}}if("return"===o)continue}var c=i(a.iterator[o],a.iterator,s);if("throw"===c.type){r.delegate=null,o="throw",s=c.arg;continue}o="next",s=v;var l=c.arg;if(!l.done)return n=E,l;r[a.resultName]=l.value,r.next=a.nextLoc,r.delegate=null}if("next"===o)n===E?r.sent=s:r.sent=v;else if("throw"===o){if(n===S)throw n=T,s;r.dispatchException(s)&&(o="next",s=v)}else"return"===o&&r.abrupt("return",s);n=M;var c=i(e,t,r);if("normal"===c.type){n=r.done?T:E;var l={value:c.arg,done:r.done};if(c.arg!==P)return l;r.delegate&&"next"===o&&(s=v)}else"throw"===c.type&&(n=T,o="throw",s=c.arg)}}}function f(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(f,this),this.reset(!0)}function m(e){if(e){var t=e[y];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function i(){for(;++r<e.length;)if(_.call(e,r))return i.value=e[r],i.done=!1,i;return i.value=v,i.done=!0,i};return n.next=n}}return{next:g}}function g(){return{value:v,done:!0}}var v,_=Object.prototype.hasOwnProperty,y="function"==typeof Symbol&&Symbol.iterator||"@@iterator",x="object"==typeof e,b=t.regeneratorRuntime;if(b)return void(x&&(e.exports=b));b=t.regeneratorRuntime=x?e.exports:{},b.wrap=n;var S="suspendedStart",E="suspendedYield",M="executing",T="completed",P={},C=a.prototype=o.prototype;s.prototype=C.constructor=a,a.constructor=s,s.displayName="GeneratorFunction",b.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return t?t===s||"GeneratorFunction"===(t.displayName||t.name):!1},b.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a,e.prototype=Object.create(C),e},b.awrap=function(e){return new c(e)},u(l.prototype),b.async=function(e,t,r,i){var o=new l(n(e,t,r,i));return b.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},u(C),C[y]=function(){return this},C.toString=function(){return"[object Generator]"},b.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},b.values=m,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=v,this.done=!1,this.delegate=null,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=v)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return o.type="throw",o.arg=e,r.next=t,!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=_.call(i,"catchLoc"),a=_.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&_.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?this.next=i.finallyLoc:this.complete(o),P},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),d(r),P}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;d(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:m(e),resultName:t,nextLoc:r},P}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,function(){return this}(),r(420))},function(e,t){"use strict";e.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}},function(e,t,r){var n=r(103);"string"==typeof n&&(n=[[e.id,n,""]]);var i=r(221)(n,{});n.locals&&(e.exports=n.locals),n.locals||e.hot.accept(103,function(){var t=r(103);"string"==typeof t&&(t=[[e.id,t,""]]),i(t)}),e.hot.dispose(function(){i()})},function(e,t,r){var n=r(104);"string"==typeof n&&(n=[[e.id,n,""]]);var i=r(221)(n,{});n.locals&&(e.exports=n.locals),n.locals||e.hot.accept(104,function(){var t=r(104);"string"==typeof t&&(t=[[e.id,t,""]]),i(t)}),e.hot.dispose(function(){i()})},function(e,t){var r=document.createElement("div");r.style.display="none",r.style.background="#fdd",r.style.color="#000",r.style.whiteSpace="pre",r.style.fontFamily="monospace",r.style.position="fixed",r.style.zIndex=9999,r.style.padding="10px",r.style.left=0,r.style.right=0,r.style.top=0,r.style.bottom=0,r.style.overflow="auto",document.body&&document.body.appendChild(r),t.showProblems=function(e){r.innerHTML="",r.style.display="block",e.forEach(function(e){var t=document.createElement("div");t.textContent=e,r.appendChild(t)})},t.clear=function(){r.innerHTML="",r.style.display="none"}},function(e,t,r){(function(e){function t(){function e(){s.log&&console.log("[HMR] connected"),a=new Date}function r(e){if(a=new Date,"💓"!=e.data)try{o(JSON.parse(e.data))}catch(t){s.warn&&console.warn("Invalid HMR message: "+e.data+"\n"+t)}}function n(){clearInterval(u),i.close(),setTimeout(t,s.timeout)}var i=new window.EventSource(s.path),a=new Date;i.onopen=e,i.onmessage=r,i.onerror=n;var u=setInterval(function(){new Date-a>s.timeout&&n()},s.timeout/2)}function n(e,t){s.warn&&console.warn("[HMR] bundle has "+e+":");var r=[];t[e].forEach(function(e){var t=u(e);s.warn&&console.warn("[HMR] "+t),r.push(t)}),a&&"warnings"!==e&&a.showProblems(r)}function i(){a&&a.clear()}function o(e){"building"==e.action?s.log&&console.log("[HMR] bundle rebuilding"):"built"==e.action?(s.log&&console.log("[HMR] bundle rebuilt in "+e.time+"ms"),e.errors.length>0?n("errors",e):(e.warnings.length>0&&n("warnings",e),i(),l(e.hash,e.modules,s))):c&&c(e)}var s={path:"/__webpack_hmr",timeout:2e4,overlay:!0,reload:!1,log:!0,warn:!0};"undefined"==typeof window.EventSource?console.warn("webpack-hot-middleware's client requires EventSource to work. You should include a polyfill if you want to support this browser: https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events#Tools"):t();var a,u=r(522);s.overlay&&(a=r(519));var c,l=r(523);e&&(e.exports={subscribe:function(e){c=e}})}).call(t,r(524)(e))},function(e,t){"use strict";e.exports=function(){return/(?:(?:\u001b\[)|\u009b)(?:(?:[0-9]{1,3})?(?:(?:;[0-9]{0,3})*)?[A-M|f-m])|\u001b[A-M]/g}},function(e,t,r){"use strict";var n=r(521)();e.exports=function(e){return"string"==typeof e?e.replace(n,""):e}},function(e,t,r){function n(e){return e&&(i=e),i==r.h()}var i,o={abort:1,fail:1},s={ignoreUnaccepted:!0};e.exports=function(t,r,i){function a(){e.hot.check(function(t,r){return t?c(t):r?void e.hot.apply(s,function(e,t){return e?c(e):(n()||a(),void u(r,t))}):(i.warn&&(console.warn("[HMR] Cannot find update (Full reload needed)"),console.warn("[HMR] (Probably because of restarting the server)")),l(),null)})}function u(e,t){var o=e.filter(function(e){return t&&t.indexOf(e)<0});return o.length>0?(i.warn&&(console.warn("[HMR] The following modules couldn't be hot updated: (Full reload needed)"),o.forEach(function(e){console.warn("[HMR]  - "+r[e])})),void l()):void(i.log&&(t&&0!==t.length?(console.log("[HMR] Updated modules:"),t.forEach(function(e){console.log("[HMR]  - "+r[e])})):console.log("[HMR] Nothing hot updated."),n()&&console.log("[HMR] App is up to date.")))}function c(t){return e.hot.status()in o?(i.warn&&(console.warn("[HMR] Cannot check for update (Full reload needed)"),console.warn("[HMR] "+t.stack||t.message)),void l()):void(i.warn&&console.warn("[HMR] Update check failed: "+t.stack||t.message))}function l(){h&&(i.warn&&console.warn("[HMR] Reloading page"),window.location.reload())}var h=i.reload;n(t)||"idle"!=e.hot.status()||(i.log&&console.log("[HMR] Checking for updates on the server..."),a())}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){!function(){"use strict";function e(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function t(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){this.map={},e instanceof r?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function n(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function i(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function o(e){var t=new FileReader;return t.readAsArrayBuffer(e),i(t)}function s(e){var t=new FileReader;return t.readAsText(e),i(t)}function a(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(d.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(d.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(e){if(!d.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText=""},d.blob?(this.blob=function(){var e=n(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(o)},this.text=function(){var e=n(this);if(e)return e;if(this._bodyBlob)return s(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=n(this);return e?e:Promise.resolve(this._bodyText)},d.formData&&(this.formData=function(){return this.text().then(l)}),this.json=function(){return this.text().then(JSON.parse)},this}function u(e){var t=e.toUpperCase();return p.indexOf(t)>-1?t:e}function c(e,t){t=t||{};var n=t.body;if(c.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new r(e.headers)),this.method=e.method,this.mode=e.mode,n||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",(t.headers||!this.headers)&&(this.headers=new r(t.headers)),this.method=u(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function l(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function h(e){var t=new r,n=e.getAllResponseHeaders().trim().split("\n");return n.forEach(function(e){var r=e.trim().split(":"),n=r.shift().trim(),i=r.join(":").trim();t.append(n,i)}),t}function f(e,t){t||(t={}),this._initBody(e),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof r?t.headers:new r(t.headers),this.url=t.url||""}if(!self.fetch){r.prototype.append=function(r,n){r=e(r),n=t(n);var i=this.map[r];i||(i=[],this.map[r]=i),i.push(n)},r.prototype["delete"]=function(t){delete this.map[e(t)]},r.prototype.get=function(t){var r=this.map[e(t)];return r?r[0]:null},r.prototype.getAll=function(t){return this.map[e(t)]||[]},r.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},r.prototype.set=function(r,n){this.map[e(r)]=[t(n)]},r.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(r){this.map[r].forEach(function(n){e.call(t,n,r,this)},this)},this)};var d={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self},p=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];c.prototype.clone=function(){return new c(this)},a.call(c.prototype),a.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},f.error=function(){var e=new f(null,{status:0,statusText:""});return e.type="error",e};var m=[301,302,303,307,308];f.redirect=function(e,t){if(-1===m.indexOf(t))throw new RangeError("Invalid status code");return new f(null,{status:t,headers:{location:e}})},self.Headers=r,self.Request=c,self.Response=f,self.fetch=function(e,t){return new Promise(function(r,n){function i(){return"responseURL"in s?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):void 0}var o;o=c.prototype.isPrototypeOf(e)&&!t?e:new c(e,t);var s=new XMLHttpRequest;s.onload=function(){var e=1223===s.status?204:s.status;if(100>e||e>599)return void n(new TypeError("Network request failed"));var t={status:e,statusText:s.statusText,headers:h(s),url:i()},o="response"in s?s.response:s.responseText;r(new f(o,t))},s.onerror=function(){n(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials&&(s.withCredentials=!0),"responseType"in s&&d.blob&&(s.responseType="blob"),o.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send("undefined"==typeof o._bodyInit?null:o._bodyInit)})},self.fetch.polyfill=!0}}()}]);
//# sourceMappingURL=bundle.js.map